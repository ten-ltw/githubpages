<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[å]]></title>
  <link href="2019919.xyz/atom.xml" rel="self"/>
  <link href="2019919.xyz/"/>
  <updated>2021-05-07T18:07:17+08:00</updated>
  <id>2019919.xyz/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://www.mweb.im">MWeb</generator>

  
  <entry>
    <title type="html"><![CDATA[TypeScript]]></title>
    <link href="2019919.xyz/16203819997302.html"/>
    <updated>2021-05-07T18:06:39+08:00</updated>
    <id>2019919.xyz/16203819997302.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">TypeScript åŸºç¡€</h2>

<h3 id="toc_1">å‡½æ•°ç­¾åå’Œé‡è½½ Signature Overloading</h3>

<pre><code class="language-typescript">function contactPeople(method: &quot;email&quot;, ...people: HasEmail[]): void;
function contactPeople(method: &quot;phone&quot;, ...people: HasPhoneNumber[]): void;
function contactPeople(method: &quot;email&quot; | &quot;phone&quot;, ...people: (HasEmail | HasPhoneNumber)[]): void {
}
</code></pre>

<h3 id="toc_2">è¯æ³•ä½œç”¨åŸŸ Lexical Scope</h3>

<h4 id="toc_3">TODO</h4>

<h2 id="toc_4">Interfaces å’Œ type aliases</h2>

<h4 id="toc_5">TODO</h4>

<h2 id="toc_6">æ³›å‹ Generics</h2>

<h3 id="toc_7">æ³›å‹ä½¿ç”¨</h3>

<pre><code class="language-typescript">interface WrappedValue&lt;T&gt; {
  value: T;
}
let val: WrappedValue&lt;string[]&gt; = { value: [] };
val.value;
</code></pre>

<p>é¼ æ ‡æ‚¬åœåœ¨ <code>val.value</code> çš„ <code>value</code> ä¸Šå¯ä»¥çœ‹åˆ°ï¼š</p>

<blockquote>
<p>(property) WrappedValue<string[]>.value: string[]</p>
</blockquote>

<p>åœ¨å„ç§ç±»åº“çš„æè¿°æ–‡ä»¶ä¸­ä¹Ÿç»å¸¸èƒ½å¤Ÿçœ‹åˆ°æ³›å‹çš„åº”ç”¨ï¼š</p>

<pre><code class="language-typescript">interface MapLike&lt;T&gt; {
    [index: string]: T;
}
interface SortedReadonlyArray&lt;T&gt; extends ReadonlyArray&lt;T&gt; {
    &quot; __sortedArrayBrand&quot;: any;
}
interface SortedArray&lt;T&gt; extends Array&lt;T&gt; {
    &quot; __sortedArrayBrand&quot;: any;
}
</code></pre>

<h3 id="toc_8">æ³›å‹å‚æ•°</h3>

<p>ä¸Šè¿°æ–¹å¼åœ¨ä½¿ç”¨ WrappedValue æ—¶å¿…é¡»æ·»åŠ æ³›å‹å‚æ•°ï¼Œå¦‚æœä¸æ·»åŠ ä½¿ç”¨ä¼šæŠ¥é”™ï¼š</p>

<blockquote>
<p>Generic type &#39;WrappedValue<T>&#39; requires 1 type argument(s).</p>
</blockquote>

<p>è¿™é‡Œå¯ä»¥çœ‹åˆ° WrappedValue éœ€è¦ä¸€ä¸ªå®å‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºå…¶è®¾ç½®å‚æ•°é»˜è®¤å€¼ï¼Œå°±å¯ä»¥ä¸æä¾›ç±»å‹å‚æ•°ä¹Ÿèƒ½ä½¿ç”¨ WrappedValueï¼š</p>

<pre><code class="language-typescript">interface WrappedValue&lt;T = any&gt; {
  value: T;
}
let val: WrappedValue = { value: [] };
val.value;
</code></pre>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ³›å‹åšå‚æ•°çš„æƒ…å†µï¼š</p>

<pre><code class="language-typescript">function resolveOrTimeout&lt;T&gt;(promise: Promise&lt;T&gt;, timeout: number): Promise&lt;T&gt; { // =&gt; 1
  return new Promise&lt;T&gt;((resolve, reject) =&gt; { // =&gt; 2
    // start the timeout, reject when it triggers
    const task = setTimeout(() =&gt; reject(&quot;time up!&quot;), timeout); // =&gt; 3

    promise.then(val =&gt; {
      // cancel the timeout
      clearTimeout(task); // =&gt; 4                                    

      // resolve with the value // =&gt; 5
      resolve(val);                                            
    });
  });
}
</code></pre>

<ol>
<li>æ³›å‹ T è®¾å®šåï¼Œä¼šä¼ é€’ä¸€ä¸ªç±»å‹ä¸º Promise&lt;T&gt; åä¸º promise çš„å‚æ•°ã€‚</li>
<li>è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç±»å‹ä¸º Promise&lt;T&gt; çš„æ–° Promiseã€‚</li>
<li>æ ¹æ® timeout æ—¶é—´è®¾ç½®å®šæ—¶ï¼Œå¦‚æœæ—¶é—´åˆ°äº†ï¼Œæ‰§è¡Œ callbackï¼Œä¹Ÿå°±æ˜¯æ–°åˆ›å»ºçš„ Promise å°† rejectedã€‚</li>
<li>å¦‚æœ timeout è®¾å®šçš„æ—¶é—´æ²¡ç»ˆæ­¢ï¼Œä¼ å…¥çš„å‚æ•° promise æå‰ fulfilledï¼Œé‚£ä¹ˆç›´æ¥æ¸…é™¤å»¶æ—¶ã€‚</li>
<li>å°† fulfilled çš„å€¼ resolve åˆ°æ–°åˆ›å»ºçš„ Promise ä¸­ã€‚</li>
</ol>

<p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ Http è¯·æ±‚è¶…æ—¶çš„è§£å†³æ–¹æ¡ˆã€‚</p>

<h3 id="toc_9">çº¦æŸå’Œä½œç”¨åŸŸ Constraints Scope</h3>

<p>å¯ä»¥é€šè¿‡ extends æ¥çº¦æŸæ³›å‹ï¼š</p>

<pre><code class="language-typescript">function arrayToDict&lt;T extends { id: string }&gt;(array: T[]): { [k: string]: T } {
  const out: { [k: string]: T } = {};
  array.forEach(val =&gt; {
    out[val.id] = val;
  });
  return out;
}
</code></pre>

<p>å¦‚æœç”¨ä»¥ä¸‹ä»£ç å°†ä¸å¸¦æœ‰ id å±æ€§å¯¹è±¡çš„æ•°ç»„ä½œä¸º arrayToDict çš„å‚æ•°ï¼š</p>

<pre><code class="language-typescript">const myDict = arrayToDict([
  { foo: &quot;foo&quot; }
]);
</code></pre>

<p>å°±ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š</p>

<blockquote>
<p>Type &#39;{ foo: string; }&#39; is not assignable to type &#39;{ id: string; }&#39;.<br/>
  Object literal may only specify known properties, and &#39;foo&#39; does not exist in type &#39;{ id: string; }&#39;.</p>
</blockquote>

<p>è¿™é‡Œé™åˆ¶äº†æ³›å‹ T å†…å¿…é¡»æœ‰ string ç±»å‹çš„ id å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>val.id</code>ã€‚å¦‚æœå°†çº¦æŸ <code>extends { id: string }</code> åˆ é™¤ï¼Œå°±ä¼šçœ‹åˆ° <code>val.id</code> å‡ºç°ä¸‹é¢çš„é”™è¯¯ï¼š</p>

<blockquote>
<p>Property &#39;id&#39; does not exist on type &#39;T&#39;.</p>
</blockquote>

<p>æ³›å‹ç±»ä¼¼å‚æ•°ï¼ŒåŒæ ·äº«æœ‰å‡½æ•°å‚æ•°åŒæ ·çš„ä½œç”¨åŸŸï¼Œä¹Ÿå¯ä»¥åº”ç”¨åœ¨é—­åŒ…ä¸­ï¼š</p>

<pre><code class="language-typescript">function firstTuple&lt;T&gt;(firstElement: T) {
  return function finishTuple&lt;U&gt;(b: U) {
    return [a, b] as [T, U];
  };
}
const myTuple = startTuple([&quot;first&quot;])(42);
</code></pre>

<p>é¼ æ ‡æ‚¬åœåœ¨ myTuple ä¸Šå¯ä»¥çœ‹åˆ°è¯¥å…ƒç»„çš„ç±»å‹ï¼š</p>

<blockquote>
<p><strong>const</strong> myTuple: [string[], number]</p>
</blockquote>

<h3 id="toc_10">æ³›å‹çš„ä½¿ç”¨</h3>

<p>æ³›å‹åªæœ‰åœ¨ input å’Œ output åŒæ—¶éœ€è¦æ—¶æ‰ä½¿ç”¨ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ²¡æœ‰å¿…è¦ç”¨æ³›å‹çš„ä¾‹å­ï¼š</p>

<pre><code class="language-typescript">interface Shape {
  draw();
}

interface Circle extends Shape {
  radius: number;
}

function drawShapes1&lt;S extends Shape&gt;(shapes: S[]) {
  shapes.forEach(s =&gt; s.draw());
}

function drawShapes2(shapes: Shape[]) {
  // this is simpler. Above type param is not necessary
  shapes.forEach(s =&gt; s.draw());
}
</code></pre>

<p>æ–¹æ³• 2 å’Œæ–¹æ³• 1 èµ·åˆ°äº†åŒæ ·çš„æ•ˆæœï¼Œä½†æ˜¯è¾“å‡ºä¸å†éœ€è¦æ³›å‹ã€‚</p>

<p>ä½†æ˜¯å¦‚æœæœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼ŒShape ä¸­ä¸ä½†æœ‰ draw æ–¹æ³•ï¼Œè¿˜æœ‰æ˜¯å¦å·²ç»ç»˜åˆ¶çš„ Flagï¼Œå¹¶ä¸”æˆ‘è¦åœ¨ç»˜åˆ¶ä¹‹åå°† Shape å¯¹è±¡è¿”å›ï¼Œå°±å¯ä»¥ä½¿ç”¨æ³›å‹ï¼š</p>

<pre><code class="language-typescript">interface Shape {
  draw();
  isDrawn: boolean;
}

interface Circle extends Shape {
  radius: number;
}

function drawShapes&lt;S extends Shape&gt;(shapes: S[]): S[] {
  return shapes.map(s =&gt; {
    s.draw;
    s.isDrawn = true;
    return s;
  })
}
</code></pre>

<h2 id="toc_11">é¡¶å±‚ç±»å‹å’Œåº•å±‚ç±»å‹</h2>

<h3 id="toc_12">Top Types</h3>

<ul>
<li>any</li>
<li>unknow</li>
</ul>

<p>é¡¶å±‚ç±»å‹å¯ä»¥æ¥æ”¶ä»»ä½•ç±»å‹çš„å€¼ã€‚</p>

<p>unknow åœ¨ä¸ç¡®å®šç±»å‹æ—¶æ— æ³•è·å–å®ƒçš„å€¼ã€‚</p>

<pre><code class="language-typescript">let myUnknown: unknown = &quot;hello, unknown&quot;;

if (typeof myUnknown === &quot;string&quot;) {
  // in here, myUnknown is of type string
  myUnknown.split(&quot;, &quot;); // 
}
if (myUnknown instanceof Promise) {
  // in here, myUnknown is of type Promise&lt;any&gt;
  myUnknown.then(x =&gt; console.log(x));
}
</code></pre>

<blockquote>
<p>typeof åœ¨åˆ¤æ–­ nullã€arrayã€object æ—¶éƒ½æ˜¯ objectï¼Œéœ€è¦ç”¨ instanceof æ¥åˆ¤æ–­åŸå‹é“¾ã€‚</p>
</blockquote>

<h3 id="toc_13">Type Guards</h3>

<p>TypeScript çš„ç±»å‹åˆ¤æ–­è‡ªä¸Šè€Œä¸‹è¿›è¡Œï¼Œæ— æ³•åå‘æ¨æ–­ç±»å‹ï¼Œæ¯”å¦‚å‡½æ•°çš„å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ç±»å‹ï¼Œå³ä½¿åœ¨åé¢èµ‹å€¼ stringï¼Œå‚æ•°ç±»å‹ä»ç„¶æ˜¯ anyã€‚</p>

<p>å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼ç¡®è®¤å¤æ‚ç±»å‹ï¼š</p>

<pre><code class="language-typescript">function isHasEmail(x: any): x is HasEmail {
  return typeof x.name === &quot;string&quot; &amp;&amp; typeof x.email === &quot;string&quot;;
}
if (isHasEmail(myUnknown)) {
  // In here, myUnknown is of type HasEmail
  console.log(myUnknown.name, myUnknown.email);
}
</code></pre>

<p>åŒç†åˆ©ç”¨æ³›å‹æœ‰äº†ä¸‹é¢è¿™ç§é€šç”¨çš„ç±»å‹å®ˆå«ï¼š</p>

<pre><code class="language-typescript">function isDefined&lt;T&gt;(arg: T | undefined): arg is T {
  return typeof arg !== &quot;undefined&quot;;
}
</code></pre>

<h3 id="toc_14">Branded Types</h3>

<h4 id="toc_15">TODO</h4>

<h3 id="toc_16">Bottom Types</h3>

<p>never ä¸ªäººæ„Ÿè§‰æ²¡å•¥ç”¨ã€‚</p>

<h2 id="toc_17">é«˜çº§ç±»å‹</h2>

<h3 id="toc_18">keyof å’Œ typeof</h3>

<p>typeof æ˜¯ JavaScript å°±æœ‰çš„ç‰¹æ€§ã€‚</p>

<p>keyof å¯ä»¥ç›´æ¥è·å–æ¥å£çš„å±æ€§åã€‚</p>

<p>æ¥å£ä¹Ÿå¯ä»¥ç”¨å±æ€§è¡¨è¾¾å¼æ¥è·å–å¯¹åº”å±æ€§çš„ç±»å‹ã€‚</p>

<pre><code class="language-typescript">interface CommunicationMethods {
  email: HasEmail;
  phone: HasPhoneNumber;
  fax: { fax: number };
}

function contact&lt;K extends keyof CommunicationMethods&gt;(
  method: K,
  contact: CommunicationMethods[K] // ğŸ’¡turning key into value -- a *mapped type*
) {
  //...
}
type AllType = keyof CommunicationMethods;
let x: AllType = &#39;email&#39;;
type Email = CommunicationMethods[&#39;email&#39;];
</code></pre>

<h3 id="toc_19">Built-In ç±»å‹</h3>

<h4 id="toc_20">Partial</h4>

<pre><code class="language-typescript">/**
 * Make all properties in T optional
 */
type Partial&lt;T&gt; = {
    [P in keyof T]?: T[P];
};
</code></pre>

<p>è¿”å›æ–°çš„ç±»å‹ï¼Œå¹¶ä¸”æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯å¯é€‰é¡¹ã€‚</p>

<h4 id="toc_21">Pick</h4>

<pre><code class="language-typescript">type HasThen&lt;T&gt; = Pick&lt;Promise&lt;T&gt;, &quot;then&quot; | &quot;catch&quot;&gt;;

let hasThen: HasThen&lt;number&gt; = Promise.resolve(4);
hasThen.then;
</code></pre>

<p>è¿”å›ä¸€ä¸ªç±»å‹ï¼ŒæŒ‡å®šå…è®¸è®¿é—®çš„å±æ€§ã€‚</p>

<h4 id="toc_22">Extract</h4>

<h4 id="toc_23">Exclude</h4>

<h4 id="toc_24">Record</h4>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu 20.04Lts å®‰è£… HA]]></title>
    <link href="2019919.xyz/16201149334405.html"/>
    <updated>2021-05-04T15:55:33+08:00</updated>
    <id>2019919.xyz/16201149334405.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">è™šæ‹Ÿæœº Hyper-V</h2>

<p>å®‰è£… SSH server<br/>
<code>sudo apt-get install openssh-server</code><br/>
å…³é—­å›¾å½¢åŒ–ç•Œé¢ï¼Œä¸ºå•¥æ²¡ä¸‹ server ç‰ˆçš„...<br/>
<code>sudo apt-get install openssh-server</code></p>

<h2 id="toc_1">å®‰è£… HA</h2>

<p><a href="https://www.home-assistant.io/installation/linux#install-home-assistant-core">å®˜æ–¹å®‰è£…</a></p>

<p>åˆ‡æ¢ç”¨æˆ·<br/>
<code>sudo -u homeassistant -H -s</code></p>

<h2 id="toc_2">ç¬¬äºŒå¤©æ— æ³•æ‰¾åˆ° command</h2>

<p><code>export PATH=$PATH:/srv/homeassistant/bin</code><br/>
æ·»åŠ æŒ‡ä»¤è·¯å¾„åˆ°ç¯å¢ƒå˜é‡ã€‚<br/>
åªæ˜¯ä¸´æ—¶æ·»åŠ ï¼Œåœ¨ä¸‹é¢æ–‡ä»¶ä¸‹æ·»åŠ  USER ç¯å¢ƒå˜é‡<br/>
vi ~/.bashrc</p>

<p>é‡å¯<br/>
<code>systemctl reboot -i</code></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Windows10 å®‰è£… HomeAssistant]]></title>
    <link href="2019919.xyz/16200327308578.html"/>
    <updated>2021-05-03T17:05:30+08:00</updated>
    <id>2019919.xyz/16200327308578.html</id>
    <content type="html"><![CDATA[
<p>ä¸€ç›´æƒ³åŠ¨æ‰‹çš„æ™ºèƒ½å®¶å±…ç»ˆäºå¼€å§‹å•¦ã€‚<br/>
å®¶åº­ä½¿ç”¨ SMBï¼Œç”¨çš„ win10 åš serviceï¼Œå› æ­¤ç›´æ¥åœ¨ win10 ä¸Šè¿›è¡Œå®‰è£…ï¼Œæ–¹ä¾¿ç³»ç»Ÿå¤‡ä»½ã€‚</p>

<h2 id="toc_0">å®‰è£…æ’é›·</h2>

<p>è¿™é‡Œè¿˜ä¸ä¼š pythonï¼Œä¸çŸ¥é“è§£å†³åŸå› ã€‚</p>

<h3 id="toc_1">python ç¯å¢ƒå®‰è£…</h3>

<p><a href="https://www.python.org/downloads/">python ä¸‹è½½</a><br/>
æ³¨æ„å®‰è£…æ—¶æ·»åŠ ç¯å¢ƒå˜é‡ã€‚</p>

<h3 id="toc_2">HomeAssistant å®‰è£…</h3>

<p><code>pip3 install homeassistant</code></p>

<p>æŠ¥é”™ï¼š</p>

<pre><code class="language-text">Microsoft Visual C++ 14.0 is required
</code></pre>

<p>ä¸‹è½½ <a href="https://visualstudio.microsoft.com/zh-hans/visual-cpp-build-tools/">C++ ç”Ÿæˆå·¥å…·</a>ï¼Œå¹¶å®‰è£…é»˜è®¤é€‰ä¸­æ‰€æœ‰å†…å®¹â€”â€”4G+ã€‚</p>

<p>å†æ¬¡æŠ¥é”™ï¼š</p>

<pre><code class="language-text">ERROR: After October 2020 you may experience errors when installing or updating package
s. This is because pip will change the way that it resolves dependency conflicts. 

We recommend you use --use-feature=2020-resolver to test your packages with the new res
olver before it becomes the default.
</code></pre>

<p>å¥½çš„è¿™å›è§£å†³åŠæ³•éƒ½å‘Šè¯‰äº†ï¼Œæ‰§è¡Œï¼š<br/>
<code>pip3 install homeassistant --use-feature=2020-resolver</code></p>

<p>å®‰è£…æˆåŠŸï¼</p>

<h2 id="toc_3">HomeAssistant å¯åŠ¨</h2>

<h3 id="toc_4">å®‰è£… HomeAssistant Frontend</h3>

<p><code>pip3 install home-assistant-frontend</code></p>

<h3 id="toc_5">å¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨</h3>

<p><code>py -m homeassistant --open-ui</code></p>

<h2 id="toc_6">æ’é™¤è­¦å‘Šå’Œé”™è¯¯</h2>

<p>åœ¨é…ç½®çš„æ—¥å¿—ä¸­æŸ¥çœ‹å¼‚å¸¸ã€‚</p>

<h3 id="toc_7">è­¦å‘Š</h3>

<pre><code class="language-text">WARNING (MainThread) [scapy.runtime] No libpcap provider available ! pcap won&#39;t be used
</code></pre>

<p><a href="https://www.winpcap.org/install/default.htm">winpcap</a> ä»£æ›¿ Linux çš„ libpcapã€‚<br/>
å®‰è£…åï¼š</p>

<pre><code class="language-text">WARNING (MainThread) [scapy.runtime] WinPcap is now deprecated (not maintained). Please use Npcap instead
</code></pre>

<p>åˆè¦ä½¿ç”¨ <a href="https://nmap.org/npcap/#download">Npcap</a> æ›¿ä»£ï¼Œå…³é—­æœåŠ¡å¸è½½ Winpcap åå®‰è£…å¹¶é‡æ–°å¯åŠ¨æœåŠ¡ã€‚</p>

<h3 id="toc_8">é”™è¯¯</h3>

<pre><code class="language-text">Unable to install package PyNaCl==1.3.0: ERROR: Command errored out with exit status 1: command:
</code></pre>

<p>è§£å†³æ–¹æ¡ˆï¼š<br/>
<code>pip uninstall typing</code><br/>
<code>pip install pynacl==1.3.0</code></p>

<pre><code class="language-text">ERROR: Could not build wheels for pynacl which use PEP 517 and cannot be installed directly
</code></pre>

<p><code>pip install pep517</code></p>

<h3 id="toc_9">æ‰‹æœº App</h3>

<p>æ‰‹æœº app æ— æ³•ç™»é™†ï¼Œæç¤ºï¼š</p>

<blockquote>
<p>æœªåŠ è½½ mobile_app ç»„ä»¶ã€‚è¯·å°†å…¶æ·»åŠ åˆ°æ‚¨çš„é…ç½®ä¸­ï¼Œé‡æ–°å¯åŠ¨ Home Assistantï¼Œç„¶åé‡è¯•ã€‚</p>
</blockquote>

<p>è¿›å…¥ç³»ç»Ÿå‘ç°æç¤ºé…ç½® mobile_appï¼š<a href="https://www.home-assistant.io/integrations/mobile_app">DOC è·¯å¾„</a></p>

<h3 id="toc_10">æ— æ³•å®‰è£… HACS æ¢ linux</h3>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Angular ä¸­ RXJS çš„åº”ç”¨]]></title>
    <link href="2019919.xyz/16178761821381.html"/>
    <updated>2021-04-08T18:03:02+08:00</updated>
    <id>2019919.xyz/16178761821381.html</id>
    <content type="html"><![CDATA[
<p>è·Ÿéš Acme Product Management å·¥ç¨‹æ¥ç†è§£ RxJS åœ¨ Angular ä¸­çš„å“åº”å¼ç¼–ç¨‹ã€‚</p>

<h2 id="toc_0">åˆæ­¥æ¥è§¦ Reactive</h2>

<p>åœ¨ Angular çš„ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä½¿ç”¨ç¼–ç¨‹å¼æ¨¡å¼ï¼ˆprocedural patternï¼‰å®ç°ä»åç«¯æœåŠ¡å™¨è·å–æ•°æ®ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬å°è¯•å£°æ˜å¼å’Œå“åº”å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p>

<h3 id="toc_1">ä½¿ç”¨ Async Pipe</h3>

<p>component.tsï¼š</p>

<pre><code class="language-typescript">export class ProductListComponent implements OnInit, OnDestroy {
  pageTitle = &#39;Product List&#39;;
  errorMessage = &#39;&#39;;

  products: Product[] = [];
  sub: Subscription;

  constructor(private productService: ProductService) { }

  ngOnInit(): void {
    this.sub = this.productService.getProducts()
      .subscribe(
        products =&gt; this.products = products,
        error =&gt; this.errorMessage = error
      );
  }

  ngOnDestroy(): void {
    this.sub.unsubscribe();
  }
}
</code></pre>

<p>component.htmlï¼š</p>

<pre><code class="language-markup">      &lt;table class=&quot;table mb-0&quot;
             *ngIf=&quot;products&quot;&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th&gt;Product&lt;/th&gt;
            &lt;th&gt;Code&lt;/th&gt;
            &lt;th&gt;Category&lt;/th&gt;
            &lt;th&gt;Price&lt;/th&gt;
            &lt;th&gt;In Stock&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody *ngFor=&quot;let product of products&quot;&gt;
          &lt;tr&gt;
            &lt;td&gt;{{ product.productName }}&lt;/td&gt;
            &lt;td&gt;{{ product.productCode }}&lt;/td&gt;
            &lt;td&gt;{{ product.categoryId }}&lt;/td&gt;
            &lt;td&gt;{{ product.price | currency:&quot;USD&quot;:&quot;symbol&quot;:&quot;1.2-2&quot; }}&lt;/td&gt;
            &lt;td&gt;{{ product.quantityInStock }}&lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
</code></pre>

<p>åœ¨ä¸ä½¿ç”¨ RxJS çš„æƒ…å†µä¸‹ï¼Œéœ€è¦ subscribe æœåŠ¡ä¸­è·å–çš„ Observableï¼Œåœ¨å…¶ emit æ•°æ®æ—¶ï¼Œå°†å–å¾—åˆ°çš„æ•°æ®ç»‘å®šåˆ°å˜é‡ products ä¸Šï¼Œæ¨¡æ¿è·Ÿéšå˜é‡æ”¹å˜è€Œæ¸²æŸ“ã€‚</p>

<p>åœ¨ä½¿ç”¨ RxJS æ—¶å¯ä»¥ä½¿ç”¨ angular çš„ async pipe ç›´æ¥å°† Observable ç»‘å®šåˆ°æ¨¡æ¿ä¸­ï¼Œå˜æ›´æ£€æµ‹è¯†åˆ«åˆ° emit æ—¶ï¼Œä¼šè‡ªåŠ¨æ¸²æŸ“ç”»é¢ã€‚</p>

<p>component.tsï¼š</p>

<pre><code class="language-typescript">export class ProductListComponent implements OnInit, OnDestroy {
  pageTitle = &#39;Product List&#39;;
  errorMessage = &#39;&#39;;

  products$: Observable&lt;Product[]&gt;

  constructor(private productService: ProductService) { }

  ngOnInit(): void {
    this.products$ = this.productService.getProducts();
  }
}
</code></pre>

<p>component.htmlï¼š</p>

<pre><code class="language-markup">      &lt;table class=&quot;table mb-0&quot;
             *ngIf=&quot;products$ | async as products&quot;&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th&gt;Product&lt;/th&gt;
            &lt;th&gt;Code&lt;/th&gt;
            &lt;th&gt;Category&lt;/th&gt;
            &lt;th&gt;Price&lt;/th&gt;
            &lt;th&gt;In Stock&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody *ngFor=&quot;let product of products&quot;&gt;
          &lt;tr&gt;
            &lt;td&gt;{{ product.productName }}&lt;/td&gt;
            &lt;td&gt;{{ product.productCode }}&lt;/td&gt;
            &lt;td&gt;{{ product.categoryId }}&lt;/td&gt;
            &lt;td&gt;{{ product.price | currency:&quot;USD&quot;:&quot;symbol&quot;:&quot;1.2-2&quot; }}&lt;/td&gt;
            &lt;td&gt;{{ product.quantityInStock }}&lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
</code></pre>

<p>ä½¿ç”¨ async pipe çš„ä¼˜ç‚¹æœ‰å¦‚ä¸‹å‡ ç‚¹ï¼š</p>

<ul>
<li>Observable ä¼šåœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶è¢« subscribeã€‚</li>
<li>è¿”å›æ¯æ¬¡è¢« emit çš„å€¼ã€‚</li>
<li>å½“ä¸€ä¸ªæ–°çš„é¡¹ç›®è¢« emit æ—¶ï¼Œæ— è®ºä»»ä½•å˜æ›´æ£€æµ‹ç­–ç•¥ï¼ŒAngular éƒ½ä¼šæ„ŸçŸ¥åˆ°å˜æ›´å¹¶ä½œå‡ºå“åº”çš„ç”»é¢æ¸²æŸ“ã€‚</li>
<li>å½“ç»„ä»¶é”€æ¯æ—¶è‡ªåŠ¨ unsubscribeã€‚</li>
</ul>

<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸Šä¸ªå®ä¾‹ä¸­ä½¿ç”¨ async pipe åä¸åœ¨éœ€è¦ OnDestroy Hook çš„åŸå› ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦æ‰‹åŠ¨ unsubscribeã€‚</p>

<p>åœ¨æœªä½¿ç”¨ async pipe æ—¶ï¼Œsubscribe çš„ callback ä¸­çš„å¼‚å¸¸å¤„ç†ç›´æ¥é€šè¿‡ Observer çš„ error å›è°ƒæ¥å¤„ç†ï¼Œç›´æ¥åœ¨æ•è·åˆ°å¼‚å¸¸æ—¶å°†å¼‚å¸¸ message èµ‹å€¼åˆ°ä¸€ä¸ª errorMessage å˜é‡ä¸­ï¼Œä»¥æ’å€¼çš„æ–¹å¼æ˜¾ç¤ºåœ¨æ¨¡æ¿ä¸­ï¼Œé‚£ä½¿ç”¨ RxJS çš„å¼‚å¸¸å¤„ç†è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p>

<h3 id="toc_2">å¼‚å¸¸å¤„ç†</h3>

<p>åœ¨ Observable å‘ç”Ÿä»»ä½•å¼‚å¸¸æ—¶ï¼ŒcatchError å¯ä»¥æ•è·åˆ°å¼‚å¸¸ï¼Œä½¿ç”¨è¿™ä¸ªæ“ä½œç¬¦æˆ‘ä»¬å¯ä»¥ï¼š</p>

<ul>
<li>æ•è·å¼‚å¸¸åé‡æ–°æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</li>
<li>ä¹Ÿå¯ä»¥åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶æ›¿æ¢æ‰å¼‚å¸¸çš„ Observable ä½¿æ“ä½œç»§ç»­è¿›è¡Œã€‚</li>
</ul>

<h4 id="toc_3">æ›¿æ¢å¼‚å¸¸</h4>

<p>service.tsï¼š</p>

<pre><code class="language-typescript">  public getProducts(): Observable&lt;Product[]&gt; {
    return this.http.get&lt;Product[]&gt;(this.productsUrl)
      .pipe(
        catchError(err =&gt; {
          console.log(err);
          return of([{ id: 1, productName: &#39;cart&#39; },
                     { id: 2, productName: &#39;hammer&#39; }]);
        })
      );
  }
</code></pre>

<p>å¦‚ä¸Šåœ¨è·å– product æ•°æ®æ—¶ï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸å¯ä»¥æ•è·åè¿”å›ä¸€ç»„æ–°çš„æ•°æ®çš„ Observableï¼Œä½¿get è¯·æ±‚å¼‚å¸¸æ—¶ä»ç„¶èƒ½å¤Ÿè·å–åˆ°ä¸€ç»„å‡æ•°æ®ã€‚</p>

<blockquote>
<p>of å’Œ from éƒ½èƒ½å¤Ÿåˆ›å»º Observable</p>

<ul>
<li>of åˆ›å»ºçš„ Observable ä¼š emit æ¯ä¸€ä¸ªå®å‚</li>
<li>from çš„æœŸå¾…å®å‚æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒåˆ›å»ºçš„ Observable ä¼š emit æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ </li>
</ul>

<p><code>of(...apples)</code> ç­‰ä»·äº <code>from(apples)</code></p>
</blockquote>

<h4 id="toc_4">é‡æ–°æŠ›å‡ºå¼‚å¸¸</h4>

<p>service.tsï¼š</p>

<pre><code class="language-typescript">  public getProducts(): Observable&lt;Product[]&gt; {
    return this.http.get&lt;Product[]&gt;(this.productsUrl)
      .pipe(
        catchError(err =&gt; {
          console.log(err);
          return throwError(err);
        })
      );
  }
</code></pre>

<p>throwError å®é™…ä¸Šä¹Ÿæ˜¯ä¸ªåˆ›å»º Observable å‡½æ•°ï¼Œå®ƒåˆ›å»ºçš„ Observable æ²¡æœ‰ä»»ä½•é¡¹ç›®ï¼Œåª emit ä¸€ä¸ªå¼‚å¸¸é€šçŸ¥ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯å˜ç›¸çš„æ›¿æ¢å¼‚å¸¸ã€‚</p>

<h4 id="toc_5">ä½¿ç”¨ async pipe åå¦‚ä½•èµ‹å€¼ errorMessage</h4>

<p>component.ts</p>

<pre><code class="language-typescript">    this.products$ = this.productService.getProducts()
      .pipe(
        catchError(err =&gt; {
          this.errorMessage = err;
          return EMPTY;
        })
      );
</code></pre>

<p>åœ¨åˆå§‹åŒ–æ—¶ï¼Œå°† service çš„ products\( èµ‹å€¼ç»™ç»„ä»¶çš„ products\) æ—¶å¯ä»¥æ·»åŠ  catchError æ“ä½œç¬¦ï¼Œè¿™æ—¶å½“æ•è·å¼‚å¸¸æ—¶ï¼Œå°† service å¤„ç†åçš„å¼‚å¸¸ä¿¡æ¯èµ‹å€¼ç»™ errorMessageå˜é‡å¹¶æ˜¾ç¤ºåœ¨ç”»é¢ä¸­ã€‚</p>

<p>è¿™é‡Œè¿”å›äº† EMPTYï¼Œå®ƒæ˜¯ç©ºçš„ Observableï¼Œæ˜¯ RxJS ä¸­çš„å¸¸é‡ã€‚</p>

<pre><code class="language-typescript">import { EMPTY } from &#39;rxjs&#39;;
</code></pre>

<h3 id="toc_6">OnPush å˜æ›´æ£€æŸ¥ç­–ç•¥</h3>

<pre><code class="language-typescript">@Component({
  templateUrl: &#39;./product-list.component.html&#39;,
  styleUrls: [&#39;./product-list.component.css&#39;],
  changeDetection: ChangeDetectionStrategy.OnPush
})
</code></pre>

<p>å‚ç…§<a href="https://2019919.xyz/16164996860696.html">å˜æ›´æ£€æµ‹</a></p>

<p>å½“æ”¹å˜ä¸º OnPush å˜æ›´æ£€æŸ¥ç­–ç•¥æ—¶ï¼Œé€šè¿‡ç»‘å®šå˜é‡çš„æ¨¡æ¿å°±æ— æ³•è·Ÿéšå˜é‡å˜æ›´è€Œè¿›è¡Œæ¸²æŸ“ç”»é¢ã€‚</p>

<p>è¿™æ—¶éœ€è¦ä¸º errorMessage ä¹Ÿåˆ›å»ºä¸€ä¸ª Observableã€‚è¿™åœ¨åé¢åš reacting to Action æ—¶å†è¿›è¡Œä¿®æ”¹ã€‚</p>

<h3 id="toc_7">ä»£ç é‡æ„</h3>

<p>è¿™é‡Œä»£ç æ˜¯ç¨‹åºå¼ç¼–ç¨‹å®ç°çš„ï¼Œå¦‚æœä½¿ç”¨å£°æ˜å¼ç¼–ç¨‹ä¼šæœ‰æ€æ ·çš„æ•ˆæœå‘¢ï¼Ÿ</p>

<p>service.tsï¼š</p>

<pre><code class="language-typescript">  public products$: Observable&lt;Product[]&gt; = this.http.get&lt;Product[]&gt;(this.productsUrl)
    .pipe(
      catchError(this.handleError)
    );
</code></pre>

<p>component.ts</p>

<pre><code class="language-typescript">export class ProductListComponent {
  pageTitle = &#39;Product List&#39;;
  errorMessage = &#39;&#39;;

  products$ = this.productService.products$
    .pipe(
      catchError(err =&gt; {
        this.errorMessage = err;
        return EMPTY;
      })
    );

  constructor(private productService: ProductService) { }

  onAdd(): void {
    console.log(&#39;Not yet implemented&#39;);
  }

  onSelected(categoryId: string): void {
    console.log(&#39;Not yet implemented&#39;);
  }
}
</code></pre>

<p>æˆ‘ä»¬åœ¨ service ä¸­å£°æ˜ products\( Observableï¼Œå®ƒæ˜¯ç”¨æ¥è·å– products çš„æ•°æ®ï¼Œå¹¶ä¸ºå…¶æ·»åŠ äº†å¼‚å¸¸å¤„ç†ç®¡é“ã€‚ç„¶åï¼Œåœ¨ç»„ä»¶ä¸­æˆ‘ä»¬å£°æ˜å¯ä»¥ä¾›æ¨¡æ¿ä½¿ç”¨çš„ products\) å¹¶å°†å…¶å¼•ç”¨æŒ‡å‘ service å£°æ˜çš„ products\(ï¼ŒåŒæ—¶ä¹Ÿå†æ¬¡ä¸ºç»„ä»¶ä¸­çš„ products\) æ·»åŠ å¼‚å¸¸å¤„ç†ç®¡é“è·å–å¼‚å¸¸ä¿¡æ¯ä»¥ä¾›æ¨¡æ¿æ˜¾ç¤ºã€‚</p>

<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸ä½†çœç•¥äº†ä¹‹å‰çš„ OnDestroy Hookï¼Œç°åœ¨è¿ OnInit Hook ä¹Ÿå¯ä»¥çœç•¥äº†ï¼Œä»£ç ä¹Ÿå˜å¾—æ¸…æ™°ã€‚</p>

<h2 id="toc_8">æ„é€ æ•°æ®</h2>

<p>å¾ˆå¤šæ—¶å€™ï¼Œä»åç«¯æœåŠ¡å™¨è·å¾—çš„æ•°æ®å¹¶ä¸å®Œå…¨æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ¯”å¦‚ä¸‹é¢çš„æˆ‘ä»¬å¦‚æœæƒ³åœ¨è·å–çš„æ•°æ®ä¸­ï¼Œè®© Price ä¸Šæµ® 50%ã€‚è¿™æ—¶å€™å°±ç”¨åˆ°äº† map æ“ä½œç¬¦ã€‚</p>

<h3 id="toc_9">Mapping an Http Response</h3>

<p>RxJS çš„ map å°±åƒ JavaScript çš„ Array.prototype.map æ–¹æ³•ä¸€æ ·ï¼š</p>

<pre><code class="language-javascript">[1,2,3].map(num =&gt; num * 2) // [2,4,6]
</code></pre>

<p>é¦–å…ˆæˆ‘ä»¬è¦äº†è§£ä¸€ä¸ª Http Response Observable ä¼šè¿”å›ä»€ä¹ˆæ•°æ®ã€‚</p>

<pre><code class="language-typescript">this.http.get&lt;Product[]&gt;(this.productsUrl)
</code></pre>

<p>é€šè¿‡ Http get è¯·æ±‚ä¼šè¿”å›ä¸€ä¸ª Responseï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ª Http Response Observable åªä¼š emit ä¸€ä¸ª itemâ€”â€”Responseã€‚é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ map å°†æ— æ³•å¾—åˆ° Productï¼š</p>

<p><img src="2.png" alt=""/><img src="media/16178761821381/16178763228978.jpg" alt=""/></p>

<p>å¯ä»¥çœ‹åˆ° item æ˜¯ Product[] ç±»å‹ï¼Œæ‰€ä»¥ IDE æŠ¥é”™ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦å†å°† Product æ•°ç»„é€šè¿‡ Array.prototype.map æ–¹æ³•è¿›è¡Œ price ä¸Šæµ® 50%ï¼š</p>

<pre><code class="language-typescript">  public products$: Observable&lt;Product[]&gt; = this.http.get&lt;Product[]&gt;(this.productsUrl)
    .pipe(
      map(products =&gt; products.map(
        product =&gt; product.price * 1.5
      ))
      catchError(this.handleError)
    );
</code></pre>

<p>å›é¡¾ä¸€ä¸‹ map æ–¹æ³•ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯å›è°ƒå‡½æ•°è¿”å›å€¼ç»„æˆçš„æ•°ç»„ï¼Œè¿™é‡Œçš„ callback è¿”å›å€¼æ˜¯ <code>product.price * 1.5</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨ products$ çš„ç±»å‹æ˜¯ Observable<number[]>ï¼Œæœç„¶ IDE ä¹Ÿå†æ¬¡æŠ¥é”™ï¼Œé‚£è¿™å›æˆ‘ä»¬å¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿ</p>

<h3 id="toc_10">æ”¹é€ æ•°ç»„å…ƒç´ </h3>

<p>æˆ‘ä»¬éœ€è¦çš„æ˜¯ Array.prototype.map çš„ callback è¿”å› Productï¼Œè€Œä¸æ˜¯ numberï¼Œé‚£æˆ‘ä»¬éœ€è¦å°†å…¶è¿”å›å€¼æ„é€ æˆ Product ç±»å‹ï¼š</p>

<pre><code class="language-typescript">  public products$: Observable&lt;Product[]&gt; = this.http.get&lt;Product[]&gt;(this.productsUrl)
    .pipe(
      map(products =&gt; products.map(
        product =&gt; ({
          ...product,
          price: product.price * 1.5,
          searchKey: [product.productName],
        }) as Product
      )),
      catchError(this.handleError)
    );
</code></pre>

<p>è¿™é‡Œä½¿ç”¨äº†å¯¹è±¡å­—é¢é‡çš„å±•å¼€æ“ä½œç¬¦ <code>...</code>ï¼Œå°† product å±•å¼€åˆ°å¯¹è±¡å­—é¢é‡ä¸­ï¼Œå¹¶é‡å†™ price å±æ€§ã€‚ </p>

<h2 id="toc_11">ç»„åˆ Streams</h2>

<p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦å¤šä¸ªæ•°æ®é›†åˆï¼Œå¹¶ç»„åˆå®ƒä»¬çš„ Observable æ•°æ®æµä¸ºåŒä¸€ä¸ªæ•°æ®æµã€‚</p>

<p>å¦‚ä¸‹é¢è¿™ä¸ªåœºæ™¯çš„ Categoryï¼š</p>

<p><img src="media/16178761821381/16178762876466.jpg" alt=""/></p>

<p>æˆ‘ä»¬çš„ Products æ•°æ®æµä¸­æœ‰ Category çš„ Idï¼Œä½†æ˜¯åœ¨ç”»é¢æ˜¾ç¤ºä¸­ï¼Œæˆ‘ä»¬æƒ³è¦è· Id æ‰€å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œè¿™æ—¶å€™å°±éœ€è¦å°† Products æ•°æ®æµå’Œ Categories çš„æ•°æ®æµç»„åˆåˆ°ä¸€èµ·ã€‚</p>

<blockquote>
<p>Combining Functionï¼š</p>

<ul>
<li>combineLatest</li>
<li>forkJoin</li>
</ul>

<p>Combining Operatorï¼š</p>

<ul>
<li>withLatestFrom</li>
</ul>
</blockquote>

<h3 id="toc_12">å°† Id æ˜ å°„ä¸º String</h3>

<p>è¿™é‡Œä½¿ç”¨ Http get Request è·å– Categorise æ•°æ®ï¼š</p>

<pre><code class="language-typescript">public productCategories$ = this.http.get&lt;ProductCategory[]&gt;(this.productCategoriesUrl);
</code></pre>

<p>å¯ä»¥çœ‹å‡ºç”¨ä¸Šé¢ä¸‰ç§ç»„åˆæ–¹å¼éƒ½ä¼šå¾—åˆ°åŒæ ·çš„ç»“æœï¼š</p>

<p><img src="media/16178761821381/16178763640436.jpg" alt=""/></p>

<p>ä½¿ç”¨ combineLatest æ–¹æ³•ç»„åˆä¸¤ä¸ª Observableï¼š</p>

<pre><code class="language-typescript">  public productsWithCategory$ = combineLatest([
    this.products$,
    this.productCategoryService.productCategories$
  ]).pipe(
    map(([products, categories]) =&gt; products.map(
      product =&gt; ({
        ...product,
        price: product.price * 1.5,
        category: categories.find(c =&gt; product.categoryId === c.id).name,
        searchKey: [product.productName],
      }) as Product
    ))
  )
</code></pre>

<p>è¿™é‡Œ <code>map(([products, categories]) =&gt; {})</code> ä½¿ç”¨äº†è§£æ„çš„æ–°ç‰¹æ€§ï¼Œç›´æ¥ç”¨æ•°ç»„ [products, categories] æ˜ å°„äº†æ¥æ”¶åˆ°çš„ç»“æœã€‚</p>

<h2 id="toc_13">æ´»åŠ¨å“åº”</h2>

<p>åº”ç”¨ç¨‹åºä¼šæœ‰å¾ˆå¤šç”¨æˆ·æ´»åŠ¨å“åº”ï¼Œæ¯”å¦‚ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ï¼Œé€‰æ‹©æ ‡ç­¾ç­‰ã€‚åœ¨è¿™ä¸ª APM å®ä¾‹ä¸­ï¼Œå¦‚æœæƒ³è¦åœ¨åˆ—è¡¨ä¸­è¿›è¡Œè¿‡æ»¤ï¼Œé‚£å°±éœ€è¦æˆ‘ä»¬çš„åˆ—è¡¨æ•°æ®æµå“åº”ç”¨æˆ·çš„ä¸‹æ‹‰åˆ—è¡¨æ¡†çš„é€‰æ‹©è¡Œä¸ºï¼Œæ¥ä¸‹æ¥å­¦ä¹  RxJS çš„æ´»åŠ¨å“åº”ã€‚</p>

<h3 id="toc_14">è¿‡æ»¤å“åº”</h3>

<h4 id="toc_15">ä¸º products æ·»åŠ  filter</h4>

<p>æ ¹æ®å‰é¢çš„ RxJS çš„ map æ“ä½œç¬¦åµŒå¥— Array.prototype.mapï¼Œè¿™æ¬¡ä½¿ç”¨ Array.prototype.filter æ¥åš products çš„æ•°æ®è¿‡æ»¤ä»£ç å¦‚ä¸‹ï¼š</p>

<p>component.ts:</p>

<pre><code class="language-typescript">  productsSimpleFilter$ = this.productService.productsWithCategory$
    .pipe(
      map(products =&gt; products.filter(product =&gt;
        this.selectedCategoryId ? product.categoryId === this.selectedCategoryId : true
      ))
    )

  private selectedCategoryId: number = 1;
</code></pre>

<p>å®šä¹‰ selectedCategoryId å˜é‡ç”¨æ¥è·å–ç”»é¢ç”¨æˆ· action å€¼ï¼Œå¹¶é€šè¿‡ filter è¿‡æ»¤ç»“æœï¼Œè¿™é‡Œä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦æ¥é˜²æ­¢ selectedCategoryId ä¸ºç©ºï¼Œå½“å…¶ä¸º null æˆ– undefined æ—¶ä¸æ·»åŠ è¿‡æ»¤ã€‚</p>

<p>åœ¨æ¨¡æ¿ä¸­ç»‘å®š productsSimpleFilter$ åï¼Œæœç„¶ç”»é¢ä¸Šèƒ½å¤Ÿè¿‡æ»¤æ‰ categoryId ä¸ç­‰äº 1 çš„æ•°æ®ã€‚</p>

<h4 id="toc_16">ç»‘å®š Categories æ•°æ®</h4>

<p>æ ¹æ®ä¸Šé¢æ‰€å­¦ç»‘å®š Category select æ ‡ç­¾çš„ optionã€‚</p>

<p>component.tsï¼š</p>

<pre><code class="language-typescript">  categories$ = this.productCategoryService.productCategories$
    .pipe(
      catchError(err =&gt; {
        this.errorMessage = err;
        return EMPTY;
      })
    );
...
  onSelected(categoryId: string): void {
    this.selectedCategoryId = +categoryId;
  }

</code></pre>

<p>component.htmlï¼š</p>

<pre><code class="language-markup">&lt;select class=&quot;form-control&quot;
        (change)=&quot;onSelected($event.target.value)&quot;&gt;
    &lt;option value=&quot;0&quot;&gt;- Display All -&lt;/option&gt;
    &lt;option *ngFor=&quot;let category of categories$ | async&quot;
        [value]=&quot;category.id&quot;&gt;{{ category.name }}&lt;/option&gt;
&lt;/select&gt;
</code></pre>

<p>ä¸º select æ·»åŠ  onSelected äº‹ä»¶æ–¹æ³•ï¼Œè¿™é‡Œä½¿ç”¨ <code>+</code> å·å°†å­—ç¬¦ä¸²éšå¼è½¬æ¢ä¸ºæ•°å­—ã€‚</p>

<p>ä½†æ˜¯ç”»é¢åˆ·æ–°åå‘ç° select é€‰æ‹©ä¸åŒçš„ category æ—¶å¹¶ä¸èƒ½ä½¿åˆ—è¡¨æ•°æ®å˜æ›´ï¼Œé‚£æˆ‘ä»¬è¯¥å¦‚ä½•é€šçŸ¥æˆ‘ä»¬çš„ stream æ¥å“åº”ç”¨æˆ·çš„æ´»åŠ¨å‘¢ï¼Ÿ</p>

<h4 id="toc_17">Data Stream å’Œ Action Stream</h4>

<p>ä»¥ Http è¯·æ±‚è·å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª Responseï¼Œå®ƒåªæœ‰ä¸€ä¸ª Itemï¼Œè¿™æ—¶è¿™ä¸ª Observable åŸºæœ¬ä¸Šè¯´å·²ç»ç»“æŸäº†å®ƒçš„ä½¿å‘½ï¼Œæœ‰äº†æ•°æ®åæˆ‘ä»¬ä¸å†éœ€è¦å®ƒï¼Œè¿™ç§ Stream æˆ‘ä»¬ç§°ä¸º Data Streamã€‚</p>

<p>åœ¨ç”¨æˆ·ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªæ´»åŠ¨å¯èƒ½é¢‘ç¹è§¦å‘ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç›´è®¢é˜…è¿™ç§ Observableï¼Œå“åº”æ¯æ¬¡ç”¨æˆ·çš„æ´»åŠ¨ï¼Œè¿™ç§ Stream æˆ‘ä»¬ç§°ä¸º Action Streamã€‚</p>

<p>combineLatest çš„ç‰¹ç‚¹æ˜¯ï¼š</p>

<ul>
<li>ä¼šç­‰åˆ°æ‰€æœ‰çš„ Observable éƒ½ emit ä¸€æ¬¡æ•°æ®ä¹‹åæ‰å¼€å§‹ emit æ•°æ®ã€‚</li>
<li>åœ¨æ”¶é›†å®Œä¸€æ¬¡æ•°æ®ä¹‹åï¼Œä»»ä½•ä¸€ä¸ª Observable emit æ•°æ®ï¼Œéƒ½ä¼š emit æ•°æ®ï¼Œå¹¶ä¸ä¼šå†æ¬¡ç­‰å¾…æ‰€æœ‰ Observable å†æ¬¡ emit æ•°æ®ã€‚</li>
</ul>

<p>å¼¹ç å›¾å¦‚ä¸‹ï¼š</p>

<p><img src="media/16178761821381/16178764373479.jpg" alt=""/></p>

<p>è¿™æ ·å°±èƒ½åŒæ—¶å°è£… Data Stream å’Œ Action Streamã€‚</p>

<p>åˆ›å»º Action Stream æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š</p>

<ol>
<li>ä½¿ç”¨å†…ç½® streamï¼Œä¾‹å¦‚ form è¡¨å•çš„ value changesã€‚</li>
<li>fromEvent</li>
<li>Subject/BehaviorSubject</li>
</ol>

<p>ç¬¬ä¸‰ç§æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚</p>

<h4 id="toc_18">Subject å’Œ BehaviorSubject</h4>

<p>Subject æ˜¯çš„ç‰¹æ®Š Observableï¼Œä¹Ÿæ˜¯ä¸€ä¸ª Observer ï¼Œå®ƒå¯ä»¥å¤šæ’­ã€‚</p>

<p>BehaviorSubject æ˜¯ç‰¹æ®Šçš„ Subjectï¼Œå®ƒåœ¨æ„é€ æ—¶å¿…é¡»æœ‰åˆå§‹å€¼ã€‚</p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ combineLatest ç»„åˆ Data Stream å’Œ Subject åˆ›å»ºçš„ Action Streamã€‚</p>

<p>component.ts</p>

<pre><code class="language-typescript">  private categorySelectedSubject = new Subject&lt;number&gt;();
  categorySelectedAction$ = this.categorySelectedSubject.asObservable();

  products$ = combineLatest([
    this.productService.productsWithCategory$,
    this.categorySelectedAction$
  ])
    .pipe(
      map(([products, selectedCategoryId]) =&gt; products.filter(product =&gt;
        selectedCategoryId ? product.categoryId === selectedCategoryId : true
      )),
      catchError(err =&gt; {
        this.errorMessage = err;
        return EMPTY;
      })
    );

  onSelected(categoryId: string): void {
    this.categorySelectedSubject.next(+categoryId);
  }
</code></pre>

<p>ç»‘å®š Data Stream å’Œ Action Stream çš„ä¸‰éƒ¨ï¼š</p>

<ol>
<li>åˆ›å»ºå¯æ’­çš„ Observableã€‚</li>
<li>ç»„åˆ Data Stream å’Œ Action Streamã€‚</li>
<li>è§¦å‘ Action çš„ next æ–¹æ³•ã€‚</li>
</ol>

<p>åˆ·æ–°ç”»é¢å·²ç»å¯ä»¥çœ‹åˆ°åœ¨ select æ ‡ç­¾é€‰æ‹©ä¸åŒçš„ category æ—¶ï¼Œåˆ—è¡¨ä¸­çš„æ•°æ®å·²ç»èƒ½å¤Ÿè¿‡æ»¤ï¼Œä½†æ˜¯ç”»é¢åˆå§‹åŒ–æ—¶æ²¡æœ‰æ•°æ®ã€‚</p>

<p>å›é¡¾ä¸‹ combineLatest çš„å¼¹ç å›¾ï¼Œå¿…é¡»æ¯ä¸ª Observable éƒ½ emit æ—¶ï¼Œç»„åˆå Stream æ‰ä¼š emit é¡¹ç›®ï¼Œè€Œæˆ‘ä»¬æ²¡æœ‰é€‰æ‹© option æ—¶ï¼ŒAction Stream å¹¶æ²¡æœ‰ emit ä»»ä½•é¡¹ç›®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ä¼šæ¥æ”¶åˆ°æ•°æ®ã€‚æ¥ä¸‹æ¥å­¦ä¹ å¦‚ä½•è®¾ç½®åˆå§‹å€¼ã€‚</p>

<h4 id="toc_19">è®¾ç½®åˆå§‹å€¼</h4>

<p>startWith æ“ä½œç¬¦ï¼Œå¯ä»¥ç›´æ¥ä¸º Action Stream æ·»åŠ  startWith æ“ä½œçš„ç®¡é“ï¼š</p>

<pre><code class="language-typescript">this.categorySelectedAction$.pipe(startWith(0))
</code></pre>

<p>æœç„¶è¿™å›ç”»é¢åˆå§‹åŒ–æ—¶å°±èƒ½æ˜¾ç¤ºæ‰€æœ‰çš„ products äº†ã€‚</p>

<p>BehaviorSubject æ˜¯æœ‰åˆå§‹å€¼çš„ Subjectï¼Œè¿™é‡ŒåŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨ BehaviorSubject æ¥å®ç°ï¼š</p>

<pre><code class="language-typescript">  private categorySelectedSubject = new BehaviorSubject&lt;number&gt;(0);
  categorySelectedAction$ = this.categorySelectedSubject.asObservable();
</code></pre>

<p>åˆ·æ–°ç”»é¢ï¼ŒåŒæ ·ä¹ŸæˆåŠŸä¿®å¤æ­¤åŠŸèƒ½ã€‚</p>

<h3 id="toc_20">å“åº”å¼‚å¸¸</h3>

<p>å‰é¢å°†å˜æ›´æ£€æµ‹ç­–ç•¥æ”¹ä¸ºäº† OnPushï¼Œå¯¼è‡´æˆ‘ä»¬ç»‘å®šçš„å˜é‡å·²ç»ä¸èƒ½è¢«æ£€æµ‹å™¨æ‰€æ£€æµ‹ï¼Œé‚£ä¹ˆå°±éœ€è¦å°†å˜é‡ç¼–ç¨‹ä¸€ä¸ª Observableã€‚</p>

<p>æˆ‘ä»¬çš„ errorMessage ä¸ä¼šåƒ Data Stream ä¸€æ ·åªä½¿ç”¨ä¸€æ¬¡ï¼Œè€Œæ˜¯ä¸€ä¸ªä¼šé¢‘ç¹å‘ç”Ÿçš„ Action Streamï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©ä½¿ç”¨ Subject æ¥å®ç°ã€‚</p>

<p>component.ts</p>

<pre><code class="language-typescript">  private errorMessageSubject = new Subject();
  public errorMessageAction$ = this.errorMessageSubject.asObservable();

  public products$ = this.productService.productsWithCategory$
    .pipe(
      catchError(err =&gt; {
        this.errorMessageSubject.next(err);
        return EMPTY;
      })
    );
</code></pre>

<p>component.html</p>

<pre><code class="language-typescript">&lt;div class=&quot;alert alert-danger&quot;
     *ngIf=&quot;errorMessageAction$ | async as errorMessage&quot;&gt;
  {{errorMessage}}
&lt;/div&gt;
</code></pre>

<h3 id="toc_21">æ·»åŠ å“åº”</h3>

<p>åº”ç”¨ merge ç»„åˆå‡½æ•°å’Œ scan æ“ä½œç¬¦ã€‚<br/>
merge å°† products çš„ Data Stream å’Œæ·»åŠ æ“ä½œçš„ Action Stream è¿æˆä¸€ä¸²ï¼Œemit çš„ç¬¬ä¸€ä¸ªé¡¹ç›®æ˜¯å–å›çš„å…¨éƒ¨æ•°æ®ï¼Œemit çš„ç¬¬äºŒä¸ªé¡¹ç›®æ˜¯æ·»åŠ çš„æ–° product æ•°æ®ã€‚é€šè¿‡ scan æ“ä½œç¬¦å°†ç¬¬äºŒä¸ªé¡¹ç›®æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªé¡¹ç›®ä¸­å¹¶è¾“å‡ºã€‚</p>

<p>service.ts</p>

<pre><code class="language-typescript">  public productsWithAdd$ = merge(this.productsWithCategory$, this.productInsertedAction$)
    .pipe(
      scan((products: Product[], insertedProduct: Product) =&gt; [...products, insertedProduct])
    )
</code></pre>

<p>è¿™é‡Œä½¿ç”¨äº†æ•°ç»„çš„å±•å¼€æ“ä½œç¬¦ <code>...</code> å°† products æ‹·è´åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚</p>

<h2 id="toc_22">æœ€å</h2>

<p><a href="https://github.com/ten-ltw/Angular-RXJS">ä»£ç </a></p>

<p><a href="https://github.com/WangYuLue/simple-rxjs">RxJSæ¨¡æ‹Ÿå®ç°</a></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ng-fundamentals åŸºç¡€å†…å®¹æŸ¥ç¼ºè¡¥æ¼]]></title>
    <link href="2019919.xyz/16175910817779.html"/>
    <updated>2021-04-05T10:51:21+08:00</updated>
    <id>2019919.xyz/16175910817779.html</id>
    <content type="html"><![CDATA[
<h2 id="toc_0">ç»„ä»¶</h2>

<pre><code class="language-javascript">@Component({
  selector: &#39;events-app&#39;,
  template: `
    &lt;h2&gt;Hello world&lt;/h2&gt;
    &lt;img src=&quot;/assets/images/basic-shield.png&quot;/&gt;
  `
})
</code></pre>

<p>èµ„æºè·¯å¾„ç›¸å¯¹äº index.htmlï¼Œä¸èƒ½ä½¿ç”¨é™æ€è·¯å¾„è®¿é—®æ–‡ä»¶ã€‚</p>

<p>webpack éœ€è¦åœ¨ç¼–è¯‘ app æ—¶çŸ¥é“å“ªä¸€ä¸ªæ–‡ä»¶è¦è¢«æ†ç»‘ï¼Œåœ¨ angular.json ä¸­è®¾ç½®ï¼š</p>

<pre><code class="language-javascript">&quot;options&quot;: {
    &quot;outputPath&quot;: &quot;dist/ng-fundamentals&quot;,
    &quot;index&quot;: &quot;src/index.html&quot;,
    &quot;main&quot;: &quot;src/main.ts&quot;,
    &quot;polyfills&quot;: &quot;src/polyfills.ts&quot;,
    &quot;tsConfig&quot;: &quot;tsconfig.app.json&quot;,
    &quot;aot&quot;: true,
    &quot;assets&quot;: [
        &quot;src/favicon.ico&quot;,
        &quot;src/assets&quot;
    ],
</code></pre>

<p>ç»„ä»¶éœ€è¦åœ¨æ¨¡å—ä¸Šæ³¨å†Œ angular æ‰çŸ¥é“å»å“ªé‡Œè·å–ç»„ä»¶èµ„æºã€‚</p>

<p>ç»„ä»¶æœ‰ä¸€ä¸ª class åŒ…å«æ‰€æœ‰ç»„ä»¶é€»è¾‘å’Œå†…å®¹ã€‚</p>

<h2 id="toc_1">Angular æ¨¡æ¿è¯­æ³•</h2>

<h3 id="toc_2">æ¨¡æ¿å˜é‡</h3>

<p><code>#æ ‡è¯†ç¬¦</code> æ¨¡æ¿å˜é‡å¯ä»¥åœ¨æ¨¡æ¿çš„ä»»ä½•ä½ç½®è®¿é—®ï¼š</p>

<pre><code class="language-markup">&lt;event-thumbnail #thumbnnail [event]=&quot;events&quot; (eventClick)=&quot;handleEventClicked($event)&quot;&gt;&lt;/event-thumbnail&gt;
&lt;button class=&quot;btn btn-primary&quot; (click)=&quot;thumbnnail.logFoo()&quot;&gt;Log me some foo&lt;/button&gt;
</code></pre>

<p>å¯ä»¥åœ¨ HTML ä¸­é€šè¿‡ç»„ä»¶çš„æ¨¡æ¿å˜é‡è®¿é—®å­ç»„ä»¶ä¸­çš„æˆå‘˜å˜é‡å’Œæˆå‘˜æ–¹æ³•ã€‚</p>

<h3 id="toc_3">ç»“æ„æŒ‡ä»¤</h3>

<p>* æ˜Ÿå·ä»£è¡¨ç»“æ„æŒ‡ä»¤</p>

<p>ç»“æ„æŒ‡ä»¤æ”¹å˜ DOM çš„å½¢çŠ¶ï¼Œå®ƒä¸æ˜¯éšè— DOM è€Œæ˜¯æ·»åŠ æˆ–åˆ é™¤ DOMã€‚</p>

<blockquote>
<p>safe navigation operator ?</p>

<p>?. ä»¥è¿™ç§æ“ä½œç¬¦ç»‘å®šæ•°æ®ï¼Œé¢„é˜² undefined</p>
</blockquote>

<p>*ngIf åœ¨ç”»é¢å±¡æ¬¡æ˜¾ç¤ºéšè— DOM æ—¶ä¼šæ¶ˆè€—è¿‡å¤§ï¼Œè¿™æ—¶å€™åº”è¯¥ä½¿ç”¨ hidden å±æ€§ï¼Œç”»é¢åˆå§‹åŒ–åä¸å˜é€‰ç”¨ *ngIfã€‚</p>

<h3 id="toc_4">ng ç»‘å®š class</h3>

<h4 id="toc_5">class binding</h4>

<pre><code class="language-markup">&lt;span [class.green]=&quot;event?.time === &#39;8:00 am&#39;&quot;&gt;{{event?.time}}&lt;/span&gt;
</code></pre>

<h4 id="toc_6">ngClass</h4>

<pre><code class="language-markup">&lt;span [ngClass]=&quot;{green: event?.time === &#39;8:00 am&#39;, bold: event?.time === &#39;8:00 am&#39;}&quot;&gt;{{event?.time}}&lt;/span&gt;
</code></pre>

<p>ngClass å‚æ•°å¯ä»¥æ˜¯å‡½æ•°ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ {classKeyï¼šboolean,â€¦} æˆ–ç©ºæ ¼åˆ†éš”å­—ç¬¦ä¸² &#39;green bold&#39; æˆ–è€… class æ•°ç»„ [&#39;green&#39; , &#39;bold&#39;]ã€‚</p>

<h3 id="toc_7">ng ç»‘å®š style</h3>

<h4 id="toc_8">style binding</h4>

<pre><code class="language-markup">&lt;span [style.color]=&quot;event?.time === &#39;8:00 am&#39; ? &#39;#003300&#39; : &#39;#bbb&#39;&quot;&gt;{{event?.time}}&lt;/span&gt;
</code></pre>

<h4 id="toc_9">ngStyle</h4>

<p>[ngStyle] åé¢æ¥å¯¹è±¡ {ä¸‰å…ƒè¿ç®—ï¼Œä¸‰å…ƒè¿ç®—}ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‡½æ•°è¿”å›æ ·å¼å¯¹è±¡ã€‚</p>

<h3 id="toc_10">æ¨¡æ¿è¡¨è¾¾å¼çº¦æŸ</h3>

<p>ä»¥ä¸‹å†…å®¹ä¸å…è®¸ä½¿ç”¨ï¼š</p>

<ul>
<li>Assignmentï¼ˆ=,+=,==,etcï¼‰</li>
<li>new Keyword</li>
<li>Expression Chaining With ;</li>
<li>Global Namespace</li>
</ul>

<p>æ€»ç»“æ¥è¯´å°±æ˜¯ä¸å…è®¸äº§ç”Ÿå‰¯ä½œç”¨ï¼Œä¸å…è®¸ä½¿ç”¨ global å‘½åç©ºé—´å†…çš„æˆå‘˜ã€‚</p>

<h2 id="toc_11">æœåŠ¡</h2>

<h3 id="toc_12">æœåŠ¡</h3>

<pre><code class="language-typescript">@Injectable()
constructor(private eventService: EventService) {    
}
</code></pre>

<p>è¿™é‡Œçš„å®é™…ä¸Šæ˜¯ä¸ªç®€å†™ï¼Œå…¨æ–‡ï¼š</p>

<pre><code class="language-typescript">@Injectable()
private eventService: EventService;
constructor(private _eventService: EventService) {
    this.eventService = _eventService;
}
</code></pre>

<p>ä¸è¦åœ¨ç»„ä»¶æ„é€ å‡½æ•°ä¸­æ·»åŠ è¿‡å¤šé€»è¾‘ï¼Œåº”è¯¥å°†é€»è¾‘æ”¾åˆ°ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­ã€‚</p>

<p><code>implements OnInit</code> æ˜¯ typeScriptï¼Œåªæ˜¯è¯­æ³•ä¸Šä¸¥è°¨ï¼Œå¹¶ä¸æ˜¯å¿…é¡»çš„ã€‚</p>

<h3 id="toc_13">å¼•å…¥ç¬¬ä¸‰æ–¹åº“</h3>

<p>å¼•å…¥ toastr æ—¶ï¼Œåœ¨ä¸Šé¢å£°æ˜äº†ä¸€ä¸ª toastr ï¼š</p>

<pre><code class="language-typescript">declare let toastr: any;
</code></pre>

<p>å®é™…ä¸Šï¼Œåœ¨ angular.json ä¸­å·²ç»æ·»åŠ äº† toastr çš„ Js åŒ…ï¼Œä½¿å…¶åœ¨ window å¯¹è±¡ä¸­æ·»åŠ äº† toaster å˜é‡ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº† toastr object æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ä¸­çš„æ¥å£ï¼Œä½†æ˜¯ typeScript ç¼–è¯‘å™¨ä¸çŸ¥é“ï¼Œæ‰€ä»¥åªéœ€è¦å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œè®©ç¼–è¯‘å™¨é€šè¿‡ç¼–è¯‘å³å¯ã€‚</p>

<p>åœ¨ä½¿ç”¨æ—¶ï¼Œä¸è¦åœ¨ä½¿ç”¨çš„ç»„ä»¶ä¸­ç›´æ¥å£°æ˜ toastr å¯¹è±¡å»ä½¿ç”¨ï¼Œè¿™æ ·ä¸å®¹æ˜“ mockï¼Œä¸æ–¹ä¾¿å•å…ƒæµ‹è¯•ï¼Œå–è€Œä»£ä¹‹çš„æ—¶æä¾›ä¸€ä¸ªå¯å¤ç”¨çš„æœåŠ¡ã€‚</p>

<p>ç›®å‰ï¼Œå·²ç»æœ‰äº† ngx-toastr åº“æä¾›äº† ToastrServie æ¥å£ä¾› angular ä½¿ç”¨ã€‚</p>

<h3 id="toc_14">è®°å½•çŠ¶æ€</h3>

<p>service è¿˜æœ‰ä¸ªåŠŸèƒ½æ˜¯è®°å½•çŠ¶æ€ã€‚ä¾‹å¦‚èº«ä»½è®¤è¯ã€‚</p>

<h2 id="toc_15">è·¯ç”±</h2>

<p>ç»„ä»¶éƒ½æœ‰ selector å±æ€§ï¼Œæ˜¯å› ä¸ºå…¶ä¼šè¢«ç”¨åœ¨ html çš„å†…éƒ¨ï¼Œå½“ç»„ä»¶è¢«ä½œä¸ºè·¯ç”±ä½¿ç”¨æ—¶ï¼Œåˆ™ä¸éœ€è¦ selector å±æ€§ã€‚</p>

<pre><code class="language-typescript">import { Routes } from &quot;@angular/router&quot;;
</code></pre>

<p>è·¯ç”±åªæ˜¯ä¸€ä¸ª<strong>æ•°ç»„</strong>é…ç½®ï¼ˆå®ƒæ˜¯æœ‰åºçš„ï¼Œä»ä¸Šå¾€ä¸‹æŸ¥æ‰¾åŒ¹é…è·¯ç”±ï¼‰,è¿™é‡Œå¯¼å…¥ Routes ä¹ŸåŒæ ·åªæ˜¯ä¸ºäº† typeScript çš„é™æ€ç±»å‹ checkã€‚</p>

<p>çœŸæ­£è®©è¿™ä¸ªæ•°ç»„å¥æ•ˆçš„æ˜¯åœ¨æ¨¡å—ä¸­é€šè¿‡è·¯ç”±æ¨¡å—çš„æ ¹è·¯ç”±å¯¹è¯¥æ•°ç»„çš„è½½å…¥ï¼š</p>

<pre><code class="language-type">RouterModule.forRoot(appRoutes)
</code></pre>

<pre><code class="language-typescript">{ path: &#39;&#39;, redirectTo: &#39;events&#39;, pathMatch: &#39;full&#39; }
</code></pre>

<p>æ³¨æ„æ·»åŠ é»˜è®¤è·¯ç”±ã€‚</p>

<p>pathMatchï¼špath-matching ç­–ç•¥ï¼Œé»˜è®¤ prefixï¼Œè¿˜æœ‰ä¸€ä¸ªé€‰é¡¹æ˜¯ full</p>

<ul>
<li>prefix ä»¥æŒ‡å®šçš„ path å¼€å§‹çš„ URL</li>
<li>full å®Œå…¨ç¬¦åˆæŒ‡å®š path çš„ URL</li>
</ul>

<h3 id="toc_16">è·¯ç”±çš„æ­¥éª¤</h3>

<ol>
<li>æ·»åŠ ä¸€ä¸ª router-outlet</li>
<li>å®šä¹‰è·¯ç”±ï¼ˆä¸€ä¸ªå¸¸é‡æ•°ç»„ï¼‰åŒ…å«ä¸€ä¸ªé»˜è®¤è·¯ç”±</li>
<li>åœ¨ module ä¸­ä½¿ç”¨ RouterModule è½½å…¥è·¯ç”±</li>
<li>&lt;base href=&quot;/&quot;&gt;</li>
</ol>

<h3 id="toc_17">è·¯ç”±å‚æ•°</h3>

<h4 id="toc_18">å®šä¹‰å‚æ•°</h4>

<p>å†’å·æç¤º Angular è¿™æ˜¯ä¸€ä¸ª URL å‚æ•°ã€‚</p>

<h4 id="toc_19">è·å–å‚æ•°</h4>

<pre><code class="language-typescript">import { ActivatedRoute } from &quot;@angular/router&quot;;
</code></pre>

<p>æ³¨å…¥ ActivateRoute service è·å–å‚æ•°ã€‚</p>

<pre><code class="language-typescript">+this.route.snapshot.params[&#39;id&#39;]
</code></pre>

<p>è¿™é‡Œè·å–åˆ°çš„å‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œéœ€è¦è½¬æˆ number</p>

<h3 id="toc_20">HTML é“¾æ¥è·¯ç”±</h3>

<pre><code class="language-typescript">[routerLink]=&quot;[&#39;/events&#39;, event.id]&quot;
</code></pre>

<p>[routerLink] çš„å‚æ•°æ˜¯æ•°ç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å­—ç¬¦ä¸²è·¯ç”±åœ°å€ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯å‚æ•°ã€‚</p>

<h3 id="toc_21">Code å¯¼èˆªé¡µé¢</h3>

<pre><code class="language-typescript">Router.navigate([&#39;/events&#39;, event.id])
</code></pre>

<p>å‚æ•°åŒä¸Š</p>

<h3 id="toc_22">Route Guards</h3>

<p>å®ˆå«å³å¯ä»¥ä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æœåŠ¡ã€‚</p>

<p>å®ƒæ—¢å¯ä»¥ç»„ç»‡è¿›å…¥æŸä¸ªé¡µé¢ï¼Œä¹Ÿå¯ä»¥é˜»æ­¢ç¦»å¼€æŸä¸ªé¡µé¢ã€‚</p>

<h4 id="toc_23">canActivate</h4>

<p>é€šè¿‡æœåŠ¡å®ç° canActivate</p>

<pre><code class="language-typescript">{ path: &#39;events/:id&#39;, component: EventDetailsComponent, canActivate: [EventRouteActivator] },
</code></pre>

<pre><code class="language-typescript">@Injectable()
export class EventRouteActivator implements CanActivate {
    constructor(private eventService: EventService, private router: Router) {
    }
    
    canActivate(route: ActivatedRouteSnapshot) {
        const eventExists = !!this.eventService.getEvent(+route.params[&#39;id&#39;]);
        if (!eventExists)
            this.router.navigate([&#39;/404&#39;]);
        return eventExists;
    }
}
</code></pre>

<p>canActivate æœ€åè¿”å› boolean å€¼ã€‚</p>

<h4 id="toc_24">canDeactivate</h4>

<p>é€šè¿‡æ–¹æ³•å®ç° canDeactivate</p>

<pre><code class="language-typescript">{ path: &#39;events/new&#39;, component: CreateEventComponent, canDeactivate: [&#39;canDeactivateCreateEvent&#39;] },
</code></pre>

<p>æ–¹æ³•éœ€è¦æ³¨å…¥ providersï¼Œä¸”ä¸èƒ½ä½¿ç”¨ç¼©å†™:</p>

<pre><code class="language-typescript">  providers: [
    {
      provide: &#39;canDeactivateCreateEvent&#39;,
      useValue: checkDirytState
    }
  ]
</code></pre>

<p>useValue æ˜¯æ–¹æ³•ï¼Œæ–¹æ³•å¯ä»¥æ”¾åœ¨ä»»ä½•æ–‡ä»¶é‡Œï¼š</p>

<pre><code class="language-typescript">export function checkDirytState(component: CreateEventComponent) {
  if (component.isDirty) {
    return window.confirm(&#39;You have not saved this event, do you really want to cancel?&#39;)
  }
  return true;
}
</code></pre>

<h3 id="toc_25">active link</h3>

<pre><code class="language-markup">&lt;a [routerLink]=&quot;[&#39;/events&#39;]&quot; routerLinkActive=&quot;active&quot; [routerLinkActiveOptions]=&quot;{exact:true}&quot;&gt;All Events&lt;/a&gt;
</code></pre>

<p>routerLinkActive=&quot;active&quot; æ·»åŠ åœ¨å«æœ‰ routerlink çš„æ ‡ç­¾ä¸Šï¼Œå½“è·¯ç”±ä¸æ ‡ç­¾æŒ‡å®šçš„è·¯ç”±åŒ¹é…ï¼Œåˆ™æ·»åŠ  active classã€‚</p>

<p>é»˜è®¤åŒ¹é…è·¯ç”±å­—ç¬¦ä¸²ç­–ç•¥æ˜¯ start withã€‚</p>

<p>æ·»åŠ  <code>[routerLinkActiveOptions]=&quot;{exact:true}&quot;</code> æ˜¯å®Œå…¨ç¬¦åˆã€‚</p>

<h3 id="toc_26">feature module æˆ– lazy loadable module</h3>

<p>ä¸ appModule çš„åŒºåˆ«ï¼š</p>

<ol>
<li>ä¸å¯¼å…¥ BrowserModule</li>
<li>å¯¼å…¥çš„ RouterModule è°ƒç”¨ forChild æ–¹æ³•</li>
</ol>

<h2 id="toc_27">è¡¨å•</h2>

<p>åˆ†ä¸ºä¸¤ç§ï¼š</p>

<ol>
<li>Template-based</li>
<li>Model-based ä¹Ÿç§° reactive forms</li>
</ol>

<p>è¡¨å•å¦‚æœéƒ½é€šè¿‡äº‹ä»¶ç»‘å®šçš„æ–¹å¼å¤ªå¤æ‚ï¼Œæ‰€ä»¥å¼•å…¥ ngModelã€‚</p>

<p>[(ngModel)] åŒå‘ç»‘å®šä½¿ç”¨åŒæ‹¬å· banana box</p>

<p>ä½¿ç”¨æ—¶æ ¹æ®éœ€è¦å†³å®šå¦‚ä½•ç»‘å®šã€‚</p>

<h3 id="toc_28">Template-based Form</h3>

<p>éœ€è¦å¼•å…¥ FormsModule æ³¨å†Œåˆ° module ä¸­ã€‚</p>

<pre><code class="language-markup">&lt;form #loginForm=&quot;ngForm&quot; (ngSubmit)=&quot;login(loginForm.value)&quot; autocomplete=&quot;off&quot;&gt;
    &lt;input (ngModel)=&quot;userName&quot; name=&quot;userName&quot; id=&quot;userName&quot; type=&quot;text&quot; class=&quot;form-control&quot; placeholder=&quot;User Name...&quot; /&gt;
&lt;/form&gt;
</code></pre>

<p>é€šè¿‡æ¨¡æ¿å˜é‡å£°æ˜ Formï¼Œ<code>#loginForm=&quot;ngForm&quot;</code> æŒ‡å®šè¯¥ Form ä¸º Angular è¡¨å•ã€‚</p>

<p>ä½¿ç”¨ ngSubmit æäº¤ï¼Œå‚æ•°æ˜¯æ¨¡æ¿å˜é‡çš„å€¼ <code>loginForm.value</code>ã€‚</p>

<p>ç”¨ name å£°æ˜ Form ä¸­çš„æˆå‘˜å±æ€§ã€‚</p>

<h4 id="toc_29">è¡¨å•éªŒè¯</h4>

<pre><code class="language-markup">&lt;em *ngIf=&quot;newEventForm.controls.date?.invalid &amp;&amp; (newEventForm.controls.date?.touched)&quot;&gt;Required&lt;/em&gt;
</code></pre>

<p>åŸºäºæ¨¡æ¿çš„è¡¨å•éªŒè¯ç‰¹åˆ«é•¿ï¼Œå› ä¸º formControl ä¸æ˜¯ public ç±»å‹ï¼Œå®ƒæ˜¯ Form çš„å±æ€§ï¼Œæ‰€ä»¥åœ¨è¡¨å•éªŒè¯æ—¶ç‰¹åˆ«ç¹çã€‚</p>

<h3 id="toc_30">Model-based Form</h3>

<p>è¿˜éœ€è¦å¼•å…¥ ReactiveFormsModule æ³¨å†Œåˆ° module ä¸­ã€‚</p>

<p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>

<ol>
<li>åˆ›å»ºæ¯ä¸ª FormControl</li>
<li>åˆ›å»ºä¸€ä¸ª FormGroup</li>
<li>ä¸º FormGroup é…ç½® FormControl</li>
<li>ç»™ HTML ä¸­çš„ form ç»‘å®š FormGroup</li>
<li>ç»™ HTML ä¸­çš„ field ç»‘å®š FormControlName</li>
</ol>

<p>formControlName ç»‘å®šæ—¶ä¸éœ€è¦å¸¦ä»»ä½•æ‹¬å·ï¼Œåªæ˜¯æŒ‡å®šå±æ€§å</p>

<h4 id="toc_31">è¡¨å•éªŒè¯</h4>

<p>è¡¨å•éªŒè¯æ˜¯ FormControl çš„ç¬¬äºŒä¸ªå‚æ•°ï¼š</p>

<pre><code class="language-typescript">let firstName = new FormControl(this.auth.currentUser.firstName, Validators.required);
</code></pre>

<p>å¦‚æœæœ‰å¤šä¸ªéªŒè¯ä½¿ç”¨æ•°ç»„ã€‚</p>

<h3 id="toc_32">è‡ªå®šä¹‰è¡¨å•éªŒè¯</h3>

<h4 id="toc_33">validator æ˜¯ä»€ä¹ˆ</h4>

<p>validator å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼š</p>

<ul>
<li>è¿”å› null æ—¶ valid</li>
<li>è¿”å› error å¯¹è±¡æ—¶ invalid</li>
</ul>

<p>error å¯¹è±¡ { key: value }</p>

<h4 id="toc_34">è‡ªå®šä¹‰è¡¨å•éªŒè¯æ–¹æ³•</h4>

<pre><code class="language-typescript">export function restrictedWords(...words) {
  return (control: FormControl): { [key: string]: any } =&gt; {
    if (!words) {
      return null;
    }
    let invalidWords = words.map(w =&gt; control.value.includes(w) ? w : null)
      .filter(w =&gt; w !== null);
    return invalidWords &amp;&amp; invalidWords.length &gt; 0
      ? { &#39;restrictedWords&#39;: invalidWords.join(&#39;, &#39;) }
      : null;
  }
}
</code></pre>

<p>è¿™é‡Œä¸ºäº†ä½¿ç”¨ FormControl ä½¿ç”¨äº†é—­åŒ…ã€‚</p>

<p>æ³¨æ„ key å€¼ <code>restrictedWords</code> ä¸æ–¹æ³•åä¸€è‡´ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Angular ä¸­çš„ DI]]></title>
    <link href="2019919.xyz/16166681233612.html"/>
    <updated>2021-03-25T18:28:43+08:00</updated>
    <id>2019919.xyz/16166681233612.html</id>
    <content type="html"><![CDATA[
<p>æˆ‘ä»¬éƒ½çŸ¥é“åˆ›å»ºä¸€ä¸ªæœåŠ¡ï¼Œå¹¶é€šè¿‡ <code>@Injectable</code> è£…é¥°å™¨æˆ–è€…åœ¨ Module ä¸­çš„ providers ä¸­æ³¨å†Œï¼Œå¹¶åœ¨ç»„ä»¶çš„æ„é€ æ–¹æ³•ä¸­é€šè¿‡å¦‚ä¸‹æ–¹å¼ä¾èµ–æ³¨å…¥ï¼š</p>

<pre><code class="language-typescript">import { AuthService } from &#39;../user/auth.service&#39;;
export class NavBarComponent {
    constructor(public auth:AuthService){
    }
}
</code></pre>

<p>é¦–å…ˆï¼Œå¿…é¡»å…ˆä»å…¶æ–‡ä»¶ä¸­å¯¼å…¥ AuthServiceï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­ä»¥å‚æ•°çš„å½¢å¼å°†å…¶æ³¨å…¥ï¼Œå‚æ•°çš„ç±»å‹ä¸æ–‡ä»¶å†…å¯¼å‡ºçš„ Class ä¸€è‡´ï¼Œè¿™ä¸ª Class æ˜¯ ES6 çš„è¯­æ³•ç³–ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚ </p>

<p>ä½†æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œæ˜¯æƒ³å¾—åˆ°ä¸€ä¸ª AuthService çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¹¶æ˜¯æƒ³è¦å¾—åˆ° AuthService Class æˆ–è€… AuthService å‡½æ•°ï¼Œè¿™å°±æ˜¯ Angular æ‰€åšçš„ï¼šåˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹å¹¶ç»™æˆ‘ä»¬è¿™ä¸ªå®ä¾‹ã€‚å½“æˆ‘ä»¬æ³¨å†Œäº† AuthService Classï¼ŒAngular ä¼šåˆ›å»ºè¿™ä¸ª Class çš„å®ä¾‹ï¼Œå¹¶åœ¨ä»»ä½•å¼•ç”¨å®ƒçš„æ„é€ å‡½æ•°ä¸­ç»™æˆ‘ä»¬è¿™ä¸ªå®ä¾‹ï¼Œè€Œåˆ›å»ºè¿™ä¸ªå®ä¾‹å°±å‘ç”Ÿåœ¨æˆ‘ä»¬å°† AuthService æ³¨å†Œåœ¨ Module çš„ providers ä¸­ã€‚</p>

<p>é‚£ Angular æ˜¯å¦‚ä½•çŸ¥é“æˆ‘ä»¬æƒ³è¦çš„æ˜¯ AuthService è€Œä¸æ˜¯å…¶ä»– service å‘¢ï¼Ÿ</p>

<h2 id="toc_0">Angular å¦‚ä½•çŸ¥é“æˆ‘ä»¬è¦çš„æ˜¯å“ªä¸ª service çš„å®ä¾‹å‘¢ï¼Ÿ</h2>

<p>Angular é€šè¿‡æˆªè·ç»„ä»¶æ„é€ å‡½æ•°ä¸­çš„å£°æ˜ï¼Œé€šè¿‡ TypeScript çš„ç±»å‹å£°æ˜ï¼ˆè¿™é‡Œå°±æ˜¯ AuthServiceï¼‰ï¼Œåœ¨æœåŠ¡ä¸­å¯»æ‰¾ã€‚æ‰€ä»¥å®é™…ä¸Šï¼Œå®ƒæ˜¯é€šè¿‡ Class ä½œä¸ºä¸€ä¸ª key æ¥å¯»æ‰¾æ­£ç¡®çš„å¯¹è±¡ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒAuthService å®ä¾‹å°±æ˜¯åœ¨ AuthService çš„ DI æ³¨å†Œæ—¶è¢«åˆ›å»ºçš„ã€‚</p>

<h3 id="toc_1">Angular ä¸ Angular Js çš„ DI çš„åŒºåˆ«</h3>

<pre><code class="language-javascript">angular.module(&#39;app&#39;).service(&#39;auth&#39;,AuthService)
</code></pre>

<p>åœ¨ Angular Js ä¸­ï¼ŒæœåŠ¡æ˜¯é€šè¿‡ä¸Šé¢çš„æ–¹å¼æ³¨å†Œçš„ï¼Œservice() æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æˆ‘ä»¬æƒ³è¦çš„å¯¹è±¡ã€‚æ‰€ä»¥ Angular Js çš„ä¾èµ–æ³¨å…¥æ˜¯é€šè¿‡å­—ç¬¦ä¸²æ¥åŒ¹é…çš„ã€‚</p>

<p>å½“æˆ‘ä»¬æƒ³è¦è¿™ä¸ªæœåŠ¡çš„å®ä¾‹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåŒåçš„å‚æ•°ã€‚è€Œåœ¨æˆ‘ä»¬ç¼–å†™ä»£ç æ—¶ï¼Œå¸¸å¸¸å› ä¸ºå•çº¯ miss å¯¼è‡´æœåŠ¡æ³¨å…¥çš„å¤±è´¥ï¼Œä¸å¾—ä¸åœ¨æ£€æŸ¥æˆ‘ä»¬çš„ä»£ç ã€‚</p>

<p>è€Œ Angular ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Class æˆ–è€… Type ä½œä¸ºæˆ‘ä»¬çš„ key æˆ–è€…æ¢ä¸ªè¯ tokenã€‚</p>

<p>åœ¨ Angular ä¸­ï¼Œæ„é€ å‡½æ•°å‚æ•°çš„ç±»å‹ AuthService èµ·åˆ°ä¸¤ä¸ªä½œç”¨ï¼šå…¶ä¸€æ˜¯ç”¨æ¥ç»™ TypeScript è¯†åˆ«å˜é‡ç±»å‹ï¼Œè®©æˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶ IDE å¯ä»¥é€šè¿‡ . æ¥è®¿é—®å…¶ä¸­çš„æˆå‘˜ã€‚å…¶äºŒå°±æ˜¯å°±æ˜¯ Angular é€šè¿‡è¿™ä¸ª Type å£°æ˜åœ¨ä¾èµ–æ³¨å…¥æ³¨å†Œä¸­å¯»æ‰¾åŒ¹é…çš„å¯¹è±¡ã€‚</p>

<p>æ‰€ä»¥åœ¨ Angular ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª service å°±ç›´æ¥åˆ›å»ºä¸€ä¸ª Classã€‚</p>

<h2 id="toc_2">å¦‚ä½•ä½¿ç”¨ InjectionToken</h2>

<p>æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ä¸€ä¸ªæ¶ˆæ¯é€šçŸ¥åº“æ¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨ InjectionTokenã€‚</p>

<h3 id="toc_3">å¦‚ä½•åœ¨ Angular ä¸­ä½¿ç”¨ toastr</h3>

<p><a href="https://www.npmjs.com/package/toastr">toastr</a> æ˜¯ä¸€ä¸ªé€šçŸ¥ Jquery åº“ï¼Œç›®å‰å·²ç»æœ‰æ”¯æŒ Angular ç‰ˆæœ¬çš„ <a href="https://www.npmjs.com/package/ngx-toastr">ngx-toastr</a> æä¾›ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœæƒ³ä½¿ç”¨åŸç”Ÿçš„ toastr æˆ‘ä»¬è¯¥å¦‚ä½•åšå‘¢ã€‚</p>

<p>æ ¹æ®å®˜æ–¹çš„æ–¹æ³•å®‰è£… toastr åº“åˆ°æˆ‘ä»¬çš„å·¥ç¨‹ä¸­ï¼Œé‚£å¦‚ä½•åœ¨ Angular ä¸­ä½¿ç”¨å‘¢ï¼Ÿ</p>

<p>é¦–å…ˆåœ¨ Angular çš„ webpack æ–‡ä»¶ä¸­å¯¼å…¥ toastr çš„ style å’Œ scriptï¼š</p>

<pre><code class="language-javascript">&quot;styles&quot;: [
    &quot;node_modules/toastr/build/toastr.min.css&quot;,
    &quot;src/styles.css&quot;
],
&quot;scripts&quot;: [
    &quot;node_modules/jquery/dist/jquery.min.js&quot;,
    &quot;node_modules/toastr/build/toastr.min.js&quot;
]
</code></pre>

<p>æ­¤æ—¶ç¼–è¯‘åçš„ SPA ä¸­å·²ç»æœ‰äº†æˆ‘ä»¬éœ€è¦çš„ toastr å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¡µé¢çš„æ§åˆ¶å°ä¸­æŸ¥çœ‹ window.toastr å¯¹è±¡ï¼š</p>

<p><img src="media/16166681233612/16166682192597.jpg" alt=""/></p>

<p>ä½†æ˜¯è¿™æ—¶å€™åœ¨ä½¿ç”¨ toastr å¯¹è±¡æ—¶ï¼ŒIDE ä¼šæŠ¥é”™ï¼š</p>

<p><img src="media/16166681233612/16166682041574.jpg" alt=""/></p>

<p>åŸå› å¾ˆç®€å•ï¼Œæ˜¯å› ä¸º TypeScript å¹¶ä¸çŸ¥é“æˆ‘ä»¬çš„ toastr å¯¹è±¡ï¼Œè¿™æ—¶å€™éœ€è¦å£°æ˜ä¸€ä¸‹è¿™ä¸ªå¯¹è±¡ï¼š</p>

<pre><code class="language-typescript">declare let toastr: any;
</code></pre>

<p>è¿™æ—¶å€™å°±å¯ä»¥é¡ºåˆ©ä½¿ç”¨ toastr åº“ä¸­çš„æˆå‘˜æ–¹æ³•æ¥å¼¹å‡ºæˆ‘ä»¬çš„æ¶ˆæ¯æç¤ºæ¡†äº†ã€‚</p>

<h3 id="toc_4">æ·»åŠ  toastr æœåŠ¡</h3>

<p>åœ¨ä¸€ä¸ªå·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬è‚¯å®šä¼šä¸æ­¢ä¸€æ¬¡çš„è¿›è¡Œ HTTP è¯·æ±‚æˆ–è€…å…¶ä»–ä¸€äº›éœ€è¦å¼¹å‡ºæ¶ˆæ¯æç¤ºæ¡†çš„æƒ…å†µï¼Œä½†æ¯æ¬¡éƒ½éœ€è¦å£°æ˜ä¸€ä¸ª toastr å¯¹è±¡æœ‰ç‚¹å¤ªéº»çƒ¦äº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‹é¢è¿™ä¸ªç±»æ³¨å†Œä¸ºæˆ‘ä»¬çš„æœåŠ¡ï¼š</p>

<pre><code class="language-typescript">import { Injectable } from &#39;@angular/core&#39;;

declare let toastr: any;

@Injectable()
export class ToastrService {
    success(message: string, title?: string) {
        toastr.success(message, title);
    }
    info(message: string, title?: string) {
        toastr.info(message, title);
    }
    warning(message: string, title?: string) {
        toastr.warning(message, title);
    }
    error(message: string, title?: string) {
        toastr.error(message, title);
    }
}
</code></pre>

<p>è¿™æ ·æˆ‘ä»¬ä¹Ÿèƒ½è¿‡æ»¤æ‰ toastr ä¸­å…¶ä»–ä¸å¿…è¦çš„æˆå‘˜æ–¹æ³•ï¼Œæ–¹ä¾¿é¡¹ç›®ä¸­çš„åŒäº‹ä½¿ç”¨ã€‚</p>

<h3 id="toc_5">InjectionToken æ³¨å†ŒæœåŠ¡</h3>

<p>å›é¡¾ä¸€ä¸‹ä¸Šæ–‡ä¸­ Angular çš„æœåŠ¡ï¼š</p>

<blockquote>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª service å°±ç›´æ¥åˆ›å»ºä¸€ä¸ª Class</p>
</blockquote>

<p>æˆ‘ä»¬å¹¶æ²¡æœ‰åˆ›å»ºä¸€ä¸ªå¯å¯¼å‡º toastr Classï¼Œå¹¶æ²¡æœ‰å»ç”¨å®ƒä½œä¸º key åœ¨æˆ‘ä»¬çš„ Module ä¸­æ³¨å†Œå®ƒï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨ Module ä¸­å¯¼å…¥ toastrï¼Œå¹¶å°†å…¶æ·»åŠ åˆ° providers æ•°ç»„ä¸­ã€‚</p>

<p>å› æ­¤æˆ‘ä»¬å¦‚ä¸‹ä¿®æ”¹æˆ‘ä»¬çš„ toastr.service.tsï¼š</p>

<pre><code class="language-typescript">import { InjectionToken } from &quot;@angular/core&quot;;

export let TOASTR_TOKEN = new InjectionToken&lt;Toastr&gt;(&#39;toastr&#39;);

export interface Toastr {
    success(msg: string, title?: string): void;
    info(msg: string, title?: string): void;
    warning(msg: string, title?: string): void;
    error(msg: string, title?: string): void;
}
</code></pre>

<p>ä½¿ç”¨ InjectionToken æ„é€ å‡½æ•° new ä¸€ä¸ª TOASTR_TOKEN å¯¹è±¡ï¼Œå¹¶æŒ‡å®šå…¶æ¥å£æ„é€ ã€‚è¿™æ ·å°±åˆ›å»ºäº†æˆ‘ä»¬çš„ InjectionTokenã€‚</p>

<p>ç„¶ååœ¨æˆ‘ä»¬çš„ Module ä¸­æ³¨å†Œ toastr æœåŠ¡ï¼š</p>

<pre><code class="language-typescript">import { IToastr, TOASTR_TOKEN } from &#39;./common/toastr.service&#39;;

declare let toastr: IToastr;

@NgModule({
  ...
  providers: [
    { provide: TOASTR_TOKEN, useValue: toastr }
  ]
  ...
})
</code></pre>

<p>é¦–å…ˆå¯¼å…¥æˆ‘ä»¬çš„ IToastr æ¥å£å’Œ TOASTR_TOKEN InjectionTokenï¼Œå£°æ˜ toastr å¯¹è±¡ï¼Œåœ¨ providers æ•°ç»„ä¸­æ³¨å†Œï¼Œè¿™é‡Œæ³¨å†Œæ—¶æ²¡æœ‰åƒä¹‹å‰çš„ AuthService æœåŠ¡ï¼Œåªä½¿ç”¨äº†ç±»å‹ã€‚AuthService çš„æ³¨å†Œå…¶å®åªæ˜¯ <code>{ provide: AuthService , useClass: AuthService }</code> çš„ç®€å†™ï¼ˆå…³äº useClass å’Œ userValue åé¢å†è¯¦ç»†å¯¹æ¯”ï¼‰ã€‚provide çš„å€¼å°±æ˜¯ tokenï¼Œè€Œ useValue çš„å€¼å°±æ˜¯ Angular ä¸ºæˆ‘ä»¬åˆ›å»ºçš„å®ä¾‹ã€‚</p>

<h3 id="toc_6">æ³¨å…¥ InjectionToken æœåŠ¡</h3>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹ InjectionToken æ³¨å†Œçš„æœåŠ¡å¦‚ä½•ä½¿ç”¨ã€‚</p>

<pre><code class="language-typescript">import { Component, OnInit, Inject } from &#39;@angular/core&#39;;
import { IToastr, TOASTR_TOKEN } from &#39;../common/toastr.service&#39;;
constructor(
  private auth: AuthService,
  private router: Router,
  @Inject(TOASTR_TOKEN) private toastr: IToastr) {
}
</code></pre>

<p>é™¤äº†å¯¼å…¥æˆ‘ä»¬çš„æ¥å£ IToastr å’Œ TOASTR_TOKEN Token ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä» <code>@angular/core</code> ä¸­å¯¼å…¥ Injectã€‚</p>

<pre><code class="language-typescript">/**
 * Type of the Inject metadata.
 *
 * @publicApi
 */
export declare interface Inject {
    /**
     * A [DI token](guide/glossary#di-token) that maps to the dependency to be injected.
     */
    token: any;
}
</code></pre>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Inject çš„å‚æ•°æ˜¯ tokenï¼Œå½“æˆ‘ä»¬æ³¨å…¥å‚æ•° toastr æ—¶ï¼ŒIToastr å¹¶ä¸æ˜¯æˆ‘ä»¬ä¾èµ–æ³¨å…¥çš„ Tokenï¼Œè€Œåªæ˜¯ç”¨æ¥æ™ºèƒ½æ„ŸçŸ¥ã€‚çœŸæ­£æŒ‡å®šäº† Token çš„æ˜¯è£…é¥°å™¨ @Inject()ã€‚</p>

<p>è¿™æ ·æˆ‘å°±å¯ä»¥åœ¨æˆ‘ä»¬çš„ç±»ä¸­æ‹¿åˆ° toastr å®ä¾‹ï¼Œåƒæ™®é€šçš„ service ä¸€æ ·ä½¿ç”¨å®ƒï¼š</p>

<pre><code class="language-typescript">  saveProfile(profileFormValue) {
    if (this.profileForm.valid) {
      this.auth.updateUser(profileFormValue.firstName, profileFormValue.lastName);
      this.toastr.success(&#39;Profile Saved&#39;);
      this.router.navigate([&#39;/events&#39;]);
    }
  }
</code></pre>

<h2 id="toc_7">å››ç§ Provider</h2>

<p>ä¸Šé¢æˆ‘ä»¬å·²ç»è§è¿‡ä¸¤ç§ providerï¼ŒuseValue å’Œ useClassã€‚</p>

<p>åœ¨ Angular çš„ DI ä¸­ä¸€å…±æœ‰å››ç§ providerï¼š</p>

<ul>
<li><a href="https://angular.io/api/core/ValueProvider">ValueProvider</a></li>
<li><a href="https://angular.io/api/core/ClassProvider">ClassProvider</a></li>
<li><a href="https://angular.io/api/core/ExistingProvider">ExistingProvider</a></li>
<li><a href="https://angular.io/api/core/FactoryProvider">FactoryProvider</a></li>
</ul>

<p>å®ƒä»¬åˆ†åˆ«ä½¿ç”¨å››ç§æ–¹å¼ä¸º Token æä¾›ä¸€ä¸ªå®ä¾‹ã€‚</p>

<h2 id="toc_8">æ€»ç»“</h2>

<p>Angular æ˜¯åœ¨æ³¨å†Œæ—¶äº§ç”Ÿçš„å®ä¾‹ï¼Œè¿™æ ·äº§ç”Ÿçš„å®ä¾‹å°†åœ¨æ³¨å†Œæ‰€åœ¨ä½œç”¨åŸŸå†…å­˜åœ¨ã€‚</p>

<p>Angular ä¾èµ–æ³¨å…¥æ—¶æ˜¯é€šè¿‡ Token æ¥æŸ¥æ‰¾å®ä¾‹ã€‚</p>

<p>å¸¸ç”¨çš„æœåŠ¡æ³¨å…¥å®é™…ä¸Šæ˜¯ä½¿ç”¨ ClassProvider æä¾›çš„å®ä¾‹ï¼Œè€Œå…¶ Token å°±æ˜¯å®ƒçš„ Classï¼Œåœ¨ä¾èµ–æ³¨å…¥æ—¶ï¼ŒAngular æˆªè·å…¶ Class å¹¶ä»¥å®ƒä¸º Token å¯»æ‰¾å®ä¾‹ã€‚</p>

<p>ç›¸ä¿¡æˆ‘ä»¬éƒ½æ˜äº†ä¾èµ–æ³¨å…¥çš„è®¾è®¡æ¨¡å¼ï¼Œä¹Ÿæ˜ç¡®å®ƒçš„ä¼˜åŠ¿ã€‚å¯æ˜¯åœ¨æˆ‘ä»¬ä¹‹å‰ä» AngularJs å¼€å§‹åˆ° Angular æ¿ç –çš„è·¯ç¨‹ä¸­æ²¡æœ‰è¿‡ä»”ç»†å­¦ä¹  Angular ä¾èµ–æ³¨å…¥çš„æœ¬è´¨ã€‚è¿™è®©æˆ‘ä»¬åœ¨å¼€å‘ä¸­åªä¼šå¤åˆ¶ç²˜è´´ä»£ç ï¼Œå¯¼è‡´æŠ¥é”™æ—¶è®©æˆ‘ä»¬æ— ä»ä¸‹æ‰‹æ—¶ï¼Œåªèƒ½é€šè¿‡æŸ¥é˜…æ–‡æ¡£çš„æ¡ˆä¾‹ï¼Œæ¥å¯¹æ¯”è‡ªå·±çš„ä»£ç ä¸­å…·ä½“æœ‰å“ªäº›é”™è¯¯ã€‚ä½†æ˜¯å½“çŸ¥é“åŸç†åï¼Œæˆ‘ä»¬ä¸ä½†èƒ½æ¸…æ™°çš„å†™å‡ºä¾èµ–æ³¨å…¥çš„ä»£ç ï¼Œè¿˜å¯ä»¥çµæ´»é€‰ç”¨ä¸åŒçš„ Providerï¼Œå†™å‡ºæ›´æ¼‚äº®çš„ä»£ç ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Angular å˜æ›´æ£€æµ‹â€”â€”å®ƒåˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ]]></title>
    <link href="2019919.xyz/16164996860696.html"/>
    <updated>2021-03-23T19:41:26+08:00</updated>
    <id>2019919.xyz/16164996860696.html</id>
    <content type="html"><![CDATA[
<p>åŸæ–‡ï¼š<a href="https://blog.angular-university.io/how-does-angular-2-change-detection-really-work/">Angular Change Detection - How Does It Really Work?</a></p>

<p>ä¸ AngularJs ä¸­çš„ç­‰æ•ˆæ–¹æ³•ç›¸æ¯”ï¼ŒAngular å˜æ›´æ£€æµ‹æœºåˆ¶æ›´åŠ é€æ˜ä¸”æ˜“äºæ¨ç†ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚è¿›è¡Œæ€§èƒ½ä¼˜åŒ–æ—¶ï¼‰ï¼Œæˆ‘ä»¬çš„ç¡®éœ€è¦äº†è§£åº•å±‚åšäº†ä»€ä¹ˆã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬é€šè¿‡ç ”ç©¶ä»¥ä¸‹ä¸»é¢˜æ¥æ›´æ·±å…¥åœ°ç ”ç©¶å˜æ›´æ£€æµ‹ï¼š</p>

<ul>
<li>å˜æ›´æ£€æµ‹æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</li>
<li>Angular å˜æ›´æ£€æµ‹å™¨æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæˆ‘èƒ½çœ‹åˆ°å®ƒå—ï¼Ÿ</li>
<li>é»˜è®¤å˜æ›´æ£€æµ‹æœºåˆ¶å¦‚ä½•å·¥ä½œ</li>
<li>æ‰“å¼€ / å…³é—­å˜æ›´æ£€æµ‹ï¼Œå¹¶æ‰‹åŠ¨è§¦å‘</li>
<li>é¿å…å˜æ›´æ£€æµ‹å¾ªç¯ï¼šç”Ÿäº§ä¸å¼€å‘æ¨¡å¼</li>
<li><code>OnPush</code> å˜æ›´æ£€æµ‹æ¨¡å¼åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</li>
<li>ä½¿ç”¨ Immutable.js ç®€åŒ– Angular åº”ç”¨ç¨‹åºçš„æ„å»º</li>
<li>æ€»ç»“</li>
</ul>

<p>å¦‚æœä½ åœ¨å¯»æ‰¾æ›´å¤šå…³äº <code>OnPush</code> å˜æ›´æ£€æµ‹çš„ä¿¡æ¯ï¼Œçœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç«  <a href="https://blog.angular-university.io/onpush-change-detection-how-it-works">Angular OnPush Change Detection and Component Design - Avoid Common Pitfalls</a>ã€‚</p>

<h2 id="toc_0">å˜æ›´æ£€æµ‹æ˜¯å¦‚ä½•å®ç°çš„</h2>

<p>Angular å¯ä»¥æ£€æµ‹ç»„ä»¶æ•°æ®ä½•æ—¶å˜æ›´ï¼Œç„¶åè‡ªåŠ¨é‡æ–°æ¸²æŸ“è§†å›¾ä»¥åæ˜ è¯¥å˜æ›´ã€‚ä½†æ˜¯ï¼Œå¦‚ä½•åœ¨è¯¸å¦‚å•å‡»æŒ‰é’®ä¹‹ç±»çš„ä½çº§äº‹ä»¶å‘ç”Ÿä¹‹ååšåˆ°è¿™ä¸€ç‚¹ï¼Œè¿™å¯ä»¥åœ¨é¡µé¢ä»»ä½•åœ°æ–¹å‘ç”Ÿå—ï¼Ÿ</p>

<p>è¦äº†è§£å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ„è¯†åˆ°åœ¨ JavaScript ä¸­æ•´ä¸ªè¿è¡Œæ—¶å¯ä»¥è¢«è®¾è®¡é‡å†™ã€‚å¦‚æœéœ€è¦ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™ <code>String</code> æˆ– <code>Number</code> ä¸­çš„å‡½æ•°ã€‚</p>

<h3 id="toc_1">é‡å†™æµè§ˆå™¨é»˜è®¤æœºåˆ¶</h3>

<p>Angular åœ¨å¯åŠ¨æ—¶ä¼šä¿®è¡¥å‡ ä¸ªä½çº§æµè§ˆå™¨ APIï¼Œä¾‹å¦‚ <code>addEventListener</code>ï¼Œè¿™æ˜¯ç”¨äºæ³¨å†Œæ‰€æœ‰æµè§ˆå™¨äº‹ä»¶ï¼ˆåŒ…æ‹¬å•å‡»å¤„ç†ç¨‹åºï¼‰çš„æµè§ˆå™¨åŠŸèƒ½ã€‚Angular ä¼šç”¨ä¸‹é¢ç­‰æ•ˆçš„æ–°ç‰ˆæœ¬æ›¿æ¢ <code>addEventListener</code>ï¼š</p>

<pre><code class="language-javascript">// this is the new version of addEventListener
function addEventListener(eventName, callback) {
     // call the real addEventListener
     callRealAddEventListener(eventName, function() {
        // first call the original callback
        callback(...);     
        // and then run Angular-specific functionality
        var changed = angular.runChangeDetection();
         if (changed) {
             angular.reRenderUIPart();
         }
     });
}
</code></pre>

<p>æ–°ç‰ˆæœ¬çš„ <code>addEventListener</code> ä¸ºä»»ä½•äº‹ä»¶å¤„ç†ç¨‹åºå¢åŠ äº†æ›´å¤šåŠŸèƒ½ï¼šå…¶ä¸ä»…è°ƒç”¨å·²æ³¨å†Œçš„å›è°ƒï¼Œè€Œä¸” Angular è¿˜å¯ä»¥è¿è¡Œå˜æ›´æ£€æµ‹å¹¶æ›´æ–° UIã€‚</p>

<h3 id="toc_2">ä½çº§è¿è¡Œæ—¶è¡¥ä¸æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h3>

<p>æµè§ˆå™¨ API çš„ä½çº§è¡¥ä¸æ˜¯ç”± Angular çš„ <a href="https://github.com/angular/zone.js/">Zone.js</a> åº“å®Œæˆçš„ã€‚äº†è§£ä»€ä¹ˆæ˜¯ zone å¾ˆé‡è¦ã€‚</p>

<p>zone æ— éæ˜¯ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå®ƒå¯ä»¥åœ¨å¤šä¸ª JavaScript VM <sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup>æ‰§è¡Œå›åˆåå¹¸å­˜ä¸‹æ¥ã€‚è¿™æ˜¯ä¸€ç§é€šç”¨æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥å‘æµè§ˆå™¨æ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚Angular ç”¨ Zone æ¥è§¦å‘å˜æ›´æ£€æµ‹ï¼Œä½†å¦ä¸€ç§å¯èƒ½çš„ç”¨é€”æ˜¯è¿›è¡Œåº”ç”¨ç¨‹åºæ€§èƒ½åˆ†æï¼Œæˆ–è·Ÿè¸ªè·¨å¤šä¸ª VM è½®æ¬¡è¿è¡Œçš„é•¿å †æ ˆè·Ÿè¸ªã€‚</p>

<h3 id="toc_3">æ”¯æŒæµè§ˆå™¨å¼‚æ­¥ API</h3>

<p>ä¿®è¡¥ä»¥ä¸‹å¸¸ç”¨çš„æµè§ˆå™¨æœºåˆ¶ï¼Œä»¥æ”¯æŒå˜æ›´æ£€æµ‹ï¼š</p>

<ul>
<li>å…¨éƒ¨æµè§ˆå™¨äº‹ä»¶ï¼ˆclickã€mouseoverã€keyup ç­‰ï¼‰</li>
<li><code>setTimeout()</code>  å’Œ <code>setInterval()</code></li>
<li>Ajax HTTP è¯·æ±‚</li>
</ul>

<p>å®é™…ä¸Šï¼ŒZone.js ä¿®è¡¥äº†è®¸å¤šå…¶ä»–æµè§ˆå™¨ APIï¼Œä»¥æ˜äº†åœ°è§¦å‘ Angular å˜æ›´æ£€æµ‹ï¼Œä¾‹å¦‚ Websocketsã€‚çœ‹çœ‹<a href="https://github.com/angular/zone.js/tree/master/test/patch"> Zone.js æµ‹è¯•è¯´æ˜</a>æ¥äº†è§£å½“å‰æ”¯æŒçš„åŠŸèƒ½ã€‚</p>

<p>è¿™ç§æœºåˆ¶çš„å±€é™æ€§ä¹‹ä¸€åœ¨äºï¼Œå¦‚æœç”±äºæŸäº›åŸå›  Zone.js ä¸æ”¯æŒå¼‚æ­¥æµè§ˆå™¨ APIï¼Œé‚£ä¹ˆå°†ä¸ä¼šè§¦å‘å˜æ›´æ£€æµ‹ã€‚ä¾‹å¦‚ï¼ŒIndexedDB å›è°ƒå°±æ˜¯è¿™ç§æƒ…å†µã€‚</p>

<p>è¿™å°±è§£é‡Šäº†å˜æ›´æ£€æµ‹æ˜¯å¦‚ä½•è§¦å‘çš„ï¼Œä½†æ˜¯ä¸€æ—¦è§¦å‘ï¼Œå®ƒå®é™…ä¸Šå¦‚ä½•å·¥ä½œï¼Ÿ</p>

<h3 id="toc_4">å˜æ›´æ£€æµ‹æ ‘</h3>

<p>æ¯ä¸ª Angular ç»„ä»¶éƒ½æœ‰ä¸€ä¸ªå…³è”çš„åˆ›å»ºäºåº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„å˜æ›´æ£€æµ‹å™¨ã€‚ä¾‹å¦‚ä¸‹é¢ <code>TodoItem</code> ç»„ä»¶ï¼š</p>

<pre><code class="language-javascript">@Component({
    selector: &#39;todo-item&#39;,
    template: `&lt;span class=&quot;todo noselect&quot; 
       (click)=&quot;onToggle()&quot;&gt;{{todo.owner.firstname}} - {{todo.description}}
       - completed: {{todo.completed}}&lt;/span&gt;`
})
export class TodoItem {
    @Input()
    todo:Todo;

    @Output()
    toggle = new EventEmitter&lt;Object&gt;();

    onToggle() {
        this.toggle.emit(this.todo);
    }
}
</code></pre>

<p>å¦‚æœåˆ‡æ¢ Todo çŠ¶æ€ï¼Œåˆ™æ­¤ç»„ä»¶å°†æ¥æ”¶ Todo å¯¹è±¡ä½œä¸ºè¾“å…¥å¹¶å‘ç”Ÿäº‹ä»¶ã€‚ä¸ºäº†ä½¿ç¤ºä¾‹æ›´æœ‰è¶£ï¼Œ<a href="https://github.com/jhades/blog.angular-university.io/blob/master/ng2-change-detection/src/todo.ts#L11">Todo ç±»</a>åŒ…å«åµŒå¥—å¯¹è±¡ï¼š</p>

<pre><code class="language-javascript">export class Todo {
    constructor(public id: number, 
        public description: string, 
        public completed: boolean, 
        public owner: Owner) {
    }
}
</code></pre>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Todo æœ‰ä¸€ä¸ªå±æ€§ <code>owner</code>ï¼Œå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ï¼šfirstname å’Œ lastnameã€‚</p>

<h3 id="toc_5">Todo Item å˜æ›´æ£€æµ‹å™¨æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ</h3>

<p>æˆ‘ä»¬å®é™…ä¸Šå¯ä»¥åœ¨è¿è¡Œæ—¶çœ‹åˆ°å˜æ›´æ£€æµ‹å™¨çš„å¤–è§‚ï¼ å¯ä»¥é€šè¿‡è®¿é—®æŸä¸ªå±æ€§æŸ¥çœ‹å®ƒï¼Œåªéœ€åœ¨ Todo ç±»ä¸­æ·»åŠ ä¸€äº›ä»£ç ä»¥<a href="https://github.com/jhades/blog.angular-university.io/blob/master/ng2-change-detection/src/todo%20.ts%EF%BC%83L11">è§¦å‘æ–­ç‚¹</a>ã€‚</p>

<p>æ‰§è¡Œåˆ°æ–­ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥éå†å †æ ˆè·Ÿè¸ªå¹¶æŸ¥çœ‹å®é™…çš„å˜æ›´æ£€æµ‹ï¼š</p>

<p><img src="https://raw.githubusercontent.com/jhades/blog.angular-university.io/master/ng2-change-detection/images/change.jpg" alt="What does an Angular change detector look like"/></p>

<p>ä¸ç”¨æ‹…å¿ƒï¼Œä½ å°†æ°¸è¿œä¸å¿…è°ƒè¯•æ­¤ä»£ç ï¼ä¹Ÿä¸æ¶‰åŠä»»ä½•é­”æœ¯ï¼Œå®ƒåªæ˜¯åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶æ„å»ºçš„æ™®é€š JavaScript æ–¹æ³•ã€‚ä½†æ˜¯å®ƒæ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿ</p>

<h2 id="toc_6">é»˜è®¤å˜æ›´æ£€æµ‹æœºåˆ¶å¦‚ä½•å·¥ä½œï¼Ÿ</h2>

<p>ä¹ä¸€çœ‹ï¼Œæ­¤æ–¹æ³•å¯èƒ½çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œå¹¶ä¸”å…¶å…¨éƒ¨å˜é‡å‘½åå¥‡æ€ªã€‚ä½†æ˜¯ï¼Œé€šè¿‡æ›´æ·±å…¥åœ°ç ”ç©¶å®ƒï¼Œæˆ‘ä»¬å‘ç°å®ƒçš„æ“ä½œéå¸¸ç®€å•ï¼šå¯¹äºæ¨¡æ¿ä¸­ä½¿ç”¨çš„æ¯ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒä¼šå°†è¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„å±æ€§çš„å½“å‰å€¼ä¸è¯¥å±æ€§çš„å…ˆå‰å€¼è¿›è¡Œæ¯”è¾ƒã€‚</p>

<p>å¦‚æœå‰åçš„å±æ€§å€¼ä¸åŒï¼Œå®ƒå°†æŠŠ isChanged è®¾ç½®ä¸º trueï¼Œå°±æ˜¯è¿™æ ·ï¼å·®ä¸å¤šäº†ï¼Œå®ƒæ˜¯é€šè¿‡ä½¿ç”¨åä¸º <code>looseNotIdentical()</code> çš„æ–¹æ³•è¿›è¡Œå€¼æ¯”è¾ƒï¼Œä½¿ç”¨ <code>===</code> æ¯”è¾ƒä½†æŒ‡å®š NaN ç›¸ç­‰é€»è¾‘ï¼ˆè¯·å‚é˜… <a href="https://github.com/angular/angular/blob/50548fb5655bca742d1056ea91217a3b8460db08/modules/%20angular2%20/%20src%20/%20facade%20/%20lang.ts%EF%BC%83L367">here</a>ï¼‰ã€‚</p>

<h3 id="toc_7">åµŒå¥—å¯¹è±¡çš„ <code>owner</code> å¦‚ä½•å¤„ç†ï¼Ÿ</h3>

<p>æˆ‘ä»¬å¯ä»¥åœ¨å˜æ›´æ£€æµ‹å™¨ä»£ç ä¸­çœ‹åˆ° <code>owner</code> åµŒå¥—å¯¹è±¡çš„å±æ€§åŒæ ·è¢«æ£€æµ‹å·®å¼‚ã€‚ä½†æ˜¯åªæ¯”è¾ƒ firstname å±æ€§ï¼Œä¸æ¯”è¾ƒ lastname å±æ€§ã€‚</p>

<p>è¿™æ˜¯å› ä¸ºç»„ä»¶æ¨¡æ¿ä¸­æœªä½¿ç”¨ lastname ï¼ˆè¯·å‚é˜… <a href="https://github.com/jhades/blog.angular-university.io/blob/master/ng2-change-detection/src/todo_item.ts#L7">here</a>ï¼‰ï¼ åŒæ ·ï¼Œå‡ºäºç›¸åŒåŸå› ï¼Œæœªæ¯”è¾ƒ Todo çš„é¡¶çº§ id å±æ€§ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°è¯´ï¼š</p>

<blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒAngular å˜æ›´æ£€æµ‹é€šè¿‡æ£€æµ‹æ¨¡æ¿è¡¨è¾¾å¼çš„å€¼æ˜¯å¦å·²æ›´æ”¹æ¥å·¥ä½œã€‚è¿™æ˜¯é’ˆå¯¹æ‰€æœ‰ç»„ä»¶éƒ½åšçš„å¤„ç†ã€‚</p>
</blockquote>

<p>æˆ‘ä»¬è¿˜å¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š</p>

<blockquote>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒAngular ä¸ä¼šè¿›è¡Œæ·±åº¦å¯¹è±¡æ¯”è¾ƒæ¥æ£€æµ‹å˜æ›´ï¼Œå®ƒä»…è€ƒè™‘æ¨¡æ¿ä½¿ç”¨çš„å±æ€§ã€‚</p>
</blockquote>

<h3 id="toc_8">ä¸ºä»€ä¹ˆé»˜è®¤æƒ…å†µä¸‹å˜æ›´æ£€æµ‹å¦‚æ­¤å·¥ä½œï¼Ÿ</h3>

<p>Angular çš„ä¸»è¦ç›®æ ‡ä¹‹ä¸€æ˜¯æ›´åŠ é€æ˜å’Œæ˜“äºä½¿ç”¨ï¼Œä»è€Œä½¿æ¡†æ¶ç”¨æˆ·ä¸å¿…è´¹åŠ²åœ°è°ƒè¯•æ¡†æ¶å¹¶äº†è§£å†…éƒ¨æœºåˆ¶ï¼Œå°±èƒ½å¤Ÿæœ‰æ•ˆåœ°ä½¿ç”¨å®ƒã€‚</p>

<p>å¦‚æœä½ ç†Ÿæ‚‰ AngularJsï¼Œæƒ³è±¡ä¸€ä¸‹ <code>$digest()</code> å’Œ <code>$apply()</code> ä»¥åŠä½•æ—¶ä½¿ç”¨å®ƒä»¬æˆ–ä¸ä½¿ç”¨å®ƒä»¬çš„æ‰€æœ‰é™·é˜±ã€‚Angular çš„ä¸»è¦ç›®æ ‡ä¹‹ä¸€å°±æ˜¯é¿å…è¿™ç§æƒ…å†µã€‚</p>

<h3 id="toc_9">å¼•ç”¨å¦‚ä½•æ¯”è¾ƒ?</h3>

<p>äº‹å®ä¸Š Javascript å¯¹è±¡æ˜¯å¯å˜çš„ï¼ŒAngular å¸Œæœ›ä¸ºè¿™äº›å¯¹è±¡æä¾›å¼€ç®±å³ç”¨çš„å…¨é¢æ”¯æŒã€‚</p>

<p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœ Angular é»˜è®¤å˜æ›´æ£€æµ‹æœºåˆ¶å°†åŸºäºç»„ä»¶è¾“å…¥çš„å¼•ç”¨æ¯”è¾ƒè€Œä¸æ˜¯é»˜è®¤æœºåˆ¶ï¼Œé‚£å°†ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ å³ä½¿æ˜¯åƒ TODO åº”ç”¨ç¨‹åºè¿™æ ·ç®€å•çš„ä¸œè¥¿ï¼Œæ„å»ºèµ·æ¥ä¹Ÿå¾ˆæ£˜æ‰‹ï¼šå¼€å‘äººå‘˜å¿…é¡»éå¸¸å°å¿ƒåœ°åˆ›å»ºæ–°çš„ Todoï¼Œè€Œä¸æ˜¯ç®€å•åœ°æ›´æ–°å±æ€§ã€‚</p>

<p>ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„ï¼Œå¦‚æœæˆ‘ä»¬ç¡®å®éœ€è¦çš„è¯ï¼Œä»ç„¶å¯ä»¥è‡ªå®šä¹‰ Angular å˜æ›´æ£€æµ‹ã€‚</p>

<h3 id="toc_10">æ€§èƒ½å¦‚ä½•ï¼Ÿ</h3>

<p>è¯·æ³¨æ„ï¼Œtodo list ç»„ä»¶çš„å˜æ›´æ£€æµ‹å™¨å¦‚ä½•æ˜¾å¼å¼•ç”¨ <code>todos</code> å±æ€§ã€‚</p>

<p>åšåˆ°è¿™ä¸€ç‚¹çš„å¦ä¸€ç§æ–¹æ³•æ˜¯åœ¨ç»„ä»¶çš„å±æ€§ä¹‹é—´åŠ¨æ€å¾ªç¯ï¼Œä»è€Œä½¿ä»£ç é€šç”¨è€Œä¸æ˜¯ç‰¹å®šäºç»„ä»¶ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸å¿…åœ¨å¯åŠ¨æ—¶ä¸ºæ¯ä¸ªç»„ä»¶æ„å»ºä¸€ä¸ªå˜æ›´æ£€æµ‹å™¨ï¼ é‚£ä¹ˆè¿™æ˜¯æ€æ ·ä¸€å›äº‹å‘¢ï¼Ÿ</p>

<h3 id="toc_11">å¿«é€Ÿæµè§ˆè™šæ‹Ÿæœºå†…éƒ¨</h3>

<p>æ‰€æœ‰è¿™äº›éƒ½ä¸ Javascript è™šæ‹Ÿæœºçš„å·¥ä½œæ–¹å¼æœ‰å…³ã€‚å°½ç®¡é€šå¸¸ VM å³æ—¶ç¼–è¯‘å™¨æ— æ³•è½»æ˜“åœ°å°†ç”¨äºåŠ¨æ€æ¯”è¾ƒå±æ€§çš„ä»£ç ä¼˜åŒ–ä¸ºæœ¬æœºä»£ç ã€‚</p>

<p>è¿™ä¸å˜æ›´æ£€æµ‹å™¨çš„ç‰¹å®šä»£ç ä¸åŒï¼Œå˜æ›´æ£€æµ‹å™¨ç¡®å®æ˜¾å¼è®¿é—®æ¯ä¸ªç»„ä»¶è¾“å…¥å±æ€§ã€‚è¯¥ä»£ç éå¸¸ç±»ä¼¼äºæˆ‘ä»¬æ‰‹å·¥ç¼–å†™çš„ä»£ç ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“è¢«è™šæ‹Ÿæœºè½¬æ¢ä¸ºæœ¬åœ°ä»£ç ã€‚</p>

<p>ä½¿ç”¨ç”Ÿæˆçš„æ˜¾å¼çš„æ£€æµ‹å™¨çš„æœ€ç»ˆç»“æœæ˜¯ä¸€ç§å˜åŒ–æ£€æµ‹æœºåˆ¶ï¼Œè¯¥æœºåˆ¶éå¸¸å¿«ï¼ˆæ¯” AngularJs æ›´å¿«ï¼‰ï¼Œå¯é¢„æµ‹ä¸”æ˜“äºæ¨ç†ã€‚</p>

<p>ä½†æ˜¯ï¼Œå¦‚æœé‡åˆ°æ€§èƒ½å›°å¢ƒï¼Œæ˜¯å¦æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä¼˜åŒ–å˜æ›´æ£€æµ‹ï¼Ÿ</p>

<h2 id="toc_12">OnPush å˜æ›´æ£€æµ‹æ¨¡å¼</h2>

<p>å¦‚æœæˆ‘ä»¬çš„ Todo list çœŸçš„å¾ˆå¤§ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½® <a href="https://github.com/jhades/blog.angular-university.io/blob/master/ng2-change-detection/src/todo_list.ts">TodoList</a> ç»„ä»¶ä»…åœ¨ Todo list å˜æ›´æ—¶æ‰è¿›è¡Œæ›´æ–°ã€‚è¿™å¯ä»¥é€šè¿‡å°†ç»„ä»¶å˜æ›´æ£€æµ‹ç­–ç•¥æ”¹ä¸º <code>OnPush</code> æ¥å®Œæˆï¼š</p>

<pre><code class="language-javascript">@Component({
    selector: &#39;todo-list&#39;,
    changeDetection: ChangeDetectionStrategy.OnPush,
    template: ...
})
export class TodoList {
    ...
}
</code></pre>

<p>ç°åœ¨è®©æˆ‘ä»¬ç»™åº”ç”¨ç¨‹åºæ·»åŠ ä¸€å¯¹æŒ‰é’®ï¼šä¸€ä¸ªæŒ‰é’®é€šè¿‡ç›´æ¥å¯¹åˆ—è¡¨çš„ç¬¬ä¸€æ¡è¿›è¡Œæ”¹å˜æ¥åˆ‡æ¢ï¼Œå¦ä¸€ä¸ªæŒ‰é’®å°† Todo æ·»åŠ åˆ°æ•´ä¸ªåˆ—è¡¨ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-javascript">@Component({
    selector: &#39;app&#39;,
    template: `&lt;div&gt;
                    &lt;todo-list [todos]=&quot;todos&quot;&gt;&lt;/todo-list&gt;
               &lt;/div&gt;
               &lt;button (click)=&quot;toggleFirst()&quot;&gt;Toggle First Item&lt;/button&gt;
               &lt;button (click)=&quot;addTodo()&quot;&gt;Add Todo to List&lt;/button&gt;`
})
export class App {
    todos:Array = initialData;

    constructor() {
    }

    toggleFirst() {
        this.todos[0].completed = ! this.todos[0].completed;
    }

    addTodo() {
        let newTodos = this.todos.slice(0);
        newTodos.push( new Todo(1, &quot;TODO 4&quot;, 
            false, new Owner(&quot;John&quot;, &quot;Doe&quot;)));
        this.todos = newTodos;
    }
}
</code></pre>

<p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ä¸¤ä¸ªæ–°æŒ‰é’®çš„è¡Œä¸ºï¼š</p>

<ul>
<li>ç¬¬ä¸€ä¸ªæŒ‰é’®â€œToggle First Itemâ€ä¸èµ·ä½œç”¨ï¼ è¿™æ˜¯å› ä¸º <code>toggleFirst()</code> æ–¹æ³•ç›´æ¥ä½¿åˆ—è¡¨çš„å…ƒç´ å‘ç”Ÿæ”¹å˜ã€‚
<code>TodoList</code> æ— æ³•æ£€æµ‹åˆ°å®ƒï¼Œå› ä¸ºå®ƒçš„è¾“å…¥å¼•ç”¨ <code>todos</code> æ²¡æœ‰æ”¹å˜ã€‚</li>
<li>ç¬¬äºŒä¸ªæŒ‰é’®ç¡®å®èµ·ä½œç”¨ï¼ è¯·æ³¨æ„ï¼Œæ–¹æ³• <code>addTodo()</code> åˆ›å»ºäº† todo list çš„å‰¯æœ¬ï¼Œç„¶åå‘è¯¥å‰¯æœ¬æ·»åŠ äº†ä¸€ä¸ªé¡¹ç›®ï¼Œæœ€åç”¨å¤åˆ¶çš„ list æ›¿æ¢äº† todos æˆå‘˜å˜é‡ã€‚è¿™ä¼šè§¦å‘å˜æ›´æ£€æµ‹ï¼Œå› ä¸ºè¯¥ç»„ä»¶åœ¨å…¶è¾“å…¥ä¸­æ£€æµ‹åˆ°å¼•ç”¨å˜æ›´ï¼šå®ƒæ”¶åˆ°äº†ä¸€ä¸ªæ–°åˆ—è¡¨ï¼</li>
<li>åœ¨ç¬¬äºŒä¸ªæŒ‰é’®ä¸­ï¼Œç›´æ¥ä¿®æ”¹ todo list å°†ä¸èµ·ä½œç”¨ï¼æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°åˆ—è¡¨ã€‚</li>
</ul>

<h3 id="toc_13"><code>OnPush</code> çœŸçš„åªæ˜¯é€šè¿‡å¼•ç”¨æ¯”è¾ƒæ¯”è¾ƒè¾“å…¥å—?</h3>

<p>äº‹å®å¹¶éå¦‚æ­¤ï¼Œå¦‚æœä½ å°è¯•é€šè¿‡å•å‡»æ¥åˆ‡æ¢ todoï¼Œå®ƒä»ç„¶å¯ä»¥ä½¿ç”¨ï¼å³ä½¿ä½ å°† <a href="https://github.com/jhades/blog.angular-university.io/blob/master/ng2-change-detection/src/todo_item.ts">TodoItem</a> ä¹Ÿåˆ‡æ¢ä¸º <code>OnPush</code>ã€‚è¿™æ˜¯å› ä¸º <code>OnPush</code> ä¸ä»…ä»…æ£€æŸ¥ç»„ä»¶è¾“å…¥ä¸­çš„æ›´æ”¹ï¼šå¦‚æœç»„ä»¶å‘ç”Ÿäº‹ä»¶ï¼Œè¯¥äº‹ä»¶ä¹Ÿå°†è§¦å‘å˜æ›´æ£€æµ‹ã€‚</p>

<p>æ ¹æ®<a href="http://victorsavkin.com/post/110170125256/change-detection-in-angular-2">å¼•ç”¨</a>è‡ª Victor Savkin çš„åšå®¢ï¼š</p>

<blockquote>
<p>å½“ä½¿ç”¨ OnPush æ£€æµ‹å™¨æ—¶ï¼Œæ¡†æ¶å°†åœ¨å…¶ä»»ä½•è¾“å…¥å±æ€§å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œå½“å®ƒè§¦å‘äº‹ä»¶æˆ–å½“ Observable è§¦å‘äº‹ä»¶æ—¶æ£€æŸ¥ OnPush ç»„ä»¶ã€‚</p>
</blockquote>

<p>å°½ç®¡å¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ï¼Œä½†å¦‚æœä¸å¯å˜å¯¹è±¡ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™ä½¿ç”¨ <code>OnPush</code> çš„ä»£ä»·æ˜¯å¾ˆé«˜çš„å¤æ‚æ€§ã€‚å®ƒå¯èƒ½ä¼šå¼•å…¥éš¾ä»¥æ¨ç†å’Œé‡ç°çš„é”™è¯¯ã€‚ä½†æ˜¯æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä½¿ <code>OnPush</code> çš„ä½¿ç”¨æˆä¸ºå¯è¡Œçš„ã€‚</p>

<h3 id="toc_14">ä½¿ç”¨ Immutable.js ç®€åŒ– Angular åº”ç”¨ç¨‹åºçš„æ„å»º</h3>

<p>å¦‚æœæˆ‘ä»¬ä»…ä½¿ç”¨ä¸å¯å˜å¯¹è±¡å’Œä¸å¯å˜åˆ—è¡¨æ„å»ºåº”ç”¨ç¨‹åºï¼Œåˆ™å¯ä»¥åœ¨æ‰€æœ‰åœ°æ–¹ä½¿ç”¨ <code>OnPush</code>ï¼Œè€Œä¸ä¼šé™·å…¥å˜æ›´æ£€æµ‹é”™è¯¯çš„é£é™©ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºä¸å¯å˜å¯¹è±¡ï¼Œä¿®æ”¹æ•°æ®çš„å”¯ä¸€æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜å¯¹è±¡å¹¶æ›¿æ¢å…ˆå‰çš„å¯¹è±¡ã€‚å¯¹äºä¸å¯å˜çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥ä¿è¯ï¼š</p>

<ul>
<li>ä¸€ä¸ªæ–°çš„ä¸å¯å˜å¯¹è±¡å°†å§‹ç»ˆè§¦å‘ <code>OnPush</code> å˜æ›´æ£€æµ‹</li>
<li>æˆ‘ä»¬ä¸èƒ½å¿˜è®°åˆ›å»ºå¯¹è±¡çš„æ–°å‰¯æœ¬è€Œæ„å¤–åœ°äº§ç”Ÿé”™è¯¯ï¼Œå› ä¸ºä¿®æ”¹æ•°æ®çš„å”¯ä¸€æ–¹æ³•æ˜¯åˆ›å»ºæ–°å¯¹è±¡</li>
</ul>

<p>å¯¹äºä¸å¯å˜çš„ä¸€ä¸ªä¸é”™çš„é€‰æ‹©æ˜¯ä½¿ç”¨ <a href="https://facebook.github.io/immutable-js/">Immutable.js</a> åº“ã€‚è¯¥åº“æä¾›äº†ç”¨äºæ„å»ºåº”ç”¨ç¨‹åºçš„ä¸å¯å˜åŸºå…ƒï¼Œä¾‹å¦‚ä¸å¯å˜å¯¹è±¡ï¼ˆMapï¼‰å’Œä¸å¯å˜åˆ—è¡¨ã€‚</p>

<p>è¯¥åº“ä¹Ÿå¯ä»¥ä»¥ç±»å‹å®‰å…¨çš„æ–¹å¼ä½¿ç”¨ï¼Œé˜…è¯»<a href="https://blog.angular-university.io/angular-2-application-architecture-building-flux-like-apps-using-redux-and-immutable-js-js/">ä¹‹å‰çš„æ–‡ç« </a>ï¼Œä»¥è·å–æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„ç¤ºä¾‹ã€‚</p>

<h2 id="toc_15">é¿å…å˜æ›´æ£€æµ‹å¾ªç¯ï¼šç”Ÿäº§ä¸å¼€å‘æ¨¡å¼</h2>

<p>Angular å˜æ›´æ£€æµ‹çš„é‡è¦å±æ€§ä¹‹ä¸€æ˜¯ï¼Œå®ƒä¸ AngularJs ä¸åŒï¼Œå®ƒå¼ºåˆ¶æ‰§è¡Œå•å‘æ•°æ®æµï¼šå½“æ›´æ–°æ§åˆ¶å™¨ç±»ä¸Šçš„æ•°æ®æ—¶ï¼Œå˜æ›´æ£€æµ‹å°†è¿è¡Œå¹¶æ›´æ–°è§†å›¾ã€‚</p>

<p>ä½†æ˜¯è§†å›¾çš„æ›´æ–°æœ¬èº«å¹¶ä¸ä¼šè§¦å‘è¿›ä¸€æ­¥çš„æ›´æ”¹ï¼Œè€Œè¿™äº›æ›´æ”¹åˆä¼šè§¦å‘è§†å›¾çš„è¿›ä¸€æ­¥æ›´æ–°ï¼Œä»è€Œåœ¨ AngularJs ä¸­åˆ›å»ºäº† digest cycleã€‚</p>

<h3 id="toc_16">å¦‚ä½•åœ¨Angularä¸­è§¦å‘å˜æ›´æ£€æµ‹å¾ªç¯ï¼Ÿ</h3>

<p>ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå›è°ƒã€‚ä¾‹å¦‚ï¼Œåœ¨ <a href="https://github.com/jhades/blog.angular-university.io/blob/master/ng2-change-detection/src/todo_list.ts#L46">TodoList</a> ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è§¦å‘å›è°ƒåˆ°å¦ä¸€ä¸ªç»„ä»¶æ”¹å˜å…¶ä¸­ä¸€ä¸ªç»‘å®šï¼š</p>

<pre><code class="language-javascript">ngAfterViewChecked() {
    if (this.callback &amp;&amp; this.clicked) {
        console.log(&quot;changing status ...&quot;);
        this.callback(Math.random());
    }
}
</code></pre>

<p>é”™è¯¯æ¶ˆæ¯å°†æ˜¾ç¤ºåœ¨æ§åˆ¶å°ä¸­ï¼š</p>

<pre><code class="language-text">EXCEPTION: Expression &#39;{{message}} in App@3:20&#39; has changed after it was checked
</code></pre>

<p>ä»…å½“æˆ‘ä»¬åœ¨å¼€å‘æ¨¡å¼ä¸‹è¿è¡Œ Angular æ—¶ï¼Œæ‰ä¼šå¼•å‘æ­¤é”™è¯¯æ¶ˆæ¯ã€‚å¦‚æœå¯ç”¨ç”Ÿäº§æ¨¡å¼ä¼šæ€æ ·ï¼Ÿ</p>

<pre><code class="language-javascript">@NgModule({
    declarations: [App],
    imports: [BrowserModule],
    bootstrap: [App]
})
export class AppModule {}
</code></pre>

<p>åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼Œä¸ä¼šå¼•å‘è¯¥é”™è¯¯ï¼Œå¹¶ä¸”ä¸ä¼šå‘ç°é—®é¢˜ã€‚</p>

<h3 id="toc_17">å˜æ›´æ£€æµ‹é—®é¢˜ç»å¸¸å‘ç”Ÿå—ï¼Ÿ</h3>

<p>æˆ‘ä»¬çš„ç¡®å¿…é¡»ç«­å°½å…¨åŠ›è§¦å‘å˜æ›´æ£€æµ‹å¾ªç¯ï¼Œä½†ä»¥é˜²ä¸‡ä¸€æœ€å¥½åœ¨å¼€å‘é˜¶æ®µå§‹ç»ˆä½¿ç”¨å¼€å‘æ¨¡å¼ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥é¿å…é—®é¢˜ã€‚</p>

<p>è¿™ç§ä¿è¯æ˜¯ä»¥ Angular å§‹ç»ˆè¿è¡Œå˜æ›´æ£€æµ‹ä¸¤æ¬¡ä¸ºä»£ä»·çš„ï¼Œè¿™æ˜¯ç¬¬äºŒæ¬¡æ£€æµ‹æ­¤ç±»æƒ…å†µã€‚åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼Œå˜æ›´æ£€æµ‹ä»…è¿è¡Œä¸€æ¬¡ã€‚</p>

<h2 id="toc_18">æ‰“å¼€ / å…³é—­å˜æ›´æ£€æµ‹å¹¶æ‰‹åŠ¨è§¦å‘</h2>

<p>åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç¡®å®å¸Œæœ›å…³é—­å˜æ›´æ£€æµ‹ã€‚æƒ³è±¡ä¸€ä¸‹ä¸€ç§æƒ…å†µï¼Œå…¶ä¸­å¤§é‡æ•°æ®é€šè¿‡ Websocket ä»åç«¯åˆ°è¾¾ã€‚æˆ‘ä»¬å¯èƒ½åªæƒ³æ¯ 5 ç§’æ›´æ–°ä¸€æ¬¡ UI çš„ç‰¹å®šéƒ¨åˆ†ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆå°†å˜æ›´æ£€æµ‹å™¨æ³¨å…¥åˆ°ç»„ä»¶ä¸­ï¼š</p>

<pre><code class="language-javascript">constructor(private ref: ChangeDetectorRef) {
    ref.detach();
    setInterval(() =&gt; {
      this.ref.detectChanges();
    }, 5000);
  }
</code></pre>

<p>å¦‚æˆ‘ä»¬æ‰€è§ï¼Œæˆ‘ä»¬åªæ˜¯æ‹†ä¸‹äº†å˜æ›´æ£€æµ‹å™¨ï¼Œè¿™æœ‰æ•ˆåœ°å…³é—­äº†å˜æ›´æ£€æµ‹ã€‚ç„¶åï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨ <code>detectChanges()</code> æ¯ 5 ç§’æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ã€‚</p>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿæ€»ç»“ä¸€ä¸‹æœ‰å…³ Angular å˜æ›´æ£€æµ‹æ‰€éœ€çš„æ‰€æœ‰çŸ¥è¯†ï¼šå®ƒæ˜¯ä»€ä¹ˆï¼Œå®ƒå¦‚ä½•å·¥ä½œä»¥åŠå˜æ›´æ£€æµ‹ä¸»è¦çš„å¯ç”¨ç±»å‹æ˜¯ä»€ä¹ˆã€‚</p>

<h2 id="toc_19">æ€»ç»“</h2>

<p>Angular å˜æ›´æ£€æµ‹æ˜¯å†…ç½®çš„æ¡†æ¶åŠŸèƒ½ï¼Œå¯ç¡®ä¿ç»„ä»¶æ•°æ®ä¸å…¶ HTML æ¨¡æ¿è§†å›¾ä¹‹é—´çš„è‡ªåŠ¨åŒæ­¥ã€‚</p>

<p>å˜æ›´æ£€æµ‹é€šè¿‡æ£€æµ‹å¸¸è§çš„æµè§ˆå™¨äº‹ä»¶ï¼ˆä¾‹å¦‚é¼ æ ‡å•å‡»ï¼ŒHTTP è¯·æ±‚å’Œå…¶ä»–ç±»å‹çš„äº‹ä»¶ï¼‰ï¼Œå¹¶ç¡®å®šæ˜¯å¦éœ€è¦æ›´æ–°æ¯ä¸ªç»„ä»¶çš„è§†å›¾æ¥èµ·ä½œç”¨ã€‚</p>

<p>å˜æ›´æ£€æµ‹æœ‰ä¸¤ç§ç±»å‹ï¼š</p>

<ul>
<li>é»˜è®¤å˜æ›´æ£€æµ‹ï¼šAngular é€šè¿‡æ¯”è¾ƒäº‹ä»¶å‘ç”Ÿä¹‹å‰å’Œä¹‹åçš„æ‰€æœ‰æ¨¡æ¿è¡¨è¾¾å¼å€¼ï¼ˆå¯¹äºç»„ä»¶æ ‘çš„æ‰€æœ‰ç»„ä»¶ï¼‰æ¥å†³å®šæ˜¯å¦éœ€è¦æ›´æ–°è§†å›¾ã€‚</li>
<li>OnPush å˜æ›´æ£€æµ‹ï¼šè¿™æ˜¯é€šè¿‡æ£€æµ‹ä¸€äº›æ–°æ•°æ®æ˜¯å¦å·²é€šè¿‡ç»„ä»¶è¾“å…¥æˆ–ä½¿ç”¨å¼‚æ­¥ç®¡é“è®¢é˜…çš„ Observable æ˜¾å¼æ¨é€åˆ°ç»„ä»¶ä¸­è€Œèµ·ä½œç”¨çš„ã€‚ï¼ˆè¿˜æœ‰è§¦å‘äº‹ä»¶ï¼‰</li>
</ul>

<p>Angularçš„<strong>é»˜è®¤</strong>å˜æ›´æ£€æµ‹æœºåˆ¶å®é™…ä¸Šä¸ AngularJs ç›¸ä¼¼ï¼šå®ƒæ¯”è¾ƒæµè§ˆå™¨äº‹ä»¶å‰åçš„æ¨¡æ¿è¡¨è¾¾å¼çš„å€¼ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦æœ‰æ‰€æ›´æ”¹ã€‚<strong>æ‰€æœ‰</strong>ç»„ä»¶éƒ½è¿™æ ·åšã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›é‡è¦çš„åŒºåˆ«ï¼š</p>

<p>å…¶ä¸€ï¼Œæ²¡æœ‰å˜æ›´æ£€æµ‹å¾ªç¯ï¼Œä¹Ÿæ²¡æœ‰åƒ AngularJs ä¸­çš„ digest cycleã€‚è¿™å…è®¸ä»…é€šè¿‡æŸ¥çœ‹å…¶æ¨¡æ¿å’Œå…¶æ§åˆ¶å™¨å°±å¯ä»¥æ¨æ–­å‡ºæ¯ä¸ªç»„ä»¶ã€‚</p>

<p>å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œç”±äºæ„å»ºäº†å˜æ›´æ£€æµ‹å™¨ï¼Œå› æ­¤ç»„ä»¶ä¸­æ£€æµ‹å˜æ›´çš„æœºåˆ¶è¦å¿«å¾—å¤šã€‚</p>

<p>æœ€åï¼Œä¸ AngularJs ä¸åŒï¼Œå˜æ›´æ£€æµ‹æœºåˆ¶æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ã€‚</p>

<div class="footnotes">
<hr/>
<ol>

<li id="fn1">
<p>JavaScript VMï¼ŒJavaScript è™šæ‹Ÿæœºï¼Œå³ JavaScript å¼•æ“ã€‚&nbsp;<a href="#fnref1" rev="footnote">&#8617;</a></p>
</li>

</ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[States and Fates]]></title>
    <link href="2019919.xyz/16129618605374.html"/>
    <updated>2021-02-10T20:57:40+08:00</updated>
    <id>2019919.xyz/16129618605374.html</id>
    <content type="html"><![CDATA[
<p>This document helps clarify the different adjectives surrounding promises, by dividing them up into two categories: <strong>states</strong> and <strong>fates</strong>.</p>

<blockquote>
<p>æœ¬æ–‡æ¡£é˜æ˜å›´ç»• Promise çš„å„ç§å½¢å®¹è¯ï¼ŒæŠŠå®ƒä»¬åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<strong>çŠ¶æ€</strong>å’Œ<strong>å‘½è¿</strong>ã€‚</p>
</blockquote>

<h2 id="toc_0">States</h2>

<p>Promises have three possible mutually exclusive states: fulfilled, rejected, and pending.</p>

<blockquote>
<p>Promise æœ‰ä¸‰ç§å¯èƒ½çš„äº’æ–¥ç‹¬ç«‹çŠ¶æ€ï¼šå·²å…‘ç°ã€å·²æ‹’ç»ã€å¾…å®šã€‚</p>
</blockquote>

<ul>
<li>A promise is <em>fulfilled</em> if <code>promise.then(f)</code> will call <code>f</code> &quot;as soon as possible.&quot;</li>
</ul>

<blockquote>
<ul>
<li>å¦‚æœ <code>promise.then(f)</code> ä¼šé©¬ä¸Šè°ƒç”¨ <code>f</code>ï¼Œé‚£ä¹ˆ promise æ˜¯å·²å…‘ç°çŠ¶æ€ã€‚</li>
</ul>
</blockquote>

<ul>
<li>A promise is <em>rejected</em> if <code>promise.then(undefined, r)</code> will call <code>r</code> &quot;as soon as possible.&quot;</li>
</ul>

<blockquote>
<ul>
<li>å¦‚æœ <code>promise.then(undefined, r)</code> ä¼šé©¬ä¸Šè°ƒç”¨ <code>r</code>ï¼Œé‚£ä¹ˆ promise æ˜¯å·²æ‹’ç»çŠ¶æ€ã€‚</li>
</ul>
</blockquote>

<ul>
<li>A promise is <em>pending</em> if it is neither fulfilled nor rejected.</li>
</ul>

<blockquote>
<ul>
<li>å¦‚æœå®ƒæ—¢ä¸æ˜¯å·²å…‘ç°ä¹Ÿä¸æ˜¯å·²æ‹’ç»ï¼Œé‚£ä¹ˆ promise æ˜¯å¾…å®šçŠ¶æ€ã€‚</li>
</ul>
</blockquote>

<p>We say that a promise is <em>settled</em> if it is not pending, i.e. if it is either fulfilled or rejected. Being settled is not a state, just a linguistic convenience.</p>

<blockquote>
<p>å¦‚æœ promise ä¸æ˜¯å¾…å®šçŠ¶æ€ï¼Œæˆ‘ä»¬è¯´å®ƒ<em>å·²æ•²å®š</em>ï¼Œæ— è®ºå®ƒæ˜¯å·²å…‘ç°è¿˜æ˜¯å·²æ‹’ç»ã€‚å·²æ•²å®šä¸æ˜¯ä¸€ä¸ªçŠ¶æ€ï¼ŒçŸ¥è¯†ä¸€ä¸ªè¯­è¨€ä¸Šçš„ä¾¿åˆ©ã€‚</p>
</blockquote>

<h2 id="toc_1">Fates</h2>

<p>Promises have two possible mutually exclusive fates: resolved, and unresolved.</p>

<blockquote>
<p>Promise æœ‰ä¸¤ç§å¯èƒ½çš„äº’æ–¥ç‹¬ç«‹å‘½è¿ï¼šå·²å†³è®®ï¼Œæœªå†³è®®ã€‚</p>
</blockquote>

<ul>
<li>A promise is <em>resolved</em> if trying to resolve or reject it has no effect, i.e. the promise has been &quot;locked in&quot; to either follow another promise, or has been fulfilled or rejected.</li>
</ul>

<blockquote>
<ul>
<li>å¦‚æœ promise å·²å†³è®®ï¼Œå°è¯•å†³è®®æˆ–æ‹’ç»å®ƒæ˜¯æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œpromise è¢«æ¥ä¸‹æ¥å…¶ä»– promise é”å®šï¼Œæˆ–è€…å·²è¢«å…‘ç°æˆ–æ‹’ç»ã€‚</li>
</ul>
</blockquote>

<ul>
<li>A promise is <em>unresolved</em> if it is not resolved, i.e. if trying to resolve or reject it will have an impact on the promise.</li>
</ul>

<blockquote>
<p>å¦‚æœ promise æœªå†³è®®ï¼Œå¦‚æœå°è¯•å…‘ç°æˆ–æ‹’ç»ä¼šå¯¹ promise äº§ç”Ÿå½±å“ã€‚</p>
</blockquote>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JavaScript æ·±æµ…æ‹·è´]]></title>
    <link href="2019919.xyz/16124460113427.html"/>
    <updated>2021-02-04T21:40:11+08:00</updated>
    <id>2019919.xyz/16124460113427.html</id>
    <content type="html"><![CDATA[
<p>åœ¨æ•°ç»„ç« èŠ‚æåˆ°æ•°ç»„çš„å±•å¼€è¿ç®—ç¬¦æ—¶ï¼Œä½œè€…ä¸¾ä¾‹è¯´æ˜å±•å¼€è¿ç®—ç¬¦å¯ä»¥è¿›è¡Œæ‹·è´ï¼ŒåŸä¸ºå¦‚ä¸‹ï¼š</p>

<blockquote>
<p>The spread operator is a convenient way to create a (shallow) copy of an array:</p>
</blockquote>

<pre><code class="language-javascript">let original = [1,2,3];
let copy = [...original];
copy[0] = 0;  // Modifying the copy does not change the original
original[0]   // =&gt; 1
</code></pre>

<p>copy å¯¹è±¡ä¸º original å±•å¼€åçš„æ•°ç»„å­—é¢é‡ï¼Œä½†æ˜¯æ‹·è´åçš„æ•°ç»„ä¿®æ”¹äº†åºåˆ—ä¸º 0 çš„å…ƒç´ çš„å€¼ï¼Œä½†æ˜¯è¢«æ‹·è´æ•°ç»„ä¸­åºåˆ—ä¸º 0 çš„å…ƒç´ çš„å€¼å¹¶æ²¡æœ‰è¢«æ”¹å˜ï¼Œä½œè€…ç§°è¿™æ ·çš„æ‹·è´ä¸ºæµ…æ‹·è´ï¼Œ</p>

<p>åœ¨æˆ‘çš„å°è±¡ä¸­æ·±æµ…æ‹·è´æ˜¯å¦‚ä¸‹å½¢å¼çš„ï¼š</p>

<ul>
<li>æµ…æ‹·è´ï¼ˆshallowCopyï¼‰åªæ˜¯å¢åŠ äº†ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å·²å­˜åœ¨çš„å†…å­˜åœ°å€ï¼Œåœ¨ä¿®æ”¹äº†æ‹·è´å…ƒï¼Œæ‹·è´å…ˆä¹Ÿä¼šè·Ÿç€æ”¹å˜ã€‚</li>
<li>æ·±æ‹·è´ï¼ˆdeepCopyï¼‰æ˜¯å¢åŠ äº†ä¸€ä¸ªæŒ‡é’ˆå¹¶ä¸”ç”³è¯·äº†ä¸€ä¸ªæ–°çš„å†…å­˜ï¼Œä½¿è¿™ä¸ªå¢åŠ çš„æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªæ–°çš„å†…å­˜ï¼Œæ‹·è´å…ƒå’Œæ‹·è´ä¹‹é—´è„±ç¦»äº†å…³ç³»ã€‚</li>
</ul>

<p>ä½†æ˜¯è¿™ä¸ªå®ä¾‹ä¸­ï¼Œä½œè€…åªæµ‹è¯•äº†æ‹·è´å…ˆçš„ä¿®æ”¹ï¼Œæˆ‘åˆåšäº†å¦‚ä¸‹æµ‹è¯•ï¼š</p>

<pre><code class="language-javascript">let original = [1,2,3];
let copy = [...original];
original[0] = 10;
copy[0]  // =&gt; 1
</code></pre>

<p>å°±æ˜¯è¯´åœ¨ä¿®æ”¹è¢«æ‹·è´æ•°ç»„æ—¶ï¼Œæ‹·è´åçš„æ•°ç»„ä¹Ÿä¸è·Ÿéšæ”¹å˜ã€‚<br/>
æ‰€ä»¥ä½œè€…çš„æµ…æ‹·è´æŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<br/>
é—®é¢˜éœ€è¦æœ€æ ¹æº¯æºï¼Œä»åŸºç¡€æ¥è§£å†³é—®é¢˜ï¼Œä¸‹é¢å°±å…ˆæ¥å›æº¯ä¸‹æ•°æ®ç±»å‹ã€‚</p>

<h2 id="toc_0">JavaScript æ•°æ®ç±»å‹</h2>

<p>æœ€æ–°Â ECMAScriptÂ æ ‡å‡†å®šä¹‰äº†ä¹ç§ç±»å‹ï¼š</p>

<ul>
<li>å…­ä¸ªæ•°æ®ç±»å‹</li>
</ul>

<pre><code class="language-javascript">typeofÂ undefinedÂ ===Â &#39;undefined&#39;;
typeofÂ trueÂ ===Â &#39;boolean&#39;;
typeofÂ 123Â ===Â &#39;number&#39;;
typeofÂ &#39;str&#39;Â ===Â &#39;string&#39;;
typeofÂ 123nÂ ===&#39;bigint&#39;;
typeofÂ Symbol(&#39;symbol&#39;)Â ===Â &#39;symbol&#39;;
</code></pre>

<ul>
<li>ä¸¤ä¸ªç»“æ„ç±»å‹</li>
</ul>

<pre><code class="language-javascript">typeofÂ {}Â ===Â &#39;object&#39;;
typeofÂ (()Â =&gt;Â {})Â ===Â &#39;function&#39;;
</code></pre>

<ul>
<li>ç»“æ„æ ¹</li>
</ul>

<pre><code class="language-javascript">typeofÂ nullÂ ===Â &#39;object&#39;;
</code></pre>

<p>ä»¥ä¸Šä¹ç§ç±»å‹åˆåˆ†ä¸ºåŸå§‹å€¼ï¼ˆPrimitiveÂ Valueï¼‰å’Œå¯¹è±¡ï¼ˆObjectï¼‰ï¼š</p>

<ul>
<li>PrimitiveÂ values
<ul>
<li>BooleanÂ type</li>
<li>NullÂ type</li>
<li>UndefinedÂ type</li>
<li>NumberÂ type</li>
<li>BigIntÂ type</li>
<li>StringÂ type</li>
<li>SymbolÂ type</li>
</ul></li>
<li>Objects</li>
</ul>

<p>åŸå§‹å€¼ï¼ˆåˆååŸºæœ¬ç±»å‹ï¼‰å…¶å€¼å­˜æ”¾åœ¨æ ˆä¸­ï¼Œå®ƒçš„å€¼æ— æ³•è¢«ä¿®æ”¹ï¼Œå½“å¯¹åŸºæœ¬ç±»å‹è¿›è¡Œæ“ä½œæ—¶ï¼Œä¼šåœ¨æ–°çš„ç©ºé—´å†…åˆ›å»ºä¸€ä¸ªåŸå§‹å€¼ã€‚</p>

<p>å¯¹è±¡ä¹Ÿå°±æ˜¯å¼•ç”¨ç±»å‹ï¼ˆåˆåå¤æ‚ç±»å‹ï¼‰ï¼Œå®ƒåªåœ¨æ ˆä¸­ä¿å­˜å…¶å†…å­˜åœ°å€ï¼ŒæŒ‡å‘å­˜åœ¨å †ä¸­çš„æ•°æ®ï¼Œå½“å¯¹å…¶è¿›è¡Œä¿®æ”¹æ—¶ï¼Œæ ˆå†…çš„åœ°å€è¿›è¡Œæ”¹å˜ï¼ŒæŒ‡å‘å †ä¸­å¦å¤–çš„æ•°æ®ã€‚</p>

<h2 id="toc_1">é—®é¢˜è§£å†³</h2>

<p>ç°åœ¨å†å›æƒ³ä¸€ä¸‹æ·±æµ…æ‹·è´çš„å®šä¹‰å°±ä¼šå‘ç°ï¼Œå…¶åªæ˜¯é’ˆå¯¹å¤æ‚ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨åŸæ–‡ä¸­æ‰€ç”¨ç¤ºä¾‹åœ¨ç”¨å±•å¼€è¿ç®—ç¬¦å¯¹Â originalÂ æ•°ç»„è¿›è¡Œæ‹·è´ï¼Œè€Œå…¶æ‹·è´çš„å€¼æ˜¯åˆå§‹æ•°ç»„å†…çš„å…ƒç´ ï¼Œè€Œå…¶å…ƒç´ åªæ˜¯Â numberÂ ç±»å‹çš„åŸå§‹å€¼ï¼Œå› æ­¤è¿™ä¸ªå®ä¾‹æ— æ³•å±•ç¤ºå…¶æµ…æ‹·è´ç‰¹æ€§ã€‚</p>

<p>äº†è§£äº†è¿™äº›åï¼Œé’ˆå¯¹å¼•ç”¨ç±»å‹åšä¸€ä¸ªå®éªŒï¼š</p>

<pre><code class="language-javascript">letÂ originalÂ =Â [{a:1},2,3];
letÂ copyÂ =Â [...original];
original[0].aÂ =Â 10;
copy[0].a;Â //Â =&gt;Â 10
</code></pre>

<p>è¿™ä¸ªä¾‹å­ä¸­åˆå§‹æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹æ•°æ®ï¼Œæ‹·è´åå¯¹å…¶ä¸­çš„Â aÂ å±æ€§è¿›è¡Œä¿®æ”¹ï¼Œæœç„¶æ‹·è´åçš„æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„Â aÂ å±æ€§å€¼ä¹Ÿè¢«ä¿®æ”¹ã€‚å¦‚æ­¤è¯æ˜äº†å±•å¼€è¿ç®—ç¬¦çš„ç¡®æ˜¯æµ…æ‹·è´ã€‚</p>

<h2 id="toc_2">Â æ€»ç»“</h2>

<p>è¿™æ¬¡çš„é”™è¯¯ç†è§£çš„æ ¹æºæ˜¯å¯¹åŸºæœ¬æ¦‚å¿µæŒæ¡çš„ä¸å¤Ÿç‰¢å›ºï¼Œè¿™é‡Œå±•å¼€è¿ç®—ç¬¦åªæ˜¯å°†åˆå§‹æ•°ç»„ä¸­çš„å…ƒç´ å±•å¼€åˆ°ä¸€ä¸ªæ–°çš„æ•°ç»„å­—é¢é‡ä¸­ï¼Œå› æ­¤å¹¶ä¸æ˜¯æ‹·è´æ•´ä¸ªæ•°ç»„ï¼Œè€Œæ˜¯æ‹·è´æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥æ·±æµ…æ‹·è´çš„æè¿°å¯¹è±¡ä¹Ÿæ˜¯æ•°ç»„ä¸­çš„å…ƒç´ ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é€šè¿‡å‡½æ•°å£°æ˜å’Œè°ƒç”¨æŒæ¡å‡½æ•°çš„ this å€¼]]></title>
    <link href="2019919.xyz/16107633205948.html"/>
    <updated>2021-01-16T10:15:20+08:00</updated>
    <id>2019919.xyz/16107633205948.html</id>
    <content type="html"><![CDATA[
<p>å‡½æ•°çš„ this å¯¹äºåŸºç¡€è–„å¼±çš„å‰ç«¯ç¨‹åºå‘˜ä¸€ç›´æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„é—®é¢˜ï¼Œåœ¨å¯¹ ES6 çš„æ¨¡ç³Šå’Œå¯¹ ES6 ä¹‹å‰çš„å‡½æ•°ä½œç”¨åŸŸä¸ç†è§£åŒé‡æ‰“å‡»ä¸‹ï¼Œå¾€å¾€æ— æ³•åŒºåˆ† this å€¼åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œå› è€Œåœ¨ç¼–å†™ç¨‹åºæ—¶å¸¸å¸¸éœ€è¦é€šè¿‡æµ‹è¯•å½“å‰ä½œç”¨åŸŸçš„ this æ˜¯ä»€ä¹ˆï¼Œå†å»ä½¿ç”¨ï¼Œç”šè‡³æ˜¯æŸäº›å…¬å¸ä¸¥æ ¼è§„å®šå“ªç§æ–¹å¼å»å®ç°ã€‚</p>

<p>ç»†ç»†çš„çœ‹å®Œäº†æƒå¨æŒ‡å—çš„ç¬¬ä¸ƒç‰ˆå—ç›Šé¢‡å¤šï¼Œä½†æ˜¯ä½œè€…å¹¶æ²¡æœ‰æ‹¿å‡ºä¸€ä¸ªç« èŠ‚ä¸“é—¨å°†ç›¸å…³å†…å®¹è¿›è¡Œæ±‡æ€»ï¼Œè¿™é‡Œå°±é€šè¿‡å‡½æ•°çš„å£°æ˜å’Œè°ƒç”¨æ¥æ€»ç»“ä¸‹å‡½æ•° this å€¼çš„å‡ ç§æƒ…å†µã€‚</p>

<h2 id="toc_0">Â å‡½æ•°å®šä¹‰</h2>

<p>å‡½æ•°çš„å®šä¹‰æœ‰å¤šç§æ–¹å¼æ¥é€‚åº”ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼š</p>

<ul>
<li>å‡½æ•°å£°æ˜è¯­å¥</li>
<li>å‡½æ•°è¡¨è¾¾å¼</li>
<li>ç®­å¤´å‡½æ•°</li>
<li>åµŒå¥—å‡½æ•°</li>
<li>åº”ç”¨å‡½æ•°çš„æ„é€ å‡½æ•°Â Function()</li>
</ul>

<h3 id="toc_1">Â å‡½æ•°å£°æ˜è¯­å¥</h3>

<p>ä¸å¤§å¤šæ•°å£°æ˜è¯­å¥ä¸€æ ·ï¼Œä»¥å…³é”®å­—Â +Â åç§°çš„å½¢å¼æ¥è¿›è¡Œå£°æ˜ï¼Œå‡½æ•°ç”¨å…³é”®å­—Â functionÂ æ¥å£°æ˜ï¼š</p>

<pre><code class="language-javascript">functionÂ testOutPut(){
Â Â Â Â console.log(&#39;HelloÂ world!&#39;);Â Â Â Â Â Â Â Â 
}
</code></pre>

<p>å‡½æ•°å£°æ˜è¯­å¥æ˜¯å‡½æ•°åå˜æˆä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„å€¼æ˜¯å‡½æ•°æœ¬èº«ã€‚è¿™é‡Œå®é™…ä¸Šæ˜¯å£°æ˜äº†ä¸€ä¸ªÂ testOutPutÂ å˜é‡ï¼Œå¹¶è®²å‡½æ•°å¯¹è±¡èµ‹å€¼ç»™Â testOutPutã€‚åœ¨Â JavaScriptÂ çš„è¿è¡Œæ—¶ä¸­ï¼Œå‡½æ•°å¯¹è±¡åˆ›å»ºäºè¯¥å‡½æ•°æ‰€åœ¨ä½œç”¨åŸŸçš„ä»£ç å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œå¯ä»¥å…ˆæ‰§è¡Œå‡½æ•°è°ƒç”¨å†è¿›è¡Œå‡½æ•°è¯­å¥å£°æ˜ã€‚åªæ˜¯ç¬¬ä¸€ä¸ªå‡½æ•°ä½œä¸ºå€¼çš„æ¦‚å¿µçš„åº”ç”¨åœºæ™¯ã€‚</p>

<h3 id="toc_2">Â å‡½æ•°è¡¨è¾¾å¼</h3>

<p>å‡½æ•°è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªèµ‹å€¼è¯­å¥ï¼Œå°†ä¸€ä¸ªå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡æˆ–å¸¸é‡ã€‚æ„Ÿè§‰å‡½æ•°è¡¨è¾¾å¼è·Ÿå‡½æ•°å£°æ˜è¯­å¥çš„è¿è¡Œæ—¶ä¸€æ ·ï¼Œä½†æ˜¯å¦‚æœå…ˆè¿›è¡Œå‡½æ•°è°ƒç”¨å†è¿›è¡Œå‡½æ•°è¡¨è¾¾å¼æ¥å®šä¹‰å‡½æ•°å°†ä¼šå¼‚å¸¸ã€‚å› ä¸ºå‡½æ•°è¡¨è¾¾å¼åœ¨æ²¡æœ‰æ‰§è¡Œå‰å¹¶æ²¡æœ‰å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡ï¼Œæ‰€ä»¥å®ƒä¹Ÿå°±ä¸èƒ½è¢«å¼•ç”¨ã€‚</p>

<pre><code class="language-javascript">beforeDefined();
letÂ beforeDefinedÂ =Â function(){console.log(1);}
//Â UncaughtÂ ReferenceError:Â beforeDefinedÂ isÂ notÂ defined
</code></pre>

<p>å‡½æ•°è¡¨è¾¾å¼çš„å‡½æ•°åç§°æ˜¯å¯é€‰é¡¹ï¼Œå¦‚æœç»™å‡½æ•°è¡¨è¾¾å¼æ·»åŠ ä¸€ä¸ªå‡½æ•°åï¼Œé‚£è¿™ä¸ªå‡½æ•°çš„<em>å±€éƒ¨å‡½æ•°ä½œç”¨åŸŸå†…</em>ä¼šåŒ…å«è¯¥å±æ€§çš„å‡½æ•°åçš„å¯¹è±¡ï¼Œå…¶å€¼ç»‘å®šçš„æ˜¯è¯¥å‡½æ•°ï¼š</p>

<pre><code class="language-javascript">constÂ fÂ =Â functionÂ fact(x)Â {
Â Â Â Â ifÂ (xÂ &lt;=Â 1)Â returnÂ 1;
Â Â Â Â elseÂ returnÂ x*fact(x-1);
};
</code></pre>

<p>åªæœ‰åœ¨å‡½æ•°å±€éƒ¨ä½œç”¨åŸŸå†…ä¼šæœ‰è¿™ä¸ªå¯¹è±¡ï¼Œæœ‰ç‚¹é—­åŒ…çš„æ„Ÿè§‰ã€‚</p>

<h3 id="toc_3">Â ç®­å¤´å‡½æ•°</h3>

<p>ç®­å¤´å‡½æ•°æ˜¯Â ES6Â çš„æ–°ç‰¹æ€§ï¼Œåœ¨å®é™…ç”Ÿäº§ä¸­éå¸¸å¸¸ç”¨ã€‚å®ƒæ”¯æŒå¾ˆå¤šç®€æ´è¯­æ³•ï¼š</p>

<pre><code class="language-javascript">constÂ sumÂ =Â (x,Â y)Â =&gt;Â {Â returnÂ xÂ +Â y;Â };
constÂ sumÂ =Â (x,Â y)Â =&gt;Â xÂ +Â y;
constÂ polynomialÂ =Â xÂ =&gt;Â x*xÂ +Â 2*xÂ +Â 3;
constÂ constantFuncÂ =Â ()Â =&gt;Â 42;
</code></pre>

<p>æ³¨æ„å‚æ•°å’Œç®­å¤´ä¹‹é—´ä¸èƒ½æ¢è¡Œï¼Œå¦åˆ™ä¼šå¼•èµ·æ­§ä¹‰ã€‚<br/>
é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒæœ€å¤§çš„ç‰¹æ€§å°±æ˜¯å®ƒç»§æ‰¿å®šä¹‰å®ƒç¯å¢ƒçš„Â thisÂ å€¼ï¼Œæˆ‘ç†è§£æ·»åŠ ç®­å¤´å‡½æ•°çš„ç›®çš„å°±æ˜¯ä¸ºäº†è§£å†³æ–¹æ³•çš„åµŒå¥—å‡½æ•°Â thisÂ å€¼ä¸ºå…¨å±€å¯¹è±¡ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯Â undefinedï¼‰çš„ç¼ºé™·ï¼š</p>

<pre><code class="language-javascript">letÂ oÂ =Â {
Â Â Â Â a:1,
Â Â Â Â m:function(){
Â Â Â Â Â Â Â Â letÂ selfÂ =Â this;
Â Â Â Â Â Â Â Â console.log(thisÂ ===Â o);
Â Â Â Â Â Â Â Â f();
Â Â Â Â Â Â Â Â functionÂ f(){
Â Â Â Â Â Â Â Â Â Â Â Â console.log(thisÂ ===Â o);
Â Â Â Â Â Â Â Â Â Â Â Â console.log(selfÂ ===Â o);
Â Â Â Â Â Â Â Â Â Â Â Â console.log(this);
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}
o.m();
//Â true
//Â flase
//Â true
//Â Window{...}
</code></pre>

<p>åœ¨Â ES6Â ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡é—­åŒ…å°†Â thisÂ å€¼ä¿å­˜åœ¨å˜é‡ä¸­ä½¿ç”¨ï¼Œè€Œæœ‰äº†ç®­å¤´å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥ç»§æ‰¿Â mÂ æ–¹æ³•çš„Â thisÂ å€¼ï¼š</p>

<pre><code class="language-javascript">oÂ =Â {
Â Â Â Â a:1,
Â Â Â Â m:function(){
Â Â Â Â Â Â Â Â letÂ selfÂ =Â this;
Â Â Â Â Â Â Â Â console.log(thisÂ ===Â o);
Â Â Â Â Â Â Â Â constÂ fÂ =Â ()Â =&gt;Â {
Â Â Â Â Â Â Â Â Â Â Â Â console.log(thisÂ ===Â o);
Â Â Â Â Â Â Â Â Â Â Â Â console.log(selfÂ ===Â o);
Â Â Â Â Â Â Â Â Â Â Â Â console.log(this);
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â f();
Â Â Â Â }
}
o.m();
//Â true
//Â true
//Â true
//Â {a:Â 1,Â m:Â Æ’}
</code></pre>

<h3 id="toc_4">Â åµŒå¥—å‡½æ•°</h3>

<p>å‡½æ•°å¯ä»¥åµŒå¥—åœ¨å…¶ä»–å‡½æ•°å†…ã€‚åµŒå¥—å‡½æ•°å¯ä»¥è®¿é—®åŒ…å«å®ƒä»¬å‡½æ•°çš„å˜é‡å’Œå‚æ•°ï¼ˆé—­åŒ…ï¼‰ï¼š</p>

<pre><code class="language-javascript">functionÂ first(){
Â Â Â Â letÂ strFirstÂ =Â &quot;first&quot;;
Â Â Â Â second();
Â Â Â Â functionÂ second(){
Â Â Â Â Â Â Â Â letÂ strSecondÂ =Â &quot;second&quot;;
Â Â Â Â Â Â Â Â third();
Â Â Â Â Â Â Â Â functionÂ third(){
Â Â Â Â Â Â Â Â Â Â Â Â console.log(strFirst);
Â Â Â Â Â Â Â Â Â Â Â Â console.log(strSecond);
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}
first();
//Â first
//Â second
</code></pre>

<h3 id="toc_5">Â Function()Â æ„é€ å‡½æ•°åˆ›å»ºå‡½æ•°</h3>

<p>Function()Â å‡½æ•°çš„å®å‚éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæœ€åä¸€ä¸ªå®å‚æ˜¯å‡½æ•°ä½“ã€‚</p>

<pre><code class="language-javascript">constÂ fÂ =Â newÂ Function(&quot;x&quot;,Â &quot;y&quot;,Â &quot;returnÂ x*y;&quot;);
</code></pre>

<p>è¿™é‡Œæƒ³åˆ°ä¸€ä¸ªæƒ…å†µï¼Œå½“å‡½æ•°åç›¸åŒæ—¶æ˜¯å¦ä¼šæŠ¥é”™ï¼š</p>

<pre><code class="language-javascript">constÂ f1Â =Â newÂ Function(&quot;x&quot;,Â &quot;x&quot;,Â &quot;returnÂ x;&quot;);
f1(1,2);
//Â 2
</code></pre>

<p>å®é™…æƒ…å†µå¹¶æ²¡æœ‰ï¼Œå†æ¬¡æµ‹è¯•ä¸€ä¸‹ç›´æ¥å‡½æ•°å£°æ˜è¯­å¥ä½¿ç”¨ä¸¤ä¸ªç›¸åŒçš„å‚æ•°ï¼Œä¹Ÿæ²¡æœ‰æŠ¥é”™ï¼š</p>

<pre><code class="language-javascript">functionÂ f2(x,x,y){returnÂ x*y};
f2(1,2,2);
//Â 4
</code></pre>

<p>è¿™æ ·çœ‹å®é™…ä¸Šè·Ÿå‡½æ•°å¤–éƒ¨ç”¨Â varÂ å£°æ˜çš„å˜é‡åœ¨å‡½æ•°ä¸­å†æ¬¡å£°æ˜ä¸€ä¸ªæ•ˆæœï¼š</p>

<pre><code class="language-javascript">varÂ xÂ =Â 1;
functionÂ test(){letÂ xÂ =Â 2;console.log(x)};
console.log(x);
test();
//Â 1
//Â 2
</code></pre>

<p>å‡½æ•°å˜é‡å£°æ˜å¤šä¸ªç›¸ç›¸åŒçš„å˜é‡åæ—¶ï¼Œä¼ é€’çš„å®å‚å€¼å°†åå¤è¦†ç›–åŒåå‚æ•°ã€‚<br/>
Function() æ„é€ å‡½æ•°éå¸¸é‡è¦çš„ä¸€ç‚¹ï¼Œå°±æ˜¯å®ƒæ‰€åˆ›å»ºçš„å‡½æ•°å¹¶ä¸æ˜¯ä½¿ç”¨è¯æ³•ä½œç”¨åŸŸï¼Œç›¸åï¼Œå‡½æ•°ä½“ä»£ç çš„ç¼–è¯‘ç±»ä¼¼é¡¶å±‚å‡½æ•°ï¼Œçœ‹ä¹¦ä¸Šçš„ä¸€ä¸ªä¾‹å­ï¼š</p>

<pre><code class="language-javascript">let scope = &quot;global&quot;;
function constructFunction() {
    let scope = &quot;local&quot;;
    return new Function(&quot;return scope&quot;);  // Doesn&#39;t capture local scope!
}
constructFunction()(); 
// &quot;global&quot;
</code></pre>

<h2 id="toc_6">Â å‡½æ•°è°ƒç”¨</h2>

<p>å‡½æ•°è°ƒç”¨å’Œæ–¹æ³•è°ƒç”¨å¾ˆå¸¸è§å°±ä¸å†èµ˜è¿°ï¼Œè¿™é‡Œæœ‰ä¸‰ç§å¾ˆå°‘ä½¿ç”¨çš„è°ƒç”¨æ–¹å¼ï¼š</p>

<ul>
<li>æ„é€ å‡½æ•°è°ƒç”¨</li>
<li>é—´æ¥è°ƒç”¨</li>
<li>éšå¼è°ƒç”¨</li>
</ul>

<h3 id="toc_7">Â æ„é€ å‡½æ•°è°ƒç”¨</h3>

<pre><code class="language-javascript">functionÂ CreatObj(){
Â Â Â Â this[&#39;p&#39;]Â =Â &quot;property&quot;;Â Â Â Â 
}
oÂ =Â newÂ CreatObj();
//Â CreatObjÂ {p:Â &quot;property&quot;}
</code></pre>

<p>æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶å°†è¿™ä¸ªå¯¹è±¡ä½œä¸ºå®ƒçš„ä¸Šä¸‹æ–‡ï¼Œä¹Ÿå°±æ˜¯è¯´æ„é€ å‡½æ•°ä¸­çš„Â thisÂ å€¼æ˜¯æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚<br/>
æ„é€ å‡½æ•°é€šå¸¸æ²¡æœ‰Â returnÂ è¯­å¥ï¼Œå½“æ˜¾ç¤ºçš„ç”¨Â returnÂ è¯­å¥è¿”å›ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡å°†å˜æˆå®ƒÂ returnÂ çš„å¯¹è±¡ï¼Œå…¶ä»–æƒ…å†µå½“æ²¡æœ‰è¿”å›å€¼æˆ–è¿”å›ä¸€ä¸ªåŸå§‹å€¼æ—¶ï¼Œè¿”å›å€¼éƒ½è¢«å¿½ç•¥ï¼Œè¿”å›å®ƒæ–°åˆ›å»ºçš„å¯¹è±¡ã€‚</p>

<h3 id="toc_8">é—´æ¥è°ƒç”¨</h3>

<p>JavaScript ä¸‡ç‰©æ¥å¯¹è±¡ï¼Œå¯¹è±¡å°±æœ‰è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•ã€‚åŒç†ï¼Œå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œä¹Ÿæœ‰è‡ªå·±çš„æ–¹æ³•å’Œå±æ€§ï¼Œè€Œ call() å’Œ apply() æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨æ¥é—´æ¥è°ƒç”¨å‡½æ•°ã€‚</p>

<h4 id="toc_9">call() æ–¹æ³•</h4>

<p>MDN ä¸­å¯¹äº call() çš„è§£é‡Šå·²ç»å¾ˆæ˜äº†äº†ï¼š</p>

<blockquote>
<p>The call() method calls a function with a given this value and arguments provided individually.</p>
</blockquote>

<pre><code class="language-javascript">f.call(o, 1, 2);
</code></pre>

<p>è¿™é‡Œä¸è¿‡æ˜¯å°† o å¯¹è±¡ä½œä¸ºå‡½æ•° f è°ƒç”¨çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¼ å…¥ä¸¤ä¸ªå®å‚ 1 å’Œ 2 ä½œä¸ºå®å‚åˆ—è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒç­‰åŒä¸ä¸‹é¢çš„ä»£ç ï¼š</p>

<pre><code class="language-javascript">o.m = f;
o.m(1, 2);
delete o.m;
</code></pre>

<p>è¿™é‡Œæ³¨æ„ delete è¯­å¥ï¼Œç›®çš„å°±æ˜¯è¯´å‡½æ•°åœ¨ä½¿ç”¨ call æ–¹æ³•æ—¶åªæ˜¯ä¸´æ—¶å°† o ä½œä¸º f çš„ä¸Šä¸‹æ–‡å¹¶è°ƒç”¨ã€‚è€Œå‡½æ•°è¿˜æœ‰ä¸ªä¸æ¶‰åŠè°ƒç”¨çš„æ–¹æ³• bind() å®ƒå¯ä»¥è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°å¯¹è±¡ï¼Œ<code>f.bind(o);</code>ï¼Œè€Œè¿™ä¸ªå¯¹è±¡å°†ä¸€ç›´ç»‘å®š o ä¸ºå‡½æ•° f çš„ this å€¼ã€‚</p>

<h4 id="toc_10">apply() æ–¹æ³•</h4>

<blockquote>
<p>The apply() method calls a function with a given this value, and arguments provided as an array (or an array-like object).</p>
</blockquote>

<p>ä¸éš¾çœ‹å‡º apply() å’Œ call() åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯å®å‚ä»¥æ•°ç»„æˆ–è€…ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡è¿›è¡Œä¼ é€’ã€‚è¿™é‡Œå¯¹ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡è¿›è¡Œæµ‹è¯•ï¼š</p>

<pre><code class="language-javascript">function test(...args){
    console.log(this);
    for(item in args) console.log(item);
}
let o = {a:1};
let likeArr = {p1:1,p2:2};
likeArr.length = 2;    
let unLikeArr = {p1:1,p2:2};
test.apply(o,likeArr);
// {a: 1}
// 0
// 1
test.apply(o,unLikeArr);
// {a: 1}
</code></pre>

<p>å¯è§æœ‰äº† length çš„å¯¹è±¡å°±è¢«å½“ä½œæ˜¯ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚</p>

<h4 id="toc_11">this å€¼</h4>

<p>å¯è§å½“ call() å’Œ apply() è°ƒç”¨å‡½æ•°æ—¶ç»™å‡½æ•°ç»‘å®šäº†ä¸€ä¸ªä¸Šä¸‹æ–‡ this å€¼ï¼Œä½†æ˜¯ç®­å¤´å‡½æ•°æ˜¯ä¸ªç‰¹ä¾‹ï¼Œå®ƒä»å®ƒå®šä¹‰çš„ä½ç½®çš„ä¸Šä¸‹æ–‡ç»§æ‰¿ this å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´å½“ç»™ç®­å¤´å‡½æ•°å®šä¹‰çš„å‡½æ•°ä½¿ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°†è¢«å¿½ç•¥ï¼š</p>

<pre><code class="language-javascript">let o = {
    a: 1,
    f: function(){
        const oBind = {b:1};
        const test = ()=&gt; console.log(this);
        test.apply(oBind);
    }
}
o.f();
// {a: 1, f: Æ’}
</code></pre>

<h3 id="toc_12">éšå¼è°ƒç”¨</h3>

<ul>
<li>getter å’Œ setter æ–¹æ³•åœ¨è·å–æˆ–è€…è®¾ç½®å®ƒçš„å±æ€§æ—¶å¯èƒ½è¢«éšå¼è°ƒç”¨ã€‚</li>
<li>åœ¨å¯¹è±¡è¿›è¡Œå­—ç¬¦ä¸²æˆ–è€…æ•°å€¼å‹å’Œ BigInt ç±»å‹è½¬æ¢æ—¶ï¼Œä¼šéšå¼è°ƒç”¨ toString() å’Œ valueOf() æ–¹æ³•ã€‚</li>
<li>å¾ªç¯å¯è¿­ä»£å¯¹è±¡çš„å…ƒç´ æ—¶ä¼šäº§ç”Ÿå¾ˆå¤šæ–¹æ³•è°ƒç”¨ã€‚</li>
<li>æ¨¡æ¿å­—ç¬¦ä¸²å¯ä»¥è°ƒç”¨å‡½æ•°ã€‚</li>
<li>Proxy å¯¹è±¡çš„ä»»ä½•ä¸€ä¸ªæ“ä½œéƒ½ä¼šå¯¼è‡´å‡½æ•°è°ƒç”¨ã€‚</li>
</ul>

<h2 id="toc_13">Â å…³äºå‡½æ•°Â thisÂ å€¼çš„æ€»ç»“</h2>

<p>å‡½æ•°Â thisÂ å€¼æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p>

<ul>
<li>å‡½æ•°å£°æ˜è¯­å¥å’Œå‡½æ•°è¡¨è¾¾å¼å®šä¹‰çš„å‡½æ•°ï¼Œåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹Â thisÂ å€¼æ°¸è¿œæ˜¯Â globalï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹æ˜¯Â undefinedã€‚</li>
<li>apply() call() bind() æ–¹æ³•ç”¨åœ¨éç®­å¤´å‡½æ•°æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå‡½æ•°è¿è¡Œæ—¶çš„ this å€¼ã€‚</li>
<li>ç®­å¤´å‡½æ•°çš„Â thisÂ å€¼æ°¸è¿œç»§æ‰¿äºå®ƒæ‰€å®šä¹‰çš„ä½ç½®çš„Â thisÂ å€¼ã€‚</li>
<li>å¯¹è±¡çš„æ–¹æ³•ä¸­Â thisÂ å€¼æ˜¯è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼ŒåµŒå¥—åœ¨è¯¥å¯¹è±¡ä¸­çš„å‡½æ•°ä¸ä¸ºæ–¹æ³•ï¼Œæ‰€ä»¥éµå¾ªå‡½æ•°çš„ this å€¼ï¼ˆglobal æˆ–è€… undefinedï¼‰ã€‚</li>
<li>æ„é€ å‡½æ•°çš„Â thisÂ å€¼æ˜¯æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚</li>
</ul>

<p>é—­åŒ…åªæ˜¯å‚æ•°å’Œå˜é‡ä½œç”¨åŸŸçš„å¼•ç”¨ï¼Œä¸ this å€¼æ— å…³ã€‚</p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[é€šè¿‡å˜é‡ä½œç”¨åŸŸæ·±å…¥äº†è§£ undefined]]></title>
    <link href="2019919.xyz/16088182648987.html"/>
    <updated>2020-12-24T21:57:44+08:00</updated>
    <id>2019919.xyz/16088182648987.html</id>
    <content type="html"><![CDATA[
<p>undefined æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒæœ‰å¯èƒ½è¢«ç¯¡æ”¹ï¼Œæ‰€ä»¥ä½¿ç”¨voidï¼ˆ0ï¼‰æ¥ä»£æ›¿ä»–ï¼Œä½†æ˜¯åœ¨åšå®éªŒçš„æ—¶å€™å‘ç°è™½ç„¶ç»™å®ƒèµ‹å€¼ä¸æŠ¥é”™ï¼Œå–å€¼æ—¶å€™ undefined å´å¹¶æ²¡æœ‰æ”¹å˜ã€‚</p>

<pre><code class="language-javascript">    undefined = 0
    // 0
    undefined
    // undefined
</code></pre>

<p>è¿™å›å­¦ä¹ åˆ°äº†å˜é‡ä½œç”¨åŸŸï¼Œå†ç»“åˆä¹‹å‰å­¦çš„å¯¹è±¡çš„å±æ€§ï¼Œæ·±å…¥äº†è§£ä¸‹ undefined åˆ°åº•ä»€ä¹ˆæ—¶å€™ä¼šè¢«ç¯¡æ”¹ã€‚</p>

<h2 id="toc_0">å‡½æ•°ä½œç”¨åŸŸå’Œå£°æ˜æå‰</h2>

<p>åˆ«çš„è¯­è¨€ä¸€èˆ¬ä¸ºå—çº§ä½œç”¨åŸŸï¼ŒJavaScript å–è€Œä»£ä¹‹ä½¿ç”¨äº†å‡½æ•°ä½œç”¨åŸŸï¼šå˜é‡åœ¨å£°æ˜å®ƒä»¬çš„å‡½æ•°ä½“ä»¥åŠè¿™ä¸ªå‡½æ•°ä½“åµŒå¥—çš„ä»»æ„å‡½æ•°ä½“å†…éƒ½æ˜¯æœ‰å®šä¹‰çš„ã€‚</p>

<pre><code class="language-javascript">    var a = function test(o){
        var i = 0;                          // iåœ¨æ•´ä¸ªå‡½æ•°ä½“å†…å‡æ˜¯æœ‰å®šä¹‰çš„
        if(typeof o == &quot;object&quot;){
            var j = 4;                      // jåœ¨å‡½æ•°ä½“å†…æ˜¯æœ‰å®šä¹‰çš„ï¼Œä¸ä»…ä»…æ˜¯åœ¨è¿™ä¸ªä»£ç æ®µå†…
            for(var k=0; k &lt; 3; k++){       // kåœ¨å‡½æ•°ä½“å†…æ˜¯æœ‰å®šä¹‰çš„ï¼Œä¸ä»…ä»…æ˜¯åœ¨å¾ªç¯å†…
                console.log(k);             // è¾“å‡ºæ•°å­—0ï½2
            }
            console.log(k);                 // kå·²ç»å®šä¹‰äº†ï¼Œè¾“å‡º3
        }
        console.log(k);                     // kå·²ç»å®šä¹‰äº†ï¼Œè¾“å‡º3
        console.log(j);                     // jå·²ç»å®šä¹‰äº†ï¼Œè¾“å‡º4
    };
</code></pre>

<p>JavaScript çš„è¿™ä¸ªç‰¹æ€§è¢«éæ­£å¼åœ°ç§°ä¸ºå£°æ˜æå‰ï¼ˆhoistingï¼‰ï¼Œå³ JavaScript å‡½æ•°é‡Œå£°æ˜çš„æ‰€æœ‰å˜é‡ï¼ˆä½†ä¸æ¶‰åŠèµ‹å€¼ï¼‰éƒ½è¢«â€œæå‰â€è‡³å‡½æ•°ä½“çš„é¡¶éƒ¨ã€‚</p>

<pre><code class="language-javascript">    var a = &#39;1&#39;;
    function f(){
        console.log(a);
        var a = &#39;2&#39;;
        console.log(a);
    }
</code></pre>

<p>ç”±äºå‡½æ•°ä½œç”¨åŸŸçš„ç‰¹æ€§ï¼Œå˜é‡ a çš„å£°æ˜è¢«æå‰åˆ°äº†æ•´ä¸ªå‡½æ•°ä½“æœ€å‰é¢ï¼Œå£°æ˜äº†ä½†æ˜¯æ²¡èµ‹å€¼ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡ console æ˜¯ undefinedã€‚æ‰§è¡Œåˆ° var è¯­å¥æ—¶æ‰è¢«èµ‹å€¼ï¼Œè¿™åº”è¯¥ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¯ä»¥ä¸€ä¸ªå˜é‡å¤šæ¬¡ var å£°æ˜çš„åŸå› ï¼Œåé¢æ¯ä¸€æ¬¡ var åªæ˜¯èµ·åˆ°äº†èµ‹å€¼çš„ä½œç”¨ã€‚</p>

<h2 id="toc_1">ES6 å—ä½œç”¨åŸŸ</h2>

<p>ES6 å¼¥è¡¥äº†è¿™è¿™ä¸ªæ¦‚å¿µï¼Œè¿½åŠ äº† let å’Œ constï¼Œä¹Ÿå°±æœ‰äº† {} å—ä½œç”¨åŸŸçš„æ¦‚å¿µï¼Œconst ç”¨æ¥å£°æ˜å¸¸é‡ï¼Œè¿™ä¸ªå°±ä¸æäº†ï¼Œç”¨ä¸Šé¢çš„ä¾‹å­æ„Ÿå—ä¸€ä¸‹ let å’Œ var çš„åŒºåˆ«ã€‚</p>

<pre><code class="language-javascript">    var a = function test(o){
        var i = 0;                          // iåœ¨æ•´ä¸ªå‡½æ•°ä½“å†…å‡æ˜¯æœ‰å®šä¹‰çš„
        if(typeof o == &quot;object&quot;){
            let j = 4;                      // jåœ¨ifå—å†…æ˜¯æœ‰å®šä¹‰çš„
            for(var k=0; k &lt; 3; k++){       // kåœ¨å‡½æ•°ä½“å†…æ˜¯æœ‰å®šä¹‰çš„ï¼Œä¸ä»…ä»…æ˜¯åœ¨å¾ªç¯å†…
                console.log(k);             // è¾“å‡ºæ•°å­—0ï½2
                console.log(j);             // jå·²ç»å®šä¹‰äº†ï¼Œè¾“å‡º4
            }
            console.log(k);                 // kå·²ç»å®šä¹‰äº†ï¼Œè¾“å‡º3
        }
        console.log(k);                     // kå·²ç»å®šä¹‰äº†ï¼Œè¾“å‡º3
        console.log(j);                     // jåœ¨å—å¤–ï¼ŒæŠ›å‡ºå¼‚å¸¸Uncaught ReferenceError: j is not defined
    };
</code></pre>

<p>let å’Œ const åªæœ‰åœ¨å—å†…æ˜¯è¢«å£°æ˜çš„ã€‚</p>

<h2 id="toc_2">å…¨å±€å˜é‡çš„æœ¬è´¨</h2>

<p>å½“å£°æ˜ä¸€ä¸ª JavaScript å…¨å±€å˜é‡æ—¶ï¼Œå®é™…ä¸Šæ˜¯å®šä¹‰äº†å…¨å±€å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ã€‚å½“ä½¿ç”¨ var å£°æ˜ä¸€ä¸ªå˜é‡æ—¶ï¼Œåˆ›å»ºçš„è¿™ä¸ªå±æ€§æ˜¯ä¸å¯é…ç½®çš„ï¼Œæ— æ³•é€šè¿‡ delete è¿ç®—ç¬¦åˆ é™¤ã€‚</p>

<pre><code class="language-javascript">    test =1
    // 1
    window.test
    // 1
    delete test
    // true
    window.test
    // undefined
    var test = 1
    // undefined
    window.test
    // 1
    delete test
    // false
    window.test
    // 1
</code></pre>

<p>å¯ä»¥çœ‹åˆ°å½“å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡çš„æ—¶å€™ä»–å˜æˆäº† window çš„å±æ€§ã€‚<br/>
JavaScript å¯ä»¥å…è®¸ä½¿ç”¨ this å…³é”®å­—æ¥å¼•ç”¨å…¨å±€å¯¹è±¡ï¼Œä½†æ˜¯ä¸èƒ½å¼•ç”¨å±€éƒ¨å˜é‡ä¸­å­˜æ”¾çš„å¯¹è±¡ã€‚</p>

<pre><code class="language-javascript">    this.test
    // 1
</code></pre>

<h2 id="toc_3">æ·±å…¥ç†è§£ undefined çš„æœ¬è´¨</h2>

<p>undefined æ˜æ˜æ˜¯ä¸ªå˜é‡ä¸ºä»€ä¹ˆèµ‹å€¼åæ— æ³•ä½¿ç”¨å‘¢ã€‚ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ undefinedï¼Œé‚£ä»–æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ä¸€ä¸ªå…¨å±€çš„å±æ€§ï¼Œäº‹å®ä¹Ÿæœç„¶å¦‚æ­¤ã€‚</p>

<pre><code class="language-javascript">    window.undefined == undefined
    // true
</code></pre>

<p>è€Œå±æ€§åˆ†ä¸¤ç±»ï¼Œä»–ä»¬çš„ç‰¹å¾å¦‚ä¸‹ï¼š</p>

<ul>
<li>æ•°æ®å±æ€§
<ul>
<li>valueï¼šå°±æ˜¯å±æ€§çš„å€¼ã€‚</li>
<li>writableï¼šå†³å®šå±æ€§æ˜¯å¦èƒ½è¢«èµ‹å€¼ã€‚</li>
<li>enumerableï¼šå†³å®š for in èƒ½å¦æšä¸¾è¯¥å±æ€§ã€‚</li>
<li>configurableï¼šå†³å®šè¯¥å±æ€§èƒ½å¦è¢«åˆ é™¤æˆ–è€…æ”¹å˜ç‰¹å¾å€¼ã€‚</li>
</ul></li>
<li>è®¿é—®å™¨å±æ€§ï¼ˆgetter/setterï¼‰
<ul>
<li>getterï¼šå‡½æ•°æˆ– undefinedï¼Œåœ¨å–å±æ€§å€¼æ—¶è¢«è°ƒç”¨ã€‚</li>
<li>setterï¼šå‡½æ•°æˆ– undefinedï¼Œåœ¨è®¾ç½®å±æ€§å€¼æ—¶è¢«è°ƒç”¨ã€‚</li>
<li>enumerableï¼šå†³å®š for in èƒ½å¦æšä¸¾è¯¥å±æ€§ã€‚</li>
<li>configurableï¼šå†³å®šè¯¥å±æ€§èƒ½å¦è¢«åˆ é™¤æˆ–è€…æ”¹å˜ç‰¹å¾å€¼ã€‚<br/>
æŸ¥çœ‹ä¸‹å…¨å±€å±æ€§ undefined çš„å±æ€§ç‰¹å¾ã€‚</li>
</ul></li>
</ul>

<pre><code class="language-javascript">    console.log(Object.getOwnPropertyDescriptor(window,&#39;undefined&#39;));
    // configurable: false
    // enumerable: false
    // value: undefined
    // writable: false
</code></pre>

<p>writableï¼šfalseï¼Œå°±æ˜¯è¿™ä¸ªåŸå›  undefined è™½ç„¶æ˜¯ä¸ªå…¨å±€å˜é‡ï¼Œä½†æ˜¯æˆ‘ä»¬èµ‹å€¼ä¹‹åä»–å¹¶æ²¡æœ‰è¢«æ”¹å˜ã€‚é‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦ç”¨ void(0) æ¥ä»£æ›¿ undefined å‘¢ï¼Ÿç»“åˆä¸Šé¢çš„å‡½æ•°ä½œç”¨åŸŸå†åšä¸€ä¸ªå®éªŒã€‚</p>

<pre><code class="language-javascript">    function test() {
        var undefined = 100; 
        console.log(undefined);
        var obj = {a : undefined}; 
        console.log(Object.getOwnPropertyDescriptor(obj,&#39;a&#39;));
    }
    test();
    // 100
    // configurable: true
    // enumerable: true
    // value: 100
    // writable: true
</code></pre>

<p>åœ¨å‡½æ•°ä½œç”¨åŸŸä¸­ï¼Œundefined è¢«ä»å£°æ˜å¹¶èµ‹å€¼ä¸º 100ï¼Œæ— è®ºæ˜¯ç›´æ¥ console å®ƒè‡ªå·±è¿˜æ˜¯å»æŸ¥çœ‹ undefined å±æ€§ç‰¹æ€§éƒ½èƒ½çœ‹å‡ºï¼Œundefined å˜é‡è¢«ä¿®æ”¹äº†ã€‚è¿™ä¹Ÿå°±è¯´åœ¨å‡½æ•°ä½œç”¨åŸŸå†… undefined å¯ä»¥è¢«ä¿®æ”¹ã€‚</p>

<pre><code class="language-javascript">    function test() {
        const undefined = 100; 
        console.log(undefined);
        const obj = {a : undefined}; 
        console.log(Object.getOwnPropertyDescriptor(obj,&#39;a&#39;));
        test();
    }
    // 100
    // configurable: true
    // enumerable: true
    // value: 100
    // writable: true
</code></pre>

<p>å—ä½œç”¨åŸŸå†…ä¹Ÿä¸€æ ·å¯ä»¥è¢«ä¿®æ”¹ï¼Œå¾—å‡ºç»“è®º undefined æ˜¯ä¸€ä¸ªç±»ä¼¼ var å£°æ˜ä¸€æ ·å¯ä»¥è¢«é‡å¤å£°æ˜çš„å…¨å±€å±æ€§ï¼Œè€Œä»–çš„å±æ€§ç‰¹æ€§ writable æ˜¯ falseï¼Œæ‰€ä»¥ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä½†æ˜¯åœ¨éå…¨å±€ä½œç”¨åŸŸå†…ï¼Œä»–æ˜¯å¯ä»¥è¢«ç¯¡æ”¹çš„ï¼Œè¿™æ—¶å€™å°±è¦æ³¨æ„ç”¨ void (0) æ¥æ›¿ä»£ undefinedã€‚</p>

<h2 id="toc_4">ä½œç”¨åŸŸé“¾<sup>1</sup></h2>

<p>ä»¥ä¹¦ä¸­çš„è§’åº¦ç”¨å¯¹è±¡å±æ€§å»çœ‹ä½œç”¨åŸŸé“¾ï¼š</p>

<ul>
<li>JavaScriptæœ€é¡¶å±‚çš„ä»£ç ï¼Œå…¶ä½œç”¨åŸŸé“¾åªæœ‰ä¸€ä¸ªå…¨å±€å¯¹è±¡ã€‚</li>
</ul>

<table>
    <tr>
        <th colspan=2>Scope chain</th>
    </tr>
    <tr>
        <td>0</td><td>Global object</td>
    <tr>
</table>

<ul>
<li>ä¸åŒ…å«åµŒå¥—çš„å‡½æ•°ï¼Œå…¶ä½œç”¨åŸŸä¸¤ä¸ªå¯¹è±¡ï¼šå‡½æ•°è‡ªèº«çš„å˜é‡å¯¹è±¡å’Œå…¨å±€å¯¹è±¡ã€‚</li>
</ul>

<table>
    <tr>
        <th colspan=2>Scope chain</th>
    </tr>
    <tr>
        <td>0</td><td>Activation object</td>
    <tr>
    <tr>
        <td>1</td><td>Global object</td>
    <tr>
</table>

<blockquote>
<p>æ´»åŠ¨å¯¹è±¡(activation object)ï¼Œè¯¥å¯¹è±¡åŒ…å«äº†å‡½æ•°çš„æ‰€æœ‰å±€éƒ¨å˜é‡ã€å‘½åå‚æ•°ã€å‚æ•°é›†åˆä»¥åŠthisï¼Œç„¶åæ­¤å¯¹è±¡ä¼šè¢«æ¨å…¥ä½œç”¨åŸŸé“¾çš„å‰ç«¯</p>
</blockquote>

<ul>
<li>å¯¹äºåŒ…å«äº†åµŒå¥—å‡½æ•°çš„å‡½æ•°ï¼Œå…¶ä½œç”¨åŸŸåŒ…å«è‡³å°‘ä¸‰ä¸ªå¯¹è±¡ï¼šè‡ªèº«çš„å˜é‡å¯¹è±¡ï¼Œå¤–å±‚çš„å˜é‡å¯¹è±¡ï¼ˆå°†è‡ªèº«åµŒå¥—çš„å‡½æ•°ï¼‰ï¼Œå…¨å±€å˜é‡å¯¹è±¡ã€‚</li>
</ul>

<table>
    <tr>
        <th colspan=2>Scope chain</th>
    </tr>
    <tr>
        <td>0</td><td>Sub activation object</td>
    <tr>
    <tr>
        <td>1</td><td>Activation object</td>
    <tr>
    <tr>
        <td>2</td><td>Global object</td>
    <tr>
</table>

<p>ä½œç”¨åŸŸé“¾ç»™æˆ‘çš„æ„Ÿè§‰ç±»ä¼¼åŸå‹é“¾ï¼Œå°†å‡½æ•°çš„ä¸Šä¸‹æ–‡æ„æˆäº†é“¾è¡¨çš„å½¢å¼ï¼Œè€Œæ–¹æ³•æ‰§è¡Œæ—¶ä¸€å±‚ä¸€å±‚å¾€å¤–æ‰¾ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿é“¾è¡¨ä»ä¸Šåˆ°ä¸‹æŸ¥æ‰¾å±æ€§ï¼Œæ‰€ä»¥æœ‰äº†å£°æ˜æå‰ï¼Œé“¾è¡¨æœ€é¡¶ç«¯ä¸ºåµŒå¥—å‡½æ•°çš„æœ€é‡Œå±‚ï¼Œé“¾è¡¨æœ€åº•ç«¯åˆ™æ˜¯å…¨å±€å˜é‡å¯¹è±¡ã€‚</p>

<pre><code class="language-javascript">    function test(){
        var fun1,fun2;
        for(var i=0;i&lt;2;i++){
            if(i === 0){
                fun1 = function(){console.log(&#39;fun1:i=&#39;+i)};
            }
            if(i === 1){
                fun2 = function(){console.log(&#39;fun2:i=&#39;+i)};
            }
        };
        fun1();
        fun2();
    }âˆ«
    test();
    // fun1:i=2
    // fun2:i=2
</code></pre>

<h2 id="toc_5">æ³¨</h2>

<ol>
<li>åœ¨çœ‹ JavaScript æƒå¨æŒ‡å—ç¬¬ä¸ƒç‰ˆç¬¬å…«ç« æ—¶å‘ç°ä½œè€…å°†åŸæ¥çš„ä½œç”¨åŸŸé“¾çš„â€œé“¾â€å­—éƒ½åˆ é™¤äº†ï¼Œå˜æˆäº†ä½œç”¨åŸŸï¼Œä½†æ˜¯è¿˜æ²¡æœ‰çœ‹å‰é¢ä½œç”¨åŸŸç›¸å…³å†…å®¹ï¼Œåº”è¯¥æœ‰æ–°çš„ç†è§£ï¼Œåœ¨å®Œæˆç¿»è¯‘åå†ç»§ç»­è¡¥å…¨ã€‚</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¬¬ 6 ç«  å¯¹è±¡]]></title>
    <link href="2019919.xyz/16113218396407.html"/>
    <updated>2021-01-22T21:23:59+08:00</updated>
    <id>2019919.xyz/16113218396407.html</id>
    <content type="html"><![CDATA[
<ul>
<li>
<a href="#toc_0">6.1 ä»‹ç»å¯¹è±¡</a>
</li>
<li>
<a href="#toc_1">6.2 åˆ›å»ºå¯¹è±¡</a>
<ul>
<li>
<a href="#toc_2">6.2.1 å¯¹è±¡å­—é¢é‡</a>
</li>
<li>
<a href="#toc_3">6.2.2 ç”¨ new åˆ›å»ºå¯¹è±¡</a>
</li>
<li>
<a href="#toc_4">6.2.3 åŸå‹</a>
</li>
<li>
<a href="#toc_5">6.2.4 Object.create()</a>
</li>
</ul>
</li>
<li>
<a href="#toc_6">6.3 æŸ¥è¯¢å’Œè®¾ç½®å±æ€§</a>
<ul>
<li>
<a href="#toc_7">6.3.1 å¯¹è±¡ä½œå…³è”æ•°ç»„</a>
</li>
<li>
<a href="#toc_8">6.3.2 ç»§æ‰¿</a>
</li>
<li>
<a href="#toc_9">6.3.3 å±æ€§è®¿é—®å¼‚å¸¸</a>
</li>
</ul>
</li>
<li>
<a href="#toc_10">6.4 åˆ é™¤å±æ€§</a>
</li>
<li>
<a href="#toc_11">6.5 æµ‹è¯•å±æ€§</a>
</li>
<li>
<a href="#toc_12">6.6 æšä¸¾å±æ€§</a>
<ul>
<li>
<a href="#toc_13">6.6.1 å±æ€§æšä¸¾é¡ºåº</a>
</li>
</ul>
</li>
<li>
<a href="#toc_14">6.7 æ‰©å±•å¯¹è±¡</a>
</li>
<li>
<a href="#toc_15">6.8 åºåˆ—åŒ–å¯¹è±¡</a>
</li>
<li>
<a href="#toc_16">6.9 å¯¹è±¡æ–¹æ³•</a>
<ul>
<li>
<a href="#toc_17">6.9.1 toString() æ–¹æ³•</a>
</li>
<li>
<a href="#toc_18">6.9.2 toLocaleString() æ–¹æ³•</a>
</li>
<li>
<a href="#toc_19">6.9.3 valueOf() æ–¹æ³•</a>
</li>
<li>
<a href="#toc_20">6.9.4 toJSON() æ–¹æ³•</a>
</li>
</ul>
</li>
<li>
<a href="#toc_21">6.10 æ‰©å±•çš„å¯¹è±¡å­—é¢é‡è¯­æ³•</a>
<ul>
<li>
<a href="#toc_22">6.10.1 é€Ÿè®°å±æ€§</a>
</li>
<li>
<a href="#toc_23">6.10.2 è®¡ç®—å±æ€§å</a>
</li>
<li>
<a href="#toc_24">6.10.3 Symbol ä½œå±æ€§å</a>
</li>
<li>
<a href="#toc_25">6.10.4 å±•å¼€è¿ç®—ç¬¦</a>
</li>
<li>
<a href="#toc_26">6.10.5 é€Ÿè®°æ–¹æ³•</a>
</li>
<li>
<a href="#toc_27">6.10.6 å±æ€§ Getter å’Œ Setter æ–¹æ³•</a>
</li>
</ul>
</li>
<li>
<a href="#toc_28">6.11 æ€»ç»“</a>
</li>
</ul>


<p>å¯¹è±¡æ˜¯ JavaScript æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œåœ¨æœ¬ç« ä¹‹å‰çš„ç« èŠ‚ä¸­å·²ç»å¤šæ¬¡çœ‹åˆ°å®ƒä»¬ã€‚å› ä¸ºå¯¹è±¡å¯¹ JavaScript è¯­è¨€éå¸¸é‡è¦ï¼Œæ‰€ä»¥äº†è§£å®ƒä»¬çš„å·¥ä½œåŸç†éå¸¸é‡è¦ï¼Œæœ¬ç« å°†æä¾›è¿™äº›ç»†èŠ‚ã€‚å®ƒä»å¯¹è±¡çš„æ­£å¼æ¦‚è¿°å¼€å§‹ï¼Œç„¶åæ·±å…¥åˆ°å…³äºåˆ›å»ºå¯¹è±¡ä»¥åŠæŸ¥è¯¢ã€è®¾ç½®ã€åˆ é™¤ã€æµ‹è¯•å’Œæšä¸¾å¯¹è±¡å±æ€§çš„å®ç”¨éƒ¨åˆ†ã€‚åœ¨è¿™äº›ä»¥å±æ€§ä¸ºä¸­å¿ƒçš„ç« èŠ‚ä¹‹åï¼Œå°†ä»‹ç»å¦‚ä½•æ‰©å±•ã€åºåˆ—åŒ–å’Œå®šä¹‰å¯¹è±¡ä¸Šçš„é‡è¦æ–¹æ³•ã€‚æœ€åï¼Œæœ¬ç« ä»¥ä¸€å¤§æ®µå…³äº ES6 ä¸­çš„æ–°å¯¹è±¡æ–‡å­—è¯­æ³•å’Œè¯¥è¯­è¨€çš„æœ€æ–°ç‰ˆæœ¬ç»“å°¾ã€‚</p>

<h2 id="toc_0">6.1 ä»‹ç»å¯¹è±¡</h2>

<p>å¯¹è±¡æ˜¯ä¸€ä¸ªå¤åˆå€¼ï¼šå®ƒèšåˆäº†å¤šä¸ªå€¼ï¼ˆåŸå§‹å€¼æˆ–å…¶ä»–å¯¹è±¡ï¼‰ï¼Œå¹¶å…è®¸æŒ‰åç§°å­˜å‚¨å’Œè·å–è¿™äº›å€¼ã€‚å¯¹è±¡æ˜¯å±æ€§çš„æ— åºé›†åˆï¼Œæ¯ä¸ªå±æ€§éƒ½æœ‰ä¸€ä¸ªåç§°å’Œä¸€ä¸ªå€¼ã€‚å±æ€§åé€šå¸¸æ˜¯å­—ç¬¦ä¸²ï¼ˆå°½ç®¡ï¼Œæ­£å¦‚æˆ‘ä»¬å°†åœ¨ Â§6.10.3 ä¸­çœ‹åˆ°çš„ï¼Œå±æ€§åä¹Ÿå¯ä»¥æ˜¯ Symbolï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯´å¯¹è±¡å°†å­—ç¬¦ä¸²æ˜ å°„åˆ°å€¼ã€‚è¿™ç§å­—ç¬¦ä¸²åˆ°å€¼çš„æ˜ å°„æœ‰ä¸åŒçš„åç§°â€”â€”å¯èƒ½å·²ç»ç†Ÿæ‚‰è¿™ç§åŸºæœ¬æ•°æ®ç»“æ„çš„åˆ«çš„åç§°â€œæ•£åˆ—â€ï¼ˆhashï¼‰ã€â€œæ•£åˆ—è¡¨â€ï¼ˆhashtableï¼‰ã€â€œå­—å…¸â€ï¼ˆdictionaryï¼‰æˆ–â€œå…³è”æ•°ç»„â€ï¼ˆassociative arrayï¼‰ã€‚ç„¶è€Œï¼Œå¯¹è±¡ä¸ä»…ä»…æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ°å€¼çš„æ˜ å°„ã€‚é™¤äº†ç»´æŠ¤è‡ªå·±çš„å±æ€§é›†ï¼ŒJavaScript å¯¹è±¡è¿˜ç»§æ‰¿å¦ä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œå³å®ƒçš„â€œåŸå‹â€ã€‚å¯¹è±¡çš„æ–¹æ³•é€šå¸¸æ˜¯ç»§æ‰¿çš„å±æ€§ï¼Œè€Œè¿™ç§â€œåŸå‹ç»§æ‰¿â€æ˜¯ JavaScript çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§ã€‚</p>

<p>JavaScript å¯¹è±¡æ˜¯åŠ¨æ€çš„â€”â€”å±æ€§é€šå¸¸å¯ä»¥æ·»åŠ å’Œåˆ é™¤â€”â€”ä½†å®ƒä»¬å¯ä»¥ç”¨æ¥æ¨¡æ‹Ÿé™æ€ç±»å‹è¯­è¨€çš„é™æ€å¯¹è±¡å’Œâ€œç»“æ„ä½“â€ï¼ˆstructï¼‰ã€‚æœ‰æ—¶å®ƒä»¬ä¹Ÿç”¨åšå­—ç¬¦ä¸²çš„é›† åˆï¼ˆå¿½ç•¥å/å€¼å¯¹ä¸­çš„å€¼ï¼‰ã€‚</p>

<p>JavaScript ä¸­ä»»ä½•ä¸æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ã€Symbol æˆ– trueã€falseã€null æˆ– undefined çš„å€¼éƒ½æ˜¯å¯¹è±¡ã€‚å³ä½¿å­—ç¬¦ä¸²ã€æ•°å­—å’Œå¸ƒå°”å€¼ä¸æ˜¯å¯¹è±¡ï¼Œå®ƒä»¬çš„è¡Œä¸ºå’Œä¸å¯å˜å¯¹è±¡éå¸¸ç±»ä¼¼ã€‚</p>

<p>å›æƒ³ä¸€ä¸‹ Â§3.8ï¼Œå¯¹è±¡æ˜¯å¯å˜çš„ï¼Œé€šè¿‡å¼•ç”¨è€Œä¸æ˜¯å€¼æ¥æ“ä½œã€‚å¦‚æœå˜é‡ x æŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œæ‰§è¡Œ <code>y = x;</code> æ—¶ï¼Œå˜é‡ y ä¹Ÿæ˜¯æŒ‡å‘åŒä¸€å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯è¯¥å¯¹è±¡çš„å‰¯æœ¬ã€‚é€šè¿‡å˜é‡ y ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¹Ÿä¼šå¯¹å˜é‡ x é€ æˆå½±å“ã€‚</p>

<p>å¯¹å¯¹è±¡æœ€å¸¸è§çš„æ“ä½œæ˜¯åˆ›å»ºå®ƒä»¬å¹¶è®¾ç½®ã€æŸ¥è¯¢ã€åˆ é™¤ã€æµ‹è¯•å’Œæšä¸¾å®ƒä»¬çš„å±æ€§ã€‚è¿™äº›åŸºæœ¬çš„æ“ä½œå°†åœ¨æœ¬ç« çš„å¼€å¤´éƒ¨åˆ†è¿›è¡Œæè¿°ã€‚ä¹‹åçš„éƒ¨åˆ†å°†ä»‹ç»æ›´é«˜çº§çš„ä¸»é¢˜ã€‚</p>

<p>å±æ€§æœ‰ä¸€ä¸ªåç§°å’Œä¸€ä¸ªå€¼ã€‚å±æ€§åå¯ä»¥æ˜¯ä»»ä½•å­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ï¼ˆæˆ–ä»»ä½• Symbolï¼‰ï¼Œä½†ä»»ä½•å¯¹è±¡éƒ½ä¸èƒ½æœ‰ä¸¤ä¸ªåŒåçš„å±æ€§ã€‚å€¼å¯ä»¥æ˜¯ä»»ä½• JavaScript å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ getter æˆ– setter å‡½æ•°ï¼ˆæˆ–ä¸¤è€…éƒ½æ˜¯ï¼‰ã€‚æˆ‘ä»¬å°†åœ¨ Â§6.10.6 ä¸­å­¦ä¹  getter å’Œ setter å‡½æ•°ã€‚</p>

<p>æœ‰æ—¶ï¼Œèƒ½å¤ŸåŒºåˆ†ç›´æ¥åœ¨å¯¹è±¡ä¸Šå®šä¹‰çš„å±æ€§å’Œä»åŸå‹å¯¹è±¡ç»§æ‰¿çš„å±æ€§æ˜¯å¾ˆé‡è¦çš„ã€‚JavaScript ä½¿ç”¨æœ¯è¯­â€œè‡ªæœ‰å±æ€§â€æ¥æŒ‡ä»£éç»§æ‰¿å±æ€§ã€‚</p>

<p>é™¤äº†åç§°å’Œå€¼ä¹‹å¤–ï¼Œæ¯ä¸ªå±æ€§è¿˜æœ‰ä¸‰ä¸ªå±æ€§å±æ€§:</p>

<ul>
<li>writable å±æ€§æŒ‡å®šæ˜¯å¦å¯ä»¥è®¾ç½®å±æ€§çš„å€¼ã€‚</li>
<li>enumerable å±æ€§æŒ‡å®š for/in å¾ªç¯æ˜¯å¦è¿”å›å±æ€§åç§°ã€‚</li>
<li>å¯é…ç½®å±æ€§æŒ‡å®šè¯¥å±æ€§æ˜¯å¦å¯ä»¥åˆ é™¤ï¼Œæ˜¯å¦å¯ä»¥ä¿®æ”¹å…¶å±æ€§ã€‚</li>
</ul>

<p>è®¸å¤š JavaScript çš„å†…ç½®å¯¹è±¡å…·æœ‰åªè¯»ã€ä¸å¯æšä¸¾æˆ–ä¸å¯é…ç½®çš„å±æ€§ã€‚ä½†æ˜¯ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆ›å»ºçš„å¯¹è±¡çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯å¯å†™ã€å¯æšä¸¾å’Œå¯é…ç½®çš„ã€‚Â§14.1 è§£é‡Šäº†ä¸ºå¯¹è±¡æŒ‡å®šéé»˜è®¤å±æ€§å±æ€§å€¼çš„æŠ€å·§ã€‚</p>

<h2 id="toc_1">6.2 åˆ›å»ºå¯¹è±¡</h2>

<p>å¯¹è±¡å¯ä»¥ç”¨å¯¹è±¡å­—é¢é‡åˆ›å»ºï¼Œä¹Ÿå¯ä»¥ç”¨ new å…³é”®å­—å’Œ Object.create() å‡½æ•°æ¥åˆ›å»ºã€‚æ¥ä¸‹æ¥çš„å‡ éƒ¨åˆ†å¯¹è¿™äº›æŠ€æœ¯ä¸€ä¸€è®²è¿°ã€‚</p>

<h3 id="toc_2">6.2.1 å¯¹è±¡å­—é¢é‡</h3>

<p>åˆ›å»ºå¯¹è±¡æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åœ¨ JavaScript ä»£ç ä¸­ä½¿ç”¨å¯¹è±¡ç›´æ¥é‡ã€‚å¯¹è±¡ç›´æ¥é‡æ˜¯ç”±è‹¥å¹²å/å€¼å¯¹ç»„æˆçš„æ˜ å°„è¡¨ï¼Œå/å€¼å¯¹ä¸­é—´ç”¨å†’å·åˆ†éš”ï¼Œå/å€¼å¯¹ä¹‹é—´ç”¨é€—å·åˆ†éš”ï¼Œæ•´ä¸ªæ˜ å°„è¡¨ç”¨èŠ±æ‹¬å·æ‹¬èµ·æ¥ã€‚å±æ€§åå¯ä»¥æ˜¯ JavaScript æ ‡è¯†ç¬¦ä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆåŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ï¼‰ã€‚å±æ€§çš„å€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„ JavaScript è¡¨è¾¾å¼ï¼›è¡¨è¾¾å¼çš„å€¼ï¼ˆå¯ä»¥æ˜¯åŸå§‹å€¼ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡å€¼ï¼‰å˜æˆè¿™ä¸ªå±æ€§çš„å€¼ã€‚ä¸‹é¢æœ‰ä¸€äº›ä¾‹å­ï¼š</p>

<pre><code class="language-javascript">let empty = {};                          // An object with no properties
let point = { x: 0, y: 0 };              // Two numeric properties
let p2 = { x: point.x, y: point.y+1 };   // More complex values
let book = {
    &quot;main title&quot;: &quot;JavaScript&quot;,          // These property names include spaces,
    &quot;sub-title&quot;: &quot;The Definitive Guide&quot;, // and hyphens, so use string literals.
    for: &quot;all audiences&quot;,                // for is reserved, but no quotes.
    author: {                            // The value of this property is
        firstname: &quot;David&quot;,              // itself an object.
        surname: &quot;Flanagan&quot;
    }
};
</code></pre>

<p>å¯¹è±¡æ–‡æœ¬ä¸­æœ€åä¸€ä¸ªå±æ€§çš„å°¾éšé€—å·æ˜¯åˆæ³•çš„ï¼Œå¹¶ä¸”æŸäº›ç¼–ç¨‹æ ·å¼é¼“åŠ±ä½¿ç”¨è¿™äº›å°¾éšé€—å·ï¼Œå› ä¸ºï¼Œå¦‚æœä¹‹ååœ¨å¯¹è±¡æ–‡æœ¬çš„æœ«å°¾æ·»åŠ æ–°å±æ€§ï¼Œåˆ™ä¸å¤ªå¯èƒ½å¯¼è‡´è¯­æ³•é”™è¯¯ã€‚</p>

<p>å¯¹è±¡å­—é¢é‡æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒæ¯æ¬¡è®¡ç®—æ—¶éƒ½ä¼šåˆ›å»ºå’Œåˆå§‹åŒ–ä¸€ä¸ªæ–°å¯¹è±¡ã€‚æ¯æ¬¡å­—é¢é‡è®¡ç®—æ—¶ï¼Œå°†è®¡ç®—æ¯ä¸ªå±æ€§çš„å€¼ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœå•ä¸ªå¯¹è±¡å­—é¢é‡å‡ºç°åœ¨å¾ªç¯ä½“æˆ–é‡å¤è°ƒç”¨çš„å‡½æ•°ä¸­ï¼Œå®ƒèƒ½åˆ›å»ºè®¸å¤šä¸ªæ–°å¯¹è±¡ï¼Œå¹¶ä¸”è¿™äº›å¯¹è±¡çš„å±æ€§å€¼å¯èƒ½å½¼æ­¤ä¸åŒã€‚</p>

<p>æ­¤å¤„çš„ç®€å•è¯­æ³•å¯¹è±¡å­—é¢é‡ï¼Œè‡ª JavaScript æœ€æ—©çš„ç‰ˆæœ¬ä»¥æ¥ä¸€ç›´æ˜¯åˆæ³•çš„ã€‚æœ€æ–°ç‰ˆæœ¬å¼•å…¥äº†è®¸å¤šå¯¹è±¡å­—é¢é‡çš„æ–°çš„ç‰¹æ€§ï¼Œè¿™äº›ç‰¹æ€§åœ¨ Â§6.10 ä¸­ä»‹ç»ã€‚</p>

<h3 id="toc_3">6.2.2 ç”¨ new åˆ›å»ºå¯¹è±¡</h3>

<p>new è¿ç®—ç¬¦åˆ›å»ºå¹¶åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚new å…³é”®å­—å¿…é¡»ç´§è·Ÿä¸€ä¸ªå‡½æ•°è°ƒç”¨ã€‚è¿™ç§æ–¹å¼ä½¿ç”¨å‡½æ•°å«åšæ„é€ å‡½æ•°è°ƒç”¨ï¼Œå…¶æä¾›åˆå§‹åŒ–ä¸€ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡çš„æœåŠ¡ã€‚åœ¨ JavaScript ä¸­ï¼Œå†…ç½®ç±»å‹éƒ½åŒ…å«ç›¸å¯¹åº”çš„æ„é€ å‡½æ•°ã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">let o = new Object();  // Create an empty object: same as {}.
let a = new Array();   // Create an empty array: same as [].
let d = new Date();    // Create a Date object representing the current time
let r = new Map();     // Create a Map object for key/value mapping
</code></pre>

<p>é™¤äº†è¿™äº›å†…ç½®æ„é€ å‡½æ•°ï¼Œå¸¸å¸¸ç”¨è‡ªå®šä¹‰æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–æ–°å¯¹è±¡ã€‚ ç¬¬ 9 ç« å°†è¯¦ç»†è®²è¿°å…¶ä¸­çš„ç»†èŠ‚ã€‚</p>

<h3 id="toc_4">6.2.3 åŸå‹</h3>

<p>åœ¨è®²è¿°ç¬¬ä¸‰ç§å¯¹è±¡åˆ›å»ºæŠ€æœ¯ä¹‹å‰ï¼Œæˆ‘ä»¬åº”å½“é¦–å…ˆè§£é‡Šä¸€ä¸‹åŸå‹ã€‚æ¯ä¸€ä¸ª JavaScript å¯¹è±¡éƒ½å’Œå¦ä¸€ä¸ªå¯¹è±¡ç›¸å…³è”ã€‚â€œå¦ä¸€ä¸ªâ€å¯¹è±¡å°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„åŸå‹ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½ä»åŸå‹ç»§æ‰¿å±æ€§ã€‚</p>

<p>æ‰€æœ‰é€šè¿‡å¯¹è±¡å­—é¢é‡åˆ›å»ºçš„å¯¹è±¡éƒ½å…·æœ‰åŒä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œå¹¶å¯ä»¥é€šè¿‡ JavaScript ä»£ç  Object.prototype è·å¾—å¯¹åŸå‹å¯¹è±¡çš„å¼•ç”¨ã€‚é€šè¿‡å…³é”®å­— new å’Œæ„é€ å‡½æ•°è°ƒç”¨åˆ›å»ºçš„å¯¹è±¡çš„åŸå‹å°±æ˜¯æ„é€ å‡½æ•°çš„ prototype å±æ€§çš„å€¼ã€‚å› æ­¤ï¼ŒåŒä½¿ç”¨ {} åˆ›å»ºå¯¹è±¡ä¸€æ ·ï¼Œé€šè¿‡ new Object() åˆ›å»ºçš„å¯¹è±¡ä¹Ÿç»§æ‰¿è‡ªObject.prototypeã€‚åŒæ ·ï¼Œé€šè¿‡ new Array() åˆ›å»ºçš„å¯¹è±¡çš„åŸå‹å°±æ˜¯ Array.prototypeï¼Œé€šè¿‡ new Date() åˆ›å»ºçš„å¯¹è±¡çš„åŸå‹å°±æ˜¯ Date.prototypeã€‚å½“ç¬¬ä¸€æ¬¡å­¦ä¹  JavaScript æ—¶ï¼Œè¿™å¯èƒ½ä»¤äººå›°æƒ‘ã€‚è¯·è®°ä½ï¼šå‡ ä¹æ‰€æœ‰å¯¹è±¡éƒ½æœ‰åŸå‹ï¼Œä½†åªæœ‰ç›¸å¯¹è¾ƒå°‘çš„å¯¹è±¡å…·æœ‰åŸå‹å±æ€§ã€‚æ­£æ˜¯è¿™äº›å…·æœ‰åŸå‹å±æ€§çš„å¯¹è±¡å®šä¹‰äº†æ‰€æœ‰å…¶ä»–å¯¹è±¡çš„åŸå‹ã€‚</p>

<p>æ²¡æœ‰åŸå‹çš„å¯¹è±¡ä¸ºæ•°ä¸å¤šï¼ŒObject.prototypeå°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼šå®ƒä¸ç»§æ‰¿ä»»ä½•å±æ€§ã€‚å…¶ä»–åŸå‹å¯¹è±¡éƒ½æ˜¯æ™®é€šå¯¹è±¡ï¼Œæ™®é€šå¯¹è±¡éƒ½å…·æœ‰åŸå‹ã€‚å¤§éƒ¨åˆ†çš„å†…ç½®æ„é€ å‡½æ•°ï¼ˆä»¥åŠå¤§éƒ¨åˆ†è‡ªå®šä¹‰çš„æ„é€ å‡½æ•°ï¼‰éƒ½å…·æœ‰ä¸€ä¸ªç»§æ‰¿è‡ª Object.prototype çš„åŸå‹ã€‚ä¾‹å¦‚ï¼Œ Date.prototype çš„å±æ€§ç»§æ‰¿è‡ª Object.prototypeï¼Œå› æ­¤ç”± new Date() åˆ›å»ºçš„ Date å¯¹è±¡çš„å±æ€§åŒæ—¶ç»§æ‰¿è‡ª Date.prototype å’Œ Object.prototypeã€‚è¿™ä¸€ç³»åˆ—é“¾æ¥çš„åŸå‹å¯¹è±¡å°±æ˜¯æ‰€è°“ â€œåŸå‹é“¾â€ï¼ˆprototype chainï¼‰ã€‚</p>

<p>Â§6.3.2 èŠ‚è®²è¿°å±æ€§ç»§æ‰¿çš„å·¥ä½œæœºåˆ¶ã€‚ç¬¬ 9 ç« å°†ä¼šæ›´è¯¦ç»†åœ°è®¨è®ºåŸå‹å’Œæ„é€ å‡½æ•°ï¼šåŒ…æ‹¬å¦‚ä½•é€šè¿‡ç¼–å†™æ„é€ å‡½æ•°å®šä¹‰å¯¹è±¡çš„â€œç±»â€ï¼Œä»¥åŠç»™æ„é€ å‡½æ•°çš„ prototype å±æ€§èµ‹å€¼å¯ä»¥è®©å…¶â€œå®ä¾‹â€ç›´æ¥ä½¿ç”¨è¿™ä¸ªåŸå‹ä¸Šçš„å±æ€§å’Œæ–¹æ³•ã€‚å¹¶ä¸”åœ¨ Â§14.3 æˆ‘ä»¬ä¼šå­¦ä¹ å¦‚ä½•æŸ¥è¯¢ï¼ˆç”šè‡³æ”¹å˜ï¼‰å¯¹è±¡çš„åŸå‹ã€‚</p>

<h3 id="toc_5">6.2.4 Object.create()</h3>

<p>Object.create() åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç”¨ç¬¬ä¸€ä¸ªå®å‚ä½œä¸ºå®ƒçš„åŸå‹ï¼š</p>

<pre><code class="language-javascript">let o1 = Object.create({x: 1, y: 2});     // o1 inherits properties x and y.
o1.x + o1.y                               // =&gt; 3
</code></pre>

<p>å¯ä»¥é€šè¿‡ä¼ å…¥å‚æ•° null æ¥åˆ›å»ºä¸€ä¸ªæ²¡æœ‰åŸå‹çš„æ–°å¯¹è±¡ï¼Œä½†é€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºçš„å¯¹è±¡ä¸ä¼šç»§æ‰¿ä»»ä½•ä¸œè¥¿ï¼Œç”šè‡³ä¸åŒ…æ‹¬åŸºç¡€æ–¹æ³•ï¼Œæ¯”å¦‚ toString()ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå°†ä¸èƒ½å’Œâ€œ+â€è¿ç®—ç¬¦ä¸€èµ·æ­£å¸¸å·¥ä½œï¼š</p>

<pre><code class="language-javascript">let o2 = Object.create(null);             // o2 inherits no props or methods.
</code></pre>

<p>å¦‚æœæƒ³åˆ›å»ºä¸€ä¸ªæ™®é€šçš„ç©ºå¯¹è±¡ï¼ˆåƒé€šè¿‡ {} æˆ– new Object() åˆ›å»ºçš„å¯¹è±¡ï¼‰ï¼Œéœ€è¦ä¼ å…¥ Object.prototypeï¼š</p>

<pre><code class="language-javascript">let o3 = Object.create(Object.prototype); // o3 is like {} or new Object().
</code></pre>

<p>å¯ä»¥é€šè¿‡ä»»æ„åŸå‹åˆ›å»ºæ–°å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œå¹¶ä¸”æœ¬ç« æˆ‘ä»¬ä¼šåœ¨å¾ˆå¤šåœ°æ–¹ä½¿ç”¨ Object.create()ã€‚ï¼ˆObject.create() ä¹Ÿå¯ä»¥ä¼ å…¥ç¬¬äºŒä¸ªå¯é€‰å®å‚æ¥æè¿°è¿™ä¸ªæ–°çš„å¯¹è±¡çš„å±æ€§ã€‚ç¬¬äºŒä¸ªå®å‚æ˜¯ä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼Œåœ¨  Â§14.1 å†è¿›è¡Œæè¿°ã€‚ï¼‰</p>

<p>Object.create() å…¶ä¸­ä¸€ä¸ªç”¨é€”æ˜¯é¢„é˜²å¯¹è±¡æ— æ„é—´ï¼ˆéæ¶æ„åœ°ï¼‰è¢«æ— æ³•æ”¯é…çš„åº“å‡½æ•°ç¯¡æ”¹ã€‚å¯ä»¥åˆ›å»ºä¸€ä¸ªç»§æ‰¿å®ƒçš„å¯¹è±¡æ¥ä¼ é€’ç»™å‡½æ•°ï¼Œè€Œä¸æ˜¯å°†å…¶ç›´æ¥ä¼ é€’ç»™å‡½æ•°ã€‚å½“å‡½æ•°è¯»å–ç»§æ‰¿å¯¹è±¡çš„å±æ€§æ—¶ï¼Œå®é™…ä¸Šè¯»å–çš„æ˜¯ç»§æ‰¿æ¥çš„å€¼ã€‚å¦‚æœç»™ç»§æ‰¿å¯¹è±¡çš„å±æ€§èµ‹å€¼ï¼Œåˆ™è¿™äº›å±æ€§åªä¼šå½±å“è¿™ä¸ªç»§æ‰¿å¯¹è±¡è‡ªèº«ï¼Œè€Œä¸æ˜¯åŸå§‹å¯¹è±¡ï¼š</p>

<pre><code class="language-javascript">let o = { x: &quot;don&#39;t change this value&quot; };
library.function(Object.create(o));  // Guard against accidental modifications
</code></pre>

<p>æƒ³è¦äº†è§£å…¶å·¥ä½œåŸç†ï¼Œéœ€è¦å…ˆçŸ¥é“ JavaScript ä¸­å±æ€§çš„æŸ¥è¯¢å’Œè®¾ç½®æœºåˆ¶ã€‚è¿™æ˜¯æ¥ä¸‹æ¥è¿™èŠ‚çš„ä¸»é¢˜ã€‚</p>

<h2 id="toc_6">6.3 æŸ¥è¯¢å’Œè®¾ç½®å±æ€§</h2>

<p>Â§4.4 å·²ç»æåˆ°ï¼Œå¯ä»¥é€šè¿‡ç‚¹ï¼ˆ.ï¼‰æˆ–æ–¹æ‹¬å·ï¼ˆ[]ï¼‰è¿ç®—ç¬¦æ¥è·å–å±æ€§çš„å€¼ã€‚è¿ç®—ç¬¦å·¦ä¾§åº”å½“æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœä½¿ç”¨ç‚¹è¿ç®—ç¬¦ï¼Œå³ä¾§å¿…é¡»æ˜¯ä¸€ä¸ªä»¥å±æ€§åç§°å‘½åçš„ç®€å•æ ‡è¯†ç¬¦ã€‚å¦‚æœä½¿ç”¨æ–¹æ‹¬å·ï¼Œæ–¹æ‹¬å·å†…å¿…é¡»æ˜¯ä¸€ä¸ªè®¡ç®—ç»“æœä¸ºå­—ç¬¦ä¸²çš„è¡¨è¾¾å¼ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯å±æ€§çš„åå­—ï¼š</p>

<pre><code class="language-javascript">let author = book.author;       // Get the &quot;author&quot; property of the book.
let name = author.surname;      // Get the &quot;surname&quot; property of the author.
let title = book[&quot;main title&quot;]; // Get the &quot;main title&quot; property of the book.
</code></pre>

<p>å’ŒæŸ¥è¯¢å±æ€§å€¼çš„å†™æ³•ä¸€æ ·ï¼Œé€šè¿‡ç‚¹å’Œæ–¹æ‹¬å·ä¹Ÿå¯ä»¥åˆ›å»ºå±æ€§æˆ–ç»™å±æ€§èµ‹å€¼ï¼Œä½†éœ€è¦å°†å®ƒä»¬æ”¾åœ¨èµ‹å€¼è¡¨è¾¾å¼çš„å·¦ä¾§ï¼š</p>

<pre><code class="language-javascript">book.edition = 7;                   // Create an &quot;edition&quot; property of book.
book[&quot;main title&quot;] = &quot;ECMAScript&quot;;  // Change the &quot;main title&quot; property.
</code></pre>

<p>å½“ä½¿ç”¨æ–¹æ‹¬å·æ—¶ï¼Œæˆ‘ä»¬è¯´æ–¹æ‹¬å·å†…çš„è¡¨è¾¾å¼å¿…é¡»è¿”å›å­—ç¬¦ä¸²ã€‚å…¶å®æ›´ä¸¥æ ¼åœ°è®²ï¼Œè¡¨è¾¾å¼å¿…é¡»è¿”å›å­—ç¬¦ä¸²æˆ–è¿”å›ä¸€ä¸ªå¯ä»¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„å€¼æˆ– Symbolï¼ˆÂ§6.10.3ï¼‰ã€‚åœ¨ç¬¬ 7 ç« é‡Œæœ‰ä¸€äº›ä¾‹å­ä¸­çš„æ–¹æ‹¬å·å†…ä½¿ç”¨äº†æ•°å­—ï¼Œè¿™æƒ…å†µæ˜¯éå¸¸å¸¸ç”¨çš„ã€‚</p>

<h3 id="toc_7">6.3.1 å¯¹è±¡ä½œå…³è”æ•°ç»„</h3>

<p>ä¸Šæ–‡æåˆ°ï¼Œä¸‹é¢ä¸¤ä¸ªè¡¨è¾¾å¼æœ‰ç›¸åŒçš„å€¼ï¼š</p>

<pre><code class="language-javascript">object.property
object[&quot;property&quot;]
</code></pre>

<p>ç¬¬ä¸€ç§è¯­æ³•ä½¿ç”¨ç‚¹è¿ç®—ç¬¦å’Œä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œè¿™å’Œ C å’Œ Java ä¸­è®¿é—®ä¸€ä¸ªç»“æ„ä½“æˆ–å¯¹è±¡çš„é™æ€å­—æ®µéå¸¸ç±»ä¼¼ã€‚ç¬¬äºŒç§è¯­æ³•ä½¿ç”¨æ–¹æ‹¬å·å’Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œçœ‹èµ·æ¥æ›´åƒæ•°ç»„ï¼Œåªæ˜¯è¿™ä¸ªæ•°ç»„å…ƒç´ æ˜¯é€šè¿‡å­—ç¬¦ä¸²ç´¢å¼•è€Œä¸æ˜¯æ•°å­—ç´¢å¼•ã€‚è¿™ç§æ•°ç»„å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å…³è”æ•°ç»„ï¼ˆassociative arrayï¼‰ï¼ˆä¹Ÿç§°åšæ•£åˆ—ã€æ˜ å°„æˆ–å­—å…¸ï¼‰ã€‚JavaScript å¯¹è±¡éƒ½æ˜¯å…³è”æ•°ç»„ï¼Œæœ¬èŠ‚å°†è®¨è®ºå®ƒçš„é‡è¦æ€§ã€‚</p>

<p>åœ¨ Cã€C++ã€Java å’Œä¸€äº›å¼ºç±»å‹è¯­è¨€ä¸­ï¼Œå¯¹è±¡åªèƒ½æ‹¥æœ‰å›ºå®šæ•°ç›®çš„å±æ€§ï¼Œå¹¶ä¸”è¿™äº›å±æ€§çš„åç§°å¿…é¡»æå‰å®šä¹‰å¥½ã€‚ç”±äº JavaScript æ˜¯ä¸€ä¸ªå¼±ç±»å‹è¯­è¨€ï¼Œå› æ­¤ä¸é€‚ç”¨è¿™æ¡è§„åˆ™ï¼šå¯¹è±¡åœ¨ç¨‹åºä¸­å¯ä»¥åˆ›å»ºä»»æ„æ•°é‡çš„å±æ€§ã€‚å½“ä½¿ç”¨ . è¿ç®—ç¬¦è®¿é—®å¯¹è±¡çš„å±æ€§æ—¶ï¼Œå±æ€§åç”¨ä¸€ä¸ªæ ‡è¯†ç¬¦æ¥è¡¨ç¤ºã€‚æ ‡è¯†ç¬¦å¿…é¡»ç›´æ¥å‡ºç°åœ¨ JavaScript ç¨‹åºä¸­ï¼Œå®ƒä»¬ä¸æ˜¯æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥æ— æ³•åœ¨ç¨‹åºä¸­ä¿®æ”¹ã€‚</p>

<p>å¦ä¸€ç§æ–¹å¼ï¼Œå½“é€šè¿‡ [] æ¥è®¿é—®å¯¹è±¡çš„å±æ€§æ—¶ï¼Œå±æ€§åé€šè¿‡å­—ç¬¦ä¸²æ¥è¡¨ç¤ºã€‚å­—ç¬¦ä¸²æ˜¯ JavaScript çš„æ•°æ®ç±»å‹ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶å¯ä»¥ä¿®æ”¹å’Œåˆ›å»ºå®ƒä»¬ã€‚å› æ­¤ï¼Œå¯ä»¥åœ¨ JavaScript ä¸­ä½¿ç”¨ä¸‹é¢è¿™ç§ä»£ç ï¼š</p>

<pre><code class="language-javascript">let addr = &quot;&quot;;
for(let i = 0; i &lt; 4; i++) {
    addr += customer[`address${i}`] + &quot;\n&quot;;
}
</code></pre>

<p>è¿™æ®µä»£ç è¯»å– customer å¯¹è±¡çš„ address0ã€address1ã€address2 å’Œ address3 å±æ€§ï¼Œå¹¶å°†å®ƒä»¬è¿æ¥èµ·æ¥ã€‚</p>

<p>è¿™ä¸ªä¾‹å­ä¸»è¦è¯´æ˜äº†é€šè¿‡å­—ç¬¦ä¸²è¡¨è¾¾å¼ä½¿ç”¨æ•°ç»„æ ‡è®°æ¥è®¿é—®å¯¹è±¡å±æ€§çš„çµæ´»æ€§ã€‚è¿™æ®µä»£ç ä¹Ÿå¯ä»¥é€šè¿‡ç‚¹è¿ç®—ç¬¦æ¥é‡å†™ï¼Œä½†æ˜¯ä¸€äº›åœºæ™¯åªèƒ½ä½¿ç”¨æ•°ç»„å†™æ³•æ¥å®Œæˆã€‚å‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ªç¨‹åºï¼Œè¿™ä¸ªç¨‹åºåˆ©ç”¨ç½‘ç»œèµ„æºè®¡ç®—ç”¨æˆ·è‚¡ç¥¨å¸‚åœºæŠ•èµ„çš„å½“å‰ä»·å€¼ã€‚ç¨‹åºå…è®¸ç”¨æˆ·è¾“å…¥ä»–ä»¬æ‹¥æœ‰çš„è‚¡ç¥¨åç§°ä»¥åŠå¯¹åº”çš„æ•°é‡ã€‚ä½ å¯ä»¥ç”¨ä¸€ä¸ªåä¸º portfolio çš„å¯¹è±¡æ¥å‚¨å­˜è¿™äº›ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªè‚¡ç¥¨åœ¨å¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ªå±æ€§ä¸ä¹‹å¯¹åº”ã€‚å±æ€§åæ˜¯è‚¡ç¥¨åï¼Œå±æ€§å€¼æ˜¯è‚¡ç¥¨æŒæœ‰ä»½é¢ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·æŒæœ‰ IBM çš„ 50 è‚¡ï¼Œé‚£ä¹ˆ portfolio.ibm å±æ€§çš„å€¼å°±ä¸º 50ã€‚</p>

<p>ä¸‹é¢æ˜¯ç¨‹åºçš„éƒ¨åˆ†ä»£ç ï¼Œè¿™ä¸ªå‡½æ•°ç”¨æ¥ç»™ portifolio æ·»åŠ æ–°çš„è‚¡ç¥¨ï¼š</p>

<pre><code class="language-javascript">function addstock(portfolio, stockname, shares) {
    portfolio[stockname] = shares;
}
</code></pre>

<p>ç”±äºç”¨æˆ·æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶è¾“å…¥è‚¡ç¥¨åç§°ï¼Œå› æ­¤åœ¨ä¹‹å‰æ— æ³•å¾—çŸ¥è¿™äº›è‚¡ç¥¨çš„åç§°æ˜¯ä»€ä¹ˆã€‚è€Œç”±äºåœ¨å†™ç¨‹åºçš„æ—¶å€™ä¸çŸ¥é“å±æ€§åç§°ï¼Œå› æ­¤æ— æ³•é€šè¿‡ç‚¹è¿ç®—ç¬¦ï¼ˆ.ï¼‰æ¥è®¿é—®å¯¹è±¡ portfolio çš„å±æ€§ã€‚ä½†å¯ä»¥ä½¿ç”¨ [] è¿ç®—ç¬¦ï¼Œå› ä¸ºå®ƒä½¿ç”¨å­—ç¬¦ä¸²å€¼ï¼ˆå­—ç¬¦ä¸²å€¼æ˜¯åŠ¨æ€çš„ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ”¹ï¼‰è€Œä¸æ˜¯æ ‡è¯†ç¬¦ï¼ˆæ ‡è¯†ç¬¦æ˜¯é™æ€çš„ï¼Œå¿…é¡»å†™æ­»åœ¨ç¨‹åºä¸­ï¼‰ä½œä¸ºç´¢å¼•å¯¹å±æ€§è¿›è¡Œè®¿é—®ã€‚</p>

<p>ç¬¬ 5 ç« ä»‹ç»äº† for/in å¾ªç¯ï¼ˆÂ§6.6 èŠ‚è¿˜ä¼šè¿›ä¸€æ­¥ä»‹ç»ï¼‰ã€‚å½“ä½¿ç”¨ for/in å¾ªç¯éå†å…³è”æ•°ç»„æ—¶ï¼Œå°±å¯ä»¥æ¸…æ™°åœ°ä½“ä¼šåˆ° for/in çš„å¼ºå¤§ä¹‹å¤„ã€‚ä¸‹é¢çš„ä¾‹å­å°±æ˜¯åˆ©ç”¨ for/in è®¡ç®—  portfolio çš„åˆè®¡å€¼ï¼š</p>

<pre><code class="language-javascript">function computeValue(portfolio) {
    let total = 0.0;
    for(let stock in portfolio) {       // For each stock in the portfolio:
        let shares = portfolio[stock];  // get the number of shares
        let price = getQuote(stock);    // look up share price
        total += shares * price;        // add stock value to total value
    }
    return total;                       // Return total value.
}
</code></pre>

<p>å¦‚æœ¬èŠ‚æ‰€ç¤ºï¼ŒJavaScript å¯¹è±¡é€šå¸¸ç”¨ä½œå…³è”æ•°ç»„ï¼Œç†è§£å…¶å·¥ä½œåŸç†éå¸¸é‡è¦ã€‚ä½†æ˜¯ï¼Œåœ¨ ES6 ä¹‹åä½¿ç”¨ Map ç±»å¸¸å¸¸æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å°†åœ¨ Â§11.1.2 ä¸­è¿›è¡Œæè¿°ã€‚</p>

<h3 id="toc_8">6.3.2 ç»§æ‰¿</h3>

<p>JavaScript å¯¹è±¡ä¸­æœ‰ä¸€ç»„â€œè‡ªæœ‰å±æ€§â€ï¼Œä¹Ÿæœ‰ä¸€ç»„å±æ€§æ˜¯ç»§æ‰¿è‡ªå®ƒçš„åŸå‹å¯¹è±¡ã€‚æƒ³è¦ç†è§£å±æ€§ç»§æ‰¿ï¼Œå¿…é¡»æ›´æ·±å…¥åœ°äº†è§£å±æ€§è®¿é—®çš„ç»†èŠ‚ã€‚è¿™ä¸€èŠ‚çš„ä¾‹å­é€šè¿‡ä½¿ç”¨ Object.create() å‡½æ•°åˆ›å»ºå¯¹è±¡æ¥æŒ‡å®šå®ƒçš„åŸå‹ã€‚æˆ‘ä»¬ä¼šåœ¨ç¬¬ 9 ç« å†æ¬¡çœ‹åˆ°å®ƒï¼Œä½†æ˜¯ï¼Œæ¯æ¬¡ä½¿ç”¨ new åˆ›å»ºç±»çš„å®ä¾‹æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªä»åŸå‹å¯¹è±¡ç»§æ‰¿å±æ€§çš„å¯¹è±¡ã€‚</p>

<p>å‡è®¾è¦æŸ¥è¯¢å¯¹è±¡ o çš„å±æ€§ xã€‚å¦‚æœ o ä¸­ä¸å­˜åœ¨ x åç§°çš„è‡ªç”±å±æ€§ï¼Œé‚£ä¹ˆå°†ä¼šç»§ç»­åœ¨ o çš„åŸå‹å¯¹è±¡ä¸­æŸ¥è¯¢å±æ€§ xã€‚å¦‚æœåŸå‹å¯¹è±¡ä¸­ä¹Ÿæ²¡æœ‰ xï¼Œä½†è¿™ä¸ªåŸå‹å¯¹è±¡ä¹Ÿæœ‰åŸå‹ï¼Œé‚£ä¹ˆç»§ç»­åœ¨è¿™ä¸ªåŸå‹å¯¹è±¡çš„åŸå‹ä¸Šæ‰§è¡ŒæŸ¥è¯¢ï¼Œç›´åˆ°æ‰¾åˆ° x æˆ–è€…æŸ¥æ‰¾åˆ°ä¸€ä¸ªåŸå‹æ˜¯ null çš„å¯¹è±¡ä¸ºæ­¢ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå¯¹è±¡çš„åŸå‹å±æ€§æ„æˆäº†ä¸€ä¸ªâ€œé“¾â€ï¼Œé€šè¿‡è¿™ä¸ªâ€œé“¾â€å¯ä»¥å®ç°å±æ€§çš„ç»§æ‰¿ã€‚</p>

<pre><code class="language-javascript">let o = {};               // o inherits object methods from Object.prototype
o.x = 1;                  // and it now has an own property x.
let p = Object.create(o); // p inherits properties from o and Object.prototype
p.y = 2;                  // and has an own property y.
let q = Object.create(p); // q inherits properties from p, o, and...
q.z = 3;                  // ...Object.prototype and has an own property z.
let f = q.toString();     // toString is inherited from Object.prototype
q.x + q.y                 // =&gt; 3; x and y are inherited from o and p
</code></pre>

<p>ç°åœ¨å‡è®¾ç»™å¯¹è±¡ o çš„å±æ€§ x èµ‹å€¼ï¼Œå¦‚æœ o ä¸­å·²ç»æœ‰å±æ€§ xï¼ˆè¿™ä¸ªå±æ€§ä¸æ˜¯ç»§æ‰¿æ¥çš„ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªèµ‹å€¼æ“ä½œåªæ”¹å˜è¿™ä¸ªå·²æœ‰å±æ€§ x çš„å€¼ã€‚å¦åˆ™ï¼Œèµ‹å€¼æ“ä½œç»™ o æ·»åŠ ä¸€ä¸ªæ–°å±æ€§ xã€‚å¦‚æœä¹‹å‰ o ç»§æ‰¿è‡ªå±æ€§ xï¼Œé‚£ä¹ˆè¿™ä¸ªç»§æ‰¿çš„å±æ€§å°±è¢«æ–°åˆ›å»ºçš„åŒåå±æ€§è¦†ç›–äº†ã€‚</p>

<p>å±æ€§èµ‹å€¼æ“ä½œæ£€æŸ¥åŸå‹é“¾åªæ˜¯åˆ¤æ–­æ˜¯å¦å…è®¸èµ‹å€¼æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœ o ç»§æ‰¿è‡ªä¸€ä¸ªåªè¯»å±æ€§ xï¼Œé‚£ä¹ˆèµ‹å€¼æ“ä½œæ˜¯ä¸å…è®¸çš„ï¼ˆÂ§6.3.3 å°†å¯¹æ­¤è¿›è¡Œè¯¦ç»†è®¨è®ºï¼‰ã€‚ å¦‚æœå…è®¸å±æ€§èµ‹å€¼æ“ä½œï¼Œå®ƒä¹Ÿæ€»æ˜¯åœ¨åŸå§‹å¯¹è±¡ä¸Šåˆ›å»ºå±æ€§æˆ–å¯¹å·²æœ‰çš„å±æ€§èµ‹å€¼ï¼Œè€Œä¸ä¼šå»ä¿®æ”¹åŸå‹é“¾ã€‚åœ¨ JavaScript ä¸­ï¼Œåªæœ‰åœ¨æŸ¥è¯¢å±æ€§æ—¶æ‰ä¼šä½“ä¼šåˆ°ç»§æ‰¿çš„å­˜åœ¨ï¼Œè€Œè®¾ç½®å±æ€§åˆ™å’Œç»§æ‰¿æ— å…³ï¼Œè¿™æ˜¯ JavaScript çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œè¯¥ç‰¹æ€§è®©ç¨‹åºå‘˜å¯ä»¥æœ‰é€‰æ‹©åœ°é‡å†™ç»§æ‰¿çš„å±æ€§ã€‚</p>

<pre><code class="language-javascript">let unitcircle = { r: 1 };         // An object to inherit from
let c = Object.create(unitcircle); // c inherits the property r
c.x = 1; c.y = 1;                  // c defines two properties of its own
c.r = 2;                           // c overrides its inherited property
unitcircle.r                       // =&gt; 1: the prototype is not affected
</code></pre>

<p>å±æ€§èµ‹å€¼è¦ä¹ˆå¤±è´¥ï¼Œè¦ä¹ˆåˆ›å»ºä¸€ä¸ªå±æ€§ï¼Œè¦ä¹ˆåœ¨åŸå§‹å¯¹è±¡ä¸­è®¾ç½®å±æ€§ã€‚ä½†æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œå¦‚æœ o ç»§æ‰¿è‡ªå±æ€§ xï¼Œè€Œè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå…·æœ‰ setter æ–¹æ³•çš„å­˜å–å™¨å±æ€§ï¼ˆå‚ç…§ Â§6.10.6ï¼‰ï¼Œé‚£ä¹ˆè¿™æ—¶å°†è°ƒç”¨ setter æ–¹æ³•è€Œä¸æ˜¯ç»™ o åˆ›å»ºä¸€ä¸ªå±æ€§ xã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œsetter æ–¹æ³•æ˜¯ç”±å¯¹è±¡ o è°ƒç”¨çš„ï¼Œè€Œä¸æ˜¯å®šä¹‰è¿™ä¸ªå±æ€§çš„åŸå‹å¯¹è±¡è°ƒç”¨çš„ã€‚å› æ­¤å¦‚æœ setter æ–¹æ³•å®šä¹‰ä»»æ„å±æ€§ï¼Œè¿™ä¸ªæ“ä½œåªæ˜¯é’ˆå¯¹ o æœ¬èº«ï¼Œå¹¶ä¸ä¼šä¿®æ”¹åŸå‹é“¾ã€‚</p>

<h3 id="toc_9">6.3.3 å±æ€§è®¿é—®å¼‚å¸¸</h3>

<p>å±æ€§è®¿é—®è¡¨è¾¾å¼å¹¶ä¸æ€»æ˜¯è¿”å›æˆ–è®¾ç½®ä¸€ä¸ªå€¼ã€‚æœ¬èŠ‚è®²è¿°æŸ¥è¯¢æˆ–è®¾ç½®å±æ€§æ—¶çš„ä¸€äº›å‡ºé”™æƒ…å†µã€‚</p>

<p>æŸ¥è¯¢ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§å¹¶ä¸ä¼šæŠ¥é”™ï¼Œå¦‚æœåœ¨å¯¹è±¡ o è‡ªèº«çš„å±æ€§æˆ–ç»§æ‰¿çš„å±æ€§ä¸­å‡æœªæ‰¾åˆ°å±æ€§ xï¼Œå±æ€§è®¿é—®è¡¨è¾¾å¼ o.x è¿”å› undefinedã€‚å›æƒ³ä¸€ä¸‹æˆ‘ä»¬çš„ book å¯¹è±¡æœ‰å±æ€§â€œsub-titleâ€ï¼Œè€Œæ²¡æœ‰å±æ€§â€œsubtitleâ€ï¼š</p>

<pre><code class="language-javascript">book.subtitle    // =&gt; undefined: property doesn&#39;t exist
</code></pre>

<p>ä½†æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè¯•å›¾æŸ¥è¯¢è¿™ä¸ªä¸å­˜åœ¨çš„å¯¹è±¡çš„å±æ€§å°±ä¼šæŠ¥é”™ã€‚null å’Œ undefined å€¼éƒ½æ²¡æœ‰å±æ€§ï¼Œå› æ­¤æŸ¥è¯¢è¿™äº›å€¼çš„å±æ€§ä¼šæŠ¥é”™ï¼Œæ¥ä¸Šä¾‹ï¼š</p>

<pre><code class="language-javascript">let len = book.subtitle.length; // !TypeError: undefined doesn&#39;t have length
</code></pre>

<p>å¦‚æœ . çš„å·¦è¾¹æ˜¯ null æˆ– undefined æ—¶ï¼Œå…¶å±æ€§è¡¨è¾¾å¼ä¼šå¤±è´¥ã€‚æ‰€ä»¥å½“å†™ä¸€ä¸ªåƒ book.author.surname ä¸€æ ·çš„è¡¨è¾¾å¼æ—¶ï¼Œå¦‚æœä½ ä¸ç¡®å®š book å’Œ book.author ç¡®å®è¢«å®šä¹‰å°±è¦å°å¿ƒäº†ã€‚ä¸‹é¢æä¾›äº†ä¸¤ç§é¿å…å‡ºé”™çš„æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">// A verbose and explicit technique
let surname = undefined;
if (book) {
    if (book.author) {
        surname = book.author.surname;
    }
}

// A concise and idiomatic alternative to get surname or null or undefined
surname = book &amp;&amp; book.author &amp;&amp; book.author.surname;
</code></pre>

<p>ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆè¿™é‡Œçš„ç¬¬äºŒç§æ–¹æ³•å¯ä»¥é¿å…ç±»å‹é”™è¯¯å¼‚å¸¸ï¼Œå¯ä»¥å‚ç…§ Â§4.10.1èŠ‚ ä¸­å…³äº &amp;&amp; è¿ç®—ç¬¦çš„çŸ­è·¯è¡Œä¸ºã€‚</p>

<p>å¦‚ Â§4.4.1 ä¸­æ‰€æè¿°ï¼ŒES2020 æ”¯æŒç”¨ ?. æ¡ä»¶å±æ€§è®¿é—®ï¼Œå®ƒå…è®¸è¿™æ ·é‡å†™ä¸Šé¢çš„èµ‹å€¼è¡¨è¾¾å¼ï¼š</p>

<pre><code class="language-javascript">let surname = book?.author?.surname;
</code></pre>

<p>å½“ç„¶ï¼Œç»™ null å’Œ undefined è®¾ç½®å±æ€§ä¹Ÿä¼šæŠ¥ç±»å‹é”™è¯¯ã€‚ç»™å…¶ä»–å€¼è®¾ç½®å±æ€§ä¹Ÿä¸æ€»æ˜¯æˆåŠŸï¼Œæœ‰ä¸€äº›å±æ€§æ˜¯åªè¯»çš„ï¼Œä¸èƒ½é‡æ–°èµ‹å€¼ï¼Œæœ‰ä¸€äº›å¯¹è±¡ä¸å…è®¸æ–°å¢å±æ€§ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ˆÂ§5.6.3ï¼‰ï¼Œå±æ€§è®¾å®šå¤±è´¥æ—¶ä¼šæŠ›å‡º TypeError å¼‚å¸¸ã€‚åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè¿™äº›å¤±è´¥çš„å¤„ç†ç»å¸¸æ²¡æœ‰ä»»ä½•ååº”ã€‚</p>

<p>å°½ç®¡å±æ€§èµ‹å€¼æˆåŠŸæˆ–å¤±è´¥çš„è§„å¾‹çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†è¦æè¿°æ¸…æ¥šå¹¶ä¸å®¹æ˜“ã€‚åœ¨è¿™äº›åœºæ™¯ä¸‹ç»™å¯¹è±¡ o è®¾ç½®å±æ€§ p ä¼šå¤±è´¥ï¼š</p>

<p>o ä¸­çš„å±æ€§ p æ˜¯åªè¯»çš„ï¼šä¸èƒ½ç»™åªè¯»å±æ€§é‡æ–°èµ‹å€¼ã€‚</p>

<p>o ä¸­çš„å±æ€§ p æ˜¯ç»§æ‰¿å±æ€§ï¼Œä¸”å®ƒæ˜¯åªè¯»çš„ï¼šä¸èƒ½é€šè¿‡åŒåè‡ªæœ‰å±æ€§è¦†ç›–åªè¯»çš„ç»§æ‰¿å±æ€§ã€‚</p>

<p>o ä¸­ä¸å­˜åœ¨è‡ªæœ‰å±æ€§ pï¼šo æ²¡æœ‰ä½¿ç”¨ setter æ–¹æ³•ç»§æ‰¿å±æ€§ pï¼Œå¹¶ä¸”oçš„å¯æ‰©å±•æ€§æ˜¯ï¼ˆè§ Â§14.2ï¼‰falseã€‚å¦‚æœ o ä¸­ä¸å­˜åœ¨ pï¼Œè€Œä¸”æ²¡æœ‰ setter æ–¹æ³•å¯ä¾›è°ƒç”¨ï¼Œåˆ™ p ä¸€å®šä¼šæ·»åŠ è‡³ o ä¸­ã€‚ä½†å¦‚æœ o ä¸æ˜¯å¯æ‰©å±•çš„ï¼Œé‚£ä¹ˆåœ¨ o ä¸­ä¸èƒ½å®šä¹‰æ–°å±æ€§ã€‚</p>

<h2 id="toc_10">6.4 åˆ é™¤å±æ€§</h2>

<p>åˆ é™¤è¿ç®—ç¬¦ï¼ˆÂ§4.13.4ï¼‰èƒ½åˆ é™¤å¯¹è±¡ä¸­çš„å±æ€§ã€‚å®ƒçš„æ“ä½œæ•°åº”å½“æ˜¯ä¸€ä¸ªå±æ€§è®¿é—®è¡¨è¾¾å¼ã€‚ä»¤äººæ„å¤–çš„æ˜¯ï¼Œdelete æ²¡æœ‰æ“ä½œå±æ€§çš„å€¼ï¼Œè€Œæ˜¯æ“ä½œå±æ€§çš„å±æ€§ï¼š</p>

<pre><code class="language-javascript">delete book.author;          // The book object now has no author property.
delete book[&quot;main title&quot;];   // Now it doesn&#39;t have &quot;main title&quot;, either.
</code></pre>

<p>delete è¿ç®—ç¬¦åªåˆ é™¤è‡ªæœ‰å±æ€§ï¼Œä¸åˆ é™¤ç»§æ‰¿å±æ€§ã€‚ï¼ˆæƒ³è¦åˆ é™¤ä¸€ä¸ªç»§æ‰¿å±æ€§ï¼Œå¿…é¡»ä»å®šä¹‰è¿™ä¸ªå±æ€§çš„åŸå‹å¯¹è±¡ä¸Šåˆ é™¤å®ƒã€‚è¿™ä¼šå½±å“æ‰€æœ‰ç»§æ‰¿è¿™ä¸ªåŸå‹çš„å¯¹è±¡ã€‚ï¼‰</p>

<p>å¦‚æœåˆ é™¤æˆåŠŸæˆ–åˆ é™¤æ²¡æœ‰ä»»ä½•å½±å“æ—¶åˆ é™¤è¡¨è¾¾å¼è®¡ç®—ç»“æœæ˜¯ trueï¼ˆå¦‚åˆ é™¤ä¸å­˜åœ¨çš„å±æ€§ï¼‰ã€‚delete ä½œç”¨äºéå±æ€§è®¿é—®è¡¨è¾¾å¼ï¼ˆæ— ç”¨ä»£ç ï¼‰æ—¶ä¹Ÿè¿”å› trueã€‚</p>

<pre><code class="language-javascript">let o = {x: 1};    // o has own property x and inherits property toString
delete o.x         // =&gt; true: deletes property x
delete o.x         // =&gt; true: does nothing (x doesn&#39;t exist) but true anyway
delete o.toString  // =&gt; true: does nothing (toString isn&#39;t an own property)
delete 1           // =&gt; true: nonsense, but true anyway
</code></pre>

<p>delete ä¸èƒ½åˆ é™¤é‚£äº›å¯é…ç½®æ€§ä¸º false çš„å±æ€§ã€‚æŸäº›å†…ç½®å¯¹è±¡çš„å±æ€§æ˜¯ä¸å¯é…ç½®çš„ï¼Œæ¯”å¦‚é€šè¿‡å˜é‡å£°æ˜å’Œå‡½æ•°å£°æ˜åˆ›å»ºçš„å…¨å±€å¯¹è±¡çš„å±æ€§ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸­ï¼Œåˆ é™¤ä¸€ä¸ªä¸å¯é…ç½®å±æ€§ä¼šæŠ¥ä¸€ä¸ªç±»å‹é”™è¯¯ã€‚åœ¨éä¸¥æ ¼æ¨¡å¼ä¸­ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹çš„ delete æ“ä½œä¼šè¿”å› falseï¼š</p>

<pre><code class="language-javascript">// In strict mode, all these deletions throw TypeError instead of returning false
delete Object.prototype // =&gt; false: property is non-configurable
var x = 1;              // Declare a global variable
delete globalThis.x     // =&gt; false: can&#39;t delete this property
function f() {}         // Declare a global function
delete globalThis.f     // =&gt; false: can&#39;t delete this property either
</code></pre>

<p>å½“åœ¨éä¸¥æ ¼æ¨¡å¼ä¸­åˆ é™¤å…¨å±€å¯¹è±¡çš„å¯é…å€¼å±æ€§æ—¶ï¼Œå¯ä»¥çœç•¥å¯¹å…¨å±€å¯¹è±¡çš„å¼•ç”¨ï¼Œç›´æ¥åœ¨ delete æ“ä½œç¬¦åè·Ÿéšè¦åˆ é™¤çš„å±æ€§åå³å¯ï¼š</p>

<pre><code class="language-javascript">globalThis.x = 1;       // Create a configurable global property (no let or var)
delete x                // =&gt; true: this property can be deleted
</code></pre>

<p>ç„¶è€Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸­ï¼Œdelete åè·Ÿéšä¸€ä¸ªéæ³•çš„æ“ä½œæ•°ï¼ˆæ¯”å¦‚ xï¼‰ï¼Œåˆ™ä¼šæŠ¥ä¸€ä¸ªè¯­æ³•é”™è¯¯ï¼Œå› æ­¤å¿…é¡»æ˜¾å¼æŒ‡å®šå¯¹è±¡åŠå…¶å±æ€§ï¼š</p>

<pre><code class="language-javascript">delete x;               // SyntaxError in strict mode
delete globalThis.x;    // This works
</code></pre>

<h2 id="toc_11">6.5 æµ‹è¯•å±æ€§</h2>

<p>JavaScript å¯¹è±¡å¯ä»¥çœ‹ä½œå±æ€§çš„é›†åˆï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæ£€æµ‹é›†åˆä¸­æˆå‘˜çš„æ‰€å±å…³ç³»â€”â€”åˆ¤æ–­æŸä¸ªå±æ€§æ˜¯å¦å­˜åœ¨äºæŸä¸ªå¯¹è±¡ä¸­ã€‚å¯ä»¥ç”¨ in è¿ç®—ç¬¦ã€hasOwnPreperty() å’Œ  propertyIsEnumerable() æ–¹æ³•æ¥å®Œæˆè¿™ä¸ªå·¥ä½œï¼Œç”šè‡³ä»…é€šè¿‡å±æ€§æŸ¥è¯¢ä¹Ÿå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™èŠ‚çš„ä¾‹å­éƒ½æ˜¯ç”¨å­—ç¬¦ä¸²ä½œä¸ºå±æ€§åç§°ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ç”¨ Symbol ä½œä¸ºå±æ€§åï¼ˆÂ§6.10.3ï¼‰ã€‚</p>

<p>in è¿ç®—ç¬¦çš„å·¦ä¾§æ˜¯å±æ€§åï¼Œå³ä¾§æ˜¯å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡çš„è‡ªæœ‰å±æ€§æˆ–ç»§æ‰¿å±æ€§ä¸­åŒ…å«è¿™ä¸ªå±æ€§åˆ™è¿”å› trueï¼š</p>

<pre><code class="language-javascript">let o = { x: 1 };
&quot;x&quot; in o         // =&gt; true: o has an own property &quot;x&quot;
&quot;y&quot; in o         // =&gt; false: o doesn&#39;t have a property &quot;y&quot;
&quot;toString&quot; in o  // =&gt; true: o inherits a toString property
</code></pre>

<p>å¯¹è±¡çš„ hasOwnProperty() æ–¹æ³•ç”¨æ¥æ£€æµ‹ç»™å®šçš„åå­—æ˜¯å¦æ˜¯å¯¹è±¡çš„è‡ªæœ‰å±æ€§ã€‚å¯¹äºç»§æ‰¿å±æ€§å®ƒå°†è¿”å› falseï¼š</p>

<pre><code class="language-javascript">let o = { x: 1 };
o.hasOwnProperty(&quot;x&quot;)        // =&gt; true: o has an own property x
o.hasOwnProperty(&quot;y&quot;)        // =&gt; false: o doesn&#39;t have a property y
o.hasOwnProperty(&quot;toString&quot;) // =&gt; false: toString is an inherited property
</code></pre>

<p>propertyIsEnumerable() æ˜¯ hasOwnProperty() çš„å¢å¼ºç‰ˆã€‚åªæœ‰æ£€æµ‹åˆ°æ˜¯è‡ªæœ‰å±æ€§ä¸”è¿™ä¸ªå±æ€§çš„å¯æšä¸¾æ€§ä¸º true æ—¶å®ƒæ‰è¿”å› trueã€‚æŸäº›å†…ç½®å±æ€§æ˜¯ä¸å¯æšä¸¾çš„ã€‚é€šå¸¸ç”± JavaScript ä»£ç åˆ›å»ºçš„å±æ€§éƒ½æ˜¯å¯æšä¸¾çš„ï¼Œé™¤éä½¿ç”¨  Â§14.1 ä¸­ä»‹ç»çš„æŠ€æœ¯æ¥è®©å®ƒä»¬ä¸å¯æšä¸¾ã€‚</p>

<pre><code class="language-javascript">let o = { x: 1 };
o.propertyIsEnumerable(&quot;x&quot;)  // =&gt; true: o has an own enumerable property x
o.propertyIsEnumerable(&quot;toString&quot;)  // =&gt; false: not an own property
Object.prototype.propertyIsEnumerable(&quot;toString&quot;) // =&gt; false: not enumerable
</code></pre>

<p>é™¤äº†ä½¿ç”¨ in è¿ç®—ç¬¦ä¹‹å¤–ï¼Œå¦ä¸€ç§æ›´ç®€ä¾¿çš„æ–¹æ³•æ˜¯ä½¿ç”¨ !== åˆ¤æ–­ä¸€ä¸ªå±æ€§æ˜¯å¦æ˜¯ undefinedï¼š</p>

<pre><code class="language-javascript">let o = { x: 1 };
o.x !== undefined        // =&gt; true: o has a property x
o.y !== undefined        // =&gt; false: o doesn&#39;t have a property y
o.toString !== undefined // =&gt; true: o inherits a toString property
</code></pre>

<p>ç„¶è€Œæœ‰ä¸€ç§åœºæ™¯åªèƒ½ä½¿ç”¨ in è¿ç®—ç¬¦è€Œä¸èƒ½ä½¿ç”¨ä¸Šè¿°å±æ€§è®¿é—®çš„æ–¹å¼ã€‚in å¯ä»¥åŒºåˆ†ä¸å­˜åœ¨çš„å±æ€§å’Œå­˜åœ¨ä½†å€¼ä¸º undefined çš„å±æ€§ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>

<pre><code class="language-javascript">let o = { x: undefined };  // Property is explicitly set to undefined
o.x !== undefined          // =&gt; false: property exists but is undefined
o.y !== undefined          // =&gt; false: property doesn&#39;t even exist
&quot;x&quot; in o                   // =&gt; true: the property exists
&quot;y&quot; in o                   // =&gt; false: the property doesn&#39;t exist
delete o.x;                // Delete the property x
&quot;x&quot; in o                   // =&gt; false: it doesn&#39;t exist anymore
</code></pre>

<h2 id="toc_12">6.6 æšä¸¾å±æ€§</h2>

<p>é™¤äº†æ£€æµ‹å¯¹è±¡çš„å±æ€§æ˜¯å¦å­˜åœ¨ï¼Œæˆ‘ä»¬è¿˜ä¼šç»å¸¸éå†å¯¹è±¡çš„å±æ€§ã€‚æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>

<p>Â§5.4.5 è®¨è®ºè¿‡ for/in å¾ªç¯ï¼Œå…¶å¯ä»¥åœ¨å¾ªç¯ä½“ä¸­éå†æŒ‡å®šå¯¹è±¡ä¸­æ‰€æœ‰å¯æšä¸¾çš„å±æ€§ï¼ˆåŒ…æ‹¬è‡ªæœ‰å±æ€§å’Œç»§æ‰¿çš„å±æ€§ï¼‰ï¼ŒæŠŠå±æ€§åç§°èµ‹å€¼ç»™å¾ªç¯å˜é‡ã€‚å¯¹è±¡ç»§æ‰¿çš„ å†…ç½®æ–¹æ³•ä¸å¯æšä¸¾çš„ï¼Œä½†åœ¨ä»£ç ä¸­ç»™å¯¹è±¡æ·»åŠ çš„å±æ€§éƒ½æ˜¯å¯æšä¸¾çš„ï¼ˆé™¤éç”¨ä¸‹æ–‡ä¸­æåˆ°çš„ä¸€ä¸ªæ–¹æ³•å°†å®ƒä»¬è½¬æ¢ä¸ºä¸å¯æšä¸¾çš„ï¼‰ã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">let o = {x: 1, y: 2, z: 3};          // Three enumerable own properties
o.propertyIsEnumerable(&quot;toString&quot;)   // =&gt; false: not enumerable
for(let p in o) {                    // Loop through the properties
    console.log(p);                  // Prints x, y, and z, but not toString
}
</code></pre>

<p>ä¸ºäº†é˜²æ­¢ for/in æšä¸¾åˆ°ç»§æ‰¿å±æ€§ï¼Œå¯ä»¥åœ¨å¾ªç¯ä¸­æ·»åŠ æ˜¾ç¤ºæ£€æŸ¥ï¼š</p>

<pre><code class="language-javascript">for(let p in o) {
    if (!o.hasOwnProperty(p)) continue;       // Skip inherited properties
}

for(let p in o) {
    if (typeof o[p] === &quot;function&quot;) continue; // Skip all methods
}
</code></pre>

<p>ä½œä¸ºä½¿ç”¨ for/in å¾ªç¯çš„æ›¿ä»£æ–¹æ³•ï¼Œé€šå¸¸ä½¿ç”¨ for/of å¾ªç¯éå†æ˜“è·å–å¯¹è±¡çš„å±æ€§åç§°æ•°ç»„ã€‚å¯ä»¥ä½¿ç”¨å››ä¸ªå‡½æ•°è·å–å±æ€§åç§°æ•°ç»„ï¼š</p>

<p>Object.keys() è¿”å›å¯¹è±¡çš„å¯æšä¸¾è‡ªæœ‰å±æ€§åç§°æ•°ç»„é›†åˆã€‚æ•°ç»„å†…ä¸åŒ…å«ä¸å¯æšä¸¾å±æ€§ã€ç»§æ‰¿å±æ€§æˆ–å±æ€§åç§°æ˜¯ Symbolï¼ˆè§ Â§6.10.3ï¼‰çš„å±æ€§</p>

<p>Object.getOwnPropertyNames() ç”¨èµ·æ¥å’Œ Object.keys() ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒè¿”å›æ•°ç»„ä¸­ä¹ŸåŒ…å«ä¸å¯è¿­ä»£çš„è‡ªæœ‰å±æ€§ï¼Œåªè¦å®ƒä»¬çš„åç§°æ˜¯å­—ç¬¦ä¸²ã€‚</p>

<p>Object.getOwnPropertySymbols() è¿”å›åç§°æ˜¯ Symbol çš„è‡ªæœ‰å±æ€§ï¼Œæ— è®ºå®ƒä»¬æ˜¯å¦å¯æšä¸¾ã€‚</p>

<p>Reflect.ownKeys() è¿”å›æ‰€æœ‰çš„è‡ªç”±å±æ€§åç§°ï¼ŒåŒ…æ‹¬å¯æšä¸¾å’Œä¸å¯æšä¸¾ç±»å‹ï¼Œä¹ŸåŒ…æ‹¬å­—ç¬¦ä¸²å’Œ Symbolï¼ˆè§ Â§14.6ï¼‰ã€‚</p>

<p>åœ¨ Â§6.7 ä¸­æœ‰ä¾‹å­ä½¿ç”¨ for/of å¾ªç¯ Object.keys()ã€‚</p>

<h3 id="toc_13">6.6.1 å±æ€§æšä¸¾é¡ºåº</h3>

<p>ES6 æ­£å¼å®šä¹‰å…ƒç´ çš„è‡ªæœ‰å±æ€§çš„æšä¸¾é¡ºåºã€‚Object.keys()ã€Object.getOwnPropertyNames()ã€Object.getOwnPropertyNames()ã€Object.getOwnPropertySymbols()ã€Reflect.ownKeys() å’Œç›¸å…³æ–¹æ³•å¦‚ JSON.stringify() å±æ€§åˆ—è¡¨éƒ½æŒ‰ä»¥ä¸‹é¡ºåºæ’åˆ—çš„ï¼Œå—å®ƒä»¬è‡ªèº«æ˜¯å¦æ˜¯ä¸å¯æšä¸¾å±æ€§åˆ—è¡¨æˆ–è€…å±æ€§æ˜¯å­—ç¬¦ä¸²æˆ–è€… Symbol å½±å“ï¼š</p>

<p>é¦–å…ˆåˆ—å‡ºåç§°ä¸ºéè´Ÿæ•´æ•°çš„å­—ç¬¦ä¸²å±æ€§ï¼ŒæŒ‰ä»æœ€å°åˆ°æœ€å¤§çš„æ•°å­—é¡ºåºåˆ—å‡ºã€‚æ­¤è§„åˆ™æ„å‘³ç€æ•°ç»„å’Œæ•°ç»„ç±»å¯¹è±¡å°†æŒ‰é¡ºåºæšä¸¾å…¶å±æ€§ã€‚</p>

<p>åˆ—å‡ºæ‰€æœ‰çœ‹èµ·æ¥åƒæ•°ç»„ç´¢å¼•çš„å±æ€§åï¼Œå°†åˆ—å‡ºæ‰€æœ‰å…·æœ‰å­—ç¬¦ä¸²åç§°çš„å‰©ä½™å±æ€§ï¼ˆåŒ…æ‹¬çœ‹èµ·æ¥åƒè´Ÿæ•°æˆ–æµ®ç‚¹æ•°å­—çš„å±æ€§ï¼‰ã€‚è¿™äº›å±æ€§æŒ‰æ·»åŠ åˆ°å¯¹è±¡çš„é¡ºåºåˆ—å‡ºã€‚å¯¹äºåœ¨å¯¹è±¡å­—é¢é‡ä¸­å®šä¹‰çš„å±æ€§ï¼Œæ­¤é¡ºåºä¸å®ƒä»¬åœ¨æ–‡æœ¬ä¸­æ˜¾ç¤ºçš„é¡ºåºç›¸åŒã€‚</p>

<p>æœ€åï¼Œå…¶åç§°ä¸º Symbol å¯¹è±¡çš„å±æ€§æŒ‰æ·»åŠ åˆ°å¯¹è±¡çš„é¡ºåºåˆ—å‡ºã€‚</p>

<p>for/in å¾ªç¯çš„æšä¸¾é¡ºåºä¸åƒè¿™äº›æšä¸¾å‡½æ•°é‚£æ ·ä¸¥æ ¼æŒ‡å®šï¼Œä½†å®ç°é€šå¸¸æŒ‰åˆšæ‰æè¿°çš„é¡ºåºæšä¸¾è‡ªå·±çš„å±æ€§ï¼Œç„¶åå‘ä¸Šç§»åŠ¨åŸå‹é“¾æŒ‰ç›¸åŒé¡ºåºæšä¸¾æ¯ä¸ªåŸå‹å¯¹è±¡çš„å±æ€§ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œå¦‚æœå·²æšä¸¾å…·æœ‰ç›¸åŒåç§°çš„å±æ€§ï¼Œæˆ–è€…ä¸å¯æšä¸¾å±æ€§å·²ç»è¢«æ£€æµ‹è¿‡å†æ¬¡æšä¸¾åˆ°ç›¸åŒåç§°çš„å±æ€§ï¼Œéƒ½ä¸ä¼šå†æ¬¡æšä¸¾ã€‚</p>

<h2 id="toc_14">6.7 æ‰©å±•å¯¹è±¡</h2>

<p>åœ¨ JavaScript ä»£ç ä¸­æœ‰ä¸€ä¸ªå¾ˆå¸¸è§çš„æ“ä½œï¼Œéœ€è¦å°†ä¸€ä¸ªå¯¹è±¡ä¸­çš„å±æ€§æ‹·è´åˆ°å¦å¤–ä¸€ä¸ªå¯¹è±¡ã€‚ä»¥ä¸‹é¢çš„ä»£ç å¾ˆå®¹æ˜“å®ç°ï¼š</p>

<pre><code class="language-javascript">let target = {x: 1}, source = {y: 2, z: 3};
for(let key of Object.keys(source)) {
    target[key] = source[key];
}
target  // =&gt; {x: 1, y: 2, z: 3}
</code></pre>

<p>ä½†æ˜¯å› ä¸ºè¿™ä¸ªæ˜¯ä¸ªå¸¸ç”¨çš„æ“ä½œï¼Œå„ç§ JavaScript æ¡†æ¶å®šä¹‰å…¬ç”¨å‡½æ•°ï¼Œç»å¸¸å°†å…¶å‘½åä¸º extend() æ¥æ‰§è¡Œè¿™ä¸ªæ‹·è´æ“ä½œã€‚æœ€ååœ¨ ES6 ä¸­ï¼Œè¿™ä¸ªåŠŸèƒ½ä»¥ Object.assign() çš„å½¢å¼è¢«æ·»åŠ åˆ° JavaScript æ ¸å¿ƒè¯­è¨€ä¸­ã€‚</p>

<p>Object.assign() éœ€è¦ä¸¤ä¸ªæˆ–å¤šä¸ªå¯¹è±¡ä½œä¸ºå…¶å®å‚ã€‚å®ƒä¿®æ”¹å¹¶è¿”å›ç¬¬ä¸€ä¸ªå®å‚ï¼Œå³ç›®æ ‡å¯¹è±¡ï¼Œä½†ä¸ä¼šæ”¹å˜ç¬¬äºŒä¸ªæˆ–ä»»ä½•åç»­å‚æ•°ï¼Œè¿™äº›å‚æ•°æ˜¯æºå¯¹è±¡ã€‚å¯¹äºæ¯ä¸ªæºå¯¹è±¡ï¼Œå®ƒå°†è¯¥å¯¹è±¡çš„å¯æšä¸¾è‡ªæœ‰å±æ€§ï¼ˆåŒ…æ‹¬åç§°ä¸º Symbol çš„å±æ€§ï¼‰å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ä¸­ã€‚å®ƒæŒ‰æºå¯¹è±¡åœ¨å®å‚åˆ—è¡¨é¡ºåºä¸­çš„é¡ºåºå¤„ç†ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæºå¯¹è±¡ä¸­çš„å±æ€§ä¼šé‡å†™åœ¨ç›®æ ‡å¯¹è±¡ä¸­çš„åŒåå±æ€§ï¼Œç„¶åä»¥ç¬¬äºŒä¸ªæºå¯¹è±¡ä¸­çš„åŒåå±æ€§ï¼ˆå¦‚æœæœ‰ç¬¬äºŒä¸ªæºå¯¹è±¡ï¼‰å†æ¬¡é‡å†™ç¬¬ä¸€ä¸ªæºå¯¹è±¡é‡å†™åçš„å±æ€§ã€‚</p>

<p>Object.assign() é€šè¿‡æ™®é€šå±æ€§çš„ get å’Œ set æ“ä½œå¤åˆ¶å±æ€§ï¼Œå› æ­¤ï¼Œå¦‚æœæºå¯¹è±¡å…·æœ‰ getter æ–¹æ³•æˆ–ç›®æ ‡å¯¹è±¡å…·æœ‰ setter æ–¹æ³•ï¼Œåˆ™å°†åœ¨å¤åˆ¶æœŸé—´è°ƒç”¨å®ƒä»¬ï¼Œä½†ä¸ä¼šå¤åˆ¶æ–¹æ³•æœ¬èº«ã€‚</p>

<p>çœ‹è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œæœ‰ä¸€ä¸ªå¯¹è±¡å®šä¹‰è®¸å¤šå±æ€§çš„é»˜è®¤å€¼ï¼Œå¸Œæœ›å°†è¿™äº›é»˜è®¤å±æ€§ä¸­ä¸å­˜åœ¨äºç›®æ ‡å¯¹è±¡ä¸­çš„å±æ€§å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ä¸­ï¼Œä½¿ç”¨ Object.assign() ä¸ä¼šå¾—åˆ°æƒ³è¦çš„ç»“æœï¼š</p>

<pre><code class="language-javascript">Object.assign(o, defaults);  // overwrites everything in o with defaults
</code></pre>

<p>æƒ³å¾—åˆ°è¿™ä¸ªæ•ˆæœéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå°†é»˜è®¤å€¼æ‹·è´åˆ°å…¶ä¸­ï¼Œç„¶åç”¨ o çš„å±æ€§é‡å†™é»˜è®¤å€¼ä¸­çš„å±æ€§ï¼š</p>

<pre><code class="language-javascript">o = Object.assign({}, defaults, o);
</code></pre>

<p>æˆ‘ä»¬ä¼šåœ¨ Â§6.10.4 è§åˆ°ï¼Œå¯ä»¥ç”¨ ... å±•å¼€æ“ä½œç¬¦å¦‚ä¸‹æ“ä½œè¿™ä¸ªå¯¹è±¡æ‹·è´å¹¶é‡å†™ï¼š</p>

<pre><code class="language-javascript">o = {...defaults, ...o};
</code></pre>

<p>ä¸ºäº†é¿å…å¯¹è±¡åˆ›å»ºå’Œå¤åˆ¶çš„é¢å¤–å¼€é”€ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç¼–å†™ä¸€ä¸ª Object.assign() ä»…åœ¨ç¼ºå°‘å±æ€§æ—¶å¤åˆ¶å±æ€§ï¼š</p>

<pre><code class="language-javascript">// Like Object.assign() but doesn&#39;t override existing properties
// (and also doesn&#39;t handle Symbol properties)
function merge(target, ...sources) {
    for(let source of sources) {
        for(let key of Object.keys(source)) {
            if (!(key in target)) { // This is different than Object.assign()
                target[key] = source[key];
            }
        }
    }
    return target;
}
Object.assign({x: 1}, {x: 2, y: 2}, {y: 3, z: 4})  // =&gt; {x: 2, y: 3, z: 4}
merge({x: 1}, {x: 2, y: 2}, {y: 3, z: 4})          // =&gt; {x: 1, y: 2, z: 4}
</code></pre>

<p>ç¼–å†™å…¶ä»–å±æ€§æ“ä½œå…¬å…±å‡½æ•°å¾ˆç®€å•ï¼Œå°±æ˜¯åƒè¿™ä¸ª merge() å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå¯¹è±¡çš„å±æ€§ä¸å‡ºç°åœ¨å¦ä¸€ä¸ªæ¨¡æ¿å¯¹è±¡ä¸­ï¼Œåˆ™ restrict() å‡½æ•°ä¼šåˆ é™¤è¿™äº›å±æ€§ã€‚æˆ–è€…ï¼Œsubtract() å‡½æ•°å¯ä»¥ä»å…¶ä»–å¯¹è±¡ä¸­åˆ é™¤ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§ã€‚</p>

<h2 id="toc_15">6.8 åºåˆ—åŒ–å¯¹è±¡</h2>

<p>å¯¹è±¡åºåˆ—åŒ–ï¼ˆserializationï¼‰æ˜¯æŒ‡å°†å¯¹è±¡çš„çŠ¶æ€è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯å°†å­—ç¬¦ä¸²è¿˜åŸä¸ºå¯¹è±¡ã€‚å‡½æ•° JSON.stringify() å’Œ JSON.parse() ç”¨æ¥åºåˆ—åŒ–å’Œè¿˜åŸ JavaScript å¯¹è±¡ã€‚è¿™äº›æ–¹æ³•éƒ½ä½¿ç”¨ JSON ä½œä¸ºæ•°æ®äº¤æ¢æ ¼å¼ï¼ŒJSON çš„å…¨ç§°æ˜¯â€œJavaScript Object Notationâ€â€”â€”JavaScript å¯¹è±¡è¡¨ç¤ºæ³•ï¼Œå®ƒçš„è¯­æ³•å’Œ JavaScript å¯¹è±¡ä¸æ•°ç»„å­—é¢é‡çš„è¯­æ³•éå¸¸ç›¸è¿‘ï¼š</p>

<pre><code class="language-javascript">let o = {x: 1, y: {z: [false, null, &quot;&quot;]}}; // Define a test object
let s = JSON.stringify(o);   // s == &#39;{&quot;x&quot;:1,&quot;y&quot;:{&quot;z&quot;:[false,null,&quot;&quot;]}}&#39;
let p = JSON.parse(s);       // p == {x: 1, y: {z: [false, null, &quot;&quot;]}}
</code></pre>

<p>JSON çš„è¯­æ³•æ˜¯ JavaScript è¯­æ³•çš„å­é›†ï¼Œå®ƒå¹¶ä¸èƒ½è¡¨ç¤º JavaScript é‡Œçš„æ‰€æœ‰å€¼ã€‚æ”¯æŒå¯¹è±¡ã€æ•°ç»„ã€å­—ç¬¦ä¸²ã€æ— ç©·å¤§æ•°å­—ã€trueã€false å’Œ nullï¼Œå¹¶ä¸”å®ƒä»¬å¯ä»¥åºåˆ—åŒ–å’Œè¿˜åŸã€‚NaNã€Infinity å’Œ -Infinity åºåˆ—åŒ–çš„ç»“æœæ˜¯ nullï¼Œæ—¥æœŸå¯¹è±¡åºåˆ—åŒ–çš„ç»“æœæ˜¯ ISO æ ¼å¼çš„æ—¥æœŸå­—ç¬¦ä¸²ï¼ˆå‚ç…§ Date.toJSON() å‡½æ•°ï¼‰ï¼Œä½† JSON.parse() ä¾ç„¶ä¿ç•™å®ƒä»¬çš„å­—ç¬¦ä¸²å½¢æ€ï¼Œè€Œä¸ä¼šå°†å®ƒä»¬è¿˜åŸä¸ºåŸå§‹æ—¥æœŸå¯¹è±¡ã€‚å‡½æ•°ã€RegExpã€Error å¯¹è±¡å’Œ undefined å€¼ä¸èƒ½åºåˆ—åŒ–å’Œè¿˜åŸã€‚JSON.stringify() åªèƒ½åºåˆ—åŒ–å¯¹è±¡å¯æšä¸¾çš„è‡ªæœ‰å±æ€§ã€‚å¯¹äºä¸€ä¸ªä¸èƒ½åºåˆ—åŒ–çš„å±æ€§æ¥è¯´ï¼Œåœ¨åºåˆ—åŒ–åçš„è¾“å‡ºå­—ç¬¦ä¸²ä¸­ä¼šå°†è¿™ä¸ªå±æ€§çœç•¥æ‰ã€‚JSON.stringify() å’Œ JSON.parse() éƒ½å¯ä»¥æ¥æ”¶ç¬¬äºŒä¸ªå¯é€‰å®å‚ï¼Œé€šè¿‡ä¼ å…¥éœ€è¦åºåˆ—åŒ–æˆ–è¿˜åŸçš„å±æ€§åˆ—è¡¨æ¥å®šåˆ¶è‡ªå®šä¹‰çš„åºåˆ—åŒ–æˆ–è¿˜åŸæ“ä½œã€‚Â§11.6 æœ‰å…³äºè¿™äº›å‡½æ•°çš„è¯¦ç»†æ–‡æ¡£ã€‚</p>

<h2 id="toc_16">6.9 å¯¹è±¡æ–¹æ³•</h2>

<p>ä¸Šæ–‡å·²ç»è®¨è®ºè¿‡ï¼Œæ‰€æœ‰çš„ JavaScript å¯¹è±¡éƒ½ä» Object.prototype ç»§æ‰¿å±æ€§ï¼ˆé™¤äº†é‚£äº›ä¸é€šè¿‡åŸå‹æ˜¾å¼åˆ›å»ºçš„å¯¹è±¡ï¼‰ã€‚è¿™äº›ç»§æ‰¿å±æ€§ä¸»è¦æ˜¯æ–¹æ³•ï¼Œå› ä¸º JavaScript ç¨‹åºå‘˜æ™®éå¯¹ç»§æ‰¿æ–¹æ³•æ›´æ„Ÿå…´è¶£ã€‚ä¾‹å¦‚æˆ‘ä»¬å·²ç»è§è¿‡çš„ hasOwnProperty() å’Œ propertyIsEnumerable() æ–¹æ³•ã€‚ï¼ˆå¹¶ä¸”æˆ‘ä»¬ä¹Ÿå·²ç»æåˆ°äº†ä¸€å°éƒ¨åˆ†å®šä¹‰åœ¨å¯¹è±¡æ„é€ å‡½æ•°ä¸­çš„é™æ€å‡½æ•°ï¼Œåƒ Object.create() å’Œ Object.keys()ã€‚ï¼‰æœ¬èŠ‚ä»‹ç»åœ¨ Object.prototype ä¸Šå®šä¹‰çš„å°‘æ•°é€šç”¨å¯¹è±¡æ–¹æ³•ï¼Œä½†æ˜¯è¿™äº›æ–¹æ³•ç»å¸¸ä¼šè¢«æ›´ä¸“ä¸šçš„å®ç°æ‰€å–ä»£ã€‚åœ¨ä¸‹é¢çš„å„èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºåœ¨å•ä¸ªå¯¹è±¡ä¸Šå®šä¹‰è¿™äº›æ–¹æ³•çš„ç¤ºä¾‹ã€‚åœ¨ç¬¬ 9 ç« ä¸­ï¼Œå°†å­¦ä¹ å¦‚ä½•æ›´å¸¸è§„åŒ–åœ°ä¸ºæ•´ä¸ªå¯¹è±¡ç±»å®šä¹‰è¿™äº›æ–¹æ³•ã€‚</p>

<h3 id="toc_17">6.9.1 toString() æ–¹æ³•</h3>

<p>toString() æ–¹æ³•æ²¡æœ‰å®å‚ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªè¡¨ç¤ºè°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡å€¼çš„å­—ç¬¦ä¸²ã€‚åœ¨éœ€è¦å°†å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™ï¼ŒJavaScript éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚æ¯”å¦‚ï¼Œå½“ä½¿ç”¨ + è¿ç®—ç¬¦è¿æ¥ä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªå¯¹è±¡æ—¶æˆ–è€…åœ¨å¸Œæœ›ä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•ä¸­ä½¿ç”¨äº†å¯¹è±¡æ—¶éƒ½ä¼šè°ƒç”¨ toString()ã€‚</p>

<p>é»˜è®¤çš„ toString() æ–¹æ³•çš„è¿”å›å€¼å¸¦æœ‰çš„ä¿¡æ¯é‡å¾ˆå°‘ï¼ˆå°½ç®¡å®ƒåœ¨æ£€æµ‹å¯¹è±¡çš„ç±»å‹æ—¶éå¸¸æœ‰ç”¨ï¼Œå‚ç…§ Â§14.4.3ï¼‰ï¼Œä¾‹å¦‚ï¼Œä¸‹é¢è¿™è¡Œä»£ç çš„è®¡ç®—ç»“æœä¸ºå­—ç¬¦ä¸²â€[object Object]â€ï¼š</p>

<pre><code class="language-javascript">let s = { x: 1, y: 1 }.toString();  // s == &quot;[object Object]&quot;
</code></pre>

<p>ç”±äºé»˜è®¤çš„ toString() æ–¹æ³•å¹¶ä¸ä¼šè¾“å‡ºå¾ˆå¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œå› æ­¤å¾ˆå¤šç±»éƒ½å¸¦æœ‰è‡ªå®šä¹‰çš„ toString()ã€‚ä¾‹å¦‚ï¼Œå½“æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œç»“æœæ˜¯ä¸€ä¸ªæ•°ç»„å…ƒç´ åˆ—è¡¨ï¼Œåªæ˜¯æ¯ä¸ªå…ƒç´ éƒ½è½¬æ¢æˆäº†å­—ç¬¦ä¸²ï¼Œå†æ¯”å¦‚ï¼Œå½“å‡½æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå¾—åˆ°å‡½æ•°çš„æºä»£ç ã€‚å¯ä»¥åƒä¸‹é¢è¿™æ ·è‡ªå®šä¹‰ toString() æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">let point = {
    x: 1,
    y: 2,
    toString: function() { return `(${this.x}, ${this.y})`; }
};
String(point)    // =&gt; &quot;(1, 2)&quot;: toString() is used for string conversions
</code></pre>

<h3 id="toc_18">6.9.2 toLocaleString() æ–¹æ³•</h3>

<p>é™¤äº†åŸºæœ¬çš„ toString() æ–¹æ³•ä¹‹å¤–ï¼Œå¯¹è±¡éƒ½åŒ…å« toLocaleString() æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¿™ä¸ªå¯¹è±¡çš„æœ¬åœ°åŒ–å­—ç¬¦ä¸²ã€‚Object ä¸­é»˜è®¤çš„ toLocaleString() æ–¹æ³•å¹¶ä¸åšä»»ä½•æœ¬åœ°åŒ–è‡ªèº«çš„æ“ä½œï¼Œå®ƒä»…è°ƒç”¨ toString() æ–¹æ³•å¹¶è¿”å›å¯¹åº”å€¼ã€‚Date å’Œ Number ç±»å¯¹ toLocaleString() æ–¹æ³•åšäº†å®šåˆ¶ï¼Œå¯ä»¥ç”¨å®ƒå¯¹æ•°å­—ã€æ—¥æœŸå’Œæ—¶é—´åšæœ¬åœ°åŒ–çš„è½¬æ¢ã€‚ Array ç±»çš„ toLocaleString() æ–¹æ³•å’Œ toString() æ–¹æ³•å¾ˆåƒï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯æ¯ä¸ªæ•°ç»„å…ƒç´ ä¼šè°ƒç”¨ toLocaleString() æ–¹æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯è°ƒç”¨å„è‡ªçš„ toString() æ–¹æ³•ã€‚å¯ä»¥åƒè¿™æ ·ä½¿ç”¨ point å¯¹è±¡åšåˆ°åŒæ ·çš„æ•ˆæœï¼š</p>

<pre><code class="language-javascript">let point = {
    x: 1000,
    y: 2000,
    toString: function() { return `(${this.x}, ${this.y})`; },
    toLocaleString: function() {
        return `(${this.x.toLocaleString()}, ${this.y.toLocaleString()})`;
    }
};
point.toString()        // =&gt; &quot;(1000, 2000)&quot;
point.toLocaleString()  // =&gt; &quot;(1,000, 2,000)&quot;: note thousands separators
</code></pre>

<p>åœ¨ Â§11.7 çš„å›½é™…åŒ–ç±»ä¸­ï¼ŒtoLocaleString() æ–¹æ³•çš„å®ç°æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>

<h3 id="toc_19">6.9.3 valueOf() æ–¹æ³•</h3>

<p>valueOf() æ–¹æ³•å’Œ toString() æ–¹æ³•éå¸¸ç±»ä¼¼ï¼Œä½†å¾€å¾€å½“ JavaScript éœ€è¦å°†å¯¹è±¡è½¬æ¢ä¸ºæŸç§åŸå§‹å€¼è€Œéå­—ç¬¦ä¸²çš„æ—¶å€™æ‰ä¼šè°ƒç”¨å®ƒï¼Œå°¤å…¶æ˜¯è½¬æ¢ä¸ºæ•°å­—çš„æ—¶å€™ã€‚å¦‚æœåœ¨éœ€è¦ä½¿ç”¨åŸå§‹å€¼çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨äº†å¯¹è±¡ï¼ŒJavaScript å°±ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚é»˜è®¤çš„ valueOf() æ–¹æ³•ä¸è¶³ä¸ºå¥‡ï¼Œä½†æœ‰äº›å†…ç½®ç±»è‡ªå®šä¹‰äº† valueOf() æ–¹æ³•. Date ç±»å®šä¹‰ valueOf() å°†æ—¥æœŸè½¬åŒ–æˆæ•°å€¼å‹ï¼Œå¹¶ä¸”è¿™å…è®¸ Date å¯¹è±¡ä½¿ç”¨ &lt; å’Œ &gt; æŒ‰æ—¶é—´å…ˆæ‰‹é¡ºåºæ¯”è¾ƒã€‚å¯ä»¥å¯¹ point å¯¹è±¡åšåŒæ ·çš„äº‹ï¼Œå®šä¹‰ä¸€ä¸ª valueOf() æ–¹æ³•è¿”å›åŸç‚¹åˆ°ç‚¹çš„è·ç¦»ï¼š</p>

<pre><code class="language-javascript">let point = {
    x: 3,
    y: 4,
    valueOf: function() { return Math.hypot(this.x, this.y); }
};
Number(point)  // =&gt; 5: valueOf() is used for conversions to numbers
point &gt; 4      // =&gt; true
point &gt; 5      // =&gt; false
point &lt; 6      // =&gt; true
</code></pre>

<h3 id="toc_20">6.9.4 toJSON() æ–¹æ³•</h3>

<p>Object.prototype å®é™…ä¸Šæ²¡æœ‰å®šä¹‰ toJSON() æ–¹æ³•ï¼Œä½†å¯¹äºéœ€è¦æ‰§è¡Œåºåˆ—åŒ–çš„å¯¹è±¡æ¥è¯´ï¼ŒJSON.stringify() æ–¹æ³•ï¼ˆè§ Â§6.8ï¼‰ä¼šè°ƒç”¨ toJSON() æ–¹æ³•ã€‚å¦‚æœåœ¨å¾…åºåˆ—åŒ–çš„å¯¹è±¡ä¸­å­˜åœ¨è¿™ ä¸ªæ–¹æ³•ï¼Œåˆ™è°ƒç”¨å®ƒï¼Œè¿”å›å€¼å³æ˜¯åºåˆ—åŒ–çš„ç»“æœï¼Œè€Œä¸æ˜¯åŸå§‹çš„å¯¹è±¡ã€‚Date ç±»ï¼ˆÂ§11.4ï¼‰å®šä¹‰äº† toJSON() æ–¹æ³•è¿”å›æ—¥æœŸçš„åºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å¯¹ point å¯¹è±¡åšåŒæ ·çš„äº‹ï¼š</p>

<pre><code class="language-javascript">let point = {
    x: 1,
    y: 2,
    toString: function() { return `(${this.x}, ${this.y})`; },
    toJSON: function() { return this.toString(); }
};
JSON.stringify([point])   // =&gt; &#39;[&quot;(1, 2)&quot;]&#39;
</code></pre>

<h2 id="toc_21">6.10 æ‰©å±•çš„å¯¹è±¡å­—é¢é‡è¯­æ³•</h2>

<p>JavaScript çš„æœ€æ–°ç‰ˆæœ¬æ‰©å±•äº†è®¸å¤šæœ‰ç”¨çš„å¯¹è±¡å­—é¢é‡ç›¸å…³çš„è¯­æ³•ã€‚ä»¥ä¸‹å°èŠ‚è§£é‡Šè¿™äº›æ‰©å±•ã€‚</p>

<h3 id="toc_22">6.10.1 é€Ÿè®°å±æ€§</h3>

<p>å‡è®¾å€¼å­˜å‚¨åœ¨å˜é‡ x å’Œ y ä¸­ï¼Œå¹¶ä¸”æƒ³è¦åˆ›å»ºå…·æœ‰åä¸º x å’Œ y çš„å±æ€§çš„å¯¹è±¡ï¼Œè¿™äº›å±æ€§åŒ…å«è¿™äº›å€¼ã€‚ä½¿ç”¨åŸºæœ¬å¯¹è±¡å­—é¢é‡è¯­æ³•ï¼Œæœ€ç»ˆä¼šé‡å¤æ¯ä¸ªæ ‡è¯†ç¬¦ä¸¤æ¬¡ï¼š</p>

<pre><code class="language-javascript">let x = 1, y = 2;
let o = {
    x: x,
    y: y
};
</code></pre>

<p>åœ¨ ES6 ä¹‹åï¼Œå¯ä»¥åˆ é™¤æ ‡è¯†ç¬¦çš„å†’å·å’Œä¸€ä¸ªå‰¯æœ¬ï¼Œæœ€ç»ˆä½¿ç”¨æ›´ç®€å•çš„ä»£ç ï¼š</p>

<pre><code class="language-javascript">let x = 1, y = 2;
let o = { x, y };
o.x + o.y  // =&gt; 3
</code></pre>

<h3 id="toc_23">6.10.2 è®¡ç®—å±æ€§å</h3>

<p>æœ‰æ—¶éœ€è¦åˆ›å»ºå…·æœ‰ç‰¹å®šå±æ€§çš„å¯¹è±¡ï¼Œä½†è¯¥å±æ€§çš„åç§°ä¸æ˜¯å¯ä»¥åœ¨æºä»£ç ä¸­é”®å…¥çš„ç¼–è¯‘æ—¶å¸¸é‡ã€‚ç›¸åï¼Œéœ€è¦çš„å±æ€§åç§°å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œæˆ–è€…æ˜¯è°ƒç”¨çš„å‡½æ•°çš„è¿”å›å€¼ã€‚ä¸èƒ½å¯¹æ­¤ç±»å±æ€§ä½¿ç”¨åŸºæœ¬å¯¹è±¡å­—é¢é‡ã€‚è€Œå¿…é¡»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡é¢å¤–çš„æ­¥éª¤ï¼Œæ·»åŠ æ‰€éœ€çš„å±æ€§ï¼š</p>

<pre><code class="language-javascript">const PROPERTY_NAME = &quot;p1&quot;;
function computePropertyName() { return &quot;p&quot; + 2; }

let o = {};
o[PROPERTY_NAME] = 1;
o[computePropertyName()] = 2;
</code></pre>

<p>ä½¿ç”¨ç§°ä¸ºè®¡ç®—å±æ€§çš„ ES6 ç‰¹æ€§è®¾ç½®è¿™æ ·çš„å¯¹è±¡è¦ç®€å•å¾—å¤šï¼Œè¯¥åŠŸèƒ½å…è®¸ä»å‰é¢çš„ä»£ç å†™å…¥æ–¹æ‹¬å†…å¹¶ç›´æ¥ç§»åŠ¨åˆ°å¯¹è±¡å­—é¢é‡ä¸­ï¼š</p>

<pre><code class="language-javascript">const PROPERTY_NAME = &quot;p1&quot;;
function computePropertyName() { return &quot;p&quot; + 2; }

let p = {
    [PROPERTY_NAME]: 1,
    [computePropertyName()]: 2
};

p.p1 + p.p2 // =&gt; 3
</code></pre>

<p>ä½¿ç”¨è¿™ç§æ–°è¯­æ³•ï¼Œæ–¹æ‹¬å·å°†å…¶åˆ†éš”æˆ JavaScript è¡¨è¾¾å¼ã€‚è®¡ç®—è¯¥è¡¨è¾¾å¼ï¼Œå¹¶å°†ç»“æœå€¼ï¼ˆå¦‚æœ‰å¿…è¦è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼‰ç”¨ä½œå±æ€§åç§°ã€‚</p>

<p>å¯èƒ½æƒ³è¦ä½¿ç”¨è®¡ç®—å±æ€§çš„ä¸€ä¸ªæƒ…å†µæ˜¯ï¼Œæœ‰ä¸€ä¸ª JavaScript ä»£ç åº“ï¼Œè¯¥åº“å¸Œæœ›ä¼ é€’å…·æœ‰ä¸€ç»„ç‰¹å®šå±æ€§çš„å¯¹è±¡ï¼Œå¹¶ä¸”è¿™äº›å±æ€§çš„åç§°å®šä¹‰ä¸ºè¯¥åº“ä¸­çš„å¸¸é‡ã€‚å¦‚æœè¦ç¼–å†™ä»£ç ä»¥åˆ›å»ºå°†ä¼ é€’ç»™è¯¥åº“çš„å¯¹è±¡ï¼Œå¯ä»¥ç¡¬ç¼–ç å±æ€§åç§°ï¼Œä½†å¦‚æœåœ¨ä»»ä½•åœ°æ–¹é”®å…¥é”™è¯¯çš„å±æ€§åç§°ï¼Œåˆ™å­˜åœ¨é”™è¯¯é£é™©ï¼›å¦‚æœåº“çš„æ–°ç‰ˆæœ¬æ›´æ”¹äº†æ‰€éœ€çš„å±æ€§åç§°ï¼Œåˆ™å­˜åœ¨ç‰ˆæœ¬ä¸åŒ¹é…é—®é¢˜çš„é£é™©ã€‚ç›¸åï¼Œå¯èƒ½ä¼šå‘ç°ï¼Œä½¿ç”¨è®¡ç®—å±æ€§è¯­æ³•ä¸åº“å®šä¹‰çš„å±æ€§åç§°å¸¸é‡æ—¶ï¼Œå®ƒä½¿ä»£ç æ›´åŠ å¥å£®ã€‚</p>

<h3 id="toc_24">6.10.3 Symbol ä½œå±æ€§å</h3>

<p>è®¡ç®—å±æ€§è¯­æ³•å¯ç”¨äº†å¦ä¸€ä¸ªéå¸¸é‡è¦çš„å¯¹è±¡å­—é¢é‡ç‰¹æ€§ã€‚åœ¨ ES6 ä¹‹åï¼Œå±æ€§åç§°å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ– Symbolã€‚å¦‚æœå°† Symbol åˆ†é…ç»™å˜é‡æˆ–å¸¸é‡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è®¡ç®—å±æ€§è¯­æ³•å°†è¯¥ Symbol ç”¨ä½œå±æ€§åç§°ï¼š</p>

<pre><code class="language-javascript">const extension = Symbol(&quot;my extension symbol&quot;);
let o = {
    [extension]: { /* extension data stored in this object */ }
};
o[extension].x = 0; // This won&#39;t conflict with other properties of o
</code></pre>

<p>å¦‚ Â§3.6 ä¸­æ‰€è¿°ï¼Œç¬¦å·æ˜¯ä¸é€æ˜å€¼ã€‚é™¤äº†å°†å®ƒä»¬ç”¨ä½œå±æ€§åç§°ï¼Œä¸èƒ½å¯¹å®ƒä»¬è¿›è¡Œä»»ä½•å…¶ä»–å¤„ç†ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ª Symbol éƒ½ä¸åŒäºæ‰€æœ‰å…¶ä»– Symbolï¼Œè¿™æ„å‘³ç€ Symbol é€‚åˆåˆ›å»ºå”¯ä¸€çš„å±æ€§åç§°ã€‚é€šè¿‡è°ƒç”¨ Symbol() å·¥å‚å‡½æ•°åˆ›å»ºæ–° Symbolã€‚ï¼ˆSymbol æ˜¯åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯å¯¹è±¡ï¼Œå› æ­¤ Symbol() ä¸æ˜¯ä½¿ç”¨ new è°ƒç”¨çš„æ„é€ å‡½æ•°ã€‚ï¼‰Symbol() è¿”å›çš„å€¼ä¸ç­‰äºä»»ä½•å…¶ä»– Symbol æˆ–å…¶ä»–å€¼ã€‚å¯ä»¥å°†å­—ç¬¦ä¸²ä¼ é€’ç»™ Symbol()ï¼Œå½“ Symbol è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œå°†ä½¿ç”¨æ­¤å­—ç¬¦ä¸²ã€‚ä½†æ˜¯ï¼Œè¿™åªæ˜¯ä¸€ä¸ªè°ƒè¯•å¸®åŠ©ï¼šä½¿ç”¨åŒä¸€å­—ç¬¦ä¸²å‚æ•°åˆ›å»ºçš„ä¸¤ä¸ª Symbol ä»ç„¶å½¼æ­¤ä¸åŒã€‚</p>

<p>Symbol çš„è¦ç‚¹ä¸æ˜¯å®‰å…¨æ€§ï¼Œè€Œæ˜¯ä¸º JavaScript å¯¹è±¡å®šä¹‰ä¸€ä¸ªå®‰å…¨çš„æ‰©å±•æœºåˆ¶ã€‚å¦‚æœä»ç¬¬ä¸‰æ–¹ä»£ç è·å–å¯¹è±¡ï¼Œæ‚¨æ— æ³•æ§åˆ¶è¯¥å¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦å‘è¯¥å¯¹è±¡æ·»åŠ è‡ªå·±çš„ä¸€äº›å±æ€§ï¼Œä½†å¸Œæœ›ç¡®ä¿å±æ€§ä¸ä¼šä¸å¯¹è±¡ä¸Šå¯èƒ½å­˜åœ¨çš„ä»»ä½•å±æ€§å†²çªï¼Œå¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ Symbol ä½œä¸ºå±æ€§åç§°ã€‚å¦‚æœè¿™æ ·åšï¼Œè¿˜å¯ä»¥ç¡®ä¿¡ç¬¬ä¸‰æ–¹ä»£ç ä¸ä¼šæ„å¤–æ›´æ”¹ Symbol å‘½åçš„å±æ€§ã€‚ï¼ˆå½“ç„¶ï¼Œè¯¥ç¬¬ä¸‰æ–¹ä»£ç å¯ä»¥ä½¿ç”¨ Object.getOwnPropertySymbols() æ¥å‘ç°ä½ ä½¿ç”¨çš„ Symbolï¼Œç„¶åå¯ä»¥æ›´æ”¹æˆ–åˆ é™¤ä½ çš„å±æ€§ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç¬¦å·ä¸æ˜¯å®‰å…¨æœºåˆ¶ã€‚ï¼‰</p>

<h3 id="toc_25">6.10.4 å±•å¼€è¿ç®—ç¬¦</h3>

<p>åœ¨ ES2018 ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ ... å°†ç°æœ‰çš„å¯¹è±¡ä¸­çš„å±æ€§å¤åˆ¶åˆ°æ–°çš„å¯¹è±¡ä¸­ï¼š</p>

<pre><code class="language-javascript">let position = { x: 0, y: 0 };
let dimensions = { width: 100, height: 75 };
let rect = { ...position, ...dimensions };
rect.x + rect.y + rect.width + rect.height // =&gt; 175
</code></pre>

<p>åœ¨æ­¤ä»£ç ä¸­ï¼Œposition å’Œ dimensions å¯¹è±¡çš„å±æ€§è¢«å±•å¼€åˆ° rect å¯¹è±¡å­—é¢é‡ä¸­ï¼Œå°±åƒå®ƒä»¬ä»¥å­—é¢é‡çš„æ–¹å¼å†™å…¥è¿™äº›å¤§æ‹¬å·ä¸­ä¸€æ ·ã€‚è¯·æ³¨æ„ï¼Œ... è¯­æ³•é€šå¸¸ç§°ä¸ºå±•å¼€è¿ç®—ç¬¦ï¼Œä½†åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸æ˜¯çœŸæ­£çš„ JavaScript è¿ç®—ç¬¦ã€‚ç›¸åï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µä¸‹è¯­æ³•ï¼Œä»…åœ¨å¯¹è±¡æ–‡æœ¬ä¸­å¯ç”¨ã€‚ï¼ˆ... åœ¨åˆ«çš„ JavaScript ä¸Šä¸‹æ–‡ä¸­æœ‰å…¶ä»–ç”¨é€”ï¼Œä½†æ˜¯å¯¹è±¡å­—é¢é‡ä¸Šä¸‹æ–‡ä¸­åªæœ‰è¿™ä¸€ç§ç”¨æ³•ã€‚ï¼‰</p>

<p>å¦‚æœå±•å¼€çš„ç›®æ ‡å¯¹è±¡å’Œæºå¯¹è±¡ä¸­å…·æœ‰ç›¸åŒçš„åç§°ï¼Œåˆ™è¯¥å±æ€§çš„å€¼å°†æ˜¯ä½ç½®å¤„äºåé¢çš„å€¼ï¼š</p>

<pre><code class="language-javascript">let o = { x: 1 };
let p = { x: 0, ...o };
p.x   // =&gt; 1: the value from object o overrides the initial value
let q = { ...o, x: 2 };
q.x   // =&gt; 2: the value 2 overrides the previous value from o.
</code></pre>

<p>è¿˜æœ‰æ³¨æ„å±•å¼€è¿ç®—ç¬¦åªå±•å¼€å¯¹è±¡çš„è‡ªæœ‰å±æ€§ï¼Œä¸å±•å¼€ç»§æ‰¿å±æ€§ï¼š</p>

<pre><code class="language-javascript">let o = Object.create({x: 1}); // o inherits the property x
let p = { ...o };
p.x                            // =&gt; undefined
</code></pre>

<p>æœ€åï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶å±•å¼€è¿ç®—ç¬¦åœ¨ä»£ç ä¸­åªæ˜¯ä¸‰ä¸ªå°ç‚¹ï¼Œä½†å®ƒå¯¹ JavaScript è§£é‡Šå™¨æ¥è¯´å¯ä»¥ä»£è¡¨å¤§é‡çš„å·¥ä½œã€‚å¦‚æœå¯¹è±¡å…·æœ‰ n ä¸ªå±æ€§ï¼Œåˆ™å°†è¿™äº›å±æ€§åˆ†æ•£åˆ°å¦ä¸€ä¸ªå¯¹è±¡çš„è¿‡ç¨‹å¾ˆå¯èƒ½æ˜¯ O(n) æ“ä½œã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ å‘ç°è‡ªå·±åœ¨ä½¿ç”¨ ... åœ¨å¾ªç¯æˆ–é€’å½’å‡½æ•°ä¸­ï¼Œç±»ä¼¼å°†æ•°æ®ç´¯ç§¯åˆ°ä¸€ä¸ªå¤§å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œæ‚¨å¯èƒ½æ­£åœ¨ç¼–å†™ä¸€ä¸ªä½æ•ˆçš„ O(n2) ç®—æ³•ï¼Œè¯¥ç®—æ³•ä¸ä¼šéšç€ n å˜å¤§è€Œæ‰©å±•ã€‚</p>

<h3 id="toc_26">6.10.5 é€Ÿè®°æ–¹æ³•</h3>

<p>å½“å‡½æ•°è¢«å®šä¹‰ä¸ºå¯¹è±¡çš„å±æ€§æ—¶ï¼Œæˆ‘ä»¬ç§°è¯¥å‡½æ•°ä¸ºæ–¹æ³•ï¼ˆæˆ‘ä»¬å°†åœ¨ç¬¬ 8 ç« å’Œç¬¬ 9 ç« ä¸­å¯¹æ–¹æ³•æœ‰æ›´å¤šçš„æè¿°ï¼‰ã€‚åœ¨ ES6 ä¹‹å‰ï¼Œåœ¨å¯¹è±¡å­—é¢é‡ä¸­ç”¨å‡½æ•°å®šä¹‰è¡¨è¾¾å¼å®šä¹‰ä¸€ä¸ªæ–¹æ³•å’Œåœ¨å¯¹è±¡ä¸­å®šä¹‰å…¶ä»–å±æ€§ä¸€æ ·ï¼š</p>

<pre><code class="language-javascript">let square = {
    area: function() { return this.side * this.side; },
    side: 10
};
square.area() // =&gt; 100
</code></pre>

<p>ä½†æ˜¯ï¼Œåœ¨ ES6 ä¸­ï¼Œå¯¹è±¡å­—é¢é‡è¯­æ³•ï¼ˆä»¥åŠæˆ‘ä»¬å°†åœ¨ç¬¬ 9 ç« ä¸­çœ‹åˆ°çš„ç±»å®šä¹‰è¯­æ³•ï¼‰å·²æ‰©å±•æˆå…è®¸çœç•¥å‡½æ•°å…³é”®å­—å’Œå†’å·çš„å¿«æ·æ–¹å¼ï¼Œå¯ä»¥å†™æˆè¿™æ ·çš„ä»£ç ï¼š</p>

<pre><code class="language-javascript">let square = {
    area() { return this.side * this.side; },
    side: 10
};
square.area() // =&gt; 100
</code></pre>

<p>ä¸¤ç§å½¢å¼æ˜¯ç›¸åŒçš„ï¼šåœ¨å¯¹è±¡å­—é¢é‡ä¸­æ·»åŠ ä¸€ä¸ªåä¸º area çš„å±æ€§ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªå‡½æ•°ä¸ºè¿™ä¸ªå±æ€§çš„å€¼ã€‚é€Ÿè®°è¯­æ³•æ›´æ¸…æ™°çš„çœ‹å‡º area() æ˜¯ä¸€ä¸ªæ–¹æ³•è€Œä¸æ˜¯ä¸€ä¸ªåƒ side ä¸€æ ·çš„æ•°æ®å±æ€§ã€‚</p>

<p>ä½¿ç”¨æ­¤é€Ÿè®°è¯­æ³•ç¼–å†™æ–¹æ³•æ—¶ï¼Œå±æ€§åç§°å¯ä»¥é‡‡ç”¨å¯¹è±¡å­—é¢é‡ä¸­çš„ä»»ä½•åˆæ³•å½¢å¼ï¼šé™¤äº†åƒä¸Šé¢çš„åç§° area è¿™æ ·çš„å¸¸è§„ JavaScript æ ‡è¯†ç¬¦å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²å­—é¢é‡å’Œè®¡ç®—å±æ€§åç§°ï¼ŒåŒ…æ‹¬ Symbol å±æ€§åç§°ï¼š</p>

<pre><code class="language-javascript">const METHOD_NAME = &quot;m&quot;;
const symbol = Symbol();
let weirdMethods = {
    &quot;method With Spaces&quot;(x) { return x + 1; },
    [METHOD_NAME](x) { return x + 2; },
    [symbol](x) { return x + 3; }
};
weirdMethods[&quot;method With Spaces&quot;](1)  // =&gt; 2
weirdMethods[METHOD_NAME](1)           // =&gt; 3
weirdMethods[symbol](1)                // =&gt; 4
</code></pre>

<p>ä½¿ç”¨ Symbol ä½œä¸ºæ–¹æ³•åç§°å¹¶ä¸åƒçœ‹èµ·æ¥é‚£ä¹ˆå¥‡æ€ªã€‚ä¸ºäº†ä½¿å¯¹è±¡å¯è¿­ä»£ï¼ˆå› æ­¤å®ƒå¯ä»¥ä¸ for/of å¾ªç¯ä¸€èµ·ä½¿ç”¨ï¼‰ï¼Œå¿…é¡»å®šä¹‰ä¸€ä¸ªå…·æœ‰ç¬¦å·åç§° Symbol.iterator çš„æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨ç¬¬ 12 ç« ä¸­æœ‰è¿™æ ·åšçš„ç¤ºä¾‹ã€‚</p>

<h3 id="toc_27">6.10.6 å±æ€§ Getter å’Œ Setter æ–¹æ³•</h3>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ¬èŠ‚æˆ‘ä»¬æ‰€è®¨è®ºçš„æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯å…·æœ‰åç§°å’Œæ™®é€šå€¼çš„æ•°æ®å±æ€§ã€‚JavaScript è¿˜æ”¯æŒå­˜å–å™¨å±æ€§ï¼Œè¿™äº›å±æ€§æ²¡æœ‰å•ä¸ªå€¼ï¼Œè€Œæ˜¯å…·æœ‰ä¸€ä¸ªæˆ–ä¸¤ä¸ªå­˜å–å™¨æ–¹æ³•ï¼šgetter å’Œæˆ–æ˜¯æˆ– setterã€‚</p>

<p>å½“ç¨‹åºæŸ¥è¯¢å­˜å–å™¨å±æ€§çš„å€¼æ—¶ï¼ŒJavaScript è°ƒç”¨ getter æ–¹æ³•ï¼ˆæ— å®å‚ï¼‰ã€‚è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯å±æ€§å­˜å–è¡¨è¾¾å¼çš„å€¼ã€‚å½“ç¨‹åºè®¾ç½®ä¸€ä¸ªå­˜å–å™¨å±æ€§çš„å€¼æ—¶ï¼Œ JavaScript è°ƒç”¨ setter æ–¹æ³•ï¼Œå°†èµ‹å€¼è¡¨è¾¾å¼å³ä¾§çš„å€¼å½“åšå‚æ•°ä¼ å…¥ setterã€‚ä»æŸç§æ„ä¹‰ä¸Šè®²ï¼Œè¿™ä¸ªæ–¹æ³•è´Ÿè´£â€œè®¾ç½®â€å±æ€§å€¼ã€‚å¯ä»¥å¿½ç•¥ setter æ–¹æ³•çš„è¿”å›å€¼ã€‚</p>

<p>å¦‚æœå±æ€§åŒæ—¶æœ‰ getter å’Œ setter æ–¹æ³•ï¼Œåˆ™å®ƒæ˜¯ä¸€ä¸ªå¯è¯»å†™å±æ€§ã€‚å¦‚æœå®ƒåªå«æœ‰ getter æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸€ä¸ªåªè¯»å±æ€§ã€‚å¦‚æœå®ƒåªæœ‰ setter æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸€ä¸ªåªå¯å†™å±æ€§ï¼ˆè¿™å¯¹ä¸€ä¸ªæ•°æ®å±æ€§æ¥è¯´æ˜¯ä¸å¯èƒ½çš„ï¼‰ï¼Œå¦‚æœå°è¯•å»è¯»å®ƒï¼Œè®¡ç®—ç»“æœæ°¸è¿œæ˜¯ undefinedã€‚</p>

<p>å­˜å‚¨å™¨å±æ€§å¯ä»¥é€šè¿‡è¡¨è¾¾å¼åœ¨å¯¹è±¡å­—é¢é‡è¯­æ³•ä¸­å®šä¹‰ï¼ˆä¸åƒæˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„å…¶ä»– ES6 æ‰©å±•ï¼Œgetter å’Œ setter æ˜¯ ES5 ä¸­çš„å†…å®¹ï¼‰ï¼š</p>

<pre><code class="language-javascript">let o = {
    // An ordinary data property
    dataProp: value,

    // An accessor property defined as a pair of functions.
    get accessorProp() { return this.dataProp; },
    set accessorProp(value) { this.dataProp = value; }
};
</code></pre>

<p>å­˜å‚¨å™¨å±æ€§å®šä¹‰ä¸ºåç§°ä¸å±æ€§åç§°ç›¸åŒçš„ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ–¹æ³•ã€‚è¿™äº›æ–¹æ³•çœ‹èµ·æ¥åƒä½¿ç”¨ ES6 é€Ÿè®°å®šä¹‰çš„æ™®é€šæ–¹æ³•ï¼Œåªä¸è¿‡ getter å’Œ setter å®šä¹‰ä½¿ç”¨ get æˆ– set å‰ç¼€ã€‚ï¼ˆåœ¨ ES6 ä¸­ï¼Œåœ¨å®šä¹‰ getter å’Œ setter æ—¶è¿˜å¯ä»¥ä½¿ç”¨è®¡ç®—å±æ€§åç§°ã€‚åªéœ€å°†å¸¦æ–¹æ‹¬å·çš„è¡¨è¾¾å¼æ›¿æ¢å±æ€§åç§°å³å¯ã€‚</p>

<p>ä¸Šé¢å®šä¹‰çš„å­˜å‚¨å™¨æ–¹æ³•åªéœ€è·å–å¹¶è®¾ç½®æ•°æ®å±æ€§çš„å€¼ï¼Œæ²¡æœ‰ç†ç”±å°†å­˜å‚¨å™¨å±æ€§æ›¿æ¢æ•°æ®å±æ€§ã€‚ä½†ä½œä¸ºä¸€ä¸ªæ›´æœ‰è¶£çš„ç¤ºä¾‹ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹è¡¨ç¤º 2D ç¬›å¡å°”ç‚¹çš„å¯¹è±¡ã€‚å®ƒå…·æœ‰è¡¨ç¤ºç‚¹çš„ x å’Œ y åæ ‡çš„æ™®é€šæ•°æ®å±æ€§ï¼Œå¹¶ä¸”å…·æœ‰æä¾›ç‚¹ç­‰æ•ˆæåæ ‡çš„å­˜å‚¨å™¨å±æ€§ï¼š</p>

<pre><code class="language-javascript">let p = {
    // x and y are regular read-write data properties.
    x: 1.0,
    y: 1.0,

    // r is a read-write accessor property with getter and setter.
    // Don&#39;t forget to put a comma after accessor methods.
    get r() { return Math.hypot(this.x, this.y); },
    set r(newvalue) {
        let oldvalue = Math.hypot(this.x, this.y);
        let ratio = newvalue/oldvalue;
        this.x *= ratio;
        this.y *= ratio;
    },

    // theta is a read-only accessor property with getter only.
    get theta() { return Math.atan2(this.y, this.x); }
};
p.r     // =&gt; Math.SQRT2
p.theta // =&gt; Math.PI / 4
</code></pre>

<p>è¯·æ³¨æ„ï¼Œåœ¨æœ¬ç¤ºä¾‹ä¸­çš„ getter å’Œ setter ä¸­ä½¿ç”¨ this å…³é”®å­—ã€‚JavaScript ä»¥å¯¹è±¡çš„æ–¹æ³•çš„æ–¹å¼è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°ä½“ä¸­ï¼Œthis æŒ‡çš„æ˜¯ç‚¹å¯¹è±¡ pã€‚å› æ­¤ï¼Œr å±æ€§çš„ getter æ–¹æ³•é€šè¿‡ this.x å’Œ this.y è·å–åˆ° x å’Œ y å±æ€§çš„å¼•ç”¨ã€‚æ–¹æ³•ä»¥åŠ this å…³é”®å­—åœ¨ Â§8.2.2 ä¸­è¯¦ç»†ä»‹ç»ã€‚</p>

<p>å­˜å‚¨å™¨å±æ€§æ˜¯å¯ç»§æ‰¿çš„ï¼Œå°±åƒæ•°æ®å±æ€§ä¸€æ ·ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„å¯¹è±¡ p ä½œä¸ºå…¶ä»–ç‚¹çš„åŸå‹ã€‚å¯ä»¥ä¸ºæ–°å¯¹è±¡æä¾›è‡ªæœ‰çš„ x å’Œ y å±æ€§ï¼Œå®ƒä»¬å°†ç»§æ‰¿ r å’Œ theta å±æ€§ï¼š</p>

<pre><code class="language-javascript">let q = Object.create(p); // A new object that inherits getters and setters
q.x = 3; q.y = 4;         // Create q&#39;s own data properties
q.r                       // =&gt; 5: the inherited accessor properties work
q.theta                   // =&gt; Math.atan2(4, 3)
</code></pre>

<p>ä¸Šè¿°ä»£ç ä½¿ç”¨å­˜å‚¨å™¨å±æ€§å®šä¹‰ä¸€ä¸ª APIï¼Œè¯¥ API æä¾›ä¸€ç»„æ•°æ®çš„ä¸¤ç§è¡¨ç¤ºå½¢å¼ï¼ˆç¬›å¡å°”åæ ‡å’Œæåæ ‡ï¼‰ã€‚ä½¿ç”¨å­˜å‚¨å™¨å±æ€§çš„å…¶ä»–åœºæ™¯åŒ…æ‹¬å±æ€§å†™å…¥çš„ç¨³å¥æ€§æ£€æµ‹ä»¥åŠåœ¨æ¯ä¸ªå±æ€§ä¸Šè¿”å›ä¸åŒçš„å€¼ï¼š</p>

<pre><code class="language-javascript">// This object generates strictly increasing serial numbers
const serialnum = {
    // This data property holds the next serial number.
    // The _ in the property name hints that it is for internal use only.
    _n: 0,

    // Return the current value and increment it
    get next() { return this._n++; },

    // Set a new value of n, but only if it is larger than current
    set next(n) {
        if (n &gt; this._n) this._n = n;
        else throw new Error(&quot;serial number can only be set to a larger value&quot;);
    }
};
serialnum.next = 10;    // Set the starting serial number
serialnum.next          // =&gt; 10
serialnum.next          // =&gt; 11: different value each time we get next
</code></pre>

<p>æœ€åï¼Œä¸‹é¢æ˜¯ä½¿ç”¨ getter æ–¹æ³•å®ç°å…·æœ‰&quot;é­”å¹»&quot;è¡Œä¸ºçš„å±æ€§çš„ç¤ºä¾‹ï¼š</p>

<pre><code class="language-javascript">// This object has accessor properties that return random numbers.
// The expression &quot;random.octet&quot;, for example, yields a random number
// between 0 and 255 each time it is evaluated.
const random = {
    get octet() { return Math.floor(Math.random()*256); },
    get uint16() { return Math.floor(Math.random()*65536); },
    get int16() { return Math.floor(Math.random()*65536)-32768; }
};
</code></pre>

<h2 id="toc_28">6.11 æ€»ç»“</h2>

<p>æœ¬ç« éå¸¸è¯¦ç»†åœ°è®°å½•äº† JavaScript å¯¹è±¡ï¼Œæ¶µç›–çš„ä¸»é¢˜åŒ…æ‹¬ï¼š</p>

<ul>
<li>åŸºæœ¬å¯¹è±¡æœ¯è¯­ï¼ŒåŒ…æ‹¬å¯æšä¸¾å’Œè‡ªæœ‰å±æ€§ç­‰æœ¯è¯­çš„å«ä¹‰ã€‚</li>
<li>å¯¹è±¡å­—é¢é‡è¯­æ³•ï¼ŒåŒ…æ‹¬ ES6 åŠä»¥åçš„è®¸å¤šæ–°ç‰¹æ€§ã€‚</li>
<li>å¦‚ä½•è¯»å–ã€å†™å…¥ã€åˆ é™¤ã€æšä¸¾å’Œæ£€æŸ¥å¯¹è±¡å±æ€§æ˜¯å¦å­˜åœ¨ã€‚</li>
<li>åŸºäºåŸå‹çš„ç»§æ‰¿æ˜¯å¦‚ä½•åœ¨ JavaScript ä¸­å·¥ä½œï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ Object.create() åˆ›å»ºä¸€ä¸ªä»å¦ä¸€ä¸ªå¯¹è±¡ç»§æ‰¿çš„å¯¹è±¡ã€‚</li>
<li>å¦‚ä½•ä½¿ç”¨ Object.assign() å°†å±æ€§ä»ä¸€ä¸ªå¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚</li>
<li>æ‰€æœ‰ JavaScript çš„éåŸå§‹å€¼éƒ½æ˜¯å¯¹è±¡ã€‚è¿™åŒ…æ‹¬æ•°ç»„å’Œå‡½æ•°ï¼Œè¿™æ˜¯æ¥ä¸‹æ¥ä¸¤ç« çš„ä¸»é¢˜ã€‚</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¬¬ 7 ç«  æ•°ç»„]]></title>
    <link href="2019919.xyz/16124375850406.html"/>
    <updated>2021-02-04T19:19:45+08:00</updated>
    <id>2019919.xyz/16124375850406.html</id>
    <content type="html"><![CDATA[
<ul>
<li>
<a href="#toc_0">7.1 åˆ›å»ºæ•°ç»„</a>
<ul>
<li>
<a href="#toc_1">7.1.1 æ•°ç»„å­—é¢é‡</a>
</li>
<li>
<a href="#toc_2">7.1.2 å±•å¼€è¿ç®—ç¬¦</a>
</li>
<li>
<a href="#toc_3">7.1.3 Array() æ„é€ å‡½æ•°</a>
</li>
<li>
<a href="#toc_4">7.1.4 Array.of()</a>
</li>
<li>
<a href="#toc_5">7.1.5 Array.from()</a>
</li>
</ul>
</li>
<li>
<a href="#toc_6">7.2 æ•°ç»„å…ƒç´ çš„è¯»å’Œå†™</a>
</li>
<li>
<a href="#toc_7">7.3 ç¨€ç–æ•°ç»„ï¼ˆSparse Arraysï¼‰</a>
</li>
<li>
<a href="#toc_8">7.4 æ•°ç»„é•¿åº¦</a>
</li>
<li>
<a href="#toc_9">7.5 æ•°ç»„å…ƒç´ æ·»åŠ å’Œåˆ é™¤</a>
</li>
<li>
<a href="#toc_10">7.6 æ•°ç»„éå†</a>
</li>
<li>
<a href="#toc_11">7.7 å¤šç»´æ•°ç»„</a>
</li>
<li>
<a href="#toc_12">7.8 æ•°ç»„æ–¹æ³•</a>
<ul>
<li>
<a href="#toc_13">7.8.1 æ•°ç»„è¿­ä»£å™¨æ–¹æ³•</a>
<ul>
<li>
<a href="#toc_14">FOREACH()</a>
</li>
<li>
<a href="#toc_15">MAP()</a>
</li>
<li>
<a href="#toc_16">FILTER()</a>
</li>
<li>
<a href="#toc_17">FIND() å’Œ FINDINDEX()</a>
</li>
<li>
<a href="#toc_18">EVERY() å’Œ SOME()</a>
</li>
<li>
<a href="#toc_19">REDUCE() å’Œ REDUCERIGHT()</a>
</li>
</ul>
</li>
<li>
<a href="#toc_20">7.8.2 ç”¨ flat() å’Œ flatMap() å±•å¹³æ•°ç»„</a>
</li>
<li>
<a href="#toc_21">7.8.3 ç”¨ concat() æ·»åŠ æ•°ç»„</a>
</li>
<li>
<a href="#toc_22">7.8.4  push()ã€pop()ã€shift() å’Œ unshift() ä¸å †æ ˆå’Œé˜Ÿåˆ—</a>
</li>
<li>
<a href="#toc_23">7.8.5 slice()ã€splice()ã€fill() å’Œ copyWithin() ä¸å­æ•°ç»„</a>
<ul>
<li>
<a href="#toc_24">SLICE()</a>
</li>
<li>
<a href="#toc_25">SPLICE()</a>
</li>
<li>
<a href="#toc_26">FILL()</a>
</li>
<li>
<a href="#toc_27">COPYWITHIN()</a>
</li>
</ul>
</li>
<li>
<a href="#toc_28">7.8.6 æ•°ç»„çš„æŸ¥è¯¢å’Œæ’åºæ–¹æ³•</a>
<ul>
<li>
<a href="#toc_29">INDEXOF() å’Œ LASTINDEXOF()</a>
</li>
<li>
<a href="#toc_30">INCLUDES()</a>
</li>
<li>
<a href="#toc_31">SORT()</a>
</li>
<li>
<a href="#toc_32">REVERSE()</a>
</li>
</ul>
</li>
<li>
<a href="#toc_33">7.8.7 æ•°ç»„è½¬åŒ–å­—ç¬¦ä¸²</a>
</li>
<li>
<a href="#toc_34">7.8.8 Array çš„é™æ€æ–¹æ³•</a>
</li>
</ul>
</li>
<li>
<a href="#toc_35">7.9 ç±»æ•°ç»„å¯¹è±¡</a>
</li>
<li>
<a href="#toc_36">7.10 ä½œä¸ºæ•°ç»„çš„å­—ç¬¦ä¸²</a>
</li>
<li>
<a href="#toc_37">7.11 æ€»ç»“</a>
</li>
</ul>


<p>æœ¬ç« è®°å½•äº†æ•°ç»„ã€ä¸€ä¸ªåœ¨ JavaScript å’Œå¤§å¤šæ•°å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹ã€‚æ•°ç»„æ˜¯å€¼çš„æœ‰åºé›†åˆã€‚æ¯ä¸ªå€¼å«åšä¸€ä¸ªå…ƒç´ ï¼Œè€Œæ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­æœ‰ä¸€ä¸ªä½ç½®ï¼Œä»¥æ•°å­—è¡¨ç¤ºï¼Œç§°ä¸ºç´¢å¼•ã€‚JavaScript æ•°ç»„æ˜¯æ— ç±»å‹çš„ï¼šæ•°ç»„å…ƒç´ å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œå¹¶ä¸”åŒä¸€ä¸ªæ•°ç»„ä¸­çš„ä¸åŒå…ƒç´ ä¹Ÿå¯èƒ½æœ‰ä¸åŒçš„ç±»å‹ã€‚æ•°ç»„çš„å…ƒç´ ç”šè‡³ä¹Ÿå¯èƒ½æ˜¯å¯¹è±¡æˆ–å…¶ä»–æ•°ç»„ï¼Œè¿™å…è®¸åˆ›å»ºå¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¦‚å¯¹è±¡çš„æ•°ç»„å’Œæ•°ç»„çš„æ•°ç»„ã€‚JavaScript æ•°ç»„çš„ç´¢å¼•æ˜¯åŸºäºé›¶çš„ 32 ä½æ•°å€¼ï¼šç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ä¸º 0ï¼Œæœ€å¤§å¯èƒ½çš„ç´¢å¼•ä¸º 4,294,967,294ï¼ˆ2<sup>32</sup>-2ï¼‰ï¼Œæ•°ç»„æœ€å¤§èƒ½å®¹çº³ 4,294,967,295 ä¸ªå…ƒç´ ã€‚JavaScript æ•°ç»„æ˜¯åŠ¨æ€çš„ï¼šæ ¹æ®éœ€è¦å®ƒä»¬ä¼šå¢é•¿æˆ–ç¼©å‡ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºæ•°ç»„æ—¶æ— é¡»å£°æ˜ä¸€ä¸ªå›ºå®šçš„å¤§å°æˆ–è€…åœ¨æ•°ç»„å¤§å°å˜åŒ–æ—¶æ— é¡»é‡æ–°åˆ†é…ç©ºé—´ã€‚JavaScript æ•°ç»„å¯èƒ½æ˜¯ç¨€ç–çš„ï¼šæ•°ç»„å…ƒç´ çš„ç´¢å¼•ä¸ä¸€å®šè¦è¿ç»­çš„ï¼Œå®ƒä»¬ä¹‹é—´å¯ä»¥æœ‰ç©ºç¼ºã€‚æ¯ä¸ª JavaScript æ•°ç»„éƒ½æœ‰ä¸€ä¸ª length å±æ€§ã€‚é’ˆå¯¹éç¨€ç–æ•°ç»„ï¼Œè¯¥å±æ€§å°±æ˜¯æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ã€‚é’ˆå¯¹ç¨€ç–æ•°ç»„ï¼Œlength å¤§äºä»»ä½•å…ƒç´ çš„æœ€é«˜ç´¢å¼•ã€‚</p>

<p>JavaScript æ•°ç»„æ˜¯ JavaScript å¯¹è±¡çš„ç‰¹æ®Šå½¢å¼ï¼Œæ•°ç»„ç´¢å¼•å®é™…ä¸Šå’Œç¢°å·§æ˜¯æ•´æ•°çš„å±æ€§åå·®ä¸å¤šã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç« çš„å…¶ä»–åœ°æ–¹æ›´å¤šåœ°è®¨è®ºç‰¹æ®ŠåŒ–çš„æ•°ç»„ã€‚é€šå¸¸ï¼Œæ•°ç»„çš„å®ç°æ˜¯ç»è¿‡ä¼˜åŒ–çš„ï¼Œç”¨æ•°å­—ç´¢å¼•æ¥è®¿é—®æ•°ç»„å…ƒç´ ä¸€èˆ¬æ¥è¯´æ¯”è®¿é—®å¸¸è§„çš„å¯¹è±¡å±æ€§è¦å¿«å¾ˆå¤šã€‚</p>

<p>æ•°ç»„ç»§æ‰¿è‡ª Array.prototype ä¸­çš„å±æ€§ï¼Œå®ƒå®šä¹‰äº†ä¸€å¥—ä¸°å¯Œçš„æ•°ç»„æ“ä½œæ–¹æ³•ï¼ŒÂ§7.8 æ¶µç›–è¿™æ–¹é¢å†…å®¹ã€‚å¤§å¤šæ•°è¿™äº›æ–¹æ³•æ˜¯é€šç”¨çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä¸ä»…å¯¹çœŸæ­£çš„æ•°ç»„æœ‰æ•ˆï¼Œè€Œä¸”å¯¹â€œç±»æ•°ç»„å¯¹è±¡â€åŒæ ·æœ‰æ•ˆã€‚Â§7.9 è®¨è®ºç±»æ•°ç»„å¯¹è±¡ã€‚æœ€åï¼ŒJavaScript å­—ç¬¦ä¸²çš„è¡Œä¸ºä¸å­—ç¬¦æ•°ç»„ç±»ä¼¼ï¼Œæˆ‘ä»¬å°†åœ¨ Â§7.10 è®¨è®ºã€‚</p>

<p>ES6 å¼•å…¥äº†ä¸€ç»„æ–°çš„æ•°ç»„ç±»ï¼Œè¿™äº›ç±»ç»Ÿç§°ä¸ºâ€œç±»å‹åŒ–æ•°ç»„â€ã€‚ä¸å¸¸è§„çš„ JavaScript æ•°ç»„ä¸åŒï¼Œç±»å‹åŒ–æ•°ç»„æœ‰å›ºå®šçš„é•¿åº¦å’Œå›ºå®šçš„æ•°å€¼å…ƒç´ ç±»å‹ã€‚å®ƒä»¬æä¾›é«˜æ€§èƒ½å’Œå¯¹äºŒè¿›åˆ¶æ•°æ®çš„å­—èŠ‚çº§è®¿é—®ï¼Œåœ¨ Â§11.2 ä¸­æœ‰ä»‹ç»ã€‚</p>

<h2 id="toc_0">7.1 åˆ›å»ºæ•°ç»„</h2>

<p>æœ‰å¾ˆå¤šç§åˆ›å»ºæ•°ç»„çš„æ–¹æ³•ã€‚ä»¥ä¸‹å°èŠ‚å°†è¯´æ˜å¦‚ä½•ä½¿ç”¨ä»¥ä¸‹æ–¹å¼åˆ›å»ºæ•°ç»„ï¼š</p>

<ul>
<li>æ•°ç»„å­—é¢é‡</li>
<li>å¯è¿­ä»£æ•°ç»„ ... å±•å¼€è¿ç®—ç¬¦</li>
<li>Array() æ„é€ å‡½æ•°</li>
<li>Array.of() å’Œ Array.from() å·¥å‚æ–¹æ³•</li>
</ul>

<h3 id="toc_1">7.1.1 æ•°ç»„å­—é¢é‡</h3>

<p>åˆ°ç›®å‰ä¸ºæ­¢ä½¿ç”¨æ•°ç»„å­—é¢é‡æ˜¯åˆ›å»ºæ•°ç»„æœ€ç®€å•çš„æ–¹æ³•ï¼Œåœ¨æ–¹æ‹¬å·ä¸­å°†æ•°ç»„å…ƒç´ ç”¨é€—å·éš”å¼€å³å¯ã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">let empty = [];                 // An array with no elements
let primes = [2, 3, 5, 7, 11];  // An array with 5 numeric elements
let misc = [ 1.1, true, &quot;a&quot;, ]; // 3 elements of various types + trailing comma
</code></pre>

<p>æ•°ç»„å­—é¢é‡ä¸­çš„å€¼ä¸ä¸€å®šè¦æ˜¯å¸¸é‡ï¼›å®ƒä»¬å¯ä»¥æ˜¯ä»»æ„çš„è¡¨è¾¾å¼ï¼š</p>

<pre><code class="language-javascript">let base = 1024;
let table = [base, base+1, base+2, base+3];
</code></pre>

<p>æ•°ç»„å­—é¢é‡å¯ä»¥åŒ…å«å¯¹è±¡å­—é¢é‡æˆ–å…¶ä»–æ•°ç»„å­—é¢é‡ï¼š</p>

<pre><code class="language-javascript">let b = [[1, {x: 1, y: 2}], [2, {x: 3, y: 4}]];
</code></pre>

<p>å¦‚æœæ•°ç»„å­—é¢é‡åœ¨ä¸€è¡Œä¸­åŒ…å«å¤šä¸ªé€—å·ï¼Œä¹‹é—´æ²¡æœ‰å€¼ï¼Œåˆ™æ•°ç»„æ˜¯ç¨€ç–çš„ï¼ˆè¯·å‚é˜… Â§7.3ï¼‰ã€‚çœç•¥å€¼çš„æ•°ç»„å…ƒç´ ä¸å­˜åœ¨ï¼Œä½†å¦‚æœæŸ¥è¯¢å®ƒä»¬åˆ™è¿”å› undefinedï¼š</p>

<pre><code class="language-javascript">let count = [1,,3]; // Elements at indexes 0 and 2. No element at index 1
let undefs = [,,];  // An array with no elements but a length of 2
</code></pre>

<p>æ•°ç»„å­—é¢é‡è¯­æ³•å…è®¸å¯é€‰çš„å°¾éƒ¨é€—å·ï¼Œæ‰€ä»¥ [,,] çš„é•¿åº¦æ˜¯ 2ï¼Œä¸æ˜¯3ã€‚</p>

<h3 id="toc_2">7.1.2 å±•å¼€è¿ç®—ç¬¦</h3>

<p>ES6 ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨å±•å¼€æ“ä½œç¬¦ ... å°†ä¸€ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ å±•å¼€åœ¨æ•°ç»„å­—é¢é‡ä¸­ï¼š</p>

<pre><code class="language-javascript">let a = [1, 2, 3];
let b = [0, ...a, 4];  // b == [0, 1, 2, 3, 4]
</code></pre>

<p>ä¸‰ä¸ªç‚¹å±•å¼€æ•°ç»„ aï¼Œæ‰€ä»¥å®ƒçš„å…ƒç´ å˜æˆäº†æ•°ç»„å­—é¢é‡ï¼Œå¹¶è¢«åˆ›å»ºåœ¨æ•°ç»„ä¸­ã€‚å°±åƒ ...a è¢«æ•°ç»„ a çš„å…ƒç´ æ‰€æ›¿æ¢ï¼Œè¢«åˆ—å‡ºä½œä¸ºæœªé—­åˆçš„æ•°ç»„å­—é¢é‡çš„ä¸€éƒ¨åˆ†ã€‚ï¼ˆæ³¨æ„ï¼Œå°½ç®¡æˆ‘ä»¬ç§°ä¸‰ç‚¹æ˜¯å±•å¼€è¿ç®—ç¬¦ï¼Œä½†è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæ“ä½œï¼Œå› ä¸ºå®ƒåªèƒ½ç”¨äºæ•°ç»„å­—é¢é‡å’Œæœ¬ä¹¦åé¢æåˆ°çš„å‡½æ•°è°ƒç”¨ã€‚ï¼‰</p>

<p>å±•å¼€è¿ç®—ç¬¦å¯ä»¥æ–¹ä¾¿çš„åˆ›å»ºä¸€ä¸ªæ•°ç»„çš„æ‹·è´ï¼ˆæµ…æ‹·è´ï¼‰ï¼š</p>

<pre><code class="language-javascript">let original = [1,2,3];
let copy = [...original];
copy[0] = 0;  // Modifying the copy does not change the original
original[0]   // =&gt; 1
</code></pre>

<p>å±•å¼€è¿ç®—ç¬¦å¯ä»¥ä½œç”¨äºä»»ä½•å¯è¿­ä»£å¯¹è±¡ã€‚ï¼ˆå¯è¿­ä»£å¯¹è±¡æ˜¯å¯ä»¥ç”¨ for/of è¿›è¡Œå¾ªç¯çš„å¯¹è±¡ï¼›ç¬¬ä¸€æ¬¡åœ¨ Â§5.4.4 ä¸­æåˆ°ï¼Œåœ¨ç¬¬ 12 ç« ä¼šçœ‹åˆ°æ›´å¤šå…³äºå®ƒä»¬çš„æè¿°ã€‚ï¼‰å­—ç¬¦ä¸²æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨å±•å¼€æ“ä½œç¬¦å°†å­—ç¬¦ä¸²è½¬æ¢æˆå•ä¸ªå­—ç¬¦çš„æ•°ç»„ã€‚</p>

<pre><code class="language-javascript">let digits = [...&quot;0123456789ABCDEF&quot;];
digits // =&gt; [&quot;0&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;,&quot;E&quot;,&quot;F&quot;]
</code></pre>

<p>Set å¯¹è±¡ï¼ˆÂ§11.1.1ï¼‰æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œæ‰€ä»¥æ•°ç»„å»é‡æœ‰ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯ç”¨å±•å¼€è¿ç®—ç¬¦å°†æ•°ç»„è½¬æ¢æˆ set ç„¶åå†è½¬æˆæ•°ç»„ï¼š</p>

<pre><code class="language-javascript">let letters = [...&quot;hello world&quot;];
[...new Set(letters)]  // =&gt; [&quot;h&quot;,&quot;e&quot;,&quot;l&quot;,&quot;o&quot;,&quot; &quot;,&quot;w&quot;,&quot;r&quot;,&quot;d&quot;]
</code></pre>

<h3 id="toc_3">7.1.3 Array() æ„é€ å‡½æ•°</h3>

<p>å¦ä¸€ç§åˆ›å»ºæ•°ç»„çš„æ–¹æ³•æ˜¯ä½¿ç”¨ Array() æ„é€ å‡½æ•°ã€‚å¯ä»¥ç”¨ä¸‰ç§ä¸åŒçš„æ–¹å¼è°ƒç”¨è¿™ä¸ªæ„é€ å‡½æ•°ï¼š</p>

<p>è°ƒç”¨æ—¶æ²¡æœ‰å®å‚ï¼š</p>

<pre><code class="language-javascript">let a = new Array();
</code></pre>

<p>è¿™ä¸ªæ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªæ²¡æœ‰å…ƒç´ çš„ç©ºæ•°ç»„ï¼Œå®ƒç­‰ä»·äº [] æ•°ç»„å­—é¢é‡ã€‚</p>

<p>è°ƒç”¨æ—¶æœ‰ä¸€ä¸ªæ•°å€¼å®å‚ï¼Œå®ƒæŒ‡å®šäº†æ•°ç»„çš„é•¿åº¦ï¼š</p>

<pre><code class="language-javascript">let a = new Array(10);
</code></pre>

<p>è¯¥æŠ€æœ¯åˆ›å»ºæŒ‡å®šé•¿åº¦çš„æ•°ç»„ã€‚å½“é¢„å…ˆçŸ¥é“æ‰€éœ€å…ƒç´ ä¸ªæ•°æ—¶ï¼Œè¿™ç§å½¢å¼çš„ Array() æ„é€ å‡½æ•°å¯ä»¥ç”¨æ¥é¢„åˆ†é…ä¸€ä¸ªæ•°ç»„ç©ºé—´ã€‚æ³¨æ„ï¼Œæ•°ç»„ä¸­æ²¡æœ‰å­˜å‚¨å€¼ï¼Œç”šè‡³æ•°ç»„çš„ç´¢å¼•å±æ€§â€œ0â€ã€â€œ1â€ç­‰è¿˜æœªå®šä¹‰ã€‚</p>

<p>ä¸ºæ•°ç»„æ˜¾å¼æŒ‡å®šä¸¤ä¸ªæˆ–å¤šä¸ªæ•°ç»„å…ƒç´ æˆ–è€…éæ•°å€¼å…ƒç´ ï¼š</p>

<pre><code class="language-javascript">let a = new Array(5, 4, 3, 2, 1, &quot;testing, testing&quot;);
</code></pre>

<p>ä»¥è¿™ç§å½¢å¼ï¼Œæ„é€ å‡½æ•°çš„å®å‚å°†ä¼šæˆä¸ºæ–°æ•°ç»„çš„å…ƒç´ ã€‚ä½¿ç”¨æ•°ç»„å­—é¢é‡æ¯”è¿™æ ·ä½¿ç”¨ Array() æ„é€ å‡½æ•°è¦ç®€å•å¤šäº†ã€‚</p>

<h3 id="toc_4">7.1.4 Array.of()</h3>

<p>å½“ Array() æ„é€ å‡½æ•°è°ƒç”¨æ—¶æœ‰ä¸€ä¸ªæ•°å€¼å‹å®å‚ï¼Œå®ƒä¼šå°†å®å‚ä½œä¸ºæ•°ç»„çš„é•¿åº¦ã€‚ä½†å½“è°ƒç”¨æ—¶ä¸æ­¢ä¸€ä¸ªæ•°å€¼å‹å®å‚æ—¶ï¼Œå®ƒä¼šå°†é‚£äº›å®å‚ä½œä¸ºæ•°ç»„çš„å…ƒç´ åˆ›å»ºã€‚è¿™æ„å‘³ç€ Array() æ„é€ å‡½æ•°ä¸èƒ½åˆ›å»ºåªæœ‰ä¸€ä¸ªæ•°å€¼å‹å…ƒç´ çš„æ•°ç»„ã€‚</p>

<p>åœ¨ ES6 ä¸­ï¼ŒArray.of() å‡½æ•°ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ï¼šå®ƒæ˜¯ä¸€ä¸ªå°†å…¶å®å‚å€¼ï¼ˆæ— è®ºæœ‰å¤šå°‘ä¸ªå®å‚ï¼‰ä½œä¸ºæ•°ç»„å…ƒç´ åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ–°æ•°ç»„çš„å·¥å‚æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">Array.of()        // =&gt; []; returns empty array with no arguments
Array.of(10)      // =&gt; [10]; can create arrays with a single numeric argument
Array.of(1,2,3)   // =&gt; [1, 2, 3]
</code></pre>

<h3 id="toc_5">7.1.5 Array.from()</h3>

<p>Array.from æ˜¯ ES6 ä¸­å¦å¤–ä¸€ä¸ªæ•°ç»„å·¥å‚æ–¹æ³•ã€‚å®ƒæœŸæœ›ä¸€ä¸ªå¯è¿­ä»£æˆ–ç±»æ•°ç»„å¯¹è±¡ä½œä¸ºå®ƒçš„ç¬¬ä¸€ä¸ªå®å‚ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡ä¸­å…ƒç´ çš„æ–°æ•°ç»„ã€‚ä½¿ç”¨ä¸€ä¸ªå¯è¿­ä»£å®å‚ï¼ŒArray.from(iterable) å·¥ä½œæ–¹å¼ç±»ä¼¼äºå±•å¼€è¿ç®—ç¬¦ [...iterable]ã€‚å®ƒä¹Ÿå¯ä»¥ç®€å•çš„æ‹·è´ä¸€ä¸ªæ•°ç»„ï¼š</p>

<pre><code class="language-javascript">let copy = Array.from(original);
</code></pre>

<p>Array.from() ä¹Ÿå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒå®šä¹‰äº†ä¸€ä¸ªå°†ç±»æ•°ç»„å¯¹è±¡æ‹·è´æˆæ•°ç»„çš„æ–¹æ³•ã€‚ç±»æ•°ç»„å¯¹è±¡æ˜¯ä¸€ä¸ªä¸æ˜¯æ•°ç»„çš„å¯¹è±¡ï¼Œå®ƒæœ‰ä¸€ä¸ªæ•°å€¼å‹çš„ length å±æ€§ï¼Œå¹¶ä¸”å®ƒçš„å€¼ç¢°å·§ä¿å­˜åœ¨å±æ€§åä¸ºæ•´æ•°çš„å±æ€§ä¸­ã€‚å½“ä½¿ç”¨å®¢æˆ·ç«¯ JavaScript æ—¶ï¼Œä¸€äº›æµè§ˆå™¨æ–¹æ³•çš„è¿”å›å€¼æ˜¯ç±»æ•°ç»„çš„ï¼Œå¹¶ä¸”å½“å°†å…¶è½¬åŒ–æˆçœŸæ­£çš„æ•°ç»„åä¼šæ›´å®¹æ˜“æ“ä½œå®ƒä»¬ï¼š</p>

<pre><code class="language-javascript">let truearray = Array.from(arraylike);
</code></pre>

<p>Array.from() ç¬¬äºŒä¸ªå®å‚ä¸ºå¯é€‰å®å‚ã€‚å¦‚æœä¼ é€’ä¸€ä¸ªå‡½æ•°ä½œä¸ºç¬¬äºŒä¸ªå®å‚ï¼Œé‚£ä¹ˆå½“æ–°æ•°ç»„è¢«åˆ›å»ºï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¼šè¢«ä½œä¸ºå®å‚ä¼ å…¥è¿™ä¸ªæŒ‡å®šå‡½æ•°ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°çš„æ¯ä¸ªè¿”å›å€¼ä¿å­˜åœ¨æ•°ç»„ä¸­ä»£æ›¿åŸæ¥çš„å€¼ã€‚ï¼ˆè¿™å¾ˆåƒåé¢ä¼šä»‹ç»çš„æ•°ç»„ map() æ–¹æ³•ï¼Œä½†æ˜¯ï¼Œå®ƒä¼šæ›´åŠ é«˜æ•ˆçš„æ‰§è¡Œæ˜ å°„ï¼Œå› å…¶ä¸ºæ²¡æœ‰åˆ›å»ºæ•°ç»„ï¼Œè€Œæ˜¯ç›´æ¥è¿›è¡Œæ˜ å°„åˆ°å¦å¤–ä¸€ä¸ªæ•°ç»„ã€‚ï¼‰</p>

<h2 id="toc_6">7.2 æ•°ç»„å…ƒç´ çš„è¯»å’Œå†™</h2>

<p>ä½¿ç”¨ [] è¿ç®—ç¬¦æ¥è®¿é—®æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚æ•°ç»„çš„å¼•ç”¨ä½äºæ–¹æ‹¬å·çš„å·¦è¾¹ã€‚æ–¹æ‹¬å·ä¸­æ˜¯ä¸€ä¸ªè¿”å›éè´Ÿæ•´æ•°å€¼çš„ä»»æ„è¡¨è¾¾å¼ã€‚ä½¿ç”¨è¯¥è¯­æ³•æ—¢å¯ä»¥è¯»åˆå¯ä»¥å†™æ•°ç»„çš„ä¸€ä¸ªå…ƒç´ ã€‚å› æ­¤ï¼Œå¦‚ä¸‹ä»£ç éƒ½æ˜¯åˆæ³•çš„ JavaScript è¯­å¥ï¼š</p>

<pre><code class="language-javascript">let a = [&quot;world&quot;];     // Start with a one-element array
let value = a[0];      // Read element 0
a[1] = 3.14;           // Write element 1
let i = 2;
a[i] = 3;              // Write element 2
a[i + 1] = &quot;hello&quot;;    // Write element 3
a[a[i]] = a[0];        // Read elements 0 and 2, write element 3
</code></pre>

<p>æ•°ç»„ç‰¹æ®Šçš„æ˜¯ï¼Œå½“ä½¿ç”¨å°äº 2<sup>32</sup>â€“1 çš„éè´Ÿæ•´æ•°å±æ€§åæ—¶ï¼Œæ•°ç»„ä¼šè‡ªåŠ¨ç»´æŠ¤ length å±æ€§ã€‚ä¾‹å¦‚ï¼Œä¸Šæ–‡ä¸­æˆ‘ä»¬åˆ›å»ºäº†åªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„ aã€‚ç„¶åæˆ‘ä»¬ä¸ºå…¶åºåˆ—ä¸º 1ã€2 å’Œ 3 çš„å…ƒç´ è¿›è¡Œèµ‹å€¼ã€‚æ•°ç»„ length å±æ€§ä¼šè‡ªåŠ¨æ”¹å˜ï¼š</p>

<pre><code class="language-javascript">a.length       // =&gt; 4
</code></pre>

<p>è¯·è®°ä½ï¼Œæ•°ç»„æ˜¯å¯¹è±¡çš„ç‰¹æ®Šå½¢å¼ã€‚ä½¿ç”¨æ–¹æ‹¬å·è®¿é—®æ•°ç»„å…ƒç´ å°±åƒç”¨æ–¹æ‹¬å·è®¿é—®å¯¹è±¡çš„å±æ€§ä¸€æ ·ã€‚JavaScript å°†æŒ‡å®šçš„æ•°å­—ç´¢å¼•å€¼è½¬æ¢æˆå­—ç¬¦ä¸²ï¼ˆç´¢å¼•å€¼ 1 å˜æˆâ€œ1â€ï¼‰ç„¶åå°†å…¶ä½œä¸ºå±æ€§åæ¥ä½¿ç”¨ã€‚å…³äºç´¢å¼•å€¼ä»æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ²¡ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼šå¯¹å¸¸è§„å¯¹è±¡ä¹Ÿå¯ä»¥è¿™ä¹ˆåšï¼š</p>

<pre><code class="language-javascript">let o = {};    // Create a plain object
o[1] = &quot;one&quot;;  // Index it with an integer
o[&quot;1&quot;]         // =&gt; &quot;one&quot;; numeric and string property names are the same
</code></pre>

<p>æ¸…æ™°åœ°åŒºåˆ†æ•°ç»„çš„ç´¢å¼•å’Œå¯¹è±¡çš„å±æ€§åæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æ‰€æœ‰çš„ç´¢å¼•éƒ½æ˜¯å±æ€§åï¼Œä½†åªæœ‰åœ¨ 0ï½2<sup>32</sup>-2 ä¹‹é—´çš„æ•´æ•°å±æ€§åæ‰æ˜¯ç´¢å¼•ã€‚æ‰€æœ‰çš„æ•°ç»„éƒ½æ˜¯å¯¹è±¡ï¼Œå¯ä»¥ä¸ºå…¶åˆ›å»ºä»»æ„åå­—çš„å±æ€§ã€‚ä½†å¦‚æœä½¿ç”¨çš„å±æ€§æ˜¯æ•°ç»„çš„ç´¢å¼•ï¼Œæ•°ç»„çš„ç‰¹æ®Šè¡Œä¸ºå°±æ˜¯å°†æ ¹æ®éœ€è¦æ›´æ–°å®ƒä»¬çš„ length å±æ€§å€¼ã€‚</p>

<p>æ³¨æ„ï¼Œå¯ä»¥ä½¿ç”¨è´Ÿæ•°æˆ–éæ•´æ•°æ¥ç´¢å¼•æ•°ç»„ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä½œä¸ºå±æ€§åæ¥ç”¨ã€‚æ—¢ç„¶åå­—ä¸æ˜¯éè´Ÿæ•´æ•°ï¼Œå®ƒå°±åªèƒ½å½“åšå¸¸è§„çš„å¯¹è±¡å±æ€§ï¼Œè€Œéæ•°ç»„çš„ç´¢å¼•ã€‚åŒæ ·ï¼Œå¦‚æœå‡‘å·§ä½¿ç”¨äº†æ˜¯éè´Ÿæ•´æ•°çš„å­—ç¬¦ä¸²ï¼Œå®ƒå°±å½“åšæ•°ç»„ç´¢å¼•ï¼Œè€Œéå¯¹è±¡å±æ€§ã€‚å½“ä½¿ç”¨çš„ä¸€ä¸ªæµ®ç‚¹æ•°å’Œä¸€ä¸ªæ•´æ•°ç›¸ç­‰æ—¶æƒ…å†µä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š</p>

<pre><code class="language-javascript">a[-1.23] = true;  // This creates a property named &quot;-1.23&quot;
a[&quot;1000&quot;] = 0;    // This the 1001st element of the array
a[1.000] = 1;     // Array index 1. Same as a[1] = 1;
</code></pre>

<p>äº‹å®ä¸Šæ•°ç»„ç´¢å¼•ä»…ä»…æ˜¯å¯¹è±¡å±æ€§åçš„ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œè¿™æ„å‘³ç€ JavaScript æ•°ç»„æ²¡æœ‰â€œè¶Šç•Œâ€é”™è¯¯çš„æ¦‚å¿µã€‚å½“è¯•å›¾æŸ¥è¯¢ä»»ä½•å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„å±æ€§æ—¶ï¼Œéƒ½ä¸ä¼šæŠ¥é”™ï¼Œåªä¼šå¾—åˆ° undefined å€¼ã€‚ç±»ä¼¼äºå¯¹è±¡ï¼Œå¯¹äºå¯¹è±¡åŒæ ·å­˜åœ¨è¿™ç§æƒ…å†µã€‚</p>

<pre><code class="language-javascript">let a = [true, false]; // This array has elements at indexes 0 and 1
a[2]                   // =&gt; undefined; no element at this index.
a[-1]                  // =&gt; undefined; no property with this name.
</code></pre>

<h2 id="toc_7">7.3 ç¨€ç–æ•°ç»„ï¼ˆSparse Arraysï¼‰</h2>

<p>ç¨€ç–æ•°ç»„å°±æ˜¯åŒ…å«ä» 0 å¼€å§‹çš„ä¸è¿ç»­ç´¢å¼•çš„æ•°ç»„ã€‚é€šå¸¸ï¼Œæ•°ç»„çš„ length å±æ€§å€¼ä»£è¡¨æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚å¦‚æœæ•°ç»„æ˜¯ç¨€ç–çš„ï¼Œlength å±æ€§å€¼å¤§äºå…ƒç´ çš„ä¸ªæ•°ã€‚å¯ä»¥ç”¨ Array() æ„é€ å‡½æ•°æˆ–ç®€å•åœ°æŒ‡å®šæ•°ç»„çš„ç´¢å¼•å€¼å¤§äºå½“å‰çš„æ•°ç»„é•¿åº¦æ¥åˆ›å»ºç¨€ç–æ•°ç»„ã€‚</p>

<pre><code class="language-javascript">let a = new Array(5); // No elements, but a.length is 5.
a = [];               // Create an array with no elements and length = 0.
a[1000] = 0;          // Assignment adds one element but sets length to 1001.
</code></pre>

<p>åé¢ä¼šçœ‹åˆ°ä½ ä¹Ÿå¯ä»¥ç”¨ delete è¿ç®—ç¬¦æ¥ç”Ÿäº§ç¨€ç–æ•°ç»„ã€‚</p>

<p>è¶³å¤Ÿç¨€ç–çš„æ•°ç»„é€šå¸¸åœ¨å®ç°ä¸Šæ¯”ç¨ å¯†çš„æ•°ç»„æ›´æ…¢ã€å†…å­˜åˆ©ç”¨ç‡æ›´é«˜ï¼Œåœ¨è¿™æ ·çš„æ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„æ—¶é—´ä¸å¸¸è§„å¯¹è±¡å±æ€§çš„æŸ¥æ‰¾æ—¶é—´ä¸€æ ·é•¿ã€‚</p>

<p>æ³¨æ„ï¼Œå½“åœ¨æ•°ç»„å­—é¢é‡ä¸­çœç•¥å€¼æ—¶ï¼ˆåƒ [1,,3] ä¸­ä½¿ç”¨é‡å¤çš„é€—å·ï¼‰è¿”å›çš„æ˜¯ç¨€ç–æ•°ç»„ï¼Œçœç•¥æ‰çš„å€¼æ˜¯ä¸å­˜åœ¨çš„ï¼š</p>

<pre><code class="language-javascript">let a1 = [,];           // This array has no elements and length 1
let a2 = [undefined];   // This array has one undefined element
0 in a1                 // =&gt; false: a1 has no element with index 0
0 in a2                 // =&gt; true: a2 has the undefined value at index 0
</code></pre>

<p>äº†è§£ç¨€ç–æ•°ç»„æ˜¯äº†è§£ JavaScript æ•°ç»„çš„çœŸå®æœ¬è´¨çš„ä¸€éƒ¨åˆ†ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®é™…ä¸Šä½ æ‰€ç¢°åˆ°çš„ç»å¤§å¤šæ•° JavaScript æ•°ç»„ä¸æ˜¯ç¨€ç–æ•°ç»„ã€‚å¹¶ä¸”ï¼Œå¦‚æœä½ ç¡®å®ç¢°åˆ°äº†ç¨€ç–æ•°ç»„ï¼Œä½ çš„ä»£ç å¾ˆå¯èƒ½åƒå¯¹å¾…éç¨€ç–æ•°ç»„ä¸€æ ·æ¥å¯¹å¾…å®ƒä»¬ï¼Œåªä¸è¿‡å®ƒä»¬åŒ…å«ä¸€äº› undefined å…ƒç´ ã€‚</p>

<h2 id="toc_8">7.4 æ•°ç»„é•¿åº¦</h2>

<p>æ¯ä¸ªæ•°ç»„æœ‰ä¸€ä¸ª length å±æ€§ï¼Œå°±æ˜¯è¿™ä¸ªå±æ€§ä½¿å…¶åŒºåˆ«äºå¸¸è§„çš„ JavaScript å¯¹è±¡ã€‚é’ˆå¯¹ç¨ å¯†ï¼ˆä¹Ÿå°±æ˜¯éç¨€ç–ï¼‰æ•°ç»„ï¼Œlength å±æ€§å€¼ä»£è¡¨æ•°ç»„ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚å…¶å€¼æ¯”æ•°ç»„ä¸­æœ€å¤§çš„ç´¢å¼•å¤§ 1ï¼š</p>

<pre><code class="language-javascript">[].length             // =&gt; 0: the array has no elements
[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;].length  // =&gt; 3: highest index is 2, length is 3
</code></pre>

<p>å½“æ•°ç»„æ˜¯ç¨€ç–çš„æ—¶ï¼Œlength å±æ€§å€¼å¤§äºå…ƒç´ çš„ä¸ªæ•°ã€‚è€Œä¸”å…³äºæ­¤æˆ‘ä»¬å¯ä»¥è¯´æ•°ç»„é•¿åº¦ä¿è¯å¤§äºå®ƒæ¯ä¸ªå…ƒç´ çš„ç´¢å¼•å€¼ã€‚æˆ–è€…ï¼Œæ¢ä¸€ç§è¯´æ³•ï¼Œåœ¨æ•°ç»„ä¸­ï¼ˆæ— è®ºç¨€ç–ä¸å¦ï¼‰è‚¯å®šæ‰¾ä¸åˆ°ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•å€¼å¤§äºæˆ–ç­‰äºå®ƒçš„é•¿åº¦ã€‚ä¸ºäº†ç»´æŒæ­¤è§„åˆ™ä¸å˜åŒ–ï¼Œæ•°ç»„æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„è¡Œä¸ºã€‚ç¬¬ä¸€ä¸ªå¦‚åŒä¸Šé¢çš„æè¿°ï¼šå¦‚æœä¸ºä¸€ä¸ªæ•°ç»„å…ƒç´ èµ‹å€¼ï¼Œå®ƒçš„ç´¢å¼• i å¤§äºæˆ–ç­‰äºç°æœ‰æ•°ç»„çš„é•¿åº¦æ—¶ï¼Œlength å±æ€§çš„å€¼å°†è®¾ç½®ä¸º i+1ã€‚</p>

<p>ç¬¬äºŒä¸ªç‰¹æ®Šçš„è¡Œä¸ºå°±æ˜¯è®¾ç½® length å±æ€§ä¸ºä¸€ä¸ªå°äºå½“å‰é•¿åº¦çš„éè´Ÿæ•´æ•°næ—¶ï¼Œå½“å‰æ•°ç»„ä¸­é‚£äº›ç´¢å¼•å€¼å¤§äºæˆ–ç­‰äº n çš„å…ƒç´ å°†ä»ä¸­åˆ é™¤ï¼š</p>

<pre><code class="language-javascript">a = [1,2,3,4,5];     // Start with a 5-element array.
a.length = 3;        // a is now [1,2,3].
a.length = 0;        // Delete all elements.  a is [].
a.length = 5;        // Length is 5, but no elements, like new Array(5)
</code></pre>

<p>è¿˜å¯ä»¥å°†æ•°ç»„çš„ length å±æ€§å€¼è®¾ç½®ä¸ºå¤§äºå…¶å½“å‰çš„é•¿åº¦ã€‚å®é™…ä¸Šè¿™ä¸ä¼šå‘æ•°ç»„ä¸­æ·»åŠ æ–°çš„å…ƒç´ ï¼Œå®ƒåªæ˜¯åœ¨æ•°ç»„å°¾éƒ¨åˆ›å»ºä¸€ä¸ªç¨€ç–åŒºåŸŸã€‚</p>

<h2 id="toc_9">7.5 æ•°ç»„å…ƒç´ æ·»åŠ å’Œåˆ é™¤</h2>

<p>æˆ‘ä»¬å·²ç»è§è¿‡æ·»åŠ æ•°ç»„å…ƒç´ æœ€ç®€å•çš„æ–¹æ³•ï¼šä¸ºæ–°ç´¢å¼•èµ‹å€¼ï¼š</p>

<pre><code class="language-javascript">let a = [];      // Start with an empty array.
a[0] = &quot;zero&quot;;   // And add elements to it.
a[1] = &quot;one&quot;;
</code></pre>

<p>ä¹Ÿå¯ä»¥ä½¿ç”¨push()æ–¹æ³•åœ¨æ•°ç»„æœ«å°¾å¢åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼š</p>

<pre><code class="language-javascript">let a = [];           // Start with an empty array
a.push(&quot;zero&quot;);       // Add a value at the end.  a = [&quot;zero&quot;]
a.push(&quot;one&quot;, &quot;two&quot;); // Add two more values.  a = [&quot;zero&quot;, &quot;one&quot;, &quot;two&quot;]
</code></pre>

<p>åœ¨æ•°ç»„å°¾éƒ¨å‹å…¥ä¸€ä¸ªå…ƒç´ ä¸ç»™ a[a.length] èµ‹å€¼æ˜¯ä¸€æ ·çš„ã€‚å¯ä»¥ä½¿ç”¨ unshift() æ–¹æ³•ï¼ˆÂ§7.8 æœ‰æè¿°ï¼‰åœ¨æ•°ç»„çš„é¦–éƒ¨æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”å°†å…¶ä»–å…ƒç´ ä¾æ¬¡ç§»åˆ°æ›´é«˜çš„ç´¢å¼•å¤„ã€‚pop() æ–¹æ³•ä¸ push() ç›¸åï¼šå®ƒç§»é™¤æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›è¿™ä¸ªå…ƒç´ ï¼Œä½¿æ•°ç»„ length å‡ 1ã€‚åŒæ ·ï¼Œshift() æ–¹æ³•ç§»é™¤å¹¶è¿”å›æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä½¿æ•°ç»„ length å‡ 1ï¼Œå¹¶å°†å…¶ä»–å…ƒç´ ä¾æ¬¡ç§»åˆ°ä½ 1 çš„ç´¢å¼•å¤„ã€‚Â§7.8 æœ‰æ›´å¤šå…³äºè¿™äº›æ–¹æ³•çš„æè¿°ã€‚</p>

<p>å¯ä»¥åƒåˆ é™¤å¯¹è±¡å±æ€§ä¸€æ ·ä½¿ç”¨ delete è¿ç®—ç¬¦æ¥åˆ é™¤æ•°ç»„å…ƒç´ ï¼š</p>

<pre><code class="language-javascript">let a = [1,2,3];
delete a[2];   // a now has no element at index 2
2 in a         // =&gt; false: no array index 2 is defined
a.length       // =&gt; 3: delete does not affect array length
</code></pre>

<p>åˆ é™¤æ•°ç»„å…ƒç´ ä¸ä¸ºå…¶èµ‹ undefined å€¼æ˜¯ç±»ä¼¼çš„ï¼ˆä½†æœ‰ä¸€äº›å¾®å¦™çš„åŒºåˆ«ï¼‰ã€‚æ³¨æ„ï¼Œå¯¹ä¸€ä¸ªæ•°ç»„å…ƒç´ ä½¿ç”¨ delete ä¸ä¼šä¿®æ”¹æ•°ç»„çš„ length å±æ€§ï¼Œä¹Ÿä¸ä¼šå°†å…ƒç´ ä»é«˜ç´¢å¼•å¤„ç§»ä¸‹æ¥å¡«å……å·²åˆ é™¤å±æ€§ç•™ä¸‹çš„ç©ºç™½ã€‚å¦‚æœä»æ•°ç»„ä¸­åˆ é™¤ä¸€ä¸ªå…ƒç´ ï¼Œå®ƒå°±å˜æˆç¨€ç–æ•°ç»„ã€‚</p>

<p>æ­£å¦‚ä¸Šé¢æ‰€çœ‹åˆ°çš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®æ–°çš„æ‰€éœ€é•¿åº¦ï¼Œå³å¯ä»æ•°ç»„å°¾éƒ¨åˆ é™¤å…ƒç´ ã€‚</p>

<p>æœ€åï¼Œsplice() æ˜¯ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•æ¥æ’å…¥ã€åˆ é™¤æˆ–æ›¿æ¢æ•°ç»„å…ƒç´ ã€‚å®ƒä¼šæ ¹æ®éœ€è¦ä¿®æ”¹ length å±æ€§å¹¶ç§»åŠ¨å…ƒç´ åˆ°æ›´é«˜æˆ–è¾ƒä½çš„ç´¢å¼•å¤„ã€‚è¯¦ç»†å†…å®¹è§ Â§7.8ã€‚</p>

<h2 id="toc_10">7.6 æ•°ç»„éå†</h2>

<p>åœ¨ ES6 ä¸­ï¼Œæœ€å®¹æ˜“éå†æ•°ç»„å…ƒç´ ï¼ˆæˆ–å¯è¿­ä»£å¯¹è±¡ï¼‰çš„æ–¹æ³•æ˜¯ for/of å¾ªç¯ï¼Œåœ¨ Â§5.4.4 ä¸­è¯¦ç»†ä»‹ç»ï¼š</p>

<pre><code class="language-javascript">let letters = [...&quot;Hello world&quot;];  // An array of letters
let string = &quot;&quot;;
for(let letter of letters) {
    string += letter;
}
string  // =&gt; &quot;Hello world&quot;; we reassembled the original text
</code></pre>

<p>å†…ç½®æ•°ç»„è¿­ä»£å™¨ for/of å¾ªç¯æŒ‰ç…§å‡åºè¿”å›æ•°ç»„å…ƒç´ ã€‚å¯¹äºç¨€ç–æ•°ç»„å®ƒæ²¡æœ‰ç‰¹æ®Šçš„è¡Œä¸ºï¼Œæ•°ç»„ä¸­ä¸å­˜åœ¨çš„å…ƒç´ åªæ˜¯å•çº¯çš„è¿”å› undefinedã€‚</p>

<p>å¦‚æœä½¿ç”¨ for/of å¾ªç¯ä¸€ä¸ªæ•°ç»„æ—¶è¿˜éœ€è¦çŸ¥é“æ¯ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œå¯ä»¥åƒè¿™æ ·å°†æ•°ç»„çš„ entries() æ–¹æ³•å’Œè§£æ„è¯­å¥ä¸€åŒä½¿ç”¨ï¼š</p>

<pre><code class="language-javascript">let everyother = &quot;&quot;;
for(let [index, letter] of letters.entries()) {
    if (index % 2 === 0) everyother += letter;  // letters at even indexes
}
everyother  // =&gt; &quot;Hlowrd&quot;
</code></pre>

<p>å¦ä¸€ç§ä¸é”™çš„éå†æ•°ç»„æ–¹æ³•æ˜¯ç”¨ forEach()ã€‚è¿™ä¸æ˜¯ for å¾ªç¯çš„æ–°å½¢å¼ï¼Œè€Œæ˜¯æä¾›æ•°ç»„éå†åŠŸèƒ½æ–¹æ³•çš„æ•°ç»„æ–¹æ³•ã€‚å¯ä»¥ç»™æ•°ç»„çš„ forEach() æ–¹æ³•ä¼ é€’ä¸€ä¸ªå‡½æ•°ï¼ŒforEach() ä¼šå¯¹æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">let uppercase = &quot;&quot;;
letters.forEach(letter =&gt; {  // Note arrow function syntax here
    uppercase += letter.toUpperCase();
});
uppercase  // =&gt; &quot;HELLO WORLD&quot;
</code></pre>

<p>æ­£å¦‚æœŸæœ›çš„ï¼ŒforEach() æŒ‰é¡ºåºå¯¹æ•°ç»„è¿›è¡Œè®¡ç®—ï¼Œå®é™…ä¸Šå®ƒå°†æ•°ç»„ç´¢å¼•ä½œä¸ºç¬¬äºŒä¸ªå®å‚ä¼ é€’åˆ°å‡½æ•°ï¼Œè¿™æœ‰æ—¶å¾ˆæœ‰ç”¨ã€‚ä¸ for/of å¾ªç¯ä¸åŒï¼ŒforEach() èƒ½æ„è¯†åˆ°ç¨€ç–æ•°ç»„ï¼Œå¹¶ä¸”ä¸ä¼šä¸ºä¸å­˜åœ¨çš„å…ƒç´ è°ƒç”¨å‡½æ•°ã€‚</p>

<p>Â§7.8.1 æ›´è¯¦ç»†åœ°è®°å½•äº† forEach() æ–¹æ³•ã€‚è¯¥éƒ¨åˆ†è¿˜ä»‹ç»æ¼”ç¤ºäº†ç‰¹å®šç±»å‹çš„æ•°ç»„éå†æ–¹æ³•ï¼Œå¦‚ map() å’Œ filter()ã€‚</p>

<p>ä¹Ÿå¯ä»¥ç”¨ä¸€ç§éå¸¸è€æ—§æ–¹å¼éå†æ•°ç»„çš„å…ƒç´ ï¼ˆÂ§5.4.3ï¼‰ï¼š</p>

<pre><code class="language-javascript">let vowels = &quot;&quot;;
for(let i = 0; i &lt; letters.length; i++) { // For each index in the array
    let letter = letters[i];              // Get the element at that index
    if (/[aeiou]/.test(letter)) {         // Use a regular expression test
        vowels += letter;                 // If it is a vowel, remember it
    }
}
vowels  // =&gt; &quot;eoo&quot;
</code></pre>

<p>åœ¨åµŒå¥—å¾ªç¯æˆ–å…¶ä»–æ€§èƒ½è‡³å…³é‡è¦çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæœ‰æ—¶å¯èƒ½ä¼šçœ‹åˆ°è¿™æ ·çš„æ•°ç»„éå†ï¼Œä»¥ä¾¿æ•°ç»„é•¿åº¦ä»…è¢«æŸ¥ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡å¾ªç¯éƒ½å»æŸ¥è¯¢ã€‚ä»¥ä¸‹ä¸¤ç§å½¢å¼éƒ½æ˜¯ç¬¦åˆä¹ æƒ¯çš„ for å¾ªç¯ï¼Œè™½ç„¶ä¸æ˜¯ç‰¹åˆ«å¸¸ç”¨ï¼Œè€Œä¸”å¯¹äºç°ä»£ JavaScript è§£é‡Šå™¨ï¼Œå®ƒä»¬æ˜¯å¦å¯¹æ€§èƒ½æœ‰ä»»ä½•å½±å“å°šä¸æ¸…æ¥šï¼š</p>

<pre><code class="language-javascript">// Save the array length into a local variable
for(let i = 0, len = letters.length; i &lt; len; i++) {
    // loop body remains the same
}

// Iterate backwards from the end of the array to the start
for(let i = letters.length-1; i &gt;= 0; i--) {
    // loop body remains the same
}
</code></pre>

<p>è¿™äº›ç¤ºä¾‹å‡å®šæ•°ç»„æ˜¯ç¨ å¯†çš„ï¼Œå¹¶ä¸”æ‰€æœ‰å…ƒç´ éƒ½åŒ…å«æœ‰æ•ˆçš„æ•°æ®ã€‚å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œåº”è¯¥åœ¨ä½¿ç”¨æ•°ç»„å…ƒç´ ä¹‹å‰æµ‹è¯•å®ƒä»¬ã€‚å¦‚æœè¦è·³è¿‡ undefined å’Œä¸å­˜åœ¨çš„å…ƒç´ ï¼Œå¯ä»¥ç¼–å†™ï¼š</p>

<pre><code class="language-javascript">for(let i = 0; i &lt; a.length; i++) {
    if (a[i] === undefined) continue; // Skip undefined + nonexistent elements
    // loop body here
}
</code></pre>

<h2 id="toc_11">7.7 å¤šç»´æ•°ç»„</h2>

<p>JavaScript ä¸æ”¯æŒçœŸæ­£çš„å¤šç»´æ•°ç»„ï¼Œä½†å¯ä»¥ç”¨æ•°ç»„çš„æ•°ç»„æ¥è¿‘ä¼¼ã€‚è®¿é—®æ•°ç»„çš„æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œåªè¦ç®€å•åœ°ä½¿ç”¨ä¸¤æ¬¡ [] æ“ä½œç¬¦å³å¯ã€‚ä¾‹å¦‚ï¼Œå‡è®¾å˜é‡ matrix æ˜¯ä¸€ä¸ªæ•°ç»„çš„æ•°ç»„ï¼Œå®ƒçš„åŸºæœ¬å…ƒç´ æ˜¯æ•°å€¼ï¼Œé‚£ä¹ˆ matrix[x] çš„æ¯ä¸ªå…ƒç´ æ˜¯åŒ…å«ä¸€ä¸ªæ•°å€¼æ•°ç»„ï¼Œè®¿é—®æ•°ç»„ä¸­ç‰¹å®šæ•°å€¼çš„ä»£ç ä¸º matrix[x][y]ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œå®ƒä½¿ç”¨äºŒç»´æ•°ç»„ä½œä¸ºä¸€ä¸ªä¹ä¹ä¹˜æ³•è¡¨ï¼š</p>

<pre><code class="language-javascript">// Create a multidimensional array
let table = new Array(10);               // 10 rows of the table
for(let i = 0; i &lt; table.length; i++) {
    table[i] = new Array(10);            // Each row has 10 columns
}

// Initialize the array
for(let row = 0; row &lt; table.length; row++) {
    for(let col = 0; col &lt; table[row].length; col++) {
        table[row][col] = row*col;
    }
}

// Use the multidimensional array to compute 5*7
table[5][7]  // =&gt; 35
</code></pre>

<h2 id="toc_12">7.8 æ•°ç»„æ–¹æ³•</h2>

<p>å‰é¢å‡ èŠ‚é‡ç‚¹ä»‹ç»äº†ç”¨äºå¤„ç†æ•°ç»„çš„åŸºæœ¬ JavaScript è¯­æ³•ã€‚ä½†é€šå¸¸ï¼Œç”± Array ç±»å®šä¹‰çš„æ–¹æ³•æ˜¯æœ€å¼ºå¤§çš„ã€‚ä¸‹ä¸€èŠ‚å°†è®°å½•è¿™äº›æ–¹æ³•ã€‚åœ¨é˜…è¯»æœ‰å…³è¿™äº›æ–¹æ³•æ—¶ï¼Œè¯·è®°ä½ï¼Œå…¶ä¸­ä¸€äº›æ–¹æ³•ä¿®æ”¹äº†è°ƒç”¨çš„æ•°ç»„ï¼Œè€Œå…¶ä¸­ä¸€äº›æ–¹æ³•ä½¿æ•°ç»„ä¿æŒä¸å˜ã€‚è®¸å¤šæ–¹æ³•è¿”å›æ•°ç»„ï¼šæœ‰æ—¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–°æ•°ç»„ï¼ŒåŸå§‹æ•°ç»„ä¿æŒä¸å˜ã€‚å…¶ä»–æ—¶å€™ï¼Œæ–¹æ³•å°†ä¿®æ”¹æ•°ç»„ï¼Œå¹¶ä¸”è¿”å›å¯¹ä¿®æ”¹åæ•°ç»„çš„å¼•ç”¨ã€‚</p>

<p>ä»¥ä¸‹æ¯ä¸ªå°èŠ‚éƒ½æ¶µç›–ä¸€ç»„ç›¸å…³çš„æ•°ç»„æ–¹æ³•ï¼š</p>

<p>è¿­ä»£å™¨æ–¹æ³•å¾ªç¯éå†æ•°ç»„çš„å…ƒç´ ï¼Œé€šå¸¸è°ƒç”¨åœ¨æ¯ä¸ªå…ƒç´ ä¸ŠæŒ‡å®šçš„å‡½æ•°ã€‚</p>

<p>å †æ ˆå’Œé˜Ÿåˆ—æ–¹æ³•åœ¨æ•°ç»„çš„å¼€å¤´å’Œç»“å°¾æ·»åŠ å’Œåˆ é™¤æ•°ç»„å…ƒç´ ã€‚</p>

<p>å­æ•°ç»„æ–¹æ³•ç”¨äºæå–ã€åˆ é™¤ã€æ’å…¥ã€å¡«å……å’Œå¤åˆ¶ä¸€ä¸ªæ›´å¤§æ•°ç»„ä¸­ç›¸é‚»çš„åŒºåŸŸã€‚</p>

<p>æœç´¢å’Œæ’åºæ–¹æ³•ç”¨äºæŸ¥æ‰¾æ•°ç»„ä¸­çš„å…ƒç´ å’Œæ’åºæ•°ç»„çš„å…ƒç´ ã€‚</p>

<p>ä»¥ä¸‹å°èŠ‚è¿˜ä»‹ç» Array ç±»çš„é™æ€æ–¹æ³•å’Œä¸€äº›ç”¨äºè¿æ¥æ•°ç»„å’Œå°†æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„å„ç§æ–¹æ³•ã€‚</p>

<h3 id="toc_13">7.8.1 æ•°ç»„è¿­ä»£å™¨æ–¹æ³•</h3>

<p>æœ¬èŠ‚ä¸­ä»‹ç»çš„æ–¹æ³•é€šè¿‡å°†æ•°ç»„å…ƒç´ æŒ‰é¡ºåºä¼ é€’åˆ°æ‰€æŒ‡å®šçš„å‡½æ•°æ¥éå†æ•°ç»„ï¼Œå®ƒä»¬æä¾›äº†è¿­ä»£ã€æ˜ å°„ã€ç­›é€‰ã€æµ‹è¯•å’Œå‡å°‘æ•°ç»„çš„ä¾¿æ·æ–¹æ³•ã€‚</p>

<p>ç„¶è€Œï¼Œåœ¨è¯¦ç»†è§£é‡Šè¿™äº›æ–¹æ³•ä¹‹å‰ï¼Œå€¼å¾—å¯¹å®ƒä»¬è¿›è¡Œä¸€äº›æ¦‚æ‹¬ã€‚é¦–å…ˆï¼Œæ‰€æœ‰è¿™äº›æ–¹æ³•éƒ½æ¥å—å‡½æ•°ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå®å‚ï¼Œå¹¶ä½¿ç”¨è°ƒç”¨æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ï¼ˆæˆ–æŸäº›å…ƒç´ ï¼‰ä½œä¸ºå®å‚è°ƒç”¨è¯¥å‡½æ•°ã€‚å¦‚æœæ•°ç»„æ˜¯ç¨€ç–çš„ï¼Œåˆ™ä¸ä¼šä¸ºä¸å­˜åœ¨çš„å…ƒç´ è°ƒç”¨ä¼ é€’çš„å‡½æ•°ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæä¾›çš„å‡½æ•°è¢«è°ƒç”¨æ—¶æœ‰ä¸‰ä¸ªå®å‚ï¼šæ•°ç»„å…ƒç´ çš„å€¼ã€æ•°ç»„å…ƒç´ çš„ç´¢å¼•å’Œæ•°ç»„æœ¬èº«ã€‚é€šå¸¸ï¼Œåªéœ€è¦è¿™äº›å®å‚å€¼ä¸­çš„ç¬¬ä¸€ä¸ªï¼Œå¹¶ä¸”å¯ä»¥å¿½ç•¥ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå€¼ã€‚</p>

<p>ä»¥ä¸‹å°èŠ‚ä¸­æè¿°çš„å¤§å¤šæ•°è¿­ä»£å™¨æ–¹æ³•éƒ½æ¥å—å¯é€‰çš„ç¬¬äºŒä¸ªå®å‚ã€‚å¦‚æœæŒ‡å®šï¼Œåˆ™è°ƒç”¨å‡½æ•°å°±åƒå®ƒæ˜¯ç¬¬äºŒä¸ªå®å‚çš„æ–¹æ³•ä¸€æ ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼ é€’çš„ç¬¬äºŒä¸ªå®å‚å°†æˆä¸ºç¬¬ä¸€ä¸ªå‡½æ•°å®å‚å†…éƒ¨çš„ this å€¼ã€‚ä¼ é€’çš„å‡½æ•°çš„è¿”å›å€¼é€šå¸¸å¾ˆé‡è¦ï¼Œä½†ä¸åŒçš„æ–¹æ³•ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†è¿”å›å€¼ã€‚æ­¤å¤„æè¿°çš„æ–¹æ³•éƒ½æ²¡æœ‰ä¿®æ”¹è°ƒç”¨å®ƒä»¬çš„æ•°ç»„ï¼ˆå½“ç„¶ï¼Œä¼ é€’çš„å‡½æ•°å¯ä»¥ä¿®æ”¹è¿™ä¸ªæ•°ç»„ï¼‰ã€‚</p>

<p>è¿™èŠ‚çš„æ¯ä¸ªå‡½æ•°éƒ½è°ƒç”¨å®ƒçš„ç¬¬ä¸€ä¸ªå‡½æ•°å®å‚ï¼Œå¹¶ä¸”é€šå¸¸å°†è¯¥å‡½æ•°å†…è”å®šä¹‰ä¸ºæ–¹æ³•è°ƒç”¨è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åœ¨å…¶ä»–åœ°æ–¹æ˜¾ç¤ºå®šä¹‰çš„å‡½æ•°ã€‚ç®­å¤´å‡½æ•°è¯­æ³•ï¼ˆå‚è§ Â§8.1.3ï¼‰åœ¨è¿™äº›æ–¹æ³•ä¸­ç‰¹åˆ«æœ‰æ•ˆï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ä½¿ç”¨å®ƒã€‚</p>

<h4 id="toc_14">FOREACH()</h4>

<p>forEach() æ–¹æ³•éå†æ•°ç»„ï¼Œè°ƒç”¨ä¸ºæ¯ä¸ªå…ƒç´ æŒ‡å®šçš„å‡½æ•°ã€‚æ­£å¦‚æˆ‘ä»¬å·²ç»æè¿°çš„é‚£æ ·ï¼Œå°†å‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå®å‚ä¼ é€’ç»™ forEach()ã€‚forEach() ç„¶åä½¿ç”¨ä¸‰ä¸ªå®å‚è°ƒç”¨å‡½æ•°ï¼šæ•°ç»„å…ƒç´ çš„å€¼ã€æ•°ç»„å…ƒç´ çš„ç´¢å¼•å’Œæ•°ç»„æœ¬èº«ã€‚å¦‚æœåªå…³å¿ƒæ•°ç»„å…ƒç´ çš„å€¼ï¼Œåˆ™ç¼–å†™ä¸€ä¸ªåªæœ‰ä¸€ä¸ªå®å‚çš„å‡½æ•°ï¼ˆå°†å¿½ç•¥å…¶ä»–å®å‚ï¼‰ï¼š</p>

<pre><code class="language-javascript">let data = [1,2,3,4,5], sum = 0;
// Compute the sum of the elements of the array
data.forEach(value =&gt; { sum += value; });          // sum == 15

// Now increment each array element
data.forEach(function(v, i, a) { a[i] = v + 1; }); // data == [2,3,4,5,6]
</code></pre>

<p>è¯·æ³¨æ„ï¼ŒforEach() ä¸æä¾›åœ¨æ‰€æœ‰å…ƒç´ ä¼ é€’ç»™å‡½æ•°ä¹‹å‰ç»ˆæ­¢è¿­ä»£çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰ç­‰æ•ˆäºå¸¸è§„ for å¾ªç¯çš„ break è¯­å¥å¯ä»¥ä½¿ç”¨ã€‚</p>

<h4 id="toc_15">MAP()</h4>

<p>map() æ–¹æ³•å°†è°ƒç”¨æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ä¼ é€’åˆ°æŒ‡å®šçš„å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«å‡½æ•°è¿”å›çš„å€¼çš„æ•°ç»„ã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">let a = [1, 2, 3];
a.map(x =&gt; x*x)   // =&gt; [1, 4, 9]: the function takes input x and returns x*x
</code></pre>

<p>ä¼ é€’åˆ° map() çš„å‡½æ•°çš„è°ƒç”¨æ–¹å¼ä¸ä¼ é€’ç»™ forEach() çš„å‡½æ•°ç›¸åŒã€‚ä½†æ˜¯ï¼Œå¯¹äº map() æ–¹æ³•ï¼Œä¼ é€’çš„å‡½æ•°åº”è¿”å›ä¸€ä¸ªå€¼ã€‚è¯·æ³¨æ„ï¼Œmap() è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼šå®ƒä¸ä¼šä¿®æ”¹è°ƒç”¨å®ƒçš„æ•°ç»„ã€‚å¦‚æœè¯¥æ•°ç»„æ˜¯ç¨€ç–çš„ï¼Œåˆ™ä¸ä¼šä¸ºç¼ºå¤±çš„å…ƒç´ è°ƒç”¨å‡½æ•°ï¼Œä½†è¿”å›çš„æ•°ç»„å°†ç¨€ç–ï¼Œå…¶ç¡®å®å…ƒç´ ä¸åŸå§‹æ•°ç»„çš„ä½ç½®ç›¸åŒï¼šå®ƒå°†å…·æœ‰ç›¸åŒçš„é•¿åº¦å’Œç›¸åŒçš„ç¼ºå¤±å…ƒç´ ã€‚</p>

<h4 id="toc_16">FILTER()</h4>

<p>filter() æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«è°ƒç”¨è¯¥æ•°ç»„çš„æ•°ç»„å…ƒç´ çš„å­é›†ã€‚ä¼ é€’ç»™å®ƒçš„å‡½æ•°åº”è¯¥æ˜¯æ–­è¨€ï¼šè¿”å›çœŸæˆ–å‡çš„å‡½æ•°ã€‚æ–­è¨€å‡½æ•°çš„è°ƒç”¨å°±åƒ forEach() å’Œ map() è°ƒç”¨ä¸€æ ·ã€‚å¦‚æœè¿”å›å€¼ä¸º trueï¼Œæˆ–è€…èƒ½è½¬æ¢ä¸º true çš„å€¼ï¼Œåˆ™ä¼ é€’ç»™æ–­è¨€çš„å…ƒç´ æ˜¯å­é›†çš„æˆå‘˜ï¼Œå¹¶å°†æ·»åŠ åˆ°å°†æˆä¸ºè¿”å›å€¼çš„æ•°ç»„ä¸­ã€‚ä¾‹å­ï¼š</p>

<pre><code class="language-javascript">let a = [5, 4, 3, 2, 1];
a.filter(x =&gt; x &lt; 3)         // =&gt; [2, 1]; values less than 3
a.filter((x,i) =&gt; i%2 === 0) // =&gt; [5, 3, 1]; every other value
</code></pre>

<p>æ³¨æ„ filter() è·³è¿‡ç¨€ç–æ•°ç»„ä¸­çš„ä¸¢å¤±å…ƒç´ å¹¶ä¸”è¿”å›å€¼ä¹Ÿæ€»æ˜¯ç¨ å¯†çš„ã€‚è¦ç¼©å°ç¨€ç–æ•°ç»„çš„é—´è·ï¼Œå¯ä»¥è¿™æ ·åšï¼š</p>

<pre><code class="language-javascript">let dense = sparse.filter(() =&gt; true);
</code></pre>

<p>è¦ç¼©å°é—´éš™å¹¶ç§»é™¤ undefined å’Œ null å…ƒç´ ï¼Œå¯ä»¥ç”¨ filter è¿™æ ·åšï¼š</p>

<pre><code class="language-javascript">a = a.filter(x =&gt; x !== undefined &amp;&amp; x !== null);
</code></pre>

<h4 id="toc_17">FIND() å’Œ FINDINDEX()</h4>

<p>find() å’Œ findIndex() æ–¹æ³•å°±åƒ filter()ï¼Œå› ä¸ºå®ƒä»¬åœ¨æ•°ç»„ä¸­è¿­ä»£ï¼ŒæŸ¥æ‰¾æ–­è¨€å‡½æ•°è¿”å›çœŸå®å€¼çš„å…ƒç´ ã€‚ä½†æ˜¯ï¼Œä¸ filter()ä¸åŒï¼Œè¿™ä¸¤ç§æ–¹æ³•åœ¨æ–­è¨€é¦–æ¬¡æŸ¥æ‰¾å…ƒç´ åˆ°æ—¶åœæ­¢éå†ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œfind() è¿”å›åŒ¹é…å…ƒç´ ï¼Œè€Œ findIndex() è¿”å›åŒ¹é…å…ƒç´ çš„ç´¢å¼•ã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…å…ƒç´ ï¼Œfind() è¿”å› undefinedï¼ŒfindIndex() è¿”å› -1ï¼š</p>

<pre><code class="language-javascript">let a = [1,2,3,4,5];
a.findIndex(x =&gt; x === 3)  // =&gt; 2; the value 3 appears at index 2
a.findIndex(x =&gt; x &lt; 0)    // =&gt; -1; no negative numbers in the array
a.find(x =&gt; x % 5 === 0)   // =&gt; 5: this is a multiple of 5
a.find(x =&gt; x % 7 === 0)   // =&gt; undefined: no multiples of 7 in the array
</code></pre>

<h4 id="toc_18">EVERY() å’Œ SOME()</h4>

<p>every() å’Œ some() æ–¹æ³•æ˜¯æ•°ç»„æ–­è¨€ï¼šå®ƒä»¬å°†æŒ‡å®šçš„æ–­è¨€å‡½æ•°åº”ç”¨äºæ•°ç»„çš„å…ƒç´ ï¼Œç„¶åè¿”å› true æˆ– falseã€‚</p>

<p>every() æ–¹æ³•ä¸æ•°å­¦å…¨ç§°é‡åŒ–ç¬¦å· âˆ€ ç›¸ä¼¼ï¼šå¦‚æœæ•°ç»„ä¸­æ‰€æœ‰å…ƒç´ æ‰§è¡Œæ–­è¨€å‡½æ•°è¿”å›å€¼éƒ½ä¸º trueï¼Œåˆ™è¿”å› trueï¼š</p>

<pre><code class="language-javascript">let a = [1,2,3,4,5];
a.every(x =&gt; x &lt; 10)      // =&gt; true: all values are &lt; 10.
a.every(x =&gt; x % 2 === 0) // =&gt; false: not all values are even.
</code></pre>

<p>some() æ–¹æ³•ä¸æ•°å­¦å­˜åœ¨é™å®šç¬¦ âˆƒ ç›¸åŒï¼šå¦‚æœæ•°ç»„ä¸­å­˜åœ¨è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ è°ƒç”¨æ–­è¨€å‡½æ•°è¿”å› true çš„è¿”å› trueï¼Œä»…åœ¨æ–­è¨€å…¨éƒ¨è¿”å› false æ—¶è¿”å› falseï¼š</p>

<pre><code class="language-javascript">let a = [1,2,3,4,5];
a.some(x =&gt; x%2===0)  // =&gt; true; a has some even numbers.
a.some(isNaN)         // =&gt; false; a has no non-numbers.
</code></pre>

<p>è¯·æ³¨æ„ï¼Œevery() å’Œ some() åªè¦å®ƒä»¬çŸ¥é“è¦è¿”å›çš„å€¼ï¼Œéƒ½åœæ­¢å¯¹æ•°ç»„å…ƒç´ çš„éå†ã€‚some() åœ¨æ–­è¨€å‡½æ•°ç¬¬ä¸€æ¬¡è¿”å› true æ—¶è¿”å› trueï¼Œå¹¶ä¸”åªæœ‰åœ¨æ¯ä¸ªå…ƒç´ è°ƒç”¨æ–­è¨€å‡½æ•°éƒ½è¿”å› false æ—¶ï¼Œæ‰ä¼šéå†æ•´ä¸ªæ•°ç»„ ã€‚every() æ­£å¥½ç›¸åï¼šå®ƒè¿”å› false æ—¶ï¼Œæ‚¨çš„è°“è¯è¿”å› falseï¼Œå¹¶ä¸”ä»…åœ¨è°“è¯å§‹ç»ˆè¿”å› true æ—¶ï¼Œæ‰ä¼šå›æ³¨æ‰€æœ‰å…ƒç´ ã€‚å¦è¯·æ³¨æ„ï¼Œæ ¹æ®æ•°å­¦çº¦å®šï¼Œevery() è¿”å› trueï¼Œæœ‰äº›è¿”å› falseï¼Œå½“åœ¨ç©ºæ•°ç»„ä¸Šè°ƒç”¨æ—¶ï¼ŒæŸäº›è¿”å› falseã€‚</p>

<h4 id="toc_19">REDUCE() å’Œ REDUCERIGHT()</h4>

<p>reduce() å’Œ reduceRight() æ–¹æ³•ä½¿ç”¨æŒ‡å®šçš„å‡½æ•°å°†æ•°ç»„å…ƒç´ è¿›è¡Œç»„åˆï¼Œç”Ÿæˆå•ä¸ªå€¼ã€‚è¿™åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­æ˜¯å¸¸è§çš„æ“ä½œï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºâ€œæ³¨å…¥â€å’Œâ€œæŠ˜å â€ã€‚ä¸¾ä¾‹è¯´æ˜å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š</p>

<pre><code class="language-javascript">let a = [1,2,3,4,5];
a.reduce((x,y) =&gt; x+y, 0)          // =&gt; 15; the sum of the values
a.reduce((x,y) =&gt; x*y, 1)          // =&gt; 120; the product of the values
a.reduce((x,y) =&gt; (x &gt; y) ? x : y) // =&gt; 5; the largest of the values
</code></pre>

<p>reduce() éœ€è¦ä¸¤ä¸ªå®å‚ã€‚ç¬¬ä¸€ä¸ªæ˜¯æ‰§è¡ŒåŒ–ç®€æ“ä½œçš„å‡½æ•°ã€‚åŒ–ç®€å‡½æ•°çš„ä»»åŠ¡å°±æ˜¯ç”¨æŸç§æ–¹æ³•æŠŠä¸¤ä¸ªå€¼ç»„åˆæˆ–åŒ–ç®€ä¸ºä¸€ä¸ªå€¼ï¼Œå¹¶è¿”å›åŒ–ç®€åçš„å€¼ã€‚åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå‡½æ•°é€šè¿‡åŠ æ³•ã€ä¹˜æ³•æˆ–å–æœ€å¤§å€¼çš„æ–¹æ³•ç»„åˆä¸¤ä¸ªå€¼ã€‚ç¬¬äºŒä¸ªï¼ˆå¯é€‰ï¼‰çš„å®å‚æ˜¯ä¸€ä¸ªä¼ é€’ç»™å‡½æ•°çš„åˆå§‹å€¼ã€‚</p>

<p>reduce() ä½¿ç”¨çš„å‡½æ•°ä¸ forEach() å’Œ map() ä½¿ç”¨çš„å‡½æ•°ä¸åŒã€‚æ¯”è¾ƒç†Ÿæ‚‰çš„æ˜¯ï¼Œæ•°ç»„å…ƒç´ ã€å…ƒç´ çš„ç´¢å¼•å’Œæ•°ç»„æœ¬èº«å°†ä½œä¸ºç¬¬ 2ï½4 ä¸ªå®å‚ä¼ é€’ç»™å‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå®å‚æ˜¯åˆ°ç›®å‰ä¸ºæ­¢çš„åŒ–ç®€æ“ä½œç´¯ç§¯çš„ç»“æœã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°æ—¶ï¼Œç¬¬ä¸€ä¸ªå®å‚æ˜¯ä¸€ä¸ªåˆå§‹å€¼ï¼Œå®ƒå°±æ˜¯ä¼ é€’ç»™ reduce() çš„ç¬¬äºŒä¸ªå®å‚ã€‚åœ¨æ¥ä¸‹æ¥çš„è°ƒç”¨ä¸­ï¼Œè¿™ä¸ªå€¼å°±æ˜¯ä¸Šä¸€æ¬¡åŒ–ç®€å‡½æ•°çš„è¿”å›å€¼ã€‚åœ¨ä¸Šé¢çš„ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨åŒ–ç®€å‡½æ•°æ—¶çš„å®å‚æ˜¯ 0 å’Œ 1ã€‚å°†ä¸¤è€…ç›¸åŠ å¹¶è¿”å› 1ã€‚å†æ¬¡è°ƒç”¨æ—¶çš„å®å‚æ˜¯ 1 å’Œ 2ï¼Œå®ƒè¿”å› 3ã€‚ç„¶åå®ƒè®¡ç®— 3+3=6ã€6+4=10ï¼Œ æœ€åè®¡ç®— 10+5=15ã€‚æœ€åçš„å€¼æ˜¯ 15ï¼Œreduce() è¿”å›è¿™ä¸ªå€¼ã€‚</p>

<p>å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œä¸Šé¢ç¬¬ä¸‰æ¬¡è°ƒç”¨ reduce() æ—¶åªæœ‰ä¸€ä¸ªå®å‚ï¼šæ²¡æœ‰æŒ‡å®šåˆå§‹å€¼ã€‚å½“ä¸æŒ‡å®šåˆå§‹å€¼è°ƒç”¨ reduce() æ—¶ï¼Œå®ƒå°†ä½¿ç”¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºå…¶åˆå§‹å€¼ã€‚è¿™æ„å‘³ç€ç¬¬ä¸€æ¬¡è°ƒç”¨åŒ–ç®€å‡½æ•°å°±ä½¿ç”¨äº†ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªæ•°ç»„å…ƒç´ ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå®å‚ã€‚åœ¨ä¸Šé¢æ±‚å’Œä¸æ±‚ç§¯çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥çœç•¥åˆå§‹å€¼å®å‚ã€‚</p>

<p>åœ¨ç©ºæ•°ç»„ä¸Šï¼Œä¸å¸¦åˆå§‹å€¼å®å‚è°ƒç”¨ reduce() å°†å¯¼è‡´ç±»å‹é”™è¯¯å¼‚å¸¸ã€‚å¦‚æœè°ƒç”¨å®ƒçš„æ—¶å€™åªæœ‰ä¸€ä¸ªå€¼ï¼ˆæ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ å¹¶ä¸”æ²¡æœ‰æŒ‡å®šåˆå§‹å€¼ï¼Œæˆ–è€…æœ‰ä¸€ä¸ªç©ºæ•°ç»„å¹¶ä¸”æŒ‡å®šä¸€ä¸ªåˆå§‹å€¼ï¼‰reduce() åªæ˜¯ç®€å•åœ°è¿”å›é‚£ä¸ªå€¼è€Œä¸ä¼šè°ƒç”¨åŒ–ç®€å‡½æ•°ã€‚</p>

<p>reduceRight() çš„å·¥ä½œåŸç†å’Œ reduce() ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯å®ƒæŒ‰ç…§æ•°ç»„ç´¢å¼•ä»é«˜åˆ°ä½ï¼ˆä»å³åˆ°å·¦ï¼‰å¤„ç†æ•°ç»„ï¼Œè€Œä¸æ˜¯ä»ä½åˆ°é«˜ã€‚å¦‚æœ reduction æ“ä½œçš„ä¼˜å…ˆé¡ºåºæ˜¯ä»å³åˆ°å·¦ï¼Œä½ å¯èƒ½æƒ³ä½¿ç”¨å®ƒï¼Œä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">// Compute 2^(3^4).  Exponentiation has right-to-left precedence
let a = [2, 3, 4];
a.reduceRight((acc,val) =&gt; Math.pow(val,acc)) // =&gt; 2.4178516392292583e+24
</code></pre>

<p>æ³¨æ„ï¼Œreduce() å’Œ reduceRight() éƒ½èƒ½æ¥æ”¶ä¸€ä¸ªå¯é€‰çš„å®å‚ï¼Œå®ƒæŒ‡å®šäº†åŒ–ç®€å‡½æ•°è°ƒç”¨æ—¶çš„ this å…³é”®å­—çš„å€¼ã€‚å¯é€‰çš„åˆå§‹å€¼å®å‚ä»ç„¶éœ€è¦å ä¸€ä¸ªä½ç½®ã€‚å¦‚æœæƒ³è®©åŒ–ç®€å‡½æ•°ä½œä¸ºä¸€ä¸ªç‰¹æ®Šå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ï¼Œè¯·å‚çœ‹ Function.bind() æ–¹æ³•ï¼ˆÂ§8.7.5ï¼‰ã€‚</p>

<p>ä¸ºäº†ç®€å•èµ·è§ï¼Œåˆ°ç›®å‰ä½ç½®æ‰€å±•ç¤ºçš„ä¾‹å­éƒ½æ˜¯æ•°å€¼çš„ï¼Œä½†æ•°å­¦è®¡ç®—ä¸æ˜¯ reduce() å’Œ reduceRight() çš„å”¯ä¸€æ„å›¾ã€‚ä»»ä½•æƒ³è¦å°†ä¸¤ä¸ªç›¸åŒç±»å‹çš„å€¼ï¼ˆä¾‹å¦‚ä¸¤ä¸ªå¯¹è±¡ï¼‰åˆå¹¶åˆ°ä¸€ä¸ªå€¼çš„å‡½æ•°éƒ½å¯ä»¥ç”¨åŒ–ç®€å‡½æ•°ã€‚å¦ä¸€æ–¹é¢ï¼Œä½¿ç”¨æ•°ç»„åŒ–ç®€çš„ç®—æ³•å¯èƒ½å¾ˆå¿«å˜å¾—å¤æ‚ä¸”éš¾ä»¥ç†è§£ï¼Œå¯èƒ½ä¼šå‘ç°ï¼Œå¦‚æœä½¿ç”¨å¸¸è§„å¾ªç¯æ„é€ æ¥å¤„ç†æ•°ç»„åˆ™æ›´å®¹æ˜“è¯»ã€å†™å’Œæ¨ç†ã€‚</p>

<h3 id="toc_20">7.8.2 ç”¨ flat() å’Œ flatMap() å±•å¹³æ•°ç»„</h3>

<p>åœ¨ ES2019 ä¸­ï¼Œflat() æ–¹æ³•åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œè¯¥æ•°ç»„åŒ…å«ä¸è°ƒç”¨çš„æ•°ç»„ç›¸åŒçš„å…ƒç´ ï¼Œåªä¸è¿‡ä½œä¸ºæ•°ç»„çš„ä»»ä½•å…ƒç´ éƒ½&quot;å±•å¹³&quot;åˆ°è¿”å›çš„æ•°ç»„ä¸­ã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">[1, [2, 3]].flat()    // =&gt; [1, 2, 3]
[1, [2, [3]]].flat()  // =&gt; [1, 2, [3]]
</code></pre>

<p>å½“è°ƒç”¨æ—¶æ²¡æœ‰å®å‚ï¼Œflat() å°†å¹³å±•ä¸€ä¸ªçº§åˆ«çš„åµŒå¥—ã€‚ä½œä¸ºæ•°ç»„çš„åŸå§‹æ•°ç»„çš„å…ƒç´ è¢«å±•å¹³ï¼Œä½†è¿™äº›æ•°ç»„çš„æ•°ç»„å…ƒç´ ä¸ä¼šå±•å¹³ã€‚å¦‚æœè¦å±•å¹³æ›´å¤šçº§åˆ«ï¼Œéœ€è¦ä¼ é€’æ•°å­—ç»™ flat()ï¼š</p>

<pre><code class="language-javascript">let a = [1, [2, [3, [4]]]];
a.flat(1)   // =&gt; [1, 2, [3, [4]]]
a.flat(2)   // =&gt; [1, 2, 3, [4]]
a.flat(3)   // =&gt; [1, 2, 3, 4]
a.flat(4)   // =&gt; [1, 2, 3, 4]
</code></pre>

<p>flatMap() æ–¹æ³•çš„å·¥ä½œæ–¹å¼ä¸ map() æ–¹æ³•ï¼ˆè§â€œmap()â€ï¼‰ç±»ä¼¼ï¼Œåªä¸è¿‡è¿”å›çš„æ•°ç»„ä¼šè‡ªåŠ¨å±•å¹³ï¼Œå°±åƒä¼ é€’åˆ° flat()ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨ a.flatMap(f) ä¸ a.map(f).flat()ï¼ˆä½†æ›´é«˜æ•ˆï¼‰ç›¸åŒï¼š</p>

<pre><code class="language-javascript">let phrases = [&quot;hello world&quot;, &quot;the definitive guide&quot;];
let words = phrases.flatMap(phrase =&gt; phrase.split(&quot; &quot;));
words // =&gt; [&quot;hello&quot;, &quot;world&quot;, &quot;the&quot;, &quot;definitive&quot;, &quot;guide&quot;];
</code></pre>

<p>å¯ä»¥å°† flatMap() è§†ä¸º map() çš„æ³›åŒ–ï¼Œå®ƒå…è®¸è¾“å…¥æ•°ç»„çš„æ¯ä¸ªå…ƒç´ æ˜ å°„åˆ°è¾“å‡ºæ•°ç»„çš„å¤šä¸ªå…ƒç´ ã€‚ç‰¹åˆ«çš„æ˜¯ï¼ŒflatMap() å…è®¸å°†è¾“å…¥å…ƒç´ æ˜ å°„åˆ°ç©ºæ•°ç»„ï¼Œè¯¥æ•°ç»„åœ¨å¹³å±•åä¸è¾“å‡ºåˆ°æ•°ç»„ä¸­ï¼š</p>

<pre><code class="language-javascript">// Map non-negative numbers to their square roots
[-2, -1, 1, 2].flatMap(x =&gt; x &lt; 0 ? [] : Math.sqrt(x)) // =&gt; [1, 2**0.5]
</code></pre>

<h3 id="toc_21">7.8.3 ç”¨ concat() æ·»åŠ æ•°ç»„</h3>

<p>concat() æ–¹æ³•åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå®ƒçš„å…ƒç´ åŒ…æ‹¬è°ƒç”¨ concat() çš„åŸå§‹æ•°ç»„çš„å…ƒç´ å’Œ concat() çš„æ¯ä¸ªå®å‚ã€‚å¦‚æœè¿™äº›å®å‚ä¸­çš„ä»»ä½•ä¸€ä¸ªè‡ªèº«æ˜¯æ•°ç»„ï¼Œåˆ™è¿æ¥çš„æ˜¯æ•°ç»„çš„å…ƒç´ ï¼Œè€Œéæ•°ç»„æœ¬èº«ã€‚ä½†è¦æ³¨æ„ï¼Œconcat() ä¸ä¼šé€’å½’æ‰å¹³åŒ–æ•°ç»„çš„æ•°ç»„ã€‚concat() ä¹Ÿä¸ä¼šä¿®æ”¹è°ƒç”¨çš„æ•°ç»„ï¼š</p>

<pre><code class="language-javascript">let a = [1,2,3];
a.concat(4, 5)          // =&gt; [1,2,3,4,5]
a.concat([4,5],[6,7])   // =&gt; [1,2,3,4,5,6,7]; arrays are flattened
a.concat(4, [5,[6,7]])  // =&gt; [1,2,3,4,5,[6,7]]; but not nested arrays
a                       // =&gt; [1,2,3]; the original array is unmodified
</code></pre>

<p>è¯·æ³¨æ„ï¼Œconcat() åˆ›å»ºè°ƒç”¨æ•°ç»„çš„æ–°å‰¯æœ¬ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™æ˜¯æ­£ç¡®çš„åšæ³•ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªæ˜‚è´µçš„æ“ä½œã€‚å¦‚æœæ‚¨å‘ç°è‡ªå·±ç¼–å†™ä»£ç åƒ <code>a = a.concat(x)</code>ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥è€ƒè™‘ä½¿ç”¨ push() æˆ– splice() ä¿®æ”¹æ•°ç»„ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„æ•°ç»„ã€‚</p>

<h3 id="toc_22">7.8.4  push()ã€pop()ã€shift() å’Œ unshift() ä¸å †æ ˆå’Œé˜Ÿåˆ—</h3>

<p>push() å’Œ pop() æ–¹æ³•å…è®¸å°†æ•°ç»„å½“åšæ ˆæ¥ä½¿ç”¨ã€‚push() æ–¹æ³•åœ¨æ•°ç»„çš„å°¾éƒ¨æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›æ•°ç»„æ–°çš„é•¿åº¦ã€‚pop() æ–¹æ³•åˆ™ç›¸åï¼šå®ƒåˆ é™¤æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå‡å°æ•°ç»„é•¿åº¦å¹¶è¿”å›å®ƒåˆ é™¤çš„å€¼ã€‚æ³¨æ„ï¼Œä¸¤ä¸ªæ–¹æ³•éƒ½ä¿®æ”¹å¹¶æ›¿æ¢åŸå§‹æ•°ç»„è€Œéç”Ÿæˆä¸€ä¸ªä¿®æ”¹ç‰ˆçš„æ–°æ•°ç»„ã€‚ç»„åˆä½¿ç”¨ push() å’Œ pop() èƒ½å¤Ÿç”¨ JavaScript æ•°ç»„å®ç°å…ˆè¿›åå‡ºçš„æ ˆã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">let stack = [];       // stack == []
stack.push(1,2);      // stack == [1,2];
stack.pop();          // stack == [1]; returns 2
stack.push(3);        // stack == [1,3]
stack.pop();          // stack == [1]; returns 3
stack.push([4,5]);    // stack == [1,[4,5]]
stack.pop()           // stack == [1]; returns [4,5]
stack.pop();          // stack == []; returns 1
</code></pre>

<p>push() æ–¹æ³•ä¸å±•å¹³ä¼ å…¥çš„æ•°ç»„ï¼Œä½†å¦‚æœæƒ³è¦å°†æ•°ç»„çš„å…ƒç´ å…¨éƒ¨å‹å…¥å¦å¤–ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ï¼ˆÂ§8.3.4ï¼‰æ¥æ˜¾ç¤ºå±•å¼€ï¼š</p>

<pre><code class="language-javascript">a.push(...values);
</code></pre>

<p>unshift() å’Œ shift() æ–¹æ³•çš„è¡Œä¸ºéå¸¸ç±»ä¼¼äº push() å’Œ pop()ï¼Œä¸ä¸€æ ·çš„æ˜¯å‰è€…æ˜¯åœ¨æ•°ç»„çš„å¤´éƒ¨è€Œéå°¾éƒ¨è¿›è¡Œå…ƒç´ çš„æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚unshift() åœ¨æ•°ç»„çš„å¤´éƒ¨æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œå¹¶å°†å·²å­˜åœ¨çš„å…ƒç´ ç§»åŠ¨åˆ°æ›´é«˜ç´¢å¼•çš„ä½ç½®æ¥è·å¾—è¶³å¤Ÿçš„ç©ºé—´ï¼Œæœ€åè¿”å›æ•°ç»„æ–°çš„é•¿åº¦ã€‚shift() åˆ é™¤æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶å°†å…¶è¿”å›ï¼Œç„¶åæŠŠæ‰€æœ‰éšåçš„å…ƒç´ ä¸‹ç§»ä¸€ä¸ªä½ç½®æ¥å¡«è¡¥æ•°ç»„å¤´éƒ¨çš„ç©ºç¼ºã€‚å¯ä»¥ä½¿ç”¨ unshift() å’Œ shift() å®ç°æ ˆï¼Œä½†å®ƒæ¯”ä½¿ç”¨ push() å’Œ pop() çš„æ•ˆç‡ä½ï¼Œå› ä¸ºæ¯æ¬¡åœ¨æ•°ç»„å¤´éƒ¨æ·»åŠ æˆ–åˆ é™¤å…ƒç´ æ—¶ï¼Œéƒ½éœ€è¦å‘ä¸Šæˆ–å‘ä¸‹ç§»åŠ¨æ•°ç»„å…ƒç´ ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ push() åœ¨æ•°ç»„æœ«å°¾æ·»åŠ å…ƒç´ å¹¶ shift() ä»æ•°ç»„çš„å¤´éƒ¨åˆ é™¤å®ƒä»¬æ¥å®ç°é˜Ÿåˆ—æ•°æ®è§£æ„ï¼š</p>

<pre><code class="language-javascript">let q = [];            // q == []
q.push(1,2);           // q == [1,2]
q.shift();             // q == [2]; returns 1
q.push(3)              // q == [2, 3]
q.shift()              // q == [3]; returns 2
q.shift()              // q == []; returns 3
</code></pre>

<p>unshift() æœ‰ä¸€ä¸ªç‰¹æ€§æ˜¯å€¼å¾—ä¸€æçš„ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—å®ƒä»¤äººæƒŠè®¶ã€‚å°†å¤šä¸ªå®å‚ä¼ å…¥ unshift() æ—¶ï¼Œå®ƒä»¬å°†ä¸€æ¬¡å…¨éƒ¨æ’å…¥ï¼Œè¿™æ„å‘³ç€å®ƒä»¬æœ€ç»ˆåœ¨æ•°ç»„ä¸­çš„é¡ºåºä¸ä¸€æ¬¡æ’å…¥ä¸€ä¸ªå®å‚çš„é¡ºåºæ—¶ä¸åŒçš„ï¼š</p>

<pre><code class="language-javascript">let a = [];            // a == []
a.unshift(1)           // a == [1]
a.unshift(2)           // a == [2, 1]
a = [];                // a == []
a.unshift(1,2)         // a == [1, 2]
</code></pre>

<h3 id="toc_23">7.8.5 slice()ã€splice()ã€fill() å’Œ copyWithin() ä¸å­æ•°ç»„</h3>

<p>æ•°ç»„å®šä¹‰äº†è®¸å¤šåœ¨è¿ç»­åŒºåŸŸï¼Œå­æ•°ç»„æˆ–æ•°ç»„çš„â€œç‰‡æ®µâ€ä¸Šå·¥ä½œçš„æ–¹æ³•ã€‚ ä»¥ä¸‹å„èŠ‚æè¿°äº†æå–ï¼Œæ›¿æ¢ï¼Œå¡«å……å’Œå¤åˆ¶ç‰‡æ®µçš„æ–¹æ³•ã€‚</p>

<h4 id="toc_24">SLICE()</h4>

<p>slice() æ–¹æ³•è¿”å›æŒ‡å®šæ•°ç»„çš„ä¸€ä¸ªç‰‡æ®µæˆ–å­æ•°ç»„ã€‚å®ƒçš„ä¸¤ä¸ªå®å‚åˆ†åˆ«æŒ‡å®šäº†ç‰‡æ®µçš„å¼€å§‹å’Œç»“æŸçš„ä½ç½®ã€‚è¿”å›çš„æ•°ç»„åŒ…å«ç¬¬ä¸€ä¸ªå®å‚æŒ‡å®šçš„ä½ç½®åˆ°ï¼ˆä½†ä¸åŒ…å«ï¼‰ç¬¬äºŒä¸ªå®å‚æŒ‡å®šçš„ä½ç½®ä¹‹é—´çš„æ‰€æœ‰æ•°ç»„å…ƒç´ ã€‚å¦‚æœåªæŒ‡å®šä¸€ä¸ªå®å‚ï¼Œè¿”å›çš„æ•°ç»„å°†åŒ…å«ä»å¼€å§‹ä½ç½®åˆ°æ•°ç»„ç»“å°¾çš„æ‰€æœ‰å…ƒç´ ã€‚å¦‚å®å‚ä¸­å‡ºç°è´Ÿæ•°ï¼Œå®ƒè¡¨ç¤ºç›¸å¯¹äºæ•°ç»„ length çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œå®å‚ -1 æŒ‡å®šäº†æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè€Œ -2 æŒ‡å®šäº†å®ƒå‰é¢çš„å…ƒç´ ã€‚æ³¨æ„ï¼Œslice() ä¸ä¼šä¿®æ”¹è°ƒç”¨çš„æ•°ç»„ã€‚ä¸‹é¢æœ‰ä¸€äº›ç¤ºä¾‹ï¼š</p>

<pre><code class="language-javascript">let a = [1,2,3,4,5];
a.slice(0,3);    // Returns [1,2,3]
a.slice(3);      // Returns [4,5]
a.slice(1,-1);   // Returns [2,3,4]
a.slice(-3,-2);  // Returns [3]
</code></pre>

<h4 id="toc_25">SPLICE()</h4>

<p>splice() æ–¹æ³•æ˜¯åœ¨æ•°ç»„ä¸­æ’å…¥æˆ–åˆ é™¤å…ƒç´ çš„é€šç”¨æ–¹æ³•ã€‚ä¸åŒäº slice() å’Œ concat()ï¼Œsplice() ä¼šä¿®æ”¹è°ƒç”¨çš„æ•°ç»„ã€‚æ³¨æ„ï¼Œsplice() å’Œ slice() æ‹¥æœ‰éå¸¸ç›¸ä¼¼çš„åå­—ï¼Œ ä½†å®ƒä»¬çš„åŠŸèƒ½å´æœ‰æœ¬è´¨çš„åŒºåˆ«ã€‚</p>

<p>splice() èƒ½å¤Ÿä»æ•°ç»„ä¸­åˆ é™¤å…ƒç´ ã€æ’å…¥å…ƒç´ åˆ°æ•°ç»„ä¸­æˆ–è€…åŒæ—¶å®Œæˆè¿™ä¸¤ç§æ“ä½œã€‚åœ¨æ’å…¥æˆ–åˆ é™¤ç‚¹ä¹‹åçš„æ•°ç»„å…ƒç´ ä¼šæ ¹æ®éœ€è¦å¢åŠ æˆ–å‡å°å®ƒä»¬çš„ç´¢å¼•å€¼ï¼Œå› æ­¤æ•°ç»„çš„å…¶ä»–éƒ¨åˆ†ä»ç„¶ä¿æŒè¿ç»­çš„ã€‚splice() çš„ç¬¬ä¸€ä¸ªå®å‚æŒ‡å®šäº†æ’å…¥å’Œï¼ˆæˆ–ï¼‰åˆ é™¤çš„èµ·å§‹ä½ç½®ã€‚ç¬¬äºŒä¸ªå®å‚æŒ‡å®šäº†åº”è¯¥ä»æ•°ç»„ä¸­åˆ é™¤çš„å…ƒç´ çš„ä¸ªæ•°ã€‚ï¼ˆæ³¨æ„è¿™é‡Œæ˜¯è¿™ä¸¤ä¸ªæ–¹æ³•çš„å¦å¤–ä¸€ä¸ªä¸åŒã€‚slice() çš„ç¬¬äºŒä¸ªå®å‚æ˜¯ç»“æŸçš„ä½ç½®ã€‚splice() çš„ç¬¬äºŒä¸ªå®å‚æ˜¯é•¿åº¦ã€‚ï¼‰å¦‚æœçœç•¥ç¬¬äºŒä¸ªå®å‚ï¼Œä»èµ·å§‹ç‚¹å¼€å§‹åˆ°æ•°ç»„ç»“å°¾çš„æ‰€æœ‰å…ƒç´ éƒ½å°†è¢«åˆ é™¤ã€‚splice() è¿”å›ä¸€ä¸ªç”±åˆ é™¤å…ƒç´ ç»„æˆçš„æ•°ç»„ï¼Œæˆ–è€…å¦‚æœæ²¡æœ‰åˆ é™¤å…ƒç´ å°±è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">let a = [1,2,3,4,5,6,7,8];
a.splice(4)    // =&gt; [5,6,7,8]; a is now [1,2,3,4]
a.splice(1,2)  // =&gt; [2,3]; a is now [1,4]
a.splice(1,1)  // =&gt; [4]; a is now [1]
</code></pre>

<p>splice() çš„å‰ä¸¤ä¸ªå®å‚æŒ‡å®šäº†éœ€è¦åˆ é™¤çš„æ•°ç»„å…ƒç´ ã€‚ç´§éšå…¶åçš„ä»»æ„ä¸ªæ•°çš„å®å‚æŒ‡å®šäº†éœ€è¦æ’å…¥åˆ°æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œä»ç¬¬ä¸€ä¸ªå®å‚æŒ‡å®šçš„ä½ç½®å¼€å§‹æ’å…¥ã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">let a = [1,2,3,4,5];
a.splice(2,0,&quot;a&quot;,&quot;b&quot;)  // =&gt; []; a is now [1,2,&quot;a&quot;,&quot;b&quot;,3,4,5]
a.splice(2,2,[1,2],3)  // =&gt; [&quot;a&quot;,&quot;b&quot;]; a is now [1,2,[1,2],3,3,4,5]
</code></pre>

<p>æ³¨æ„ï¼Œä¸åŒäº concat()ï¼Œsplice() æ’å…¥æ•°ç»„æœ¬èº«ï¼Œä¸æ˜¯æ•°ç»„çš„å…ƒç´ ã€‚</p>

<h4 id="toc_26">FILL()</h4>

<p>fill() æ–¹æ³•å°†æ•°ç»„æˆ–æ•°ç»„ç‰‡æ®µçš„å…ƒç´ å¡«å……ä¸ºæŒ‡å®šå€¼ã€‚å®ƒå°†å¯¹è°ƒç”¨å®ƒçš„æ•°ç»„è¿›è¡Œçªå˜ï¼Œå¹¶è¿”å›ä¿®æ”¹åçš„æ•°ç»„ï¼š</p>

<pre><code class="language-javascript">let a = new Array(5);   // Start with no elements and length 5
a.fill(0)               // =&gt; [0,0,0,0,0]; fill the array with zeros
a.fill(9, 1)            // =&gt; [0,9,9,9,9]; fill with 9 starting at index 1
a.fill(8, 2, -1)        // =&gt; [0,9,8,8,9]; fill with 8 at indexes 2, 3
</code></pre>

<p>fill() çš„ç¬¬ä¸€ä¸ªå®å‚æ˜¯å°†æ•°ç»„å…ƒç´ å¡«å……çš„å€¼ã€‚å¯é€‰çš„ç¬¬äºŒä¸ªå®å‚æŒ‡å®šèµ·å§‹ç´¢å¼•ã€‚å¦‚æœçœç•¥ï¼Œåˆ™å¡«å……å°†ä»ç´¢å¼• 0 å¼€å§‹ã€‚å¯é€‰çš„ç¬¬ä¸‰ä¸ªå®å‚æŒ‡å®šç»“æŸç´¢å¼•ï¼Œå°†å¡«å……åˆ°ï¼ˆä½†ä¸åŒ…æ‹¬ï¼‰è¯¥ç´¢å¼•çš„æ•°ç»„å…ƒç´ ã€‚ å¦‚æœçœç•¥æ­¤å®å‚ï¼Œåˆ™ä»èµ·å§‹ç´¢å¼•åˆ°æœ«å°¾å¡«å……æ•°ç»„ã€‚å¯ä»¥é€šè¿‡ä¼ é€’è´Ÿæ•°æ¥æŒ‡å®šç›¸å¯¹äºæ•°ç»„æœ«å°¾çš„ç´¢å¼•ï¼Œå°±åƒ slice() ä¸€æ ·ã€‚</p>

<h4 id="toc_27">COPYWITHIN()</h4>

<p>copyWithin() å°†æ•°ç»„çš„ä¸€ä¸ªç‰‡æ®µå¤åˆ¶åˆ°æ•°ç»„ä¸­çš„æ–°ä½ç½®ã€‚å®ƒåœ¨é€‚å½“çš„ä½ç½®ä¿®æ”¹æ•°ç»„å¹¶è¿”å›ä¿®æ”¹åçš„æ•°ç»„ï¼Œä½†ä¸ä¼šæ›´æ”¹æ•°ç»„çš„é•¿åº¦ã€‚ç¬¬ä¸€ä¸ªå®å‚æŒ‡å®šå°†ç¬¬ä¸€ä¸ªå…ƒç´ å¤åˆ¶åˆ°çš„ç›®æ ‡ç´¢å¼•ã€‚ç¬¬äºŒä¸ªå®å‚æŒ‡å®šè¢«å¤åˆ¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ã€‚å¦‚æœçœç•¥æ­¤ç¬¬äºŒä¸ªå®å‚ï¼Œåˆ™ä½¿ç”¨ 0ã€‚ç¬¬ä¸‰ä¸ªå®å‚æŒ‡å®šè¢«å¤åˆ¶çš„å…ƒç´ ç‰‡æ®µçš„ç»“å°¾ã€‚å¦‚æœçœç•¥ï¼Œåˆ™ä½¿ç”¨æ•°ç»„çš„é•¿åº¦ã€‚ä»å¼€å§‹ç´¢å¼•åˆ°ç»“æŸç´¢å¼•ï¼ˆä½†ä¸åŒ…æ‹¬ç»“æŸç´¢å¼•ï¼‰çš„å…ƒç´ å°†è¢«å¤åˆ¶ã€‚å¯ä»¥é€šè¿‡ä¼ é€’è´Ÿæ•°æ¥æŒ‡å®šç›¸å¯¹äºæ•°ç»„æœ«å°¾çš„ç´¢å¼•ï¼Œå°±åƒ slice() ä¸€æ ·ï¼š</p>

<pre><code class="language-javascript">let a = [1,2,3,4,5];
a.copyWithin(1)       // =&gt; [1,1,2,3,4]: copy array elements up one
a.copyWithin(2, 3, 5) // =&gt; [1,2,3,4,4]: copy last 2 elements to index 2
a.copyWithin(0, -2)   // =&gt; [4,4,3,4,4]: negative offsets work, too
</code></pre>

<p>copyWithin() æ—¨åœ¨ä½œä¸ºä¸€ç§é«˜æ€§èƒ½æ–¹æ³•ï¼Œå¯¹ç±»å‹åŒ–æ•°ç»„ç‰¹åˆ«æœ‰ç”¨ï¼ˆè¯·å‚è§ Â§11.2ï¼‰ã€‚å®ƒæ¨¡ä»¿çš„ C æ ‡å‡†åº“ä¸­ memmove() å‡½æ•°ã€‚ è¯·æ³¨æ„ï¼Œå³ä½¿æºåŒºåŸŸå’Œç›®æ ‡åŒºåŸŸä¹‹é—´å­˜åœ¨é‡å ï¼Œè¯¥æ‹·è´ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>

<h3 id="toc_28">7.8.6 æ•°ç»„çš„æŸ¥è¯¢å’Œæ’åºæ–¹æ³•</h3>

<p>æ•°ç»„å®ç° indexOf()ã€lastIndexOf() å’Œ include() æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ç±»ä¼¼äºåç§°ç›¸åŒçš„å­—ç¬¦ä¸²æ–¹æ³•ã€‚è¿˜æœ‰ sort() å’Œ reverse() æ–¹æ³•ï¼Œç”¨äºå¯¹æ•°ç»„å…ƒç´ è¿›è¡Œé‡æ–°æ’åºã€‚è¿™äº›æ–¹æ³•åœ¨ä¸‹é¢çš„å°èŠ‚ä¸­ä»‹ç»ã€‚</p>

<h4 id="toc_29">INDEXOF() å’Œ LASTINDEXOF()</h4>

<p>indexOf() å’Œ lastIndexOf() åœ¨æ•°ç»„ä¸­æœç´¢å…·æœ‰æŒ‡å®šå€¼çš„å…ƒç´ ï¼Œå¹¶è¿”å›æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œåˆ™è¿”å› -1ã€‚indexOf() ä»å¤´åˆ°å°¾æœç´¢æ•°ç»„ï¼ŒlastIndexOf() ä»å°¾åˆ°å¤´æœç´¢ï¼š</p>

<pre><code class="language-javascript">let a = [0,1,2,1,0];
a.indexOf(1)       // =&gt; 1: a[1] is 1
a.lastIndexOf(1)   // =&gt; 3: a[3] is 1
a.indexOf(3)       // =&gt; -1: no element has value 3
</code></pre>

<p>indexOf() å’Œ lastIndexOf() ä½¿ç”¨ === è¿ç®—ç¬¦å°†å…¶å®å‚ä¸æ•°ç»„å…ƒç´ è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœæ•°ç»„åŒ…å«å¯¹è±¡è€Œä¸æ˜¯åŸå§‹å€¼ï¼Œåˆ™è¿™äº›æ–¹æ³•å°†æ£€æŸ¥ä¸¤ä¸ªå¼•ç”¨æ˜¯å¦éƒ½æŒ‡å‘å®Œå…¨ç›¸åŒçš„å¯¹è±¡ã€‚å¦‚æœè¦å®é™…æŸ¥çœ‹å¯¹è±¡çš„å†…å®¹ï¼Œå°è¯•å°† find() æ–¹æ³•ä»£æ›¿è‡ªå®šä¹‰çš„æ–­è¨€å‡½æ•°ã€‚</p>

<p>indexOf() å’Œ lastIndexOf() é‡‡ç”¨å¯é€‰çš„ç¬¬äºŒä¸ªå®å‚ï¼Œè¯¥å®å‚æŒ‡å®šå¼€å§‹æœç´¢çš„æ•°ç»„ç´¢å¼•ã€‚å¦‚æœçœç•¥æ­¤å‚æ•°ï¼Œåˆ™ indexOf() ä»å¼€å¤´å¼€å§‹ï¼ŒlastIndexOf() ä»ç»“å°¾å¼€å§‹ã€‚ç¬¬äºŒä¸ªå‚æ•°å…è®¸ä½¿ç”¨è´Ÿå€¼ï¼Œå¹¶å°†å…¶è§†ä¸ºè·æ•°ç»„æœ«ç«¯çš„åç§»é‡ï¼Œå°±åƒ slice() æ–¹æ³•ä¸€æ ·ï¼šä¾‹å¦‚ï¼Œå€¼ â€“1 æŒ‡å®šæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p>

<p>ä»¥ä¸‹å‡½æ•°åœ¨æ•°ç»„ä¸­æœç´¢æŒ‡å®šçš„å€¼ï¼Œå¹¶è¿”å›æ‰€æœ‰åŒ¹é…ç´¢å¼•çš„æ•°ç»„ã€‚è¿™æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ indexOf() çš„ç¬¬äºŒä¸ªå‚æ•°æ¥æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå‚æ•°ä¹‹å¤–çš„åŒ¹é…é¡¹ã€‚</p>

<pre><code class="language-javascript">// Find all occurrences of a value x in an array a and return an array
// of matching indexes
function findall(a, x) {
    let results = [],            // The array of indexes we&#39;ll return
        len = a.length,          // The length of the array to be searched
        pos = 0;                 // The position to search from
    while(pos &lt; len) {           // While more elements to search...
        pos = a.indexOf(x, pos); // Search
        if (pos === -1) break;   // If nothing found, we&#39;re done.
        results.push(pos);       // Otherwise, store index in array
        pos = pos + 1;           // And start next search at next element
    }
    return results;              // Return array of indexes
}
</code></pre>

<p>è¯·æ³¨æ„ï¼Œå­—ç¬¦ä¸²å…·æœ‰ indexOf() å’Œ lastIndexOf() æ–¹æ³•ï¼Œå®ƒä»¬ä¸è¿™äº›æ•°ç»„æ–¹æ³•ä¸€æ ·å·¥ä½œï¼Œä¸åŒä¹‹å¤„åœ¨äºç¬¬äºŒä¸ªå®å‚æ˜¯è´Ÿæ•°æ—¶è¢«è§†ä¸ºé›¶ã€‚</p>

<h4 id="toc_30">INCLUDES()</h4>

<p>ES2016 çš„ includes() æ–¹æ³•é‡‡ç”¨å•ä¸ªå®å‚ï¼Œå¦‚æœæ•°ç»„åŒ…å«è¯¥å€¼è¿”å› true å¦åˆ™ falseã€‚å®ƒä¸ä¼šå‘Šè¯‰ä½ å€¼çš„ç´¢å¼•ï¼Œåªå‘Šè¯‰ä½ è¯¥å€¼æ˜¯å¦å­˜åœ¨ã€‚includes() æ–¹æ³•å®é™…ä¸Šæ˜¯æ•°ç»„é›†çš„æˆå‘˜èº«ä»½æµ‹è¯•ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œæ•°ç»„ä¸æ˜¯ Set çš„é«˜æ•ˆè¡¨ç¤ºå½¢å¼ï¼Œå¦‚æœä½¿ç”¨å¤šä¸ªå…ƒç´ ï¼Œåˆ™åº”ä½¿ç”¨çœŸæ­£çš„ Set å¯¹è±¡ï¼ˆÂ§11.1.1ï¼‰ã€‚</p>

<p>includes() æ–¹æ³•åœ¨ä¸€ä¸ªé‡è¦æ–¹é¢ä¸ indexOf() æ–¹æ³•ç•¥æœ‰ä¸åŒã€‚indexOf() ä¸ === è¿ç®—ç¬¦ä½¿ç”¨ç›¸åŒçš„ç®—æ³•æµ‹è¯•ç›¸ç­‰æ€§ï¼Œå¹¶ä¸”è¿™ä¸ªç›¸ç­‰ç®—æ³•è®¤ä¸ºéæ•°å­—å€¼ä¸æ‰€æœ‰å…¶ä»–å€¼ï¼ˆåŒ…æ‹¬è‡ªèº«ï¼‰ä¸åŒã€‚includes() ä½¿ç”¨ç•¥æœ‰ä¸åŒçš„ç›¸ç­‰ç®—æ³•ï¼Œå®ƒè®¤ä¸º NaN ç­‰äºè‡ªèº«ã€‚è¿™æ„å‘³ç€ indexOf() ä¸ä¼šæ£€æµ‹æ•°ç»„ä¸­çš„ NaN å€¼ï¼Œä½† includes() å¯ä»¥ï¼š</p>

<pre><code class="language-javascript">let a = [1,true,3,NaN];
a.includes(true)            // =&gt; true
a.includes(2)               // =&gt; false
a.includes(NaN)             // =&gt; true
a.indexOf(NaN)              // =&gt; -1; indexOf can&#39;t find NaN
</code></pre>

<h4 id="toc_31">SORT()</h4>

<p>sort() å¯¹æ•°ç»„çš„å…ƒç´ ç›´æ¥è¿›è¡Œæ’åºï¼Œå¹¶è¿”å›æ’åºåçš„æ•°ç»„ã€‚å½“è°ƒç”¨ sort() æ—¶ï¼Œå®ƒä¼šæŒ‰å­—æ¯é¡ºåºå¯¹æ•°ç»„å…ƒç´ è¿›è¡Œæ’åºï¼ˆå¦‚æœ‰å¿…è¦ï¼Œæš‚æ—¶å°†å®ƒä»¬è½¬æ¢ä¸ºå­—ç¬¦ä¸²ä»¥æ‰§è¡Œæ¯”è¾ƒï¼‰ï¼š</p>

<pre><code class="language-javascript">let a = [&quot;banana&quot;, &quot;cherry&quot;, &quot;apple&quot;];
a.sort(); // a == [&quot;apple&quot;, &quot;banana&quot;, &quot;cherry&quot;]
</code></pre>

<p>å¦‚æœæ•°ç»„ä¸­åŒ…å« undefined å…ƒç´ ï¼Œå®ƒä»¬ä¼šè¢«æ”¾åœ¨æ•°ç»„çš„ç»“å°¾ã€‚</p>

<p>è‹¥è¦å°†æ•°ç»„æŒ‰å­—æ¯é¡ºåºä»¥å¤–çš„é¡ºåºæ’åºï¼Œå¿…é¡»å°†æ¯”è¾ƒå‡½æ•°ä½œä¸ºå®å‚ä¼ é€’ç»™ sort()ã€‚è¯¥å‡½æ•°å†³å®šäº†å®ƒçš„ä¸¤ä¸ªå®å‚åœ¨æ’å¥½åºçš„æ•°ç»„ä¸­çš„å…ˆåé¡ºåºã€‚å‡è®¾ç¬¬ä¸€ä¸ªå®å‚åº”è¯¥åœ¨å‰ï¼Œæ¯”è¾ƒå‡½æ•°åº”è¯¥è¿”å›ä¸€ä¸ªå°äº 0 çš„æ•°å€¼ã€‚åä¹‹ï¼Œå‡è®¾ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥åœ¨åï¼Œå‡½æ•°åº”è¯¥è¿”å›ä¸€ä¸ªå¤§äº 0 çš„æ•°å€¼ã€‚å¹¶ä¸”ï¼Œå‡è®¾ä¸¤ä¸ªå€¼ç›¸ç­‰ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬çš„é¡ºåºæ— å…³ç´§è¦ï¼‰ï¼Œå‡½æ•°åº”è¯¥è¿”å› 0ã€‚ä¾‹å¦‚ï¼Œç”¨æ•°å€¼å¤§å°è€Œéå­—æ¯è¡¨é¡ºåºè¿›è¡Œæ•°ç»„æ’åºï¼Œä»£ç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-javascript">let a = [33, 4, 1111, 222];
a.sort();               // a == [1111, 222, 33, 4]; alphabetical order
a.sort(function(a,b) {  // Pass a comparator function
    return a-b;         // Returns &lt; 0, 0, or &gt; 0, depending on order
});                     // a == [4, 33, 222, 1111]; numerical order
a.sort((a,b) =&gt; b-a);   // a == [1111, 222, 33, 4]; reverse numerical order
</code></pre>

<p>å¦å¤–ä¸€ä¸ªæ•°ç»„å…ƒç´ æ’åºçš„ä¾‹å­ï¼Œä¹Ÿè®¸éœ€è¦å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„æ‰§è¡Œä¸åŒºåˆ†å¤§å°å†™çš„å­—æ¯è¡¨æ’åºï¼Œæ¯”è¾ƒå‡½æ•°é¦–å…ˆå°†å®å‚éƒ½è½¬åŒ–ä¸ºå°å†™å­—ç¬¦ä¸²ï¼ˆä½¿ç”¨ toLowerCase() æ–¹æ³•ï¼‰ï¼Œå†å¼€å§‹æ¯”è¾ƒï¼š</p>

<pre><code class="language-javascript">let a = [&quot;ant&quot;, &quot;Bug&quot;, &quot;cat&quot;, &quot;Dog&quot;];
a.sort();    // a == [&quot;Bug&quot;,&quot;Dog&quot;,&quot;ant&quot;,&quot;cat&quot;]; case-sensitive sort
a.sort(function(s,t) {
    let a = s.toLowerCase();
    let b = t.toLowerCase();
    if (a &lt; b) return -1;
    if (a &gt; b) return 1;
    return 0;
});   // a == [&quot;ant&quot;,&quot;Bug&quot;,&quot;cat&quot;,&quot;Dog&quot;]; case-insensitive sort
</code></pre>

<h4 id="toc_32">REVERSE()</h4>

<p>reverse() æ–¹æ³•åè½¬æ•°ç»„ä¸­å…ƒç´ çš„é¡ºåºå¹¶è¿”å›åè½¬åçš„æ•°ç»„ã€‚å®ƒç›´æ¥åœ¨æ•°ç»„ä¸­æ“ä½œï¼Œæ¢ä¸€ç§è¯´æ³•ï¼Œå®ƒä¸åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œå®ƒä¸åˆ›å»ºä¸€ä¸ªæ–°çš„å¸¦æœ‰æ’åºåçš„å…ƒç´ çš„æ•°ç»„ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å·²å­˜åœ¨çš„æ•°ç»„ä¸­è¿›è¡Œæ’åºã€‚</p>

<pre><code class="language-javascript">let a = [1,2,3];
a.reverse();   // a == [3,2,1]
</code></pre>

<h3 id="toc_33">7.8.7 æ•°ç»„è½¬åŒ–å­—ç¬¦ä¸²</h3>

<p>Array ç±»å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•æ¥å°†æ•°ç»„è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œé€šå¸¸åœ¨åˆ›å»ºæ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯æ—¶ä¼šç”¨åˆ°ã€‚ï¼ˆå¦‚æœè¦ä»¥æ–‡æœ¬å½¢å¼ä¿å­˜æ•°ç»„çš„å†…å®¹ä¾›ä»¥åé‡ç”¨ï¼Œè¯·ä½¿ç”¨ JSON.stringify()ï¼ˆÂ§6.8ï¼‰åºåˆ—åŒ–æ•°ç»„ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ­¤å¤„æè¿°çš„æ–¹æ³•ã€‚ï¼‰</p>

<p>join() æ–¹æ³•å°†æ•°ç»„çš„æ‰€æœ‰å…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶è¿æ¥å®ƒä»¬ï¼Œè¿”å›ç”Ÿæˆçš„å­—ç¬¦ä¸²ã€‚å¯ä»¥æŒ‡å®šä¸€ä¸ªå¯é€‰å­—ç¬¦ä¸²æ¥åˆ†éš”ç”Ÿæˆçš„å­—ç¬¦ä¸²ä¸­çš„å…ƒç´ ã€‚å¦‚æœæœªæŒ‡å®šåˆ†éš”ç¬¦å­—ç¬¦ä¸²ï¼Œåˆ™ä½¿ç”¨é€—å·ï¼š</p>

<pre><code class="language-javascript">let a = [1, 2, 3];
a.join()               // =&gt; &quot;1,2,3&quot;
a.join(&quot; &quot;)            // =&gt; &quot;1 2 3&quot;
a.join(&quot;&quot;)             // =&gt; &quot;123&quot;
let b = new Array(10); // An array of length 10 with no elements
b.join(&quot;-&quot;)            // =&gt; &quot;---------&quot;: a string of 9 hyphens
</code></pre>

<p>join() æ–¹æ³•æ˜¯ String.split() æ–¹æ³•çš„åå‘æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šè¿‡å°†å­—ç¬¦ä¸²æ‹†åˆ†ä¸ºå¤šä¸ªç‰‡æ®µæ¥åˆ›å»ºæ•°ç»„ã€‚</p>

<p>æ•°ç»„ä¸æ‰€æœ‰ JavaScript å¯¹è±¡ä¸€æ ·ï¼Œå…·æœ‰ toString() æ–¹æ³•ã€‚å¯¹äºæ•°ç»„ï¼Œæ­¤æ–¹æ³•çš„å·¥ä½œæ–¹å¼ä¸æ²¡æœ‰å‚æ•°çš„ join() æ–¹æ³•ç›¸åŒï¼š</p>

<pre><code class="language-javascript">[1,2,3].toString()          // =&gt; &quot;1,2,3&quot;
[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;].toString()  // =&gt; &quot;a,b,c&quot;
[1, [2,&quot;c&quot;]].toString()     // =&gt; &quot;1,2,c&quot;
</code></pre>

<p>è¯·æ³¨æ„ï¼Œè¾“å‡ºä¸åŒ…æ‹¬æ–¹æ‹¬å·æˆ–æ•°ç»„å€¼å‘¨å›´çš„ä»»ä½•å…¶ä»–åˆ†éš”ç¬¦ã€‚</p>

<p>toLocaleString() æ˜¯ toString() çš„æœ¬åœ°åŒ–ç‰ˆæœ¬ã€‚å®ƒé€šè¿‡è°ƒç”¨å…ƒç´ çš„ toLocaleString() æ–¹æ³•å°†æ¯ä¸ªæ•°ç»„å…ƒç´ è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åä½¿ç”¨ç‰¹å®šäºåŒºåŸŸè®¾ç½®ï¼ˆå’Œå®ç°å®šä¹‰ï¼‰åˆ†éš”ç¬¦å­—ç¬¦ä¸²è¿æ¥ç”Ÿæˆçš„å­—ç¬¦ä¸²ã€‚</p>

<h3 id="toc_34">7.8.8 Array çš„é™æ€æ–¹æ³•</h3>

<p>é™¤äº†æˆ‘ä»¬å·²ç»è®°å½•çš„æ•°ç»„æ–¹æ³•ä¹‹å¤–ï¼ŒArray ç±»è¿˜å®šä¹‰äº†ä¸‰ä¸ªé™æ€å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ Array æ„é€ å‡½æ•°è€Œä¸æ˜¯æ•°ç»„è°ƒç”¨ã€‚Array.of() å’Œ Array.from() æ˜¯ç”¨äºåˆ›å»ºæ–°æ•°ç»„çš„å·¥å‚æ–¹æ³•ã€‚å®ƒä»¬è®°å½•åœ¨ Â§7.1.4 å’Œ Â§7.1.5 ä¸­ã€‚</p>

<p>å¦å¤–ä¸€ä¸ªé™æ€æ•°ç»„æ–¹æ³•æ˜¯ Array.isArray()ï¼Œç”¨æ¥åˆ¤æ–­ä¸€ä¸ªæœªçŸ¥å€¼æ˜¯å¦æ˜¯æ•°ç»„ï¼š</p>

<pre><code class="language-javascript">Array.isArray([])     // =&gt; true
Array.isArray({})     // =&gt; false
</code></pre>

<h2 id="toc_35">7.9 ç±»æ•°ç»„å¯¹è±¡</h2>

<p>æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼ŒJavaScript æ•°ç»„çš„æœ‰ä¸€äº›ç‰¹æ€§æ˜¯å…¶ä»–å¯¹è±¡æ‰€æ²¡æœ‰çš„ï¼š</p>

<ul>
<li>å½“æœ‰æ–°çš„å…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨ä¸­æ—¶ï¼Œè‡ªåŠ¨æ›´æ–° length å±æ€§ã€‚</li>
<li>length è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒå°å€¼å°†æˆªæ–­æ•°ç»„ã€‚</li>
<li>ä» Array.prototype ä¸­ç»§æ‰¿ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•ã€‚</li>
<li>æ•°ç»„ä¼ å…¥ Array.isArray() æ–¹æ³•è¿”å› trueã€‚</li>
</ul>

<p>è¿™äº›ç‰¹æ€§è®© JavaScript æ•°ç»„å’Œå¸¸è§„çš„å¯¹è±¡æœ‰æ˜æ˜¾çš„åŒºåˆ«ã€‚ä½†æ˜¯å®ƒä»¬ä¸æ˜¯å®šä¹‰æ•°ç»„çš„æœ¬è´¨ç‰¹æ€§ã€‚ä¸€ç§å¸¸å¸¸å®Œå…¨åˆç†çš„çœ‹æ³•æ˜¯æŠŠæ‹¥æœ‰ä¸€ä¸ªæ•°å€¼å‹ length å±æ€§å’Œå¯¹åº”éè´Ÿæ•´æ•°å±æ€§çš„å¯¹è±¡çœ‹ä½œæ•°ç»„çš„åŒç±»ã€‚</p>

<p>å®é™…ä¸Šè¿™äº›â€œç±»æ•°ç»„â€å¯¹è±¡åœ¨å®è·µä¸­å¶å°”å‡ºç°ï¼Œè™½ç„¶ä¸èƒ½é€šè¿‡å®ƒä»¬ç›´æ¥è°ƒç”¨æ•°ç»„æ–¹æ³•æˆ–è€…æœŸæœ› length å±æ€§æœ‰ä»€ä¹ˆç‰¹æ®Šçš„è¡Œä¸ºï¼Œä½†æ˜¯ä»ç„¶å¯ä»¥ç”¨é’ˆå¯¹çœŸæ­£æ•°ç»„éå†ä»£ç æ¥éå†å®ƒä»¬ã€‚ç»“è®ºå°±æ˜¯å¾ˆå¤šæ•°ç»„ç®—æ³•é’ˆå¯¹ç±»æ•°ç»„å¯¹è±¡åŒæ ·å¥æ•ˆï¼Œå°±åƒé’ˆå¯¹çœŸæ­£çš„æ•°ç»„ä¸€æ ·ã€‚å°¤å…¶æ˜¯è¿™ç§æƒ…å†µï¼Œç®—æ³•æŠŠæ•°ç»„çœ‹æˆåªè¯»çš„æˆ–è€…å¦‚æœä¿æŒæ•°ç»„é•¿åº¦ä¸å˜ã€‚</p>

<p>ä»¥ä¸‹ä»£ç ä¸ºä¸€ä¸ªå¸¸è§„å¯¹è±¡å¢åŠ äº†ä¸€äº›å±æ€§ä½¿å…¶å˜æˆç±»æ•°ç»„å¯¹è±¡ï¼Œç„¶åéå†ç”Ÿæˆçš„ä¼ªæ•°ç»„çš„â€œå…ƒç´ â€ï¼š</p>

<pre><code class="language-javascript">let a = {};  // Start with a regular empty object

// Add properties to make it &quot;array-like&quot;
let i = 0;
while(i &lt; 10) {
    a[i] = i * i;
    i++;
}
a.length = i;

// Now iterate through it as if it were a real array
let total = 0;
for(let j = 0; j &lt; a.length; j++) {
    total += a[j];
}
</code></pre>

<p>åœ¨å®¢æˆ·ç«¯ JavaScript ä¸­ï¼Œå¾ˆå¤šä½œç”¨äº HTML documents çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ document.querySelectorAll()ï¼‰è¿”å›ç±»æ•°ç»„å¯¹è±¡ã€‚ä¸‹é¢è¿™ä¸ªå‡½æ•°å¯èƒ½ä¼šç”¨äºæµ‹è¯•å¯¹è±¡æ˜¯å¦å¯ä»¥ç”¨ä½œç±»æ•°ç»„ï¼š</p>

<pre><code class="language-javascript">// Determine if o is an array-like object.
// Strings and functions have numeric length properties, but are
// excluded by the typeof test. In client-side JavaScript, DOM text
// nodes have a numeric length property, and may need to be excluded
// with an additional o.nodeType !== 3 test.
function isArrayLike(o) {
    if (o &amp;&amp;                            // o is not null, undefined, etc.
        typeof o === &quot;object&quot; &amp;&amp;        // o is an object
        Number.isFinite(o.length) &amp;&amp;    // o.length is a finite number
        o.length &gt;= 0 &amp;&amp;                // o.length is non-negative
        Number.isInteger(o.length) &amp;&amp;   // o.length is an integer
        o.length &lt; 4294967295) {        // o.length &lt; 2^32 - 1
        return true;                    // Then o is array-like.
    } else {
        return false;                   // Otherwise it is not.
    }
}
</code></pre>

<p>æˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚çœ‹åˆ°å­—ç¬¦ä¸²çš„è¡Œä¸ºåƒæ•°ç»„ä¸€æ ·ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå¯¹äºæ•°ç»„è¿™ç§æµ‹è¯•ï¼ˆå¯¹å­—ç¬¦ä¸²é€šå¸¸è¿”å› false ï¼‰å®ƒä»¬é€šå¸¸æœ€å¥½ä½œä¸ºå­—ç¬¦ä¸²å¤„ç†ï¼Œè€Œä¸æ˜¯ä½œä¸ºæ•°ç»„å¤„ç†ã€‚</p>

<p>å¤§å¤šæ•° JavaScript æ•°ç»„æ–¹æ³•éƒ½ç‰¹æ„å®šä¹‰ä¸ºæ³›å‹ï¼Œä»¥ä¾¿å®ƒä»¬åœ¨åº”ç”¨äºé™¤æ•°ç»„ä¹‹å¤–çš„ç±»æ•°ç»„å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ç”±äºç±»æ•°ç»„å¯¹è±¡ä¸ä¼šä» Array.prototype ç»§æ‰¿ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥åœ¨å®ƒä»¬ä¸Šè°ƒç”¨æ•°ç»„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ Function.call æ–¹æ³•é—´æ¥è°ƒç”¨å®ƒä»¬ï¼ˆè¯¦æƒ…è¯·å‚é˜… Â§8.7.4ï¼‰ï¼š</p>

<pre><code class="language-javascript">let a = {&quot;0&quot;: &quot;a&quot;, &quot;1&quot;: &quot;b&quot;, &quot;2&quot;: &quot;c&quot;, length: 3}; // An array-like object
Array.prototype.join.call(a, &quot;+&quot;)                  // =&gt; &quot;a+b+c&quot;
Array.prototype.map.call(a, x =&gt; x.toUpperCase())  // =&gt; [&quot;A&quot;,&quot;B&quot;,&quot;C&quot;]
Array.prototype.slice.call(a, 0)   // =&gt; [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]: true array copy
Array.from(a)                      // =&gt; [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]: easier array copy
</code></pre>

<p>æ­¤ä»£ç å€’æ•°ç¬¬äºŒè¡Œè°ƒç”¨æ•°ç»„ç±»å¯¹è±¡ä¸Šçš„ Array slice() æ–¹æ³•ï¼Œä»¥ä¾¿å°†è¯¥å¯¹è±¡çš„å…ƒç´ å¤åˆ¶åˆ°çœŸæ­£çš„æ•°ç»„å¯¹è±¡ä¸­ã€‚è¿™æ˜¯ä¸€ä¸ªæƒ¯ç”¨çš„æŠ€å·§ï¼Œå­˜åœ¨äºè®¸å¤šæ—§ä»£ç ä¸­ï¼Œä½†ç°åœ¨ä½¿ç”¨ Array.from() è¦å®¹æ˜“å¾—å¤šã€‚</p>

<h2 id="toc_36">7.10 ä½œä¸ºæ•°ç»„çš„å­—ç¬¦ä¸²</h2>

<p>JavaScript å­—ç¬¦ä¸²çš„è¡Œä¸ºç±»ä¼¼äº UTF-16 Unicode å­—ç¬¦çš„åªè¯»æ•°ç»„ã€‚å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·æ›¿ä»£ charAt() æ–¹æ³•è®¿é—®å•ä¸ªå­—ç¬¦ï¼š</p>

<pre><code class="language-javascript">let s = &quot;test&quot;;
s.charAt(0)    // =&gt; &quot;t&quot;
s[1]           // =&gt; &quot;e&quot;
</code></pre>

<p>å½“ç„¶ï¼Œå­—ç¬¦ä¸²ä½¿ç”¨ typeof è¿ç®—ç¬¦ä»ç„¶è¿”å› &quot;string&quot;ï¼Œå¦‚æœå°†å­—ç¬¦ä¸²ä¼ é€’ç»™ Array.isArray() æ–¹æ³•ï¼Œåˆ™è¿”å› falseã€‚</p>

<p>å¯ç´¢å¼•å­—ç¬¦ä¸²çš„ä¸»è¦å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ–¹æ‹¬å·æ›¿æ¢å¯¹ charAt() çš„è°ƒç”¨ï¼Œæ–¹æ‹¬å·æ›´ç®€æ´ã€æ›´å¯è¯»ï¼Œè€Œä¸”å¯èƒ½æ›´é«˜æ•ˆã€‚ä½†æ˜¯ï¼Œå­—ç¬¦ä¸²çš„è¡Œä¸ºç±»ä¼¼äºæ•°ç»„ï¼Œä¹Ÿæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¯¹å®ƒä»¬åº”ç”¨æ³›å‹æ•°ç»„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">Array.prototype.join.call(&quot;JavaScript&quot;, &quot; &quot;)  // =&gt; &quot;J a v a S c r i p t&quot;
</code></pre>

<p>è¯·è®°ä½ï¼Œå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜å€¼ï¼Œå› æ­¤å½“å­—ç¬¦ä¸²è¢«è§†ä¸ºæ•°ç»„æ—¶ï¼Œå®ƒä»¬æ˜¯åªè¯»æ•°ç»„ã€‚æ•°ç»„æ–¹æ³• push()ã€sort()ã€reverse() å’Œ splice() ç›´æ¥ä¿®æ”¹æ•°ç»„ï¼Œå®ƒä»¬ä¸èƒ½å¤„ç†å­—ç¬¦ä¸²ã€‚ä½†æ˜¯ï¼Œå°è¯•ä½¿ç”¨æ•°ç»„æ–¹æ³•ä¿®æ”¹å­—ç¬¦ä¸²ä¸ä¼šå¼•å‘å¼‚å¸¸ï¼šå®ƒåªæ˜¯é™é»˜å¤±è´¥ã€‚</p>

<h2 id="toc_37">7.11 æ€»ç»“</h2>

<p>æœ¬ç« æ·±å…¥ä»‹ç»äº† JavaScript æ•°ç»„ï¼ŒåŒ…æ‹¬æœ‰å…³ç¨€ç–æ•°ç»„å’Œç±»æ•°ç»„å¯¹è±¡çš„æ·±å¥¥ç»†èŠ‚ã€‚æœ¬ç« è¦ç‚¹åŒ…æ‹¬ï¼š</p>

<ul>
<li>æ•°ç»„å­—é¢é‡ç¼–å†™ï¼šæ–¹æ‹¬å·å†…é€—å·åˆ†éš”å€¼åˆ—è¡¨ã€‚</li>
<li>é€šè¿‡åœ¨æ–¹æ‹¬å·å†…æŒ‡å®šæ‰€éœ€çš„æ•°ç»„ç´¢å¼•æ¥è®¿é—®å•ä¸ªæ•°ç»„å…ƒç´ ã€‚</li>
<li>for/of å¾ªç¯å’Œ ES6 ä¸­å¼•å…¥çš„ ... å±•å¼€è¿ç®—ç¬¦æ˜¯éå†æ•°ç»„çš„ç‰¹åˆ«æœ‰ç”¨çš„æ–¹æ³•ã€‚</li>
<li>Array ç±»å®šä¹‰äº†ä¸€ç»„ç”¨äºæ“ä½œæ•°ç»„çš„ä¸°å¯Œæ–¹æ³•ï¼Œåº”è¯¥ç¡®ä¿ç†Ÿæ‚‰ Array APIã€‚</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¬¬ 8 ç«  å‡½æ•°]]></title>
    <link href="2019919.xyz/16106664265983.html"/>
    <updated>2021-01-15T07:20:26+08:00</updated>
    <id>2019919.xyz/16106664265983.html</id>
    <content type="html"><![CDATA[
<ul>
<li>
<a href="#toc_0">8.1 å‡½æ•°å®šä¹‰</a>
<ul>
<li>
<a href="#toc_1">8.1.1 å‡½æ•°å£°æ˜</a>
</li>
<li>
<a href="#toc_2">8.1.2 å‡½æ•°è¡¨è¾¾å¼</a>
</li>
<li>
<a href="#toc_3">8.1.3 ç®­å¤´å‡½æ•°</a>
</li>
<li>
<a href="#toc_4">8.1.4 åµŒå¥—å‡½æ•°</a>
</li>
</ul>
</li>
<li>
<a href="#toc_5">8.2 å‡½æ•°è°ƒç”¨</a>
<ul>
<li>
<a href="#toc_6">8.2.1 å‡½æ•°è°ƒç”¨</a>
<ul>
<li>
<a href="#toc_7">æ¡ä»¶è°ƒç”¨</a>
</li>
<li>
<a href="#toc_8">é€’å½’å‡½æ•°å’Œæ ˆ</a>
</li>
</ul>
</li>
<li>
<a href="#toc_9">8.2.2 æ–¹æ³•è°ƒç”¨</a>
<ul>
<li>
<a href="#toc_10">æ–¹æ³•é“¾</a>
</li>
</ul>
</li>
<li>
<a href="#toc_11">8.2.3 æ„é€ å‡½æ•°è°ƒç”¨</a>
</li>
<li>
<a href="#toc_12">8.2.4 é—´æ¥è°ƒç”¨</a>
</li>
<li>
<a href="#toc_13">8.2.5 å‡½æ•°éšå¼è°ƒç”¨</a>
</li>
</ul>
</li>
<li>
<a href="#toc_14">8.3 å‡½æ•°çš„å®å‚å’Œå½¢å‚</a>
<ul>
<li>
<a href="#toc_15">8.3.1 å¯é€‰å½¢å‚å’Œé»˜è®¤å€¼</a>
</li>
<li>
<a href="#toc_16">8.3.2 å‰©ä½™å‚æ•°å’Œå¯å˜é•¿å®å‚åˆ—è¡¨</a>
</li>
<li>
<a href="#toc_17">8.3.3 å®å‚å¯¹è±¡</a>
</li>
<li>
<a href="#toc_18">8.3.4 å‡½æ•°è°ƒç”¨æ—¶çš„å±•å¼€è¿ç®—ç¬¦</a>
</li>
<li>
<a href="#toc_19">8.3.5 å®å‚è§£æ„åˆ°å½¢å‚ä¸­</a>
</li>
<li>
<a href="#toc_20">8.3.6 å®å‚ç±»å‹</a>
</li>
</ul>
</li>
<li>
<a href="#toc_21">8.4 å‡½æ•°ä½œä¸ºå€¼</a>
<ul>
<li>
<a href="#toc_22">8.4.1 è‡ªå®šä¹‰å‡½æ•°å±æ€§</a>
</li>
</ul>
</li>
<li>
<a href="#toc_23">8.5 å‡½æ•°ä½œä¸ºå‘½åç©ºé—´</a>
</li>
<li>
<a href="#toc_24">8.6 é—­åŒ…</a>
</li>
<li>
<a href="#toc_25">8.7 å‡½æ•°å±æ€§ã€æ–¹æ³•ã€å’Œæ„é€ å‡½æ•°</a>
<ul>
<li>
<a href="#toc_26">8.7.1 length å±æ€§</a>
</li>
<li>
<a href="#toc_27">8.7.2 name å±æ€§</a>
</li>
<li>
<a href="#toc_28">8.7.3 prototype å±æ€§</a>
</li>
<li>
<a href="#toc_29">8.7.4 call() å’Œ apply() æ–¹æ³•</a>
</li>
<li>
<a href="#toc_30">8.7.5 bind() æ–¹æ³•</a>
</li>
<li>
<a href="#toc_31">8.7.6 toString() æ–¹æ³•</a>
</li>
<li>
<a href="#toc_32">8.7.7 Function() æ„é€ å‡½æ•°</a>
</li>
</ul>
</li>
<li>
<a href="#toc_33">8.8 å‡½æ•°å¼ç¼–ç¨‹</a>
<ul>
<li>
<a href="#toc_34">8.8.1 ç”¨å‡½æ•°å¤„ç†æ•°ç»„</a>
</li>
<li>
<a href="#toc_35">8.8.2 é«˜é˜¶å‡½æ•°</a>
</li>
<li>
<a href="#toc_36">8.8.3 å±€éƒ¨åº”ç”¨å‡½æ•°</a>
</li>
<li>
<a href="#toc_37">8.8.4 è®°å¿†ï¼ˆMemoizationï¼‰</a>
</li>
</ul>
</li>
<li>
<a href="#toc_38">8.9 æ€»ç»“</a>
</li>
</ul>


<p>æœ¬ç« ä»‹ç»äº† JavaScript å‡½æ•°ã€‚å‡½æ•°æ˜¯ JavaScript ç¨‹åºçš„åŸºæœ¬æ„å»ºå—ï¼Œä¹Ÿæ˜¯å‡ ä¹æ‰€æœ‰ç¼–ç¨‹è¯­è¨€çš„å…±åŒç‰¹æ€§ã€‚ä½ å¯èƒ½å·²ç»äº†è§£å‡½æ•°çš„æ¦‚å¿µï¼Œå¦‚å­ä¾‹ç¨‹æˆ–è¿‡ç¨‹ã€‚</p>

<p>å‡½æ•°æ˜¯ä¸€ä¸ª JavaScript ä»£ç å—ï¼Œåªå®šä¹‰ä¸€æ¬¡ï¼Œä½†å¯ä»¥æ‰§è¡Œæˆ–è°ƒç”¨ä»»æ„æ¬¡æ•°ã€‚JavaScript å‡½æ•°æ˜¯å‚æ•°åŒ–çš„ï¼šä¸€ä¸ªå‡½æ•°å®šä¹‰å¯ä»¥åŒ…å«ä¸€ä¸ªæ ‡è¯†ç¬¦åˆ—è¡¨ï¼Œç§°ä¸ºå‚æ•°ï¼Œä½œä¸ºå‡½æ•°ä½“çš„å±€éƒ¨å˜é‡ã€‚å‡½æ•°è°ƒç”¨ä¸ºå‡½æ•°çš„å‚æ•°æä¾›å€¼æˆ–å®å‚ã€‚å‡½æ•°é€šå¸¸ä½¿ç”¨å®ƒä»¬çš„å®å‚å€¼æ¥è®¡ç®—ä¸€ä¸ªè¿”å›å€¼ï¼Œè¯¥è¿”å›å€¼æˆä¸ºå‡½æ•°è°ƒç”¨è¡¨è¾¾å¼çš„å€¼ã€‚é™¤äº†å‚æ•°ä¹‹å¤–ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½æœ‰å¦ä¸€ä¸ªå€¼â€”â€”è°ƒç”¨ä¸Šä¸‹æ–‡â€”â€”å³ this å…³é”®å­—çš„å€¼ã€‚</p>

<p>å¦‚æœå‡½æ•°æŒ‚è½½åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šä½œä¸ºå…¶å±æ€§ï¼Œå®ƒå°±è¢«ç§°ä¸ºæ–¹æ³•ã€‚å½“è¯¥æ–¹æ³•åœ¨å¯¹è±¡ä¸­è¢«è°ƒç”¨æˆ–é€šè¿‡å¯¹è±¡è°ƒç”¨æ—¶ï¼Œè¯¥å¯¹è±¡å°±æ˜¯è¯¥æ–¹æ³•å‡½æ•°çš„è°ƒç”¨ä¸Šä¸‹æ–‡æˆ– this å€¼ã€‚ç”¨äºåˆå§‹åŒ–æ–°åˆ›å»ºçš„å¯¹è±¡çš„å‡½æ•°ç§°ä¸ºæ„é€ å‡½æ•°ã€‚æ„é€ å‡½æ•°åœ¨ Â§6.2 ä¸­æœ‰ä»‹ç»ï¼Œæˆ‘ä»¬å°†åœ¨ç¬¬9ç« ä¸­å†æ¬¡è°ˆåˆ°å®ƒã€‚</p>

<p>åœ¨ JavaScript ä¸­ï¼Œå‡½æ•°æ˜¯å¯¹è±¡ï¼Œå®ƒä»¬å¯ä»¥è¢«ç¨‹åºæ“ä½œã€‚ä¾‹å¦‚ï¼ŒJavaScript å¯ä»¥å°†å‡½æ•°èµ‹ç»™å˜é‡ï¼Œå¹¶å°†å®ƒä»¬ä¼ é€’ç»™å…¶ä»–å‡½æ•°ã€‚ç”±äºå‡½æ•°æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥ç»™å®ƒä»¬è®¾ç½®å±æ€§ï¼Œç”šè‡³è°ƒç”¨å®ƒä»¬çš„æ–¹æ³•ã€‚</p>

<p>JavaScript å‡½æ•°å¯ä»¥åµŒå¥—åœ¨å…¶ä»–å‡½æ•°ä¸­å®šä¹‰ï¼Œå¹¶ä¸”å®ƒä»¬å¯ä»¥è®¿é—®å®šä¹‰å®ƒä»¬æ‰€å¤„çš„ä½œç”¨åŸŸå†…ä»»ä½•å˜é‡ã€‚è¿™æ„å‘³ç€ JavaScript å‡½æ•°æ˜¯é—­åŒ…ï¼Œæ”¯æŒé—­åŒ…æ˜¯éå¸¸é‡è¦çš„ï¼Œå®ƒæ˜¯éå¸¸å¼ºå¤§çš„ç¼–ç¨‹æŠ€å·§ã€‚</p>

<h2 id="toc_0">8.1 å‡½æ•°å®šä¹‰</h2>

<p>å®šä¹‰ JavaScript å‡½æ•°æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯ä½¿ç”¨ function å…³é”®å­—ï¼Œå®ƒæ—¢å¯ä»¥ç”¨ä½œå£°æ˜åˆå¯ä»¥ç”¨ä½œè¡¨è¾¾å¼ã€‚ES6 å®šä¹‰äº†ä¸€ç§ä¸ä½¿ç”¨ function å…³é”®å­—çš„é‡è¦æ–°æ–¹æ³•æ¥å®šä¹‰çš„å‡½æ•°ï¼šâ€œç®­å¤´å‡½æ•°â€ï¼Œå®ƒå…·æœ‰ç‰¹åˆ«ç®€æ´è¯­æ³•ï¼Œå¹¶ä¸”åœ¨å°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°çš„åœºæ™¯ä¸­éå¸¸å®ç”¨ã€‚æ¥ä¸‹æ¥çš„å°èŠ‚å°†ä»‹ç»è¿™ä¸‰ç§å®šä¹‰å‡½æ•°çš„æ–¹æ³•ã€‚æ³¨æ„ï¼Œå…³äºå‡½æ•°å®šä¹‰è¯­æ³•åŒ…å«çš„å‡½æ•°å‚æ•°ç›¸å…³å†…å®¹å°†åœ¨ Â§8.3 ä¸­ä»‹ç»ã€‚</p>

<p>åœ¨å¯¹è±¡å­—é¢é‡å’Œç±»å®šä¹‰ä¸­ï¼Œæœ‰ä¸€ç§æ–¹ä¾¿çš„å¿«æ·è¯­æ³•æ¥å®šä¹‰æ–¹æ³•ã€‚è¿™ç§ç®€å†™è¯­æ³•åœ¨ Â§6.10.5 ä¸­æœ‰ä»‹ç»ï¼Œç›¸å½“äºé€šè¿‡å¯¹è±¡å­—é¢é‡è¯­æ³•å°†å‡½æ•°å®šä¹‰è¡¨è¾¾å¼ç”¨æœ€åŸºæœ¬çš„å±æ€§åï¼šå±æ€§å€¼çš„æ–¹å¼èµ‹å€¼ç»™å¯¹è±¡çš„å±æ€§ã€‚åœ¨å¦ä¸€ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨å¯¹è±¡å­—é¢é‡ä¸­ä½¿ç”¨å…³é”®å­— get å’Œ set æ¥å®šä¹‰ç‰¹æ®Šçš„å±æ€§ getter å’Œ setter æ–¹æ³•ã€‚è¿™ä¸ªå‡½æ•°å®šä¹‰è¯­æ³•åœ¨ Â§6.10.6 ä¸­ä»‹ç»è¿‡ã€‚</p>

<p>æ³¨æ„ï¼Œå‡½æ•°ä¹Ÿå¯ä»¥ç”¨ Function() æ„é€ å‡½æ•°æ¥å®šä¹‰ï¼Œè¿™æ˜¯ Â§8.7.7 çš„ä¸»é¢˜ã€‚æ­¤å¤–ï¼ŒJavaScript è¿˜å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šç±»å‹çš„å‡½æ•°ã€‚function* å®šä¹‰å‡½æ•°ç”Ÿæˆå™¨ï¼ˆè§ç¬¬12ç« ï¼‰å’Œ async function å®šä¹‰å¼‚æ­¥å‡½æ•°ï¼ˆè§ç¬¬13ç« ï¼‰ã€‚</p>

<h3 id="toc_1">8.1.1 å‡½æ•°å£°æ˜</h3>

<p>å‡½æ•°å£°æ˜ç”± function å…³é”®å­—ç»„æˆï¼Œåé¢è·Ÿç€è¿™äº›ç»„ä»¶:</p>

<ul>
<li>å‡½æ•°åç§°æ ‡è¯†ç¬¦ã€‚åç§°æ˜¯å‡½æ•°å£°æ˜çš„å¿…è¦éƒ¨åˆ†:å®ƒç”¨ä½œå˜é‡çš„åç§°ï¼Œå¹¶å°†æ–°å®šä¹‰çš„å‡½æ•°å¯¹è±¡èµ‹å€¼ç»™è¯¥å˜é‡ã€‚</li>
<li>ä¸€å¯¹åœ†æ‹¬å·ï¼Œå…¶ä¸­åŒ…å«ç”±0ä¸ªæˆ–è€…å¤šä¸ªç”¨é€—å·åˆ†éš”çš„æ ‡è¯†ç¬¦ç»„æˆçš„åˆ—è¡¨ã€‚è¿™äº›æ ‡è¯†ç¬¦æ˜¯å‡½æ•°çš„å‚æ•°åï¼Œå®ƒä»¬çš„è¡Œä¸ºç±»ä¼¼äºå‡½æ•°ä½“ä¸­çš„å±€éƒ¨å˜é‡ã€‚</li>
<li>ä¸€å¯¹èŠ±æ‹¬å·ï¼Œå…¶ä¸­åŒ…å«ç”±0æ¡æˆ–è€…å¤šæ¡ JavaScript è¯­å¥ã€‚è¿™äº›è¯­å¥æ„æˆäº†å‡½æ•°ä½“ï¼šæ¯å½“å‡½æ•°è°ƒç”¨æ—¶ï¼Œå°±ä¼šæ‰§è¡Œè¿™äº›è¯­å¥ã€‚</li>
</ul>

<p>ä¸‹é¢æ˜¯ä¸€äº›å‡½æ•°å£°æ˜çš„ä¾‹å­:</p>

<pre><code class="language-javascript">// Print the name and value of each property of o.  Return undefined.
function printprops(o) {
    for(let p in o) {
        console.log(`${p}: ${o[p]}\n`);
    }
}

// Compute the distance between Cartesian points (x1,y1) and (x2,y2).
function distance(x1, y1, x2, y2) {
    let dx = x2 - x1;
    let dy = y2 - y1;
    return Math.sqrt(dx*dx + dy*dy);
}

// A recursive function (one that calls itself) that computes factorials
// Recall that x! is the product of x and all positive integers less than it.
function factorial(x) {
    if (x &lt;= 1) return 1;
    return x * factorial(x-1);
}
</code></pre>

<p>é‡ä¸­ä¹‹é‡è¦ç†è§£å‡½æ•°å£°æ˜æ˜¯å‡½æ•°åå˜æˆä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„å€¼æ˜¯å‡½æ•°æœ¬èº«ã€‚å‡½æ•°å£°æ˜è¯­å¥â€œè¢«æå‰â€åˆ°è„šæœ¬ã€å‡½æ•°ã€å—ä¹‹å‰ï¼Œå› æ­¤è¿™ç§æ–¹å¼å®šä¹‰çš„å‡½æ•°å¯ä»¥åœ¨å®ƒå®šä¹‰ä¹‹å‰è¢«è°ƒç”¨ã€‚å¦ä¸€ç§è¯´æ³•æ˜¯æ‰€æœ‰å£°æ˜åœ¨ Javascript ä»£ç å—ä¸­çš„å‡½æ•°ï¼Œåœ¨å—å†…å§‹ç»ˆæ˜¯æœ‰å®šä¹‰çš„ï¼Œå®ƒä»¬å®šä¹‰åœ¨ JavaScript è§£é‡Šå™¨å¼€å§‹è§£é‡Šæ‰§è¡Œå—å†…ä»»ä½•è¯­å¥ä¹‹å‰ã€‚</p>

<p>distance() å’Œ factorial() å‡½æ•°è®¡ç®—ä¸€ä¸ªå€¼ï¼Œå®ƒä»¬ç”¨ retrun æ¥å°†è¿™ä¸ªå€¼è¿”å›ç»™è°ƒç”¨è€…ã€‚return è¯­å¥å¯¼è‡´å‡½æ•°åœæ­¢æ‰§è¡Œï¼Œå¹¶è¿”å›å®ƒçš„è¡¨è¾¾å¼çš„å€¼ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ç»™è°ƒç”¨è€…ã€‚å¦‚æœ return è¯­å¥æ²¡æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³çš„è¡¨è¾¾å¼ï¼Œåˆ™å‡½æ•°è¿”å› undefined å€¼ã€‚</p>

<p>printprops() å‡½æ•°ä¸åŒï¼šå®ƒè´Ÿè´£è¾“å‡ºå¯¹è±¡å±æ€§çš„åç§°å’Œå€¼ã€‚æ²¡æœ‰è¿”å›å€¼çš„å¿…è¦ï¼Œå¹¶ä¸”è¯¥å‡½æ•°ä¹Ÿä¸åŒ…å«ä¸€ä¸ª return è¯­å¥ã€‚ è°ƒç”¨ printprops() å‡½æ•°çš„è¿”å›å€¼æ°¸è¿œæ˜¯ undefinedã€‚å¦‚æœä¸€ä¸ªå‡½æ•°ä¸åŒ…å«ä¸€ä¸ª return è¯­å¥ï¼Œå®ƒä»…ä»…æ‰§è¡Œå‡½æ•°ä½“å†…æ¯ä¸€æ¡è¯­å¥ç›´åˆ°ç»“æŸï¼Œå¹¶è¿”å› undefined ç»™è°ƒç”¨è€…ã€‚</p>

<p>åœ¨ ES6 ä¹‹å‰ï¼Œå‡½æ•°åªå…è®¸åœ¨ JavaScript æ–‡ä»¶é¡¶å±‚æˆ–è€…å…¶ä»–å‡½æ•°ä¸­å£°æ˜ã€‚ç„¶è€Œä¸€äº›å®ç°è¿åè§„çº¦ï¼Œåœ¨å¾ªç¯ä½“æ¡ä»¶ä½“æˆ–è€…å…¶ä»–å—ä¸­å®šä¹‰å‡½æ•°ã€‚åœ¨ ES6 çš„ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå‡½æ•°å…è®¸åœ¨å—å†…è¿›è¡Œå£°æ˜ã€‚ä¸€ä¸ªå®šä¹‰åœ¨å—å†…çš„å‡½æ•°åªå­˜åœ¨äºè¯¥å—å†…ï¼Œå—å¤–æ˜¯ä¸å¯è§çš„ã€‚</p>

<h3 id="toc_2">8.1.2 å‡½æ•°è¡¨è¾¾å¼</h3>

<p>å‡½æ•°è¡¨è¾¾å¼çœ‹èµ·æ¥å¾ˆåƒå‡½æ•°å£°æ˜ï¼Œä½†æ˜¯å®ƒå‡ºç°åœ¨ä¸€ä¸ªå®ƒçš„ä¸Šå±‚è¡¨è¾¾å¼æˆ–è¯­å¥çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶ä¸”å‡½æ•°åç§°æ˜¯å¯é€‰é¡¹ã€‚</p>

<p>ä¸‹é¢æ˜¯ä¸€äº›å‡½æ•°è¡¨è¾¾å¼çš„ä¾‹å­ï¼š</p>

<pre><code class="language-javascript">// This function expression defines a function that squares its argument.
// Note that we assign it to a variable
const square = function(x) { return x*x; };

// Function expressions can include names, which is useful for recursion.
const f = function fact(x) { if (x &lt;= 1) return 1; else return x*fact(x-1); };

// Function expressions can also be used as arguments to other functions:
[3,2,1].sort(function(a,b) { return a-b; });

// Function expressions are sometimes defined and immediately invoked:
let tensquared = (function(x) {return x*x;}(10));
</code></pre>

<p>æ³¨æ„å‡½æ•°åç§°åœ¨å‡½æ•°è¡¨è¾¾å¼ä¸­æ˜¯å¯é€‰é¡¹ï¼Œåœ¨å¤§éƒ¨åˆ†å‡½æ•°è¡¨è¾¾å¼ä¸­æˆ‘ä»¬çœç•¥äº†å®ƒã€‚å‡½æ•°å£°æ˜å®é™…ä¸Šå£°æ˜äº†ä¸€ä¸ªå˜é‡å¹¶ä¸”å°†å‡½æ•°å¯¹è±¡èµ‹å€¼ç»™å®ƒã€‚æŒ‰ç…§è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œå‡½æ•°è¡¨è¾¾å¼æ²¡æœ‰å£°æ˜ä¸€ä¸ªå˜é‡ï¼šå¯ä»¥æ ¹æ®å®ƒæ˜¯å¦ä¼šå¤šæ¬¡è°ƒç”¨ç”±ä½ è‡ªå·±å†³å®šæ˜¯å°†æ–°å®šä¹‰çš„å‡½æ•°å¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ªå¸¸é‡è¿˜æ˜¯å˜é‡ã€‚ç”¨ const å®šä¹‰å‡½æ•°è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„åšæ³•ï¼Œä½ ä¸ä¼šå› ä¸ºæ„å¤–èµ‹å€¼è€Œé‡å†™äº†ä½ çš„å‡½æ•°ã€‚</p>

<p>å¯ä»¥ç»™å‡½æ•°ä¸€ä¸ªåç§°ï¼Œå°±åƒ factorial å‡½æ•°ï¼Œå®ƒéœ€è¦è°ƒç”¨å®ƒè‡ªå·±ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼åŒ…å«ä¸€ä¸ªåç§°ï¼Œé‚£è¿™ä¸ªå‡½æ•°çš„å±€éƒ¨å‡½æ•°ä½œç”¨åŸŸå†…ä¼šåŒ…å«ä¸€ä¸ªå±æ€§åä¸ºè¯¥å‡½æ•°åçš„å¯¹è±¡ï¼Œå…¶å€¼ç»‘å®šçš„æ˜¯è¯¥å‡½æ•°ã€‚å®é™…ä¸Šï¼Œå‡½æ•°åå˜æˆè¿™ä¸ªå‡½æ•°çš„ä¸€ä¸ªå±€éƒ¨å˜é‡ã€‚å¤§å¤šæ•°å‡½æ•°è¡¨è¾¾å¼ä¸éœ€è¦å‡½æ•°åç§°ï¼Œè¿™è®©å®ƒä»¬çš„å®šä¹‰æ›´ç®€æ´ï¼ˆä½†æ˜¯å¹¶æ²¡æœ‰ä¸‹é¢è¦è®²çš„ç®­å¤´å‡½æ•°ç®€æ´ï¼‰ã€‚</p>

<p>åœ¨å‡½æ•°å£°æ˜å’Œå‡½æ•°è¡¨è¾¾å¼ä¹‹é—´æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ä¸åŒã€‚å½“ä½ ç”¨å‡½æ•°å£°æ˜ï¼Œè¯¥å‡½æ•°å¯¹è±¡åˆ›å»ºäºè¯¥å‡½æ•°æ‰€åœ¨ä½œç”¨åŸŸçš„ä»£ç å¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯å£°æ˜æå‰ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨å‡½æ•°å®šä¹‰ä¹‹å‰è°ƒç”¨ä»–ä»¬ã€‚å¦‚æœç”¨å‡½æ•°è¡¨è¾¾å¼æ¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿™æ ·ä½¿ç”¨å°±æ˜¯ä¸å¯¹çš„ï¼šè¯¥å‡½æ•°ä¸ä¼šå­˜åœ¨ï¼Œç›´åˆ°å‡½æ•°å®šä¹‰è¡¨è¾¾å¼çœŸæ­£è¢«è®¡ç®—ã€‚å› ä¸ºï¼Œæƒ³è¦æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œä½ å¿…é¡»å¯ä»¥å¼•ç”¨å®ƒï¼Œè€Œä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼å®šä¹‰çš„å‡½æ•°ä¸€ç›´åˆ°è¯¥å‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡åæ‰èƒ½è¢«å¼•ç”¨ï¼Œæ‰€ä»¥è¦ä½¿ç”¨å‡½æ•°è¡¨è¾¾å¼éœ€è¦åœ¨å‡½æ•°è¢«è°ƒç”¨ä¹‹å‰å®šä¹‰ã€‚</p>

<h3 id="toc_3">8.1.3 ç®­å¤´å‡½æ•°</h3>

<p>åœ¨ ES6 ä¹‹åï¼Œä½ å¯ä»¥ç”¨ä¸€ä¸ªç‰¹åˆ«ç®€æ´çš„è¯­æ³•æ¥å®šä¹‰å‡½æ•°ï¼Œè¢«ç§°ä¸ºâ€œç®­å¤´å‡½æ•°â€ã€‚è¿™ä¸ªè¯­æ³•è”æƒ³åˆ°æ•°å­¦ç¬¦å·ï¼Œç”¨ä¸€ä¸ª =&gt; &quot;ç®­å¤´&quot;æ¥åˆ†éš”å‡½æ•°çš„å‚æ•°å’Œå‡½æ•°ä½“ã€‚function å…³é”®å­—æœªä½¿ç”¨ï¼Œå¹¶ä¸”ï¼Œç”±äºç®­å¤´å‡½æ•°æ˜¯è¡¨è¾¾å¼è€Œä¸æ˜¯å£°æ˜è¯­å¥ï¼Œä¹Ÿä¸éœ€è¦ä¸€ä¸ªå‡½æ•°åç§°ã€‚ä¸€èˆ¬ç®­å¤´å‡½æ•°ç”¨åœ†æ‹¬å·åŒ…å«ä¸€ä¸ªé€—å·åˆ†éš”çš„å‚æ•°åˆ—è¡¨ï¼Œæ¥ä¸€ä¸ª =&gt; ç®­å¤´ï¼Œåé¢æ˜¯èŠ±æ‹¬å·åŒ…å«çš„å‡½æ•°ä½“ã€‚</p>

<pre><code class="language-javascript">const sum = (x, y) =&gt; { return x + y; };
</code></pre>

<p>ä½†æ˜¯ç®­å¤´å‡½æ•°æ”¯æŒæ›´åŠ ç®€æ´çš„è¯­æ³•ã€‚å¦‚æœå‡½æ•°ä½“åªæœ‰ä¸€ä¸ªç®€å•çš„ return è¯­å¥ï¼Œä½ å¯ä»¥çœç•¥ return å…³é”®å­—ï¼Œåˆ†å·å’ŒèŠ±æ‹¬å·éƒ½ä¸€èµ·çœç•¥ï¼Œå°†å‡½æ•°ä½“å†™æˆä¸€ä¸ªè®¡ç®—è¿”å›å€¼çš„è¡¨è¾¾å¼ã€‚</p>

<pre><code class="language-javascript">const sum = (x, y) =&gt; x + y;
</code></pre>

<p>è€Œä¸”ï¼Œå¦‚æœä¸€ä¸ªç®­å¤´å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œä½ å¯ä»¥çœç•¥å‚æ•°åˆ—è¡¨çš„åœ†æ‹¬å·ã€‚</p>

<pre><code class="language-javascript">const polynomial = x =&gt; x*x + 2*x + 3;
</code></pre>

<p>æ³¨æ„ï¼Œå¦‚æœç®­å¤´å‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œå¿…é¡»å†™ä¸€å¯¹ç©ºåœ†æ‹¬å·ã€‚</p>

<pre><code class="language-javascript">const constantFunc = () =&gt; 42;
</code></pre>

<p>æ³¨æ„ï¼Œå½“å†™ä¸€ä¸ªç®­å¤´å‡½æ•°æ—¶ï¼Œå‡½æ•°å‚æ•°å’Œç®­å¤´ä¹‹é—´ä¸èƒ½æ¢è¡Œã€‚å¦åˆ™ï¼Œå¯èƒ½ä¼šç›´æ¥åœ¨èµ‹å€¼åä¸­æ­¢ï¼Œå°±åƒ <code>const polynomial = x</code>ï¼Œå› ä¸ºå®ƒæœ¬èº«æ˜¯ä¸€ä¸ªè¯­æ³•ä¸Šåˆæ³•çš„èµ‹å€¼è¯­å¥ã€‚</p>

<p>æ­¤å¤–ï¼Œå¦‚æœç®­å¤´å‡½æ•°ä½“æ˜¯ä¸€ä¸ªå•ä¸€çš„ return è¯­å¥ï¼Œè€Œä¸”ä»–è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡å­—é¢é‡ï¼Œé‚£å¿…é¡»å°†å¯¹è±¡å­—é¢é‡ç”¨åœ†æ‹¬å·åŒ…èµ·æ¥ï¼Œé¿å…å°†å¯¹è±¡å­—é¢é‡çš„å¤§æ‹¬å·è¯¯è§£æˆå‡½æ•°ä½“çš„å¤§æ‹¬å·ã€‚</p>

<pre><code class="language-javascript">const f = x =&gt; { return { value: x }; };  // Good: f() returns an object
const g = x =&gt; ({ value: x });            // Good: g() returns an object
const h = x =&gt; { value: x };              // Bad: h() returns nothing
const i = x =&gt; { v: x, w: x };            // Bad: Syntax Error
</code></pre>

<p>è¿™æ®µä»£ç çš„ç¬¬ä¸‰è¡Œï¼Œå‡½æ•° h() å°±æœ‰æ­§ä¹‰ï¼šè¿™æ®µä»£ç åŸæœ¬è¿”å›å¯¹è±¡å­—é¢é‡è¢«è½¬åŒ–ä¸ºä¸€ä¸ªæ ‡ç­¾è¯­å¥ï¼Œæ‰€ä»¥ä¸€ä¸ªè¿”å› undefined çš„å‡½æ•°è¢«åˆ›å»ºã€‚ç¬¬å››è¡Œï¼Œç»“æ„æ›´å¤æ‚çš„å¯¹è±¡å­—é¢é‡ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„è¯­å¥ï¼Œè¿™æ®µä»£ç ä¼šæŠ›å‡ºä¸€ä¸ªè¯­æ³•å¼‚å¸¸ã€‚</p>

<p>ç®€æ´çš„ç®­å¤´å‡½æ•°å¯ä»¥å®Œç¾çš„ä¼ é€’ä¸€ä¸ªå‡½æ•°ç»™å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œæ¯”å¦‚ä¸€äº›æ•°ç»„çš„å¸¸è§„æ“ä½œæ–¹æ³• map()ï¼Œfilter() å’Œ reduce()ï¼ˆè§ Â§7.8.1ï¼‰ï¼Œä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">// Make a copy of an array with null elements removed.
let filtered = [1,null,2,3].filter(x =&gt; x !== null); // filtered == [1,2,3]
// Square some numbers:
let squares = [1,2,3,4].map(x =&gt; x*x);               // squares == [1,4,9,16]
</code></pre>

<p>ç®­å¤´å‡½æ•°ä¸åŒäºç”¨å…³é”®å­—å®šä¹‰çš„å‡½æ•°ï¼šç®­å¤´å‡½æ•°ä»å®šä¹‰å®ƒä»¬çš„ç¯å¢ƒç»§æ‰¿ this å…³é”®å­—ï¼Œè€Œä¸æ˜¯åƒå…¶ä»–å®šä¹‰æ–¹å¼é‚£æ ·å®šä¹‰è‡ªå·±çš„è°ƒç”¨ä¸Šä¸‹æ–‡ã€‚è¿™æ˜¯ç®­å¤´å‡½æ•°ä¸€ä¸ªé‡è¦ä¸”ç‰¹åˆ«å®ç”¨çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¼šåœ¨è¿™ä¸€ç« çš„åé¢å†æ¬¡æåˆ°å®ƒã€‚ç®­å¤´å‡½æ•°ä¹Ÿä¸åŒäºå…¶ä»–å‡½æ•°ï¼Œå®ƒä»¬æ²¡æœ‰æœ‰åŸå‹å±æ€§ã€‚è¿™æ„å‘³ç€å®ƒä¸èƒ½è¢«å½“ä½œä¸€ä¸ªæ„é€ å‡½æ•°å»åˆ›å»ºä¸€ä¸ªç±»ï¼ˆè§ Â§9.2ï¼‰ã€‚</p>

<h3 id="toc_4">8.1.4 åµŒå¥—å‡½æ•°</h3>

<p>åœ¨ JavaScript ä¸­ï¼Œå‡½æ•°å¯ä»¥åµŒå¥—åœ¨å…¶ä»–å‡½æ•°å†…ã€‚ä¾‹å¦‚ï¼š</p>

<pre><code class="language-javascript">function hypotenuse(a, b) {
    function square(x) { return x*x; }
    return Math.sqrt(square(a) + square(b));
}
</code></pre>

<p>åµŒå¥—å‡½æ•°çš„æœ‰è¶£ä¹‹å¤„åœ¨äºå®ƒçš„å˜é‡ä½œç”¨åŸŸè§„åˆ™ï¼šå®ƒä»¬å¯ä»¥è®¿é—®åµŒå¥—å®ƒä»¬ï¼ˆæˆ–å¤šé‡åµŒå¥—ï¼‰çš„å‡½æ•°çš„å‚æ•°å’Œå˜é‡ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä»£ç é‡Œï¼Œå†…éƒ¨å‡½æ•° square() å¯ä»¥è¯»å†™å¤–éƒ¨å‡½æ•° hypotenuse() å®šä¹‰çš„å‚æ•° a å’Œ bã€‚è¿™äº›ä½œç”¨åŸŸè§„åˆ™å¯¹åµŒå¥—å‡½æ•°éå¸¸é‡è¦ï¼Œæˆ‘ä»¬ä¼šåœ¨ Â§8.6 å†æ·±å…¥äº†è§£å®ƒä»¬ã€‚</p>

<h2 id="toc_5">8.2 å‡½æ•°è°ƒç”¨</h2>

<p>æ„æˆå‡½æ•°ä¸»ä½“çš„ JavaScript ä»£ç åœ¨å®šä¹‰ä¹‹æ—¶å¹¶ä¸ä¼šæ‰§è¡Œï¼Œåªæœ‰è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå®ƒä»¬æ‰ä¼šæ‰§è¡Œã€‚JavaScript å‡½æ•°å¯ä»¥ä»¥äº”ç§æ–¹å¼è¢«è°ƒç”¨ã€‚</p>

<ul>
<li>ä½œä¸ºå‡½æ•°</li>
<li>ä½œä¸ºæ–¹æ³•</li>
<li>ä½œä¸ºæ„é€ å‡½æ•°</li>
<li>é€šè¿‡å®ƒä»¬çš„ call() å’Œ apply() æ–¹æ³•é—´æ¥è°ƒç”¨</li>
<li>éšå¼è°ƒç”¨ï¼Œä¸åŒäºæ™®é€šå‡½æ•°è°ƒï¼Œé€šè¿‡ JavaScript è¯­è¨€ç‰¹æ€§è°ƒç”¨å‡½æ•°ã€‚</li>
</ul>

<h3 id="toc_6">8.2.1 å‡½æ•°è°ƒç”¨</h3>

<p>å‡½æ•°æˆ–æ–¹æ³•é€šè¿‡è°ƒç”¨è¡¨è¾¾å¼ï¼ˆÂ§4.5ï¼‰è¢«è°ƒç”¨ã€‚è°ƒç”¨è¡¨è¾¾å¼ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼Œè®¡ç®—å‡½æ•°å¯¹è±¡çš„å‡½æ•°è¡¨è¾¾å¼ï¼Œä¸€ä¸ªå¼€æ”¾åœ†æ‹¬å·ï¼Œé€—å·åˆ†éš”çš„é›¶ä¸ªæˆ–å¤šä¸ªå®å‚è¡¨è¾¾å¼åˆ—è¡¨ï¼Œä¸€ä¸ªé—­åˆåœ†æ‹¬å·ã€‚å¦‚æœå‡½æ•°è¡¨è¾¾å¼æ˜¯å±æ€§è®¿é—®è¡¨è¾¾å¼ï¼ˆå‡½æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æˆ–è€…ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ ï¼‰é‚£ä¹ˆå®ƒæ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨è¡¨è¾¾å¼ã€‚è¿™ç§æƒ…å†µä¼šé€šè¿‡ä¸‹é¢çš„ä¾‹å­è¯´æ˜ï¼Œæ¥ä¸‹æ¥è¿™ä¸ªä»£ç åŒ…å«äº†ä¸€äº›å¸¸è§„çš„å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼ï¼š</p>

<pre><code class="language-javascript">printprops({x: 1});
let total = distance(0,0,2,1) + distance(2,1,3,5);
let probability = factorial(5)/factorial(13);
</code></pre>

<p>åœ¨è°ƒç”¨ä¸­ï¼Œæ¯ä¸ªå®å‚è¡¨è¾¾å¼ï¼ˆåœ†æ‹¬å·å†…çš„ï¼‰æ‰§è¡Œè®¡ç®—ï¼Œè¿”å›å€¼ä½œä¸ºå‡½æ•°çš„å®å‚ã€‚è¿™äº›å€¼ä¼ ç»™å‡½æ•°å®šä¹‰çš„å‚æ•°ã€‚åœ¨å‡½æ•°ä½“å†…ï¼Œå‚æ•°çš„å¼•ç”¨æŒ‡å‘å¯¹åº”å®å‚çš„å€¼ã€‚</p>

<p>å¯¹äºå¸¸è§„çš„å‡½æ•°è°ƒç”¨ï¼Œå‡½æ•°è¿”å›å€¼å˜æˆå‡½æ•°è°ƒç”¨è¡¨è¾¾å¼çš„å€¼ã€‚å¦‚æœå› è§£é‡Šå™¨æ‰§è¡Œåˆ°å‡½æ•°ç»“å°¾è€Œè¿”å›ï¼Œè¿”å›å€¼å°±æ˜¯ undefinedã€‚å¦‚æœå‡½æ•°è¿”å›æ˜¯å› ä¸ºè§£é‡Šå™¨æ‰§è¡Œä¸€ä¸ª return è¯­å¥ï¼Œé‚£ä¹ˆè¿”å›å€¼æ˜¯ return åé¢çš„è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœï¼Œå¦‚æœ return è¯­å¥æ²¡æœ‰å€¼ä¹Ÿè¿”å› undefinedã€‚</p>

<h4 id="toc_7">æ¡ä»¶è°ƒç”¨</h4>

<p>åœ¨ ES2020 ä¸­ä½ å¯ä»¥é€šè¿‡åœ¨å‡½æ•°è¡¨è¾¾å¼å’Œåœ†æ‹¬å·ä¹‹é—´æ’å…¥ ?. ç¬¦å·ï¼Œä½¿å‡½æ•°åªæœ‰åœ¨ä¸ä¸º null å’Œ undefined æ—¶å€™å†è°ƒç”¨ã€‚è¡¨è¾¾å¼ f?.(x) ç­‰ä»·ï¼ˆå‡è®¾æ²¡æœ‰å‰¯ä½œç”¨ï¼‰äºï¼š</p>

<pre><code class="language-javascript">(f !== null &amp;&amp; f !== undefined) ? f(x) : undefined
</code></pre>

<p>è¯¦ç»†çš„æ¡ä»¶æ‰§è¡Œè¯­æ³•æè¿°åœ¨ Â§4.5.1ã€‚</p>

<p>å‡½æ•°è°ƒç”¨åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè°ƒç”¨ä¸Šä¸‹æ–‡ï¼ˆ this ï¼‰æ˜¯å…¨å±€å¯¹è±¡ã€‚ç„¶è€Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œè°ƒç”¨ä¸Šä¸‹æ–‡æ˜¯ undefinedã€‚æ³¨æ„ç®­å¤´è¯­æ³•å®šä¹‰çš„å‡½æ•°è¡Œä¸ºæ˜¯ä¸åŒçš„ï¼šå®é™…ä¸Šå®ƒä»¬æ€»æ˜¯ç»§æ‰¿å®ƒä»¬å®šä¹‰ä½ç½®çš„ this å€¼ã€‚</p>

<p>ä»¥å‡½æ•°å½¢å¼è°ƒç”¨çš„å‡½æ•°é€šå¸¸ä¸ä½¿ç”¨ this å…³é”®å­—ã€‚ä¸è¿‡ï¼Œthis å…³é”®å­—å¯ä»¥ç”¨æ¥åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯ä¸¥æ ¼æ¨¡å¼ã€‚</p>

<pre><code class="language-javascript">// Define and invoke a function to determine if we&#39;re in strict mode.
const strict = (function() { return !this; }());
</code></pre>

<h4 id="toc_8">é€’å½’å‡½æ•°å’Œæ ˆ</h4>

<p>é€’å½’å‡½æ•°å°±åƒæœ¬ç« å¼€å§‹çš„ factorial() å‡½æ•°ï¼Œå®ƒè°ƒç”¨å®ƒè‡ªå·±ã€‚æŸäº›ç®—æ³•ï¼ˆå¦‚æ¶‰åŠåŸºäºæ ‘çš„æ•°æ®ç»“æ„ï¼‰å¯ä»¥ä½¿ç”¨é€’å½’å‡½æ•°ç‰¹åˆ«ä¼˜é›…åœ°å®ç°ã€‚åœ¨å†™é€’å½’å‡½æ•°æ—¶ï¼Œè€ƒè™‘å†…å­˜åˆ†é…æ˜¯å¾ˆé‡è¦çš„ã€‚å½“å‡½æ•° A è°ƒç”¨å‡½æ•° Bï¼Œç„¶åå‡½æ•° B åˆè°ƒç”¨å‡½æ•° C æ—¶ï¼ŒJavascript ç¼–è¯‘å™¨éœ€è¦çŸ¥é“åœ¨å“ªé‡Œé‡æ–°æ‰§è¡Œå‡½æ•° Bï¼Œå½“å‡½æ•° B æ‰§è¡Œå®Œæˆåå®ƒéœ€è¦çŸ¥é“åœ¨å“ªé‡Œæ‰§è¡Œå‡½æ•° Aã€‚ä½ å¯ä»¥å°†æ‰§è¡Œä¸Šä¸‹æ–‡æƒ³è±¡æˆä¸€ä¸ªæ ˆã€‚å½“ä¸€ä¸ªå‡½æ•°è°ƒç”¨å¦å¤–ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡è¢«å‹å…¥æ ˆä¸­ã€‚å½“è¢«è°ƒç”¨å‡½æ•°è¿”å›ï¼Œå®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡ä»æ ˆä¸­å¼¹å‡ºã€‚å¦‚æœä¸€ä¸ªå‡½æ•°é€’å½’è°ƒç”¨100æ¬¡ï¼Œé‚£ä¹ˆä¼šæœ‰100ä¸ªå¯¹è±¡è¢«å‹å…¥æ ˆä¸­ï¼Œç„¶åè¿™100ä¸ªå¯¹è±¡å†ä¾æ¬¡ä»æ ˆä¸­å¼¹å‡ºã€‚è¿™ç§è°ƒç”¨éå¸¸è€—å†…å­˜ã€‚ä»¥ç°ä»£çš„ç¡¬ä»¶é€’å½’è°ƒç”¨100æ¬¡é€šå¸¸æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªå‡½æ•°é€’å½’ä¸Šåƒæ¬¡ï¼Œå®ƒå¯èƒ½ä¼šå¤±è´¥å¹¶æŠ¥é”™â€œMaximum call-stack size exceeded.â€ã€‚</p>

<h3 id="toc_9">8.2.2 æ–¹æ³•è°ƒç”¨</h3>

<p>æ–¹æ³•åªä¸è¿‡æ˜¯å¯¹è±¡å±æ€§å‡½æ•°ã€‚å¦‚æœæœ‰ä¸€ä¸ªå‡½æ•° f å’Œä¸€ä¸ªå¯¹è±¡ oï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç ç»™å¯¹è±¡ o å®šä¹‰ä¸€ä¸ªåä¸º m çš„æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">o.m = f;
</code></pre>

<p>ç»™å¯¹è±¡ o å®šä¹‰äº†æ–¹æ³• m()ï¼Œç”¨è¿™ç§æ–¹å¼è°ƒç”¨å®ƒï¼š</p>

<pre><code class="language-javascript">o.m();
</code></pre>

<p>æˆ–è€… m() éœ€è¦ä¸¤ä¸ªå®å‚ï¼Œå¯ä»¥è¿™æ ·è°ƒç”¨å®ƒï¼š</p>

<pre><code class="language-javascript">o.m(x, y);
</code></pre>

<p>ä¾‹å­ä¸­çš„ä»£ç æ˜¯ä¸€ä¸ªè°ƒç”¨è¡¨è¾¾å¼ï¼šå®ƒåŒ…å«ä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼ o.m å’Œä¸¤ä¸ªå®å‚è¡¨è¾¾å¼ x å’Œ yã€‚å‡½æ•°è¡¨è¾¾å¼æœ¬èº«æ˜¯ä¸€ä¸ªå±æ€§è®¿é—®è¡¨è¾¾å¼ï¼Œè¿™æ„å‘³ç€è¯¥å‡½æ•°è¢«å½“ä½œä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ã€‚</p>

<p>å¯¹æ–¹æ³•è°ƒç”¨çš„å‚æ•°å’Œè¿”å›å€¼çš„å¤„ç†ï¼Œå’Œä¸Šé¢æ‰€æè¿°çš„æ™®é€šå‡½æ•°è°ƒç”¨å®Œå…¨ä¸€è‡´ã€‚ä½†æ˜¯ï¼Œæ–¹æ³•è°ƒç”¨å’Œå‡½æ•°è°ƒç”¨æœ‰ä¸€ä¸ªé‡è¦çš„åŒºåˆ«ï¼Œå³ï¼šè°ƒç”¨ä¸Šä¸‹æ–‡ã€‚å±æ€§è®¿é—®è¡¨è¾¾å¼ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªå¯¹è±¡ï¼ˆæœ¬ä¾‹ä¸­çš„ oï¼‰å’Œå±æ€§åç§°ï¼ˆmï¼‰ã€‚åœ¨åƒè¿™æ ·çš„æ–¹æ³•è°ƒç”¨è¡¨è¾¾å¼é‡Œï¼Œå¯¹è±¡ o æˆä¸ºè°ƒç”¨ä¸Šä¸‹æ–‡ï¼Œå‡½æ•°ä½“å¯ä»¥ä½¿ç”¨å…³é”®å­—thiså¼•ç”¨è¯¥å¯¹è±¡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p>

<pre><code class="language-javascript">let calculator = { // An object literal
    operand1: 1,
    operand2: 1,
    add() {        // We&#39;re using method shorthand syntax for this function
        // Note the use of the this keyword to refer to the containing object.
        this.result = this.operand1 + this.operand2;
    }
};
calculator.add();  // A method invocation to compute 1+1.
calculator.result  // =&gt; 2
</code></pre>

<p>å¤§å¤šæ•°æ–¹æ³•è°ƒç”¨ä½¿ç”¨ç‚¹ç¬¦å·æ¥è®¿é—®å±æ€§ï¼Œä½¿ç”¨æ–¹æ‹¬å·ï¼ˆå±æ€§è®¿é—®è¡¨è¾¾å¼ï¼‰ä¹Ÿå¯ä»¥è¿›è¡Œå±æ€§è®¿é—®æ“ä½œã€‚ä¸‹é¢ä¸¤ä¸ªä¾‹å­éƒ½æ˜¯å‡½æ•°è°ƒç”¨ï¼š</p>

<pre><code class="language-javascript">o[&quot;m&quot;](x,y);   // Another way to write o.m(x,y).
a[0](z)        // Also a method invocation (assuming a[0] is a function).
</code></pre>

<p>æ–¹æ³•è°ƒç”¨å¯èƒ½åŒ…æ‹¬æ›´å¤æ‚çš„å±æ€§è®¿é—®è¡¨è¾¾å¼ï¼š</p>

<pre><code class="language-javascript">customer.surname.toUpperCase(); // Invoke method on customer.surname
f().m();                        // Invoke method m() on return value of f()
</code></pre>

<p>æ–¹æ³•å’Œ this å…³é”®å­—æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹èŒƒå¼çš„æ ¸å¿ƒã€‚ä»»ä½•å‡½æ•°åªè¦ä½œä¸ºæ–¹æ³•è°ƒç”¨å®é™…ä¸Šéƒ½ä¼šä¼ å…¥ä¸€ä¸ªéšå¼çš„å®å‚å¯¹è±¡ï¼Œå°±æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•å¯¹è±¡æœ¬èº«ã€‚é€šå¸¸æ¥è®²ï¼Œæ–¹æ³•æ‰§è¡Œå°±æ˜¯å¯¹è±¡çš„æŸç§æ“ä½œï¼Œæ–¹æ³•è°ƒç”¨çš„è¯­æ³•ä¹Ÿæ¸…æ™°çš„è¡¨è¾¾äº†å®ƒæ˜¯æ“ä½œå¯¹è±¡çš„å‡½æ•°ï¼Œæ¯”è¾ƒä¸‹é¢ä¸¤è¡Œä»£ç ï¼š</p>

<pre><code class="language-javascript">rect.setSize(width, height);
setRectSize(rect, width, height);
</code></pre>

<p>æˆ‘ä»¬å‡è®¾è¿™ä¸¤è¡Œä»£ç çš„åŠŸèƒ½å®Œå…¨ä¸€æ ·ï¼Œå®ƒä»¬éƒ½ä½œç”¨äºä¸€ä¸ªå‡å®šçš„å¯¹è±¡ rectã€‚å¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€è¡Œçš„æ–¹æ³•è°ƒç”¨è¯­æ³•éå¸¸æ¸…æ™°åœ°è¡¨æ˜è¿™ä¸ªå‡½æ•°æ‰§è¡Œçš„è½½ä½“æ˜¯ rect å¯¹è±¡ï¼Œå‡½æ•°ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½å°†åŸºäºè¿™ä¸ªå¯¹è±¡ã€‚</p>

<h4 id="toc_10">æ–¹æ³•é“¾</h4>

<p>å½“æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è¿˜å¯ä»¥å†è°ƒç”¨å®ƒçš„æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•è°ƒç”¨åºåˆ—ä¸­ï¼ˆæˆ–â€œé“¾â€ï¼‰æ¯æ¬¡çš„è°ƒç”¨ç»“æœéƒ½æ˜¯å¦å¤–ä¸€ä¸ªè¡¨è¾¾å¼çš„ç»„æˆéƒ¨åˆ†ã€‚æ¯”å¦‚ï¼ŒåŸºäº Promise çš„å¼‚æ­¥æ“ä½œï¼ˆå‚è§ç¬¬13ç« ï¼‰ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šè¿™æ ·å†™ä»£ç ï¼š</p>

<pre><code class="language-javascript">// Run three asynchronous operations in sequence, handling errors.
doStepOne().then(doStepTwo).then(doStepThree).catch(handleErrors);
</code></pre>

<p>å½“æ–¹æ³•å¹¶ä¸éœ€è¦è¿”å›å€¼æ—¶ï¼Œæœ€å¥½ç›´æ¥è¿”å› thisã€‚å¦‚æœåœ¨è®¾è®¡çš„ API ä¸­ä¸€ç›´é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œä½¿ç”¨ API å°±å¯ä»¥ç”¨æ–¹æ³•é“¾ <sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup> é£æ ¼çš„ç¼–ç¨‹ï¼Œåœ¨è¿™ç§ç¼–ç¨‹é£æ ¼ä¸­ï¼Œåªè¦æŒ‡å®šä¸€æ¬¡è¦è°ƒç”¨çš„å¯¹è±¡å³å¯ï¼Œä½™ä¸‹çš„æ–¹æ³•éƒ½å¯ä»¥åŸºäºæ­¤è¿›è¡Œè°ƒç”¨ï¼š</p>

<pre><code class="language-javascript">new Square().x(100).y(100).size(50).outline(&quot;red&quot;).fill(&quot;blue&quot;).draw();
</code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œthis æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œä¸æ˜¯å˜é‡ï¼Œä¹Ÿä¸æ˜¯å±æ€§åã€‚JavaScript çš„è¯­æ³•ä¸å…è®¸ç»™ this èµ‹å€¼ã€‚</p>

<p>å…³é”®å­— this æ²¡æœ‰å˜é‡ä½œç”¨åŸŸçš„é™åˆ¶ï¼Œé™¤äº†ç®­å¤´å‡½æ•°ï¼ŒåµŒå¥—å‡½æ•°ä¸ä¼šä»åŒ…å«å®ƒçš„å‡½æ•°ä¸­ç»§æ‰¿ thisã€‚å¦‚æœåµŒå¥—å‡½æ•°ä½œä¸ºæ–¹æ³•è°ƒç”¨ï¼Œå…¶ this çš„å€¼æŒ‡å‘è°ƒç”¨å®ƒçš„å¯¹è±¡ã€‚å¦‚æœåµŒå¥—çš„å‡½æ•°ä½œä¸ºå‡½æ•°è°ƒç”¨ï¼ˆä¸åŒ…å«ç®­å¤´å‡½æ•°ï¼‰ï¼Œå…¶ this å€¼ä¸æ˜¯å…¨å±€å¯¹è±¡ï¼ˆéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰å°±æ˜¯undefinedï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰ã€‚å¾ˆå¤šäººè¯¯ä»¥ä¸ºåœ¨ä¸€ä¸ªæ–¹æ³•ä¸­çš„å‡½æ•°å£°æ˜å¹¶ä»¥å‡½æ•°è°ƒç”¨çš„æ–¹å¼å»æ‰§è¡Œå¯ä»¥ç”¨ this æ¥è·å–æ–¹æ³•çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­è¯´æ˜äº†è¿™ä¸ªé—®é¢˜ï¼š</p>

<pre><code class="language-javascript">let o = {                 // An object o.
    m: function() {       // Method m of the object.
        let self = this;  // Save the &quot;this&quot; value in a variable.
        this === o        // =&gt; true: &quot;this&quot; is the object o.
        f();              // Now call the helper function f().

        function f() {    // A nested function f
            this === o    // =&gt; false: &quot;this&quot; is global or undefined
            self === o    // =&gt; true: self is the outer &quot;this&quot; value.
        }
    }
};
o.m();                    // Invoke the method m on the object o.
</code></pre>

<p>åµŒå¥—å‡½æ•° f() ä¸­ï¼Œthis å…³é”®ä¹‹ä¸ç­‰äºå¯¹è±¡ oã€‚è¿™è¢«å¹¿æ³›çš„è®¤ä¸ºæ˜¯ JavaScript çš„ä¸€ä¸ªç¼ºé™·ï¼Œäº†è§£è¿™ä¸€ç‚¹æ˜¯å¾ˆæ˜¯å¾ˆé‡è¦çš„ã€‚ä¸Šé¢çš„ä»£ç æ¼”ç¤ºäº†ä¸€ç§å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨æ–¹æ³• m ä¸­ï¼Œå°† this å€¼èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ selfï¼Œåœ¨ç­¾åˆ°å‡½æ•° f ä¸­ï¼Œå¯ä»¥ç”¨ self ä»£æ›¿ this æ¥å¼•ç”¨åŒ…å«å®ƒçš„å¯¹è±¡ã€‚</p>

<p>åœ¨ ES6 ä¹‹åï¼Œæœ‰å¦å¤–ä¸€ç§è§£å†³æ–¹æ¡ˆæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°†åµŒå¥—å‡½æ•° f è½¬æ¢æˆç®­å¤´å‡½æ•°ï¼Œå®ƒä¼šæ­£ç¡®çš„ç»§æ‰¿ this å€¼ï¼š</p>

<pre><code class="language-javascript">const f = () =&gt; {
    this === o  // true, since arrow functions inherit this
};
</code></pre>

<p>å‡½æ•°è¡¨è¾¾å¼ä¸åƒå‡½æ•°å£°æ˜ï¼Œå£°æ˜æå‰ï¼Œæ‰€ä»¥ä¸ºäº†è®©è¿™ç§è§£å†³æ–¹æ¡ˆå®šä¹‰çš„å‡½æ•°å¯ä»¥è¢«è°ƒç”¨ï¼Œéœ€è¦å°† f å‡½æ•°å®šä¹‰è¡¨è¾¾å¼æ”¾åœ¨æ–¹æ³• m ä¸­ï¼Œè¿™æ ·å®ƒæ‰å¯ä»¥åœ¨å®ƒè¢«è°ƒç”¨æ—¶å­˜åœ¨ã€‚</p>

<p>å¦å¤–è¿˜å¯ä»¥ç”¨åµŒå¥—å‡½æ•°çš„ bind() æ–¹æ³•ï¼Œåœ¨æŒ‡å®šå¯¹è±¡ä¸Šéšå¼è°ƒç”¨ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼š</p>

<pre><code class="language-javascript">const f = (function() {
    this === o  // true, since we bound this function to the outer this
}).bind(this);
</code></pre>

<p>å…³äº bind() æ–¹æ³•å°†åœ¨ Â§8.7.5 ä¸­è®²è§£ã€‚</p>

<h3 id="toc_11">8.2.3 æ„é€ å‡½æ•°è°ƒç”¨</h3>

<p>å¦‚æœå‡½æ•°æˆ–è€…æ–¹æ³•è°ƒç”¨ä¹‹å‰å¸¦æœ‰å…³é”®å­— newï¼Œå®ƒå°±æ„æˆæ„é€ å‡½æ•°è°ƒç”¨ï¼ˆæ„é€ å‡½æ•°è°ƒç”¨åœ¨ Â§4.6 å’Œ Â§6.2.2 èŠ‚æœ‰ç®€å•ä»‹ç»ï¼Œç¬¬9ç« ä¼šå¯¹æ„é€ å‡½æ•°åšæ›´è¯¦ç»†çš„è®¨è®ºï¼‰ã€‚æ„é€ å‡½æ•°è°ƒç”¨å’Œæ™®é€šçš„å‡½æ•°è°ƒç”¨ä»¥åŠæ–¹æ³•è°ƒç”¨åœ¨å®å‚å¤„ç†ã€è°ƒç”¨ä¸Šä¸‹æ–‡å’Œè¿”å›å€¼æ–¹é¢éƒ½æœ‰ä¸åŒã€‚</p>

<p>å¦‚æœæ„é€ å‡½æ•°è°ƒç”¨åœ¨åœ†æ‹¬å·å†…åŒ…å«ä¸€ç»„å®å‚åˆ—è¡¨ï¼Œå…ˆè®¡ç®—è¿™äº›å®å‚è¡¨è¾¾å¼ï¼Œç„¶åä¼ å…¥å‡½æ•°å†…ï¼Œè¿™å’Œå‡½æ•°è°ƒç”¨å’Œæ–¹æ³•è°ƒç”¨æ˜¯ä¸€è‡´çš„ã€‚ä½†å¦‚æœæ„é€ å‡½æ•°æ²¡æœ‰å½¢å‚ï¼ŒJavaScript æ„é€ å‡½æ•°è°ƒç”¨çš„è¯­æ³•æ˜¯å…è®¸çœç•¥å®å‚åˆ—è¡¨å’Œåœ†æ‹¬å·çš„ã€‚å‡¡æ˜¯æ²¡æœ‰å½¢å‚çš„æ„é€ å‡½æ•°è°ƒç”¨éƒ½å¯ä»¥çœç•¥åœ†æ‹¬å·ï¼Œæ¯”å¦‚ï¼Œä¸‹é¢è¿™ä¸¤è¡Œä»£ç å°±æ˜¯ç­‰ä»·çš„ï¼š</p>

<pre><code class="language-javascript">o = new Object();
o = new Object;
</code></pre>

<p>æ„é€ å‡½æ•°è°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç»§æ‰¿è‡ªæ„é€ å‡½æ•°çš„ prototype å±æ€§ã€‚æ„é€ å‡½æ•°è¯•å›¾åˆå§‹åŒ–è¿™ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå¹¶å°†è¿™ä¸ªå¯¹è±¡ç”¨åšå…¶è°ƒç”¨ä¸Šä¸‹æ–‡ï¼Œå› æ­¤æ„é€ å‡½æ•°å†…å¯ä»¥ä½¿ç”¨ this å…³é”®å­—æ¥å¼•ç”¨è¿™ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡ã€‚æ³¨æ„ï¼Œå°½ç®¡æ„é€ å‡½æ•°çœ‹èµ·æ¥åƒä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œå®ƒä¾ç„¶ä¼šä½¿ç”¨è¿™ä¸ªæ–°å¯¹è±¡ä½œä¸ºè°ƒç”¨ä¸Šä¸‹æ–‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¡¨è¾¾å¼ new o.m() ä¸­ï¼Œè°ƒç”¨ä¸Šä¸‹æ–‡å¹¶ä¸æ˜¯ oã€‚</p>

<p>æ„é€ å‡½æ•°é€šå¸¸ä¸ä½¿ç”¨ return å…³é”®å­—ï¼Œå®ƒä»¬é€šå¸¸åˆå§‹åŒ–æ–°å¯¹è±¡ï¼Œå½“æ„é€ å‡½æ•°çš„å‡½æ•°ä½“æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œå®ƒä¼šéšå¼è¿”å›ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ„é€ å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœå°±æ˜¯è¿™ä¸ªæ–°å¯¹è±¡çš„å€¼ã€‚ç„¶è€Œå¦‚æœæ„é€ å‡½æ•°æ˜¾å¼åœ°ä½¿ç”¨ return è¯­å¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆè°ƒç”¨è¡¨è¾¾å¼çš„å€¼å°±æ˜¯è¿™ä¸ªå¯¹è±¡ã€‚å¦‚æœæ„é€ å‡½æ•°ä½¿ç”¨ return è¯­å¥ä½†æ²¡æœ‰æŒ‡å®šè¿”å›å€¼ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªåŸå§‹å€¼ï¼Œé‚£ä¹ˆè¿™æ—¶å°†å¿½ç•¥è¿”å›å€¼ï¼ŒåŒæ—¶ä½¿ç”¨è¿™ä¸ªæ–°å¯¹è±¡ä½œä¸ºè°ƒç”¨ç»“æœã€‚</p>

<h3 id="toc_12">8.2.4 é—´æ¥è°ƒç”¨</h3>

<p>JavaScript ä¸­çš„å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå’Œå…¶ä»– JavaScript å¯¹è±¡æ²¡ä»€ä¹ˆä¸¤æ ·ï¼Œå‡½æ•°å¯¹è±¡ä¹Ÿå¯ä»¥åŒ…å«æ–¹æ³•ã€‚å…¶ä¸­çš„ä¸¤ä¸ªæ–¹æ³• call() å’Œ apply() å¯ä»¥ç”¨æ¥é—´æ¥åœ°è°ƒç”¨å‡½æ•°ã€‚ä¸¤ä¸ªæ–¹æ³•éƒ½å…è®¸æ˜¾å¼æŒ‡å®šè°ƒç”¨æ‰€éœ€çš„ this å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•å‡½æ•°å¯ä»¥ä½œä¸ºä»»ä½•å¯¹è±¡çš„æ–¹æ³•æ¥è°ƒç”¨ï¼Œå“ªæ€•è¿™ä¸ªå‡½æ•°ä¸æ˜¯é‚£ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥æŒ‡å®šè°ƒç”¨çš„å®å‚ã€‚call() æ–¹æ³•ä½¿ç”¨å®ƒè‡ªæœ‰çš„å®å‚åˆ—è¡¨ä½œä¸ºå‡½æ•°çš„å®å‚ï¼Œapply() æ–¹æ³•åˆ™è¦æ±‚ä»¥æ•°ç»„çš„å½¢å¼ä¼ å…¥å®å‚ã€‚Â§8.7.4 èŠ‚ä¼šæœ‰å…³äº call() å’Œapply () æ–¹æ³•çš„è¯¦ç»†è®¨è®ºã€‚</p>

<h3 id="toc_13">8.2.5 å‡½æ•°éšå¼è°ƒç”¨</h3>

<p>æœ‰å„ç§å„æ ·çš„ JavaScript è¯­è¨€ç‰¹æ€§ï¼Œå®ƒä»¬çœ‹èµ·æ¥ä¸åƒå‡½æ•°è°ƒç”¨ä½†æ˜¯å´èƒ½è°ƒç”¨å‡½æ•°ã€‚é¢å¤–å°å¿ƒç¼–å†™å‡½æ•°æ—¶å¯èƒ½ä¼šéšå¼è°ƒç”¨ï¼Œå› ä¸ºåœ¨éšå¼å‡½æ•°è°ƒç”¨ä¸­ bugã€å‰¯ä½œç”¨å’Œæ€§èƒ½é—®é¢˜éƒ½æ¯”æ™®é€šçš„å‡½æ•°æ›´éš¾è¯Šæ–­å’Œä¿®å¤ã€‚</p>

<p>å¯èƒ½å¼•èµ·å‡½æ•°éšå¼è°ƒç”¨çš„è¯­è¨€ç‰¹æ€§åŒ…æ‹¬ï¼š</p>

<p>å¦‚æœä¸€ä¸ªå¯¹è±¡å®šä¹‰äº† getter æˆ–è€… setter æ–¹æ³•ï¼Œè·å–æˆ–è€…è®¾ç½®å®ƒçš„å±æ€§å€¼å¯èƒ½è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚è§ Â§6.10.6 æœ‰æ›´å¤šç›¸å…³æè¿°ã€‚</p>

<p>å½“å¯¹è±¡ç”¨ä½œä¸€ä¸ªå­—ç¬¦ä¸²æ–‡æœ¬æ—¶ï¼ˆä¾‹å¦‚å¯¹è±¡å’Œä¸€ä¸ªå­—ç¬¦ä¸²è¿æ¥ï¼‰ï¼Œå®ƒçš„ toString() æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚åŒæ ·çš„ï¼Œå¯¹è±¡ç”¨ä½œä¸€ä¸ªæ•°å€¼å‹æ–‡æœ¬æ—¶ï¼Œå®ƒçš„ valueOf() æ–¹æ³•è¢«è°ƒç”¨ã€‚è¯¦è§ Â§3.9.3ã€‚</p>

<p>å½“å¾ªç¯å¯è¿­ä»£å¯¹è±¡çš„å…ƒç´ æ—¶ä¼šäº§ç”Ÿå¾ˆå¤šæ–¹æ³•è°ƒç”¨ã€‚ç¬¬12ç« ä»‹ç»äº†è¿­ä»£å™¨åœ¨å‡½æ•°è°ƒç”¨çº§åˆ«å¦‚ä½•å·¥ä½œï¼Œå¹¶æ¼”ç¤ºå¦‚ä½•ç¼–å†™æ–¹æ³•æ¥å®šä¹‰è‡ªå·±çš„å¯è¿­ä»£ç±»å‹ã€‚</p>

<p>å¯ä»¥ä¼ªè£…åœ¨æ¨¡æ¿å­—é¢é‡ä¸­ ã€‚åœ¨ Â§14.5 ä¸­æ¼”ç¤ºå¦‚ä½•åœ¨æ¨¡æ¿å­—ç¬¦ä¸²ä¸­è°ƒç”¨å‡½æ•°ã€‚</p>

<p>Proxy å¯¹è±¡ï¼ˆåœ¨ Â§14.7 ä¸­æè¿°ï¼‰çš„è¡Œä¸ºå®Œå…¨ç”±å‡½æ•°æ§åˆ¶ã€‚å®ƒçš„ä»»ä½•ä¸€ä¸ªæ“ä½œéƒ½ä¼šå¯¼è‡´å‡½æ•°è°ƒç”¨ã€‚</p>

<h2 id="toc_14">8.3 å‡½æ•°çš„å®å‚å’Œå½¢å‚</h2>

<p>JavaScript ä¸­çš„å‡½æ•°å®šä¹‰å¹¶æœªæŒ‡å®šå‡½æ•°å½¢å‚çš„ç±»å‹ï¼Œå‡½æ•°è°ƒç”¨ä¹Ÿæœªå¯¹ä¼ å…¥çš„å®å‚å€¼åšä»»ä½•ç±»å‹æ£€æŸ¥ã€‚å®é™…ä¸Šï¼ŒJavaScript å‡½æ•°è°ƒç”¨ç”šè‡³ä¸æ£€æŸ¥ä¼ å…¥å½¢å‚çš„ä¸ªæ•°ã€‚ä¸‹é¢å‡ èŠ‚å°†ä¼šè®¨è®ºå½“è°ƒç”¨å‡½æ•°æ—¶çš„å®å‚ä¸ªæ•°å’Œå£°æ˜çš„å½¢å‚ä¸ªæ•°ä¸åŒ¹é…æ—¶å‡ºç°çš„çŠ¶å†µï¼ŒåŒæ ·ä»‹ç»äº†å¦‚ä½•æ˜¾å¼æµ‹è¯•å‡½æ•°å®å‚çš„ç±»å‹ï¼Œä»¥é¿å…éæ³•çš„å®å‚ä¼ å…¥å‡½æ•°ã€‚</p>

<h3 id="toc_15">8.3.1 å¯é€‰å½¢å‚å’Œé»˜è®¤å€¼</h3>

<p>å½“è°ƒç”¨å‡½æ•°çš„æ—¶å€™ä¼ å…¥çš„å®å‚æ¯”å‡½æ•°å£°æ˜æ—¶æŒ‡å®šçš„å½¢å‚ä¸ªæ•°è¦å°‘ï¼Œå‰©ä¸‹çš„å½¢å‚éƒ½å°†è®¾ç½®ä¸º undefined å€¼ã€‚æ‰€ä»¥ä¸€äº›å‚æ•°è®¾ç½®æˆå¯é€‰çš„æ˜¯éå¸¸å®ç”¨çš„ã€‚çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>

<pre><code class="language-javascript">// Append the names of the enumerable properties of object o to the
// array a, and return a.  If a is omitted, create and return a new array.
function getPropertyNames(o, a) {
    if (a === undefined) a = [];  // If undefined, use a new array
    for(let property in o) a.push(property);
    return a;
}

// getPropertyNames() can be invoked with one or two arguments:
let o = {x: 1}, p = {y: 2, z: 3};  // Two objects for testing
let a = getPropertyNames(o); // a == [&quot;x&quot;]; get o&#39;s properties in a new array
getPropertyNames(p, a);      // a == [&quot;x&quot;,&quot;y&quot;,&quot;z&quot;]; add p&#39;s properties to it
</code></pre>

<p>ç¬¬ä¸€è¡Œä»£ç ä¸­å¯ä»¥ä½¿ç”¨ || è¿ç®—ç¬¦æ¥ä»£æ›¿ä¸€ä¸ª if è¯­å¥ï¼Œè¿™æ˜¯ä¸€ç§ä¹ æƒ¯ç”¨æ³•ï¼š</p>

<pre><code class="language-javascript">a = a || [];
</code></pre>

<p>å›å¿†ä¸€ä¸‹ï¼ŒÂ§4.10.2 ä»‹ç»äº†â€œ||â€è¿ç®—ç¬¦ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå®å‚æ˜¯çœŸå€¼çš„è¯å°±è¿”å›ç¬¬ä¸€ä¸ªå®å‚ï¼›å¦åˆ™è¿”å›ç¬¬äºŒä¸ªå®å‚ã€‚åœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œå¦‚æœä½œä¸ºç¬¬äºŒä¸ªå®å‚ä¼ å…¥ä»»æ„å¯¹è±¡ï¼Œé‚£ä¹ˆå‡½æ•°å°±ä¼šä½¿ç”¨è¿™ä¸ªå¯¹è±¡ã€‚å¦‚æœçœç•¥æ‰ç¬¬äºŒä¸ªå®å‚ï¼ˆæˆ–è€…ä¼ é€’ null ä»¥åŠå…¶ä»–ä»»ä½•å‡å€¼ï¼‰ï¼Œé‚£ä¹ˆå°±æ–°åˆ›å»ºä¸€ä¸ªç©ºæ•°ç»„ï¼Œå¹¶èµ‹å€¼ç»™ aã€‚</p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ç”¨è¿™ç§å¯é€‰å®å‚æ¥å®ç°å‡½æ•°æ—¶ï¼Œéœ€è¦å°†å¯é€‰å®å‚æ”¾åœ¨å®å‚åˆ—è¡¨çš„æœ€åã€‚é‚£äº›è°ƒç”¨ä½ çš„å‡½æ•°çš„ç¨‹åºå‘˜æ˜¯æ²¡åŠæ³•çœç•¥ç¬¬ä¸€ä¸ªå®å‚å¹¶ä¼ å…¥ç¬¬äºŒä¸ªå®å‚ï¼Œä»–ä»¬å¿…é¡»æ˜¾åœ°çš„å°† undefined ä¼ å…¥ä½œä¸ºç¬¬ä¸€ä¸ªå®å‚ ã€‚</p>

<p>åœ¨ ES6 ä¹‹åï¼Œå¯ä»¥ç›´æ¥åœ¨å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­ä¸ºæ¯ä¸ªå‡½æ•°å‚æ•°å®šä¹‰é»˜è®¤å€¼ã€‚ç›´æ¥åœ¨å‚æ•°ååé¢æ¥ä¸€ä¸ªç­‰å·å†æ¥ä¸€ä¸ªé»˜è®¤å€¼ï¼ˆç”¨äºæ²¡æœ‰å®å‚æä¾›ç»™å‚æ•°æ—¶å‚æ•°çš„å€¼ï¼‰ï¼š</p>

<pre><code class="language-javascript">// Append the names of the enumerable properties of object o to the
// array a, and return a.  If a is omitted, create and return a new array.
function getPropertyNames(o, a = []) {
    for(let property in o) a.push(property);
    return a;
}
</code></pre>

<p>é»˜è®¤å‚æ•°è¡¨è¾¾å¼åªæœ‰åœ¨å‡½æ•°è°ƒç”¨æ—¶è¿›è¡Œè®¡ç®—ï¼Œè€Œä¸æ˜¯åœ¨å®ƒå®šä¹‰æ—¶ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡ getPropertyNames() å‡½æ•°åªä¼ ä¸€ä¸ªå®å‚è°ƒç”¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„ç©ºæ•°ç»„è¢«åˆ›å»ºå¹¶ä¼ ç»™å‚æ•°ã€‚<sup id="fnref2"><a href="#fn2" rel="footnote">2</a></sup> æœ€å®¹æ˜“ç†è§£çš„å°±æ˜¯å‚æ•°é»˜è®¤å€¼æ˜¯å¸¸é‡ï¼ˆæˆ–è€…å­—é¢é‡è¡¨è¾¾å¼ [] å’Œ {}ï¼‰ã€‚ä½†è¿™å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼šä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ç”¨å˜é‡æˆ–è€…å‡½æ•°è°ƒç”¨ï¼Œè®¡ç®—ä¸€ä¸ªé»˜è®¤å‚æ•°çš„å€¼ã€‚ä¸€ä¸ªå¾ˆæœ‰è¶£çš„æƒ…å†µæ˜¯ï¼Œå¯¹äºæœ‰å¤šä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå¯ä»¥ç”¨å‰é¢çš„å‚æ•°å€¼æ¥å®šä¹‰åé¢çš„å‚æ•°é»˜è®¤å€¼ã€‚</p>

<pre><code class="language-javascript">// This function returns an object representing a rectangle&#39;s dimensions.
// If only width is supplied, make it twice as high as it is wide.
const rectangle = (width, height=width*2) =&gt; ({width, height});
rectangle(1)  // =&gt; { width: 1, height: 2 }
</code></pre>

<p>è¿™æ®µä»£ç æè¿°äº†ç®­å¤´å‡½æ•°ä¸­çš„å‚æ•°é»˜è®¤å€¼ã€‚æ–¹æ³•å‡½æ•°å’Œå…¶ä»–å½¢å¼çš„å‡½æ•°å®šä¹‰ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>

<h3 id="toc_16">8.3.2 å‰©ä½™å‚æ•°å’Œå¯å˜é•¿å®å‚åˆ—è¡¨</h3>

<p>è°ƒç”¨å‡½æ•°æ—¶å…è®¸ä¼ å…¥çš„å®å‚æ¯”å‡½æ•°å£°æ˜æ—¶æŒ‡å®šçš„å½¢å‚ä¸ªæ•°å°‘ã€‚å‰©ä½™å‚æ•°å…è®¸ç›¸åçš„æƒ…å†µï¼šå®ƒå…è®¸æˆ‘ä»¬åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼ å…¥æ¯”å‹å‚å¤šä»»æ„ä¸ªæ•°çš„å®å‚ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¯ä»¥ä¼ å…¥ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å€¼å‹å®å‚çš„ä¾‹å­ï¼Œå¹¶ä¸”è¿”å›å…¶ä¸­æœ€å¤§çš„æ•°ï¼š</p>

<pre><code class="language-javascript">function max(first=-Infinity, ...rest) {
    let maxValue = first; // Start by assuming the first arg is biggest
    // Then loop through the rest of the arguments, looking for bigger
    for(let n of rest) {
        if (n &gt; maxValue) {
            maxValue = n;
        }
    }
    // Return the biggest
    return maxValue;
}

max(1, 10, 100, 2, 3, 1000, 4, 5, 6)  // =&gt; 1000
</code></pre>

<p>å‰©ä½™å‚æ•°ç”±ä¸‰ä¸ª . å¼€å§‹ï¼Œå¿…é¡»æ˜¯å‡½æ•°å£°æ˜çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚è°ƒç”¨æœ‰å‰©ä½™å‚æ•°çš„å‡½æ•°æ—¶ï¼Œä¼ é€’çš„å®å‚å…ˆèµ‹å€¼ç»™éå‰©ä½™å‚æ•°ï¼Œç„¶åå…¶ä½™æ‰€æœ‰çš„å®å‚ï¼ˆä¹Ÿå°±æ˜¯â€œå‰©ä½™â€å®å‚ï¼‰å­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„ä¸­å˜æˆå‰©ä½™å‚æ•°çš„å€¼ï¼Œæœ€åä¸€ç‚¹éå¸¸é‡è¦ï¼šåœ¨ä¸€ä¸ªå‡½æ•°ä½“ä¸­ï¼Œå‰©ä½™å‚æ•°çš„å€¼æ€»æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„å¯èƒ½æ˜¯ç©ºçš„ï¼Œä½†æ˜¯å‰©ä½™å‚æ•°æ°¸è¿œä¸ä¼šæ˜¯ undefinedã€‚ï¼ˆå› æ­¤ï¼Œä»ä¸ä¼šç»™å‰©ä½™å‚æ•°è®¾ç½®é»˜è®¤å€¼ï¼Œå¹¶ä¸”è¿™ä¹Ÿæ˜¯ä¸åˆæ³•çš„ã€‚ï¼‰</p>

<p>ç±»ä¼¼è¿™ç§å‡½æ•°å¯ä»¥æ¥æ”¶ä»»æ„ä¸ªæ•°çš„å®å‚ï¼Œè¿™ç§å‡½æ•°ä¹Ÿç§°ä¸ºâ€œä¸å®šå®å‚å‡½æ•°â€ï¼Œè¿™ä¸ªæœ¯è¯­æºè‡ªå¤è€çš„Cè¯­è¨€ã€‚</p>

<p>ä¸è¦æ··æ·† ... å®šä¹‰å‡½æ•°çš„å‰©ä½™å‚æ•°å’Œ ... å±•å¼€è¿ç®—ç¬¦ï¼Œå°†åœ¨ Â§8.3.4 æè¿°å±•å¼€è¿ç®—ç¬¦åœ¨å‡½æ•°è°ƒç”¨ä¸­çš„åº”ç”¨ã€‚</p>

<h3 id="toc_17">8.3.3 å®å‚å¯¹è±¡</h3>

<p>å‰©ä½™å‚æ•°æ˜¯åœ¨ ES6 ä¸­åŠ å…¥çš„æ¦‚å¿µã€‚åœ¨è¿™ä¹‹å‰ï¼Œä¸å®šå®å‚å‡½æ•°æ˜¯ç”¨ Arguments å¯¹è±¡å®ç°çš„ï¼šåœ¨å‡½æ•°ä½“ä¸­ï¼Œæ ‡è¯†ç¬¦ Arguments æ˜¯æŒ‡å‘å®å‚å¯¹è±¡çš„å¼•ç”¨ã€‚Arguments å¯¹è±¡æ˜¯ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡ï¼ˆå‚ç…§ Â§7.9ï¼‰ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡æ•°å­—ä¸‹æ ‡å°±èƒ½è®¿é—®ä¼ å…¥å‡½æ•°çš„å®å‚å€¼ï¼Œè€Œä¸ç”¨éè¦é€šè¿‡åå­—æ¥å¾—åˆ°å®å‚ã€‚ä¸‹é¢çš„ max() å‡½æ•°å°±æ˜¯ä»¥å‰ç”¨ Arguments å¯¹è±¡ä»£æ›¿å‰©ä½™å‚æ•°çš„ä¾‹å­ï¼š</p>

<pre><code class="language-javascript">function max(x) {
    let maxValue = -Infinity;
    // Loop through the arguments, looking for, and remembering, the biggest.
    for(let i = 0; i &lt; arguments.length; i++) {
        if (arguments[i] &gt; maxValue) maxValue = arguments[i];
    }
    // Return the biggest
    return maxValue;
}

max(1, 10, 100, 2, 3, 1000, 4, 5, 6)  // =&gt; 1000
</code></pre>

<p>Arguments å¯¹è±¡å¯è¿½æº¯åˆ° JavaScript çš„æœ€æ—©æ—¶ä»£ï¼Œå¹¶å¸¦æœ‰ä¸€äº›å¥‡æ€ªçš„å†å²åŒ…è¢±ï¼Œè¿™ä½¿å¾—å®ƒæ•ˆç‡ä½ä¸‹ä¸”éš¾ä»¥ä¼˜åŒ–ï¼Œå°¤å…¶æ˜¯ä¸åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ã€‚å¯èƒ½è¿˜ä¼šé‡åˆ°ä¸€äº›ä»£ç ä½¿ç”¨ Arguments å¯¹è±¡ï¼Œä½†æ˜¯åœ¨ç¼–å†™æ–°ä»£ç æ—¶è¦é¿å…ä½¿ç”¨ï¼Œå¯ä»¥ç”¨ ... å‰©ä½™å‡½æ•°æ¥æ›¿ä»£ã€‚Arguments å¯¹è±¡è¿˜æœ‰éƒ¨åˆ†ä»¤äººé—æ†¾çš„é—äº§ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œarguments è¢«è§†ä¸ºä¿ç•™å­—ï¼Œä¸èƒ½å£°æ˜å…·æœ‰è¯¥åç§°çš„å±€éƒ¨å˜é‡æ¥å®šä¹‰å‡½æ•°çš„å‚æ•°ã€‚</p>

<h3 id="toc_18">8.3.4 å‡½æ•°è°ƒç”¨æ—¶çš„å±•å¼€è¿ç®—ç¬¦</h3>

<p>å½“éœ€è¦å•ä¸ªå€¼æ—¶ï¼Œ... å±•å¼€è¿ç®—ç¬¦ç”¨æ¥æ‹†åŒ…ï¼Œæˆ–è€…è¯´å°†å…ƒç´ ä»æ•°ç»„ï¼ˆæˆ–è€…å…¶ä»–çš„ä»»ä½•å’Œè¿­ä»£å¯¹è±¡ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ï¼‰ä¸­â€œå±•å¼€â€åˆ°ä¸Šä¸‹æ–‡ã€‚æˆ‘ä»¬å·²ç»åœ¨ Â§7.1.2 è§åˆ°äº†å±•å¼€è¿ç®—ç¬¦åœ¨æ•°ç»„å­—é¢é‡ä¸Šçš„ä½¿ç”¨ã€‚å±•å¼€è¿ç®—ç¬¦å¯ä»¥åœ¨å‡½æ•°è°ƒç”¨ä¸­ä»¥åŒæ ·æ–¹å¼ä½¿ç”¨ï¼š</p>

<pre><code class="language-javascript">let numbers = [5, 2, 10, -1, 9, 100, 1];
Math.min(...numbers)  // =&gt; -1
</code></pre>

<p>æ³¨æ„ ... ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„è¿ç®—ç¬¦ï¼Œå› ä¸ºå®ƒä¸èƒ½é€šè¿‡è®¡ç®—æ¥æä¾›ä¸€ä¸ªå€¼ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥ç”¨åœ¨æ•°ç»„å­—é¢é‡å’Œå‡½æ•°è°ƒç”¨ä¸­çš„ç‰¹æ®Šçš„ JavaScript è¯­æ³•ã€‚</p>

<p>åœ¨å‡½æ•°å®šä¹‰å’Œå‡½æ•°è°ƒç”¨ä¸­ä½¿ç”¨ç›¸åŒçš„ ... è¯­æ³•æ—¶ï¼Œå’Œå±•å¼€è¿ç®—ç¬¦æœ‰ç€ç›¸ä»¿çš„æ•ˆæœã€‚åœ¨ Â§8.3.2 ä¸­æˆ‘ä»¬çœ‹åˆ°å‡½æ•°å®šä¹‰ä½¿ç”¨ ... å°†å¤æ•°ä¸ªå‡½æ•°å®å‚åˆå¹¶åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚å‰©ä½™å‚æ•°å’Œå±•å¼€è¿ç®—ç¬¦ç»å¸¸ä¸€åŒä½¿ç”¨ï¼Œå°±åƒä¸‹é¢è¿™ä¸ªå‡½æ•°ï¼š</p>

<pre><code class="language-javascript">// This function takes a function and returns a wrapped version
function timed(f) {
    return function(...args) {  // Collect args into a rest parameter array
        console.log(`Entering function ${f.name}`);
        let startTime = Date.now();
        try {
            // Pass all of our arguments to the wrapped function
            return f(...args);  // Spread the args back out again
        }
        finally {
            // Before we return the wrapped return value, print elapsed time.
            console.log(`Exiting ${f.name} after ${Date.now()-startTime}ms`);
        }
    };
}

// Compute the sum of the numbers between 1 and n by brute force
function benchmark(n) {
    let sum = 0;
    for(let i = 1; i &lt;= n; i++) sum += i;
    return sum;
}

// Now invoke the timed version of that test function
timed(benchmark)(1000000) // =&gt; 500000500000; this is the sum of the numbers
</code></pre>

<h3 id="toc_19">8.3.5 å®å‚è§£æ„åˆ°å½¢å‚ä¸­</h3>

<p>ç”¨å®å‚åˆ—è¡¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œå®å‚çš„å€¼æœ€ç»ˆèµ‹å€¼ç»™å‡½æ•°å®šä¹‰çš„å‚æ•°ã€‚å‡½æ•°è°ƒç”¨åˆå§‹åŒ–é˜¶æ®µéå¸¸åƒå˜é‡èµ‹å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸å¿…æƒŠè®¶äºå¯ä»¥å°†è§£æ„èµ‹å€¼ï¼ˆè§ Â§3.10.3ï¼‰ç”¨äºå‡½æ•°ã€‚</p>

<p>å¦‚æœä¸€ä¸ªå‡½æ•°çš„å‚æ•°å¸¦æœ‰æ–¹æ‹¬å·ï¼Œå°±è¯´æ˜å‡½æ•°è¦ç»™æ¯ä¸€ä¸ªæ–¹æ‹¬å·ä¼ ä¸€ä¸ªæ•°ç»„ã€‚åœ¨ä¸€ä¸ªè°ƒç”¨è¿›ç¨‹ä¸­ï¼Œæ•°ç»„å®å‚ä¼šè¢«æ‹†åŒ…ä¼ é€’ç»™å¯¹åº”çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬å°† 2D çŸ¢é‡è¡¨ç¤ºä¸ºä¸¤ä¸ªæ•°å­—çš„æ•°ç»„ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ X åæ ‡ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯ Y åæ ‡ã€‚ç”¨è¿™ä¸ªç®€å•çš„æ•°æ®ç»“æ„ï¼Œç¼–å†™ä¸‹é¢è¿™ä¸ªå‡½æ•°è®¡ç®—ä¸¤ä¸ªçŸ¢é‡çš„å’Œï¼š</p>

<pre><code class="language-javascript">function vectorAdd(v1, v2) {
    return [v1[0] + v2[0], v1[1] + v2[1]];
}
vectorAdd([1,2], [3,4])  // =&gt; [4,6]
</code></pre>

<p>å¦‚æœä¸‹é¢è¿™ç§æ–¹å¼è§£æ„è¿™ä¸¤ä¸ªçŸ¢é‡å®å‚ï¼Œè¿™æ®µä»£ç å°†æ›´å®¹æ˜“ç†è§£ï¼š</p>

<pre><code class="language-javascript">function vectorAdd([x1,y1], [x2,y2]) { // Unpack 2 arguments into 4 parameters
    return [x1 + x2, y1 + y2];
}
vectorAdd([1,2], [3,4])  // =&gt; [4,6]
</code></pre>

<p>åŒæ ·ï¼Œå¦‚æœå®šä¹‰ä¸€ä¸ªå‡½æ•°æ—¶éœ€è¦å¯¹è±¡å®å‚ï¼Œä½ èƒ½å¯¹è¿™ä¸ªå¯¹è±¡è¿›è¡Œå‚æ•°è§£æ„ã€‚å†æ¬¡å®ç”¨çŸ¢é‡çš„ä¾‹å­ï¼Œè¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬ç”¨ x å’Œ y å‚æ•°åŒ…è£…æˆå¯¹è±¡æ¥æè¿°çŸ¢é‡ï¼š</p>

<pre><code class="language-javascript">// Multiply the vector {x,y} by a scalar value
function vectorMultiply({x, y}, scalar) {
    return { x: x*scalar, y: y*scalar };
}
vectorMultiply({x: 1, y: 2}, 2)  // =&gt; {x: 2, y: 4}
</code></pre>

<p>è¿™ä¸ªä¾‹å­å°†ä¸€ä¸ªç®€å•çš„å¯¹è±¡å®å‚è§£æ„æˆä¸¤ä¸ªå‚æ•°æ˜¯å¾ˆç®€å•çš„ï¼Œå› ä¸ºå‚æ•°çš„åå­—å’Œæˆ‘ä»¬åœ¨å¯¹è±¡ä¸­ä½¿ç”¨çš„å±æ€§åæ˜¯åŒ¹é…çš„ã€‚å½“æ‚¨éœ€è¦å°†åŒä¸€ä¸ªåç§°çš„å±æ€§è§£æ„ä¸ºå…·æœ‰ä¸åŒåç§°çš„å‚æ•°æ—¶ï¼Œè¯­æ³•æ›´åŠ å†—é•¿å’Œéš¾æ‡‚ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªçŸ¢é‡åŠ æ³•çš„ä¾‹å­ï¼ŒåŸºäºå¯¹è±¡çŸ¢é‡çš„å®ç°ï¼š</p>

<pre><code class="language-javascript">function vectorAdd(
    {x: x1, y: y1}, // Unpack 1st object into x1 and y1 params
    {x: x2, y: y2}  // Unpack 2nd object into x2 and y2 params
)
{
    return { x: x1 + x2, y: y1 + y2 };
}
vectorAdd({x: 1, y: 2}, {x: 3, y: 4})  // =&gt; {x: 4, y: 6}
</code></pre>

<p>åƒ {x:x1, y:y1} çš„è§£æ„è¯­æ³•æ£˜æ‰‹çš„æ˜¯è®°ä½å“ªä¸€ä¸ªæ˜¯å±æ€§åå“ªä¸€ä¸ªæ˜¯å‚æ•°åã€‚ç‰¢è®°è§£æ„èµ‹å€¼å’Œè§£æ„å‡½æ•°è°ƒç”¨çš„è§„åˆ™ï¼Œå£°æ˜çš„å˜é‡æˆ–å‚æ•°åœ¨å¯¹è±¡å­—é¢é‡ä¸­çš„ä½ç½®å›ºå®šã€‚å±æ€§åæ€»æ˜¯åœ¨å†’å·çš„å·¦è¾¹ï¼Œå‚æ•°ï¼ˆæˆ–å˜é‡ï¼‰ååœ¨å³è¾¹ã€‚</p>

<p>å¯ä»¥ä½¿ç”¨è§£æ„å‚æ•°å®šä¹‰å‚æ•°é»˜è®¤å€¼ã€‚ä¸‹é¢æ˜¯é€‚ç”¨äº 2D æˆ– 3D çŸ¢é‡çš„çŸ¢é‡ä¹˜æ³•ï¼š</p>

<pre><code class="language-javascript">// Multiply the vector {x,y} or {x,y,z} by a scalar value
function vectorMultiply({x, y, z=0}, scalar) {
    return { x: x*scalar, y: y*scalar, z: z*scalar };
}
vectorMultiply({x: 1, y: 2}, 2)  // =&gt; {x: 2, y: 4, z: 0}
</code></pre>

<p>ä¸€äº›è¯­è¨€ï¼ˆåƒ Pythonï¼‰å…è®¸å‡½æ•°çš„è°ƒç”¨è€…ä»¥ <code>name=value</code> å‹å¼æŒ‡å®šå®å‚ï¼Œè¿™åœ¨æœ‰å¾ˆå¤šå¯é€‰å®å‚æˆ–è€…å‚æ•°åˆ—è¡¨é•¿åˆ°éš¾ä»¥è®°ä½æ­£ç¡®çš„é¡ºåºæ—¶æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚JavaScript ä¸å…è®¸ç›´æ¥è¿™æ ·åšï¼Œä½†å¯ä»¥é€šè¿‡è§£æ„å¯¹è±¡å®å‚åˆ°å‡½æ•°å‚æ•°ä¸­ã€‚æ„æ€ä¸€ä¸ªå‡½æ•°å°†æŒ‡å®šæ•°é‡çš„å…ƒç´ ä»ä¸€ä¸ªæ•°ç»„å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå¯ä»¥éšæ„åœ°ä¸ºæ¯ä¸ªæ•°ç»„æŒ‡å®šèµ·å§‹åç§»é‡ã€‚å¦‚ä¸‹æœ‰äº”ä¸ªå¯ä¼ å…¥å‚æ•°ï¼Œå…¶ä¸­ä¸€äº›æœ‰é»˜è®¤å€¼ï¼Œå¹¶ä¸”è°ƒç”¨è€…å¾ˆéš¾è®°ä½å‚æ•°çš„é¡ºåºæ¥ä¼ é€’å®å‚ï¼Œå¯ä»¥åƒè¿™æ ·å®šä¹‰å’Œè°ƒç”¨ arraycopy() æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">function arraycopy({from, to=from, n=from.length, fromIndex=0, toIndex=0}) {
    let valuesToCopy = from.slice(fromIndex, fromIndex + n);
    to.splice(toIndex, 0, ...valuesToCopy);
    return to;
}
let a = [1,2,3,4,5], b = [9,8,7,6,5];
arraycopy({from: a, n: 3, to: b, toIndex: 4}) // =&gt; [9,8,7,6,1,2,3,5]
</code></pre>

<p>å½“è§£æ„ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨å…¶è¢«æ‹†åŒ…æ—¶ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªå‰©ä½™å‚æ•°å°†å…¶ä½™å€¼æ”¾åœ¨æ•°ç»„ä¸­ã€‚ åœ¨æ–¹æ‹¬å·ä¸­çš„å‰©ä½™å‚æ•°å’ŒçœŸæ­£çš„å‡½æ•°ä¸­çš„å‰©ä½™å‚æ•°æ˜¯å®Œå…¨ä¸åŒçš„ï¼š</p>

<pre><code class="language-javascript">// This function expects an array argument. The first two elements of that
// array are unpacked into the x and y parameters. Any remaining elements
// are stored in the coords array. And any arguments after the first array
// are packed into the rest array.
function f([x, y, ...coords], ...rest) {
    return [x+y, ...rest, ...coords];  // Note: spread operator here
}
f([1, 2, 3, 4], 5, 6)   // =&gt; [3, 5, 6, 3, 4]
</code></pre>

<p>åœ¨ ES2018ï¼Œä¹Ÿå¯ä»¥ç”¨å‰©ä½™å‚æ•°è§£æ„å¯¹è±¡ã€‚å‰©ä½™å‚æ•°æ˜¯ä¸€ä¸ªæ²¡æœ‰è§£æ„çš„å±æ€§çš„å¯¹è±¡ã€‚å¯¹è±¡å‰©ä½™å‚æ•°ç»å¸¸ä¸å¯¹è±¡å±•å¼€è¿ç®—ç¬¦è¿ç”¨ï¼Œè¿™æ˜¯ ES2018 çš„æ–°ç‰¹æ€§ï¼š</p>

<pre><code class="language-javascript">// Multiply the vector {x,y} or {x,y,z} by a scalar value, retain other props
function vectorMultiply({x, y, z=0, ...props}, scalar) {
    return { x: x*scalar, y: y*scalar, z: z*scalar, ...props };
}
vectorMultiply({x: 1, y: 2, w: -1}, 2)  // =&gt; {x: 2, y: 4, z: 0, w: -1}
</code></pre>

<p>æœ€åï¼Œè¯·è®°ä½ï¼Œé™¤äº†å¯ä»¥è§£æ„å®å‚å¯¹è±¡å’Œæ•°ç»„ï¼Œä¹Ÿå¯ä»¥è§£æ„æ•°ç»„å¯¹è±¡ï¼Œå¯¹è±¡æœ‰æ•°ç»„å±æ€§ï¼Œå¹¶ä¸”å¯¹è±¡è¿˜æœ‰å¯¹è±¡çš„å±æ€§ã€‚æ„æ€ä¸€ä¸ªå°†åœ†è¡¨ç¤ºä¸ºå…·æœ‰ xã€yã€åŠå¾„å’Œé¢œè‰²å±æ€§çš„å¯¹è±¡çš„å›¾å½¢ä»£ç ï¼Œé¢œè‰²å±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ç”± RGB ç»„æˆã€‚ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å¸Œæœ›å°†å•ä¸ªåœ†å¯¹è±¡ä¼ é€’ç»™å®ƒï¼Œä½†å…¶è§£æ„ä¸ºå…­ä¸ªå•ç‹¬çš„å‚æ•°ï¼š</p>

<pre><code class="language-javascript">function drawCircle({x, y, radius, color: [r, g, b]}) {
    // Not yet implemented
}
</code></pre>

<p>å¦‚æœå‡½æ•°å®å‚è§£æ„æ¯”è¿™æ›´å¤æ‚ï¼Œä»£ç ä¼šå˜å¾—æ›´éš¾è¯»ï¼Œè€Œä¸æ˜¯æ›´ç®€å•ã€‚æœ‰æ—¶ï¼Œæ˜¾ç¤ºåœ°å¯¹å¯¹è±¡å±æ€§è®¿é—®å’Œæ•°ç»„ç´¢å¼•ä¼šè®©ä»£ç æ›´æ¸…æ™°ã€‚</p>

<h3 id="toc_20">8.3.6 å®å‚ç±»å‹</h3>

<p>JavaScript æ–¹æ³•çš„å½¢å‚å¹¶æœªå£°æ˜ç±»å‹ï¼Œåœ¨å½¢å‚ä¼ å…¥å‡½æ•°ä½“ä¹‹å‰ä¹Ÿæœªåšä»»ä½•ç±»å‹æ£€æŸ¥ã€‚å¯ä»¥é‡‡ç”¨è¯­ä¹‰åŒ–çš„å•è¯æ¥ç»™å‡½æ•°å®å‚å‘½åï¼Œå¹¶åœ¨å‡½æ•°æ³¨é‡Šç»™æ¯ä¸€ä¸ªå®å‚è¯¦ç»†æè¿°ï¼Œä»¥æ­¤ä½¿ä»£ç è‡ªæ–‡æœ¬åŒ–ã€‚</p>

<p>Â§3.9 å·²ç»æåˆ°ï¼ŒJavaScript åœ¨å¿…è¦æ—¶ä¼šè¿›è¡Œç±»å‹è½¬æ¢ã€‚å› æ­¤å¦‚æœå‡½æ•°æœŸ æœ›æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å®å‚ï¼Œè€Œè°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥å…¶ä»–ç±»å‹çš„å€¼ï¼Œæ‰€ä¼ å…¥çš„å€¼ä¼šåœ¨å‡½æ•°ä½“å†…å°†å…¶ç”¨åšå­—ç¬¦ä¸²çš„åœ°æ–¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚æ‰€æœ‰çš„åŸå§‹ç±»å‹éƒ½å¯ä»¥è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åŒ…å« toString() æ–¹æ³•ï¼ˆå°½ç®¡ä¸ä¸€å®šæœ‰ç”¨ï¼‰ï¼Œæ‰€ä»¥è¿™ç§åœºæ™¯ä¸‹æ˜¯ä¸ä¼šæœ‰ä»»ä½•é”™è¯¯çš„ã€‚</p>

<p>ç„¶è€Œäº‹æƒ…ä¸æ€»æ˜¯è¿™æ ·ï¼Œå›å¤´çœ‹ä¸€ä¸‹åˆšæ‰æåˆ°çš„ arraycopy() æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æœŸæœ›è·å¾—ä¸€ä¸ªæˆ–ä¸¤ä¸ªå®å‚ï¼Œå¹¶ä¸”è¿™äº›å®å‚çš„ç±»å‹é”™è¯¯ä¼šå¯¼è‡´å‡½æ•°æ‰§è¡Œå¤±è´¥ã€‚é™¤éæ‰€å†™çš„ç§æœ‰å‡½æ•°åªä¼šè¢«é™„è¿‘çš„ä»£ç è°ƒç”¨ï¼Œä½ åº”å½“æ·»åŠ ç±»ä¼¼çš„å®å‚ç±»å‹æ£€æŸ¥é€»è¾‘ã€‚å› ä¸ºå®æ„¿ç¨‹åºåœ¨ä¼ å…¥éæ³•å€¼æ—¶æŠ¥é”™ï¼Œä¹Ÿä¸æ„¿éæ³•å€¼å¯¼è‡´ç¨‹åºåœ¨æ‰§è¡Œæ—¶æŠ¥é”™ï¼Œç›¸æ¯”è€Œè¨€ï¼Œé€»è¾‘æ‰§è¡Œæ—¶çš„æŠ¥é”™æ¶ˆæ¯ä¸ç”šæ¸…æ™°ä¸”æ›´éš¾å¤„ç†ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­çš„å‡½æ•°å°±åšäº†è¿™ç§ç±»å‹æ£€æŸ¥ï¼š</p>

<pre><code class="language-javascript">// Return the sum of the elements an iterable object a.
// The elements of a must all be numbers.
function sum(a) {
    let total = 0;
    for(let element of a) { // Throws TypeError if a is not iterable
        if (typeof element !== &quot;number&quot;) {
            throw new TypeError(&quot;sum(): elements must be numbers&quot;);
        }
        total += element;
    }
    return total;
}
sum([1,2,3])    // =&gt; 6
sum(1, 2, 3);   // !TypeError: 1 is not iterable
sum([1,2,&quot;3&quot;]); // !TypeError: element 2 is not a number
</code></pre>

<h2 id="toc_21">8.4 å‡½æ•°ä½œä¸ºå€¼</h2>

<p>å‡½æ•°å¯ä»¥å®šä¹‰ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ï¼Œè¿™æ˜¯å‡½æ•°æœ€é‡è¦çš„ç‰¹æ€§ã€‚å‡½æ•°å®šä¹‰å’Œè°ƒç”¨æ˜¯  JavaScript çš„è¯æ³•ç‰¹æ€§ï¼Œå¯¹äºå…¶ä»–å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€æ¥è¯´äº¦æ˜¯å¦‚æ­¤ã€‚ç„¶è€Œåœ¨ JavaScript ä¸­ï¼Œå‡½æ•°ä¸ä»…æ˜¯ä¸€ç§è¯­æ³•ï¼Œä¹Ÿæ˜¯å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡ï¼Œå­˜å‚¨åœ¨å¯¹è±¡çš„å±æ€§æˆ–æ•°ç»„çš„å…ƒç´ ä¸­ï¼Œä½œä¸ºå‚æ•°ä¼ å…¥å¦å¤–ä¸€ä¸ªå‡½æ•°ç­‰ã€‚<sup id="fnref3"><a href="#fn3" rel="footnote">3</a></sup></p>

<p>To understand how functions can be JavaScript data as well as JavaScript syntax, consider this function definition:</p>

<blockquote>
<p>ä¸ºäº†ä¾¿äºç†è§£ JavaScript ä¸­çš„å‡½æ•°æ˜¯å¦‚ä½•ç”¨åš Javascript æ•°æ®ä»¥åŠ JavaScript è¯­æ³•çš„ï¼Œæ¥çœ‹ä¸€ä¸‹è¿™æ ·ä¸€ä¸ªå‡½æ•°å®šä¹‰ï¼š</p>
</blockquote>

<pre><code class="language-javascript">function square(x) { return x*x; }
</code></pre>

<p>è¿™ä¸ªå®šä¹‰åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°å¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å˜é‡ squareã€‚å‡½æ•°çš„åå­—å®é™…ä¸Šæ˜¯æ— å½¢çš„ï¼Œå®ƒï¼ˆsquareï¼‰ä»…ä»…æ˜¯å˜é‡çš„åç§°ï¼Œè¿™ä¸ªå˜é‡æ˜¯å‡½æ•°å¯¹è±¡çš„å¼•ç”¨ã€‚å‡½æ•°è¿˜å¯ä»¥èµ‹å€¼ç»™å…¶ä»–çš„å˜é‡ï¼Œå¹¶ä¸”ä»å¯ä»¥æ­£å¸¸å·¥ä½œï¼š</p>

<pre><code class="language-javascript">let s = square;  // Now s refers to the same function that square does
square(4)        // =&gt; 16
s(4)             // =&gt; 16
</code></pre>

<p>é™¤äº†å¯ä»¥å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡ï¼ŒåŒæ ·å¯ä»¥å°†å‡½æ•°èµ‹å€¼ç»™å¯¹è±¡çš„å±æ€§ã€‚å½“å‡½æ•°ä½œä¸ºå¯¹è±¡çš„å±æ€§è°ƒç”¨æ—¶ï¼Œå‡½æ•°å°±ç§°ä¸ºâ€œæ–¹æ³•â€ï¼š</p>

<pre><code class="language-javascript">let o = {square: function(x) { return x*x; }}; // An object literal
let y = o.square(16);                          // y == 256
</code></pre>

<p>å‡½æ•°ç”šè‡³ä¸éœ€è¦å¸¦åå­—ï¼Œå°±åƒæŠŠå®ƒä»¬èµ‹å€¼ç»™æ•°ç»„å…ƒç´ ï¼š</p>

<pre><code class="language-javascript">let a = [x =&gt; x*x, 20]; // An array literal
a[0](a[1])              // =&gt; 400
</code></pre>

<p>ä¸Šé¢çš„ä¾‹å­çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œä½†çš„ç¡®æ˜¯åˆæ³•çš„å‡½æ•°è°ƒç”¨è¡¨è¾¾å¼ï¼</p>

<p>ä¸¾ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜å°†å‡½æ•°å½“ä½œå€¼æ¥å¯¹å¾…çš„ç›Šå¤„ï¼Œè€ƒè™‘ä¸‹ Array.sort() æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ç”¨æ¥å¯¹æ•°ç»„å…ƒç´ è¿›è¡Œæ’åºã€‚å› ä¸ºæ’åºçš„è§„åˆ™æœ‰å¾ˆå¤šï¼ˆåŸºäºæ•°å€¼å¤§å°ã€å­—æ¯è¡¨é¡ºåºã€æ—¥æœŸå¤§å°ã€ä»å°åˆ°å¤§ã€ä»å¤§åˆ°å°ç­‰ï¼‰ï¼Œsort() æ–¹æ³•å¯ä»¥æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç”¨æ¥å¤„ç†å…·ä½“çš„æ’åºæ“ä½œã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨éå¸¸ç®€å•ï¼šå¯¹äºä»»æ„ä¸¤ä¸ªå€¼éƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œä»¥æŒ‡å®šå®ƒä»¬åœ¨æ’åºåçš„æ•°ç»„ä¸­çš„å…ˆåé¡ºåºã€‚è¿™ä¸ªå‡½æ•°å‚æ•°ä½¿å¾— Array.sort() å…·æœ‰æ›´å®Œç¾çš„é€šç”¨æ€§å’Œæ— é™å¯æ‰©å±•æ€§ï¼Œå®ƒå¯ä»¥å¯¹ä»»ä½•ç±»å‹çš„æ•°æ®è¿›è¡Œä»»æ„æ’åºã€‚Â§7.8.6 æœ‰ç¤ºä¾‹ä»£ç ã€‚</p>

<p>ä¾‹ 8-1 å±•ç¤ºäº†å°†å‡½æ•°ç”¨åšå€¼æ—¶çš„ä¸€äº›ä¾‹å­ï¼Œè¿™æ®µä»£ç å¯èƒ½ä¼šéš¾è¯»ä¸€äº›ï¼Œä½†æ³¨é‡Šè§£é‡Šäº†ä»£ç çš„å…·ä½“å«ä¹‰ï¼š</p>

<p>ä¾‹ 8-1ï¼šç”¨å‡½æ•°åšå€¼</p>

<pre><code class="language-javascript">// We define some simple functions here
function add(x,y) { return x + y; }
function subtract(x,y) { return x - y; }
function multiply(x,y) { return x * y; }
function divide(x,y) { return x / y; }

// Here&#39;s a function that takes one of the preceding functions
// as an argument and invokes it on two operands
function operate(operator, operand1, operand2) {
    return operator(operand1, operand2);
}

// We could invoke this function like this to compute the value (2+3) + (4*5):
let i = operate(add, operate(add, 2, 3), operate(multiply, 4, 5));

// For the sake of the example, we implement the simple functions again,
// this time within an object literal;
const operators = {
    add:      (x,y) =&gt; x+y,
    subtract: (x,y) =&gt; x-y,
    multiply: (x,y) =&gt; x*y,
    divide:   (x,y) =&gt; x/y,
    pow:      Math.pow  // This works for predefined functions too
};

// This function takes the name of an operator, looks up that operator
// in the object, and then invokes it on the supplied operands. Note
// the syntax used to invoke the operator function.
function operate2(operation, operand1, operand2) {
    if (typeof operators[operation] === &quot;function&quot;) {
        return operators[operation](operand1, operand2);
    }
    else throw &quot;unknown operator&quot;;
}

operate2(&quot;add&quot;, &quot;hello&quot;, operate2(&quot;add&quot;, &quot; &quot;, &quot;world&quot;)) // =&gt; &quot;hello world&quot;
operate2(&quot;pow&quot;, 10, 2)  // =&gt; 100
</code></pre>

<h3 id="toc_22">8.4.1 è‡ªå®šä¹‰å‡½æ•°å±æ€§</h3>

<p>JavaScript ä¸­çš„å‡½æ•°å¹¶ä¸æ˜¯åŸå§‹å€¼ï¼Œè€Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°å¯ä»¥æ‹¥æœ‰å±æ€§ã€‚å½“å‡½æ•°éœ€è¦ä¸€ä¸ªâ€œé™æ€â€å˜é‡æ¥åœ¨è°ƒç”¨æ—¶ä¿æŒæŸä¸ªå€¼ä¸å˜ï¼Œæœ€æ–¹ä¾¿çš„æ–¹å¼å°±æ˜¯ç»™å‡½æ•°å®šä¹‰å±æ€§ï¼Œè€Œä¸æ˜¯å®šä¹‰å…¨å±€å˜é‡ï¼Œæ˜¾ç„¶å®šä¹‰å…¨å±€å˜é‡ä¼šè®©å‘½åç©ºé—´å˜å¾—æ›´åŠ æ‚ä¹±æ— ç« ã€‚æ¯”å¦‚ï¼Œå‡è®¾ä½ æƒ³å†™ä¸€ä¸ªè¿”å›ä¸€ä¸ªå”¯ä¸€æ•´æ•°çš„å‡½æ•°ï¼Œä¸ç®¡åœ¨å“ªé‡Œè°ƒç”¨å‡½æ•°éƒ½ä¼šè¿”å›è¿™ä¸ªæ•´æ•°ã€‚è€Œå‡½æ•°ä¸èƒ½ä¸¤æ¬¡è¿”å›åŒä¸€ä¸ªå€¼ï¼Œä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå‡½æ•°å¿…é¡»èƒ½å¤Ÿè·Ÿè¸ªå®ƒæ¯æ¬¡è¿”å›çš„å€¼ï¼Œè€Œä¸”è¿™äº›å€¼çš„ä¿¡æ¯éœ€è¦åœ¨ä¸åŒçš„å‡½æ•°è°ƒè¿‡ç¨‹ä¸­æŒä¹…åŒ–ã€‚å¯ä»¥å°†è¿™äº›ä¿¡æ¯å­˜æ”¾åˆ°å…¨å±€å˜é‡ä¸­ï¼Œä½†è¿™å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºè¿™ä¸ªä¿¡æ¯ä»…ä»…æ˜¯å‡½æ•°æœ¬èº«ç”¨åˆ°çš„ã€‚æœ€å¥½å°†è¿™ä¸ªä¿¡æ¯ä¿å­˜åˆ°å‡½æ•°å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ä¸­ï¼Œä¸‹é¢è¿™ä¸ªä¾‹å­å°±å®ç°äº†è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨å‡½æ•°éƒ½ä¼šè¿”å›ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°ï¼š</p>

<pre><code class="language-javascript">// Initialize the counter property of the function object.
// Function declarations are hoisted so we really can
// do this assignment before the function declaration.
uniqueInteger.counter = 0;

// This function returns a different integer each time it is called.
// It uses a property of itself to remember the next value to be returned.
function uniqueInteger() {
    return uniqueInteger.counter++;  // Return and increment counter property
}
uniqueInteger()  // =&gt; 0
uniqueInteger()  // =&gt; 1
</code></pre>

<p>æ¥çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œä¸‹é¢è¿™ä¸ªå‡½æ•° factorial() ä½¿ç”¨äº†è‡ªèº«çš„å±æ€§ï¼ˆå°†è‡ªèº«å½“åšæ•°ç»„æ¥å¯¹å¾…ï¼‰æ¥ç¼“å­˜ä¸Šä¸€æ¬¡çš„è®¡ç®—ç»“æœï¼š</p>

<pre><code class="language-javascript">// Compute factorials and cache results as properties of the function itself.
function factorial(n) {
    if (Number.isInteger(n) &amp;&amp; n &gt; 0) {           // Positive integers only
        if (!(n in factorial)) {                  // If no cached result
            factorial[n] = n * factorial(n-1);    // Compute and cache it
        }
        return factorial[n];                      // Return the cached result
    } else {
        return NaN;                               // If input was bad
    }
}
factorial[1] = 1;  // Initialize the cache to hold this base case.
factorial(6)  // =&gt; 720
factorial[5]  // =&gt; 120; the call above caches this value
</code></pre>

<h2 id="toc_23">8.5 å‡½æ•°ä½œä¸ºå‘½åç©ºé—´</h2>

<p>å˜é‡å£°æ˜åœ¨å‡½æ•°å†…å¯¹äºå‡½æ•°ä½“å¤–æ˜¯ä¸å¯è§çš„ã€‚å› æ­¤ï¼Œæœ‰æ—¶å®šä¹‰å‡½æ•°ä½œä¸ºä¸´æ—¶å‘½åç©ºé—´éå¸¸æœ‰ç”¨ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰å˜é‡è€Œä¸å¼„ä¹±å…¨å±€å‘½åç©ºé—´ã€‚</p>

<p>æ¯”å¦‚ï¼Œå‡è®¾ä½ å†™äº†ä¸€æ®µ JavaScript æ¨¡å—ä»£ç ï¼Œè¿™æ®µä»£ç å°†è¦ç”¨åœ¨ä¸åŒçš„ JavaScript ç¨‹åºä¸­ï¼ˆå¯¹äºå®¢æˆ·ç«¯ JavaScript æ¥è®²é€šå¸¸æ˜¯ç”¨åœ¨å„ç§å„æ ·çš„ç½‘é¡µä¸­ï¼‰ã€‚å’Œå¤§å¤šæ•°ä»£ç ä¸€æ ·ï¼Œå‡å®šè¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªç”¨ä»¥å­˜å‚¨ä¸­é—´è®¡ç®—ç»“æœçš„å˜é‡ã€‚è¿™æ ·é—®é¢˜å°±æ¥äº†ï¼Œå½“æ¨¡å—ä»£ç æ”¾åˆ°ä¸åŒçš„ç¨‹åºä¸­è¿è¡Œæ—¶ï¼Œä½ æ— æ³•å¾—çŸ¥è¿™ä¸ªå˜é‡æ˜¯å¦å·²ç»åˆ›å»ºäº†ï¼Œå¦‚æœå·²ç»å­˜åœ¨è¿™ä¸ªå˜é‡ï¼Œé‚£ä¹ˆå°†ä¼šå’Œä»£ç å‘ç”Ÿå†²çªã€‚è§£å†³åŠæ³•å½“ç„¶æ˜¯å°†ä»£ç æ”¾å…¥ä¸€ä¸ªå‡½æ•°å†…ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚è¿™æ ·å…¨å±€å˜é‡å°±å˜æˆäº†å‡½æ•°å†…çš„å±€éƒ¨å˜é‡ï¼š</p>

<pre><code class="language-javascript">function chunkNamespace() {
    // Chunk of code goes here
    // Any variables defined in the chunk are local to this function
    // instead of cluttering up the global namespace.
}
chunkNamespace();  // But don&#39;t forget to invoke the function!
</code></pre>

<p>è¿™æ®µä»£ç ä»…ä»…å®šä¹‰äº†ä¸€ä¸ªå•ç‹¬çš„å…¨å±€å˜é‡ï¼šåä¸º chunkNamespace çš„å‡½æ•°ã€‚å¦‚æœè¿˜æ˜¯å¤ªéº»çƒ¦ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªå•ç‹¬çš„è¡¨è¾¾å¼å®šä¹‰ä¸€ä¸ªåŒ¿åå‡½æ•°å¹¶è°ƒç”¨å®ƒï¼š</p>

<pre><code class="language-javascript">(function() {  // chunkNamespace() function rewritten as an unnamed expression.
    // Chunk of code goes here
}());          // End the function literal and invoke it now.
</code></pre>

<p>è¿™ç§å®šä¹‰åŒ¿åå‡½æ•°å¹¶ç«‹å³åœ¨å•ä¸ªè¡¨è¾¾å¼ä¸­è°ƒç”¨å®ƒçš„å†™æ³•éå¸¸å¸¸è§ï¼Œå¹¶ç»™å®ƒèµ·äº†ä¸ªåå­—â€œåŒ¿åè°ƒç”¨å‡½æ•°è¡¨è¾¾å¼â€ã€‚æ³¨æ„ä¸Šé¢ä»£ç çš„åœ†æ‹¬å·çš„ç”¨æ³•ï¼Œfunction ä¹‹å‰çš„å·¦åœ†æ‹¬å·æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºå¦‚æœä¸å†™è¿™ä¸ªå·¦åœ†æ‹¬å·ï¼ŒJavaScript è§£é‡Šå™¨ä¼šè¯•å›¾å°†å…³é”®å­— function è§£æä¸ºå‡½æ•°å£°æ˜è¯­å¥ã€‚ä½¿ç”¨åœ†æ‹¬å· JavaScript è§£é‡Šå™¨æ‰ä¼šæ­£ç¡®åœ°å°†å…¶è§£æä¸ºå‡½æ•°å®šä¹‰è¡¨è¾¾å¼ã€‚ä½¿ç”¨å‰å¯¼æ‹¬å·ä¹Ÿæœ‰åŠ©äºäººç±»é˜…è¯»æ—¶åŒºåˆ†å‡½æ•°å®šä¹‰æ˜¯ç«‹å³æ‰§è¡Œè¿˜æ˜¯ä¾›ä»¥åä½¿ç”¨ã€‚</p>

<p>å‡½æ•°ç”¨ä½œå‘½åç©ºé—´å¾ˆå¸¸ç”¨ï¼Œåœ¨å‘½åç©ºé—´å‡½æ•°ä¸­å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ä½¿ç”¨å…¶ä¸­çš„å˜é‡ï¼Œç„¶åå°†ä»–ä»¬ä½œä¸ºå‡½æ•°å‘½åç©ºé—´çš„è¿”å›å€¼ã€‚è¿™æ ·çš„å‡½æ•°ç§°ä¸ºé—­åŒ…ï¼Œå®ƒä»¬æ˜¯ä¸‹ä¸€èŠ‚çš„ä¸»é¢˜ã€‚</p>

<h2 id="toc_24">8.6 é—­åŒ…</h2>

<p>å’Œå…¶ä»–å¤§å¤šæ•°ç°ä»£ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒJavaScript ä¹Ÿé‡‡ç”¨è¯æ³•ä½œç”¨åŸŸã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°çš„æ‰§è¡Œä¾èµ–äºå˜é‡ä½œç”¨åŸŸï¼Œè¿™ä¸ªä½œç”¨åŸŸæ˜¯åœ¨å‡½æ•°å®šä¹‰æ—¶å†³å®šçš„ï¼Œè€Œä¸æ˜¯å‡½æ•°è°ƒç”¨æ—¶å†³å®šçš„ã€‚ä¸ºäº†å®ç°è¿™ç§è¯æ³•ä½œç”¨åŸŸï¼ŒJavaScript å‡½æ•°å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ä¸ä»…åŒ…å«å‡½æ•°çš„ä»£ç é€»è¾‘ï¼Œè¿˜å¿…é¡»åŒ…æ‹¬å¯¹å‡½æ•°å®šä¹‰å‡ºç°çš„ä½œç”¨åŸŸçš„å¼•ç”¨ã€‚å°†å‡½æ•°å¯¹è±¡å¯å’Œä½œç”¨åŸŸç›¸äº’å…³è”èµ·æ¥ï¼ˆä¸€å¯¹å˜é‡çš„ç»‘å®šï¼‰ï¼Œå‡½æ•°ä½“å†…éƒ¨çš„å˜é‡éƒ½å¯ä»¥ä¿å­˜åœ¨å‡½æ•°ä½œç”¨åŸŸå†…ï¼Œè¿™ç§ç‰¹æ€§åœ¨è®¡ç®—æœºç§‘å­¦æ–‡çŒ®ä¸­ç§°ä¸ºé—­åŒ…ã€‚</p>

<p>ä»æŠ€æœ¯çš„è§’åº¦è®²ï¼Œæ‰€æœ‰çš„ JavaScript å‡½æ•°éƒ½æ˜¯é—­åŒ…ï¼Œä½†æ˜¯å¤§å¤šæ•°å‡½æ•°è°ƒç”¨å’Œå®šä¹‰åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œé€šå¸¸ä¸ä¼šæ³¨æ„è¿™é‡Œæœ‰æ¶‰åŠåˆ°é—­åŒ…ã€‚å½“è°ƒç”¨å‡½æ•°ä¸å’Œå…¶å®šä¹‰å¤„äºåŒä¸€ä½œç”¨åŸŸå†…æ—¶ï¼Œäº‹æƒ…å°±å˜å¾—éå¸¸å¾®å¦™ã€‚å½“ä¸€ä¸ªå‡½æ•°åµŒå¥—äº†å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œå¤–éƒ¨å‡½æ•°å°†åµŒå¥—çš„å‡½æ•°å¯¹è±¡ä½œä¸ºè¿”å›å€¼è¿”å›çš„æ—¶å€™å¾€å¾€ä¼šå‘ç”Ÿè¿™ç§äº‹æƒ…ã€‚æœ‰å¾ˆå¤šå¼ºå¤§çš„ç¼–ç¨‹æŠ€æœ¯éƒ½åˆ©ç”¨åˆ°äº†è¿™ç±»åµŒå¥—çš„å‡½æ•°é—­åŒ…ï¼Œä»¥è‡³äºè¿™ç§ç¼–ç¨‹æ¨¡å¼åœ¨ JavaScript ä¸­éå¸¸å¸¸è§ã€‚å½“ä½ ç¬¬ä¸€æ¬¡ç¢°åˆ°é—­åŒ…æ—¶å¯èƒ½ä¼šè§‰å¾—éå¸¸è®©äººè´¹è§£ï¼Œä¸€æ—¦ä½ ç†è§£æŒæ¡äº†é—­åŒ…ä¹‹åï¼Œå°±èƒ½éå¸¸è‡ªå¦‚åœ°ä½¿ç”¨å®ƒäº†ï¼Œäº†è§£è¿™ä¸€ç‚¹è‡³å…³é‡è¦ã€‚</p>

<p>ç†è§£é—­åŒ…é¦–å…ˆè¦äº†è§£åµŒå¥—å‡½æ•°çš„è¯æ³•ä½œç”¨åŸŸè§„åˆ™ã€‚çœ‹ä¸€ä¸‹è¿™æ®µä»£ç ï¼š</p>

<pre><code class="language-javascript">let scope = &quot;global scope&quot;;          // A global variable
function checkscope() {
    let scope = &quot;local scope&quot;;       // A local variable
    function f() { return scope; }   // Return the value in scope here
    return f();
}
checkscope()                         // =&gt; &quot;local scope&quot;
</code></pre>

<p>checkscope() å‡½æ•°å£°æ˜äº†ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œç„¶åå®šä¹‰å¹¶æ‰§è¡Œäº†ä¸€ä¸ªå‡½æ•° f() ï¼Œå‡½æ•° f() è¿”å›äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼Œæœ€åå°†å‡½æ•° f() çš„æ‰§è¡Œç»“æœè¿”å›ã€‚ä½ åº”å½“éå¸¸æ¸…æ¥šä¸ºä»€ä¹ˆè°ƒç”¨ checkscope() ä¼šè¿”å› local scopeã€‚ç°åœ¨æˆ‘ä»¬å¯¹è¿™æ®µä»£ç åšä¸€ç‚¹æ”¹åŠ¨ã€‚ä½ çŸ¥é“è¿™æ®µä»£ç è¿”å›ä»€ä¹ˆå—ï¼Ÿ</p>

<pre><code class="language-javascript">let scope = &quot;global scope&quot;;          // A global variable
function checkscope() {
    let scope = &quot;local scope&quot;;       // A local variable
    function f() { return scope; }   // Return the value in scope here
    return f;
}
let s = checkscope()();              // What does this return?
</code></pre>

<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†å‡½æ•°å†…çš„ä¸€å¯¹åœ†æ‹¬å·ç§»åŠ¨åˆ°äº† checkscope() ä¹‹åã€‚checkscope() ç°åœ¨ä»…ä»…è¿”å›å‡½æ•°å†…åµŒå¥—çš„ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›ç»“æœã€‚åœ¨å®šä¹‰å‡½æ•°çš„ä½œç”¨åŸŸå¤–é¢ï¼Œè°ƒç”¨è¿™ä¸ªåµŒå¥—çš„å‡½æ•°ï¼ˆåŒ…å«æœ€åä¸€è¡Œä»£ç çš„æœ€åä¸€å¯¹åœ†æ‹¬å·ï¼‰ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿ</p>

<p>å›æƒ³ä¸€ä¸‹è¯æ³•ä½œç”¨åŸŸçš„åŸºæœ¬è§„åˆ™ï¼šJavaScript å‡½æ•°çš„æ‰§è¡Œç”¨åˆ°äº†ä½œç”¨åŸŸï¼Œè¿™ä¸ªä½œç”¨åŸŸæ˜¯å‡½æ•°å®šä¹‰çš„æ—¶å€™åˆ›å»ºçš„ã€‚åµŒå¥—çš„å‡½æ•° f() å®šä¹‰åœ¨å˜é‡ scope ç»‘å®šçš„å€¼æ˜¯â€œlocal scopeâ€çš„ä½œç”¨åŸŸé‡Œï¼Œè¿™ä¸ªç»‘å®šæ— è®º f å‡½æ•°åœ¨ä½•å¤„è°ƒç”¨éƒ½ä¾ç„¶æœ‰æ•ˆã€‚å› æ­¤æœ€åä¸€è¡Œä»£ç è¿”å›â€œlocal scopeâ€ï¼Œè€Œä¸æ˜¯â€œglobal scopeâ€ã€‚ç®€è¨€ä¹‹ï¼Œé—­åŒ…çš„è¿™ä¸ªç‰¹æ€§å¼ºå¤§åˆ°è®©äººåƒæƒŠï¼šå®ƒä»¬å¯ä»¥æ•æ‰åˆ°å®ƒä»¬çš„å¤–éƒ¨å‡½æ•°æ‰€ç»‘å®šçš„å±€éƒ¨å˜é‡ï¼ˆå’Œå‚æ•°ï¼‰ã€‚</p>

<p>åœ¨ Â§8.4.1 ä¸­å®šä¹‰äº† uniqueInteger() å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä½¿ç”¨è‡ªèº«çš„ä¸€ä¸ªå±æ€§æ¥ä¿å­˜æ¯æ¬¡è¿”å›çš„å€¼ï¼Œä»¥ä¾¿æ¯æ¬¡è°ƒç”¨éƒ½èƒ½è·Ÿè¸ªä¸Šæ¬¡çš„è¿”å›å€¼ã€‚ä½†è¿™ç§åšæ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ¶æ„ä»£ç å¯èƒ½å°†è®¡æ•°å™¨é‡ç½®æˆ–è€…æŠŠä¸€ä¸ªéæ•´æ•°èµ‹å€¼ç»™å®ƒï¼Œå¯¼è‡´ uniquenterger() å‡½æ•°ä¸ä¸€å®šèƒ½äº§ç”Ÿâ€œå”¯ä¸€â€çš„â€œæ•´æ•°â€ã€‚è€Œé—­åŒ…å¯ä»¥æ•æ‰åˆ°å•ä¸ªå‡½æ•°è°ƒç”¨çš„å±€éƒ¨å˜é‡ï¼Œå¹¶å°†è¿™äº›å±€éƒ¨å˜é‡ç”¨åšç§æœ‰çŠ¶æ€ã€‚ä¸‹é¢æ˜¯å¦‚ä½•ç”¨ç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼é‡å†™ uniqueInteger() æ¥å®šä¹‰å‘½åç©ºé—´å’Œé—­åŒ…æ¥ä¿æŒå…¶çŠ¶æ€ç§æœ‰åŒ–ï¼š</p>

<pre><code class="language-javascript">let uniqueInteger = (function() {  // Define and invoke
    let counter = 0;               // Private state of function below
    return function() { return counter++; };
}());
uniqueInteger()  // =&gt; 0
uniqueInteger()  // =&gt; 1
</code></pre>

<p>ä½ éœ€è¦ä»”ç»†é˜…è¯»è¿™æ®µä»£ç æ‰èƒ½ç†è§£å…¶å«ä¹‰ã€‚ç²—ç•¥æ¥çœ‹ï¼Œç¬¬ä¸€è¡Œä»£ç çœ‹èµ·æ¥åƒå°†å‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ uniqueIntegerï¼Œå®é™…ä¸Šï¼Œè¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªç«‹å³è°ƒç”¨çš„å‡½æ•°ï¼ˆå‡½æ•°çš„å¼€å§‹å¸¦æœ‰å·¦åœ†æ‹¬å·ï¼‰ï¼Œå› æ­¤æ˜¯è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼èµ‹å€¼ç»™å˜é‡ uniqueIntegerã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹å‡½æ•°ä½“ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯å¦å¤–ä¸€ä¸ªå‡½æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªåµŒå¥—çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°†å®ƒèµ‹å€¼ç»™å˜é‡ uniqueIntegerã€‚åµŒå¥—çš„å‡½æ•°æ˜¯å¯ä»¥è®¿é—®ä½œç”¨åŸŸå†…çš„å˜é‡çš„ï¼Œè€Œä¸”å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°ä¸­å®šä¹‰çš„ counter å˜é‡ã€‚å½“å¤–éƒ¨å‡½æ•°è¿”å›ä¹‹åï¼Œå…¶ä»–ä»»ä½•ä»£ç éƒ½æ— æ³•è®¿é—® counter å˜é‡ï¼šåªæœ‰å†…éƒ¨çš„å‡½æ•°æ‰èƒ½è®¿é—®åˆ°å®ƒã€‚</p>

<p>åƒ counter ä¸€æ ·çš„ç§æœ‰å˜é‡ä¸æ˜¯åªèƒ½ç”¨åœ¨ä¸€ä¸ªå•ç‹¬çš„é—­åŒ…å†…ï¼Œåœ¨åŒä¸€ä¸ªå¤–éƒ¨å‡½æ•°å†…å®šä¹‰çš„å¤šä¸ªåµŒå¥—å‡½æ•°ä¹Ÿå¯ä»¥è®¿é—®å®ƒï¼Œè¿™å¤šä¸ªåµŒå¥—å‡½æ•°éƒ½å…±äº«ä¸€ä¸ªä½œç”¨åŸŸï¼Œçœ‹ä¸€ä¸‹è¿™æ®µä»£ç ï¼š</p>

<pre><code class="language-javascript">function counter() {
    let n = 0;
    return {
        count: function() { return n++; },
        reset: function() { n = 0; }
    };
}

let c = counter(), d = counter();   // Create two counters
c.count()                           // =&gt; 0
d.count()                           // =&gt; 0: they count independently
c.reset();                          // reset() and count() methods share state
c.count()                           // =&gt; 0: because we reset c
d.count()                           // =&gt; 1: d was not reset
</code></pre>

<p>counter() å‡½æ•°è¿”å›äº†ä¸€ä¸ªâ€œè®¡æ•°å™¨â€å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼šcount() è¿”å›ä¸‹ä¸€ä¸ªæ•´æ•°ï¼Œreset() é‡ç½®å†…éƒ¨çŠ¶æ€ã€‚é¦–å…ˆè¦ç†è§£ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥è®¿é—®ç§æœ‰å˜é‡nã€‚å†è€…ï¼Œæ¯æ¬¡è°ƒç”¨ counter() éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸé“¾å’Œä¸€ä¸ªæ–°çš„ç§æœ‰å˜é‡ã€‚å› æ­¤ï¼Œå¦‚æœè°ƒç”¨ counter() ä¸¤æ¬¡ï¼Œåˆ™ä¼šå¾—åˆ°ä¸¤ä¸ªè®¡æ•°å™¨å¯¹è±¡ï¼Œè€Œä¸”å½¼æ­¤åŒ…å«ä¸åŒçš„ç§æœ‰å˜é‡ï¼Œè°ƒç”¨å…¶ä¸­ä¸€ä¸ªè®¡æ•°å™¨å¯¹è±¡çš„ count() æˆ– reset() ä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€ä¸ªå¯¹è±¡ã€‚</p>

<p>ä»æŠ€æœ¯è§’åº¦çœ‹ï¼Œå…¶å®å¯ä»¥å°†è¿™ä¸ªé—­åŒ…åˆå¹¶ä¸ºå±æ€§å­˜å–å™¨æ–¹æ³• getter å’Œ setterã€‚ä¸‹é¢è¿™æ®µä»£ç æ‰€ç¤ºçš„ counter() å‡½æ•°çš„ç‰ˆæœ¬æ˜¯ Â§6.10.6 ä¸­ä»£ç çš„å˜ç§ï¼Œæ‰€ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œç§æœ‰çŠ¶æ€çš„å®ç°æ˜¯åˆ©ç”¨äº†é—­åŒ…ï¼Œè€Œä¸æ˜¯åˆ©ç”¨æ™®é€šçš„å¯¹è±¡å±æ€§æ¥å®ç°ï¼š</p>

<pre><code class="language-javascript">function counter(n) {  // Function argument n is the private variable
    return {
        // Property getter method returns and increments private counter var.
        get count() { return n++; },
        // Property setter doesn&#39;t allow the value of n to decrease
        set count(m) {
            if (m &gt; n) n = m;
            else throw Error(&quot;count can only be set to a larger value&quot;);
        }
    };
}

let c = counter(1000);
c.count            // =&gt; 1000
c.count            // =&gt; 1001
c.count = 2000;
c.count            // =&gt; 2000
c.count = 2000;    // !Error: count can only be set to a larger value
</code></pre>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„ counter() å‡½æ•°å¹¶æœªå£°æ˜å±€éƒ¨å˜é‡ï¼Œè€Œåªæ˜¯ä½¿ç”¨å‚æ•° n æ¥ä¿å­˜ç§æœ‰çŠ¶æ€å¹¶ä¸å±æ€§å­˜å–å™¨æ–¹æ³•å…±äº«ã€‚è¿™æ ·çš„è¯ï¼Œè°ƒç”¨ counter() çš„å‡½æ•°å°±å¯ä»¥æŒ‡å®šç§æœ‰å˜é‡çš„åˆå§‹å€¼äº†ã€‚</p>

<p>ä¾‹ 8-2æ˜¯è¿™ç§ä½¿ç”¨é—­åŒ…æŠ€æœ¯æ¥å…±äº«çš„ç§æœ‰çŠ¶æ€çš„é€šç”¨åšæ³•ã€‚è¿™ä¸ªä¾‹å­å®šä¹‰äº† addPrivateProperty() å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å®šä¹‰äº†ä¸€ä¸ªç§æœ‰å˜é‡ï¼Œä»¥åŠä¸¤ä¸ªåµŒå¥—çš„å‡½æ•°ç”¨æ¥è·å–å’Œè®¾ç½®è¿™ä¸ªç§æœ‰å˜é‡çš„å€¼ã€‚å®ƒå°†è¿™äº›åµŒå¥—å‡½æ•°æ·»åŠ ä¸ºæ‰€æŒ‡å®šå¯¹è±¡çš„æ–¹æ³•ï¼š</p>

<p>ä¾‹ 8-2ï¼šåˆ©ç”¨é—­åŒ…å®ç°çš„ç§æœ‰å±æ€§å­˜å–å™¨æ–¹æ³•</p>

<pre><code class="language-javascript">// This function adds property accessor methods for a property with
// the specified name to the object o. The methods are named get&lt;name&gt;
// and set&lt;name&gt;. If a predicate function is supplied, the setter
// method uses it to test its argument for validity before storing it.
// If the predicate returns false, the setter method throws an exception.
//
// The unusual thing about this function is that the property value
// that is manipulated by the getter and setter methods is not stored in
// the object o. Instead, the value is stored only in a local variable
// in this function. The getter and setter methods are also defined
// locally to this function and therefore have access to this local variable.
// This means that the value is private to the two accessor methods, and it
// cannot be set or modified except through the setter method.
function addPrivateProperty(o, name, predicate) {
    let value;  // This is the property value

    // The getter method simply returns the value.
    o[`get${name}`] = function() { return value; };

    // The setter method stores the value or throws an exception if
    // the predicate rejects the value.
    o[`set${name}`] = function(v) {
        if (predicate &amp;&amp; !predicate(v)) {
            throw new TypeError(`set${name}: invalid value ${v}`);
        } else {
            value = v;
        }
    };
}

// The following code demonstrates the addPrivateProperty() method.
let o = {};  // Here is an empty object

// Add property accessor methods getName and setName()
// Ensure that only string values are allowed
addPrivateProperty(o, &quot;Name&quot;, x =&gt; typeof x === &quot;string&quot;);

o.setName(&quot;Frank&quot;);       // Set the property value
o.getName()               // =&gt; &quot;Frank&quot;
o.setName(0);             // !TypeError: try to set a value of the wrong type
</code></pre>

<p>æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¾ˆå¤šä¾‹å­ï¼Œåœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸­å®šä¹‰ä¸¤ä¸ªé—­åŒ…ï¼Œè¿™ä¸¤ä¸ªé—­åŒ…å…±äº«åŒæ ·çš„ç§æœ‰å˜é‡æˆ–å˜é‡ã€‚è¿™æ˜¯ä¸€ç§éå¸¸é‡è¦çš„æŠ€æœ¯ï¼Œä½†è¿˜æ˜¯è¦ç‰¹åˆ«å°å¿ƒé‚£äº›ä¸å¸Œæœ›å…±äº«çš„å˜é‡å¾€å¾€ä¸ç»æ„é—´å…±äº«ç»™äº†å…¶ä»–çš„é—­åŒ…ï¼Œäº†è§£è¿™ä¸€ç‚¹ä¹Ÿå¾ˆé‡è¦ã€‚çœ‹ä¸€ä¸‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>

<pre><code class="language-javascript">// This function returns a function that always returns v
function constfunc(v) { return () =&gt; v; }

// Create an array of constant functions:
let funcs = [];
for(var i = 0; i &lt; 10; i++) funcs[i] = constfunc(i);

// The function at array element 5 returns the value 5.
funcs[5]()    // =&gt; 5
</code></pre>

<p>è¿™æ®µä»£ç åˆ©ç”¨å¾ªç¯åˆ›å»ºäº†å¾ˆå¤šä¸ªé—­åŒ…ï¼Œå½“å†™ç±»ä¼¼è¿™ç§ä»£ç çš„æ—¶å€™å¾€å¾€ä¼šçŠ¯ä¸€ä¸ªé”™è¯¯ï¼šé‚£å°±æ˜¯è¯•å›¾å°†å¾ªç¯ä»£ç ç§»å…¥å®šä¹‰è¿™ä¸ªé—­åŒ…çš„å‡½æ•°ä¹‹å†…ï¼Œçœ‹ä¸€ä¸‹è¿™æ®µä»£ç ï¼š</p>

<pre><code class="language-javascript">// Return an array of functions that return the values 0-9
function constfuncs() {
    let funcs = [];
    for(var i = 0; i &lt; 10; i++) {
        funcs[i] = () =&gt; i;
    }
    return funcs;
}

let funcs = constfuncs();
funcs[5]()    // =&gt; 10; Why doesn&#39;t this return 5?
</code></pre>

<p>ä¸Šé¢è¿™æ®µä»£ç åˆ›å»ºäº†10ä¸ªé—­åŒ…ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚è¿™äº›é—­åŒ…éƒ½æ˜¯åœ¨åŒä¸€ä¸ªå‡½æ•°è°ƒç”¨ä¸­å®šä¹‰çš„ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥å…±äº«å˜é‡ iã€‚å½“ constfuncs() è¿”å›æ—¶ï¼Œå˜é‡ i çš„å€¼æ˜¯10ï¼Œæ‰€æœ‰çš„é—­åŒ…éƒ½å…±äº«è¿™ä¸€ä¸ªå€¼ï¼Œå› æ­¤ï¼Œæ•°ç»„ä¸­çš„å‡½æ•°çš„è¿”å›å€¼éƒ½æ˜¯åŒä¸€ä¸ªå€¼ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚å…³è”åˆ°é—­åŒ…çš„ä½œç”¨åŸŸéƒ½æ˜¯â€œæ´»åŠ¨çš„â€ï¼Œè®°ä½è¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚åµŒå¥—çš„å‡½æ•°ä¸ä¼šå°†ä½œç”¨åŸŸå†…çš„ç§æœ‰æˆå‘˜å¤åˆ¶ä¸€ä»½ï¼Œä¹Ÿä¸ä¼šå¯¹æ‰€ç»‘å®šçš„å˜é‡ç”Ÿæˆé™æ€å¿«ç…§ã€‚ä»æ ¹æœ¬ä¸Šè®²ï¼Œè¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œä½¿ç”¨ var å£°æ˜çš„å˜é‡ï¼Œå®ƒçš„å®šä¹‰è´¯ç©¿æ•´ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬çš„ for å¾ªç¯ä½¿ç”¨ var i å£°æ˜å¾ªç¯å˜é‡ï¼Œå› æ­¤å˜é‡ i åœ¨æ•´ä¸ªå‡½æ•°ä¸­éƒ½æœ‰å®šä¹‰ï¼Œè€Œä¸æ˜¯æ›´ç‹­ä¹‰åœ°ä½œç”¨äºå¾ªç¯çš„ä¸»ä½“ã€‚è¯¥ä»£ç æ¼”ç¤ºäº† ES6 ä¹‹å‰çš„å¸¸è§ Bug ç±»åˆ«ï¼Œä½†åœ¨ ES6 ä¸­å¼•å…¥å—çº§å˜é‡ä½œç”¨åŸŸè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬åªæ˜¯ç”¨ let æˆ– const æ›¿æ¢ varï¼Œ é‚£ä¹ˆé—®é¢˜å°±æ¶ˆå¤±äº†ã€‚ç”±äº let å’Œ const æ˜¯å—çº§ä½œç”¨åŸŸï¼Œå› æ­¤å¾ªç¯çš„æ¯ä¸ªè¿­ä»£éƒ½å®šä¹‰äº†ä¸€ä¸ªç‹¬ç«‹äºæ‰€æœ‰å…¶ä»–è¿­ä»£çš„ä½œç”¨åŸŸï¼Œå¹¶ä¸”æ¯ä¸ªä½œç”¨åŸŸéƒ½æœ‰å…¶è‡ªå·±çš„ç‹¬ç«‹ç»‘å®š iã€‚</p>

<p>ä¹¦å†™é—­åŒ…çš„æ—¶å€™è¿˜éœ€æ³¨æ„ä¸€ä»¶äº‹æƒ…ï¼Œthis æ˜¯ JavaScript çš„å…³é”®å­—ï¼Œè€Œä¸æ˜¯å˜é‡ã€‚æ­£å¦‚ä¹‹å‰è®¨è®ºçš„ï¼Œç®­å¤´å‡½æ•°ä»åŒ…å«å®ƒä»¬çš„å‡½æ•°ä¸­ç»§æ‰¿ this å€¼ï¼Œä½†æ˜¯ç”¨ function å…³é”®å­—å®šä¹‰çš„å‡½æ•°ä¸æ˜¯ã€‚æ‰€ä»¥å¦‚æœå†™ä¸€ä¸ªé—­åŒ…éœ€è¦ä½¿ç”¨åŒ…å«å®ƒçš„å‡½æ•°çš„ this å€¼ï¼Œè¦åœ¨é—­åŒ…è¿”å›ä¹‹å‰ä½¿ç”¨ç®­å¤´å‡½æ•°æˆ–è€…ç”¨è°ƒç”¨ bind()ï¼Œæˆ–è€…å°† this å€¼èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œè¿™æ ·ä½ çš„é—­åŒ…ä¼šç»§æ‰¿å®ƒï¼š</p>

<pre><code class="language-javascript">const self = this;  // Make the this value available to nested functions
</code></pre>

<h2 id="toc_25">8.7 å‡½æ•°å±æ€§ã€æ–¹æ³•ã€å’Œæ„é€ å‡½æ•°</h2>

<p>æˆ‘ä»¬çœ‹åˆ°åœ¨ JavaScript ç¨‹åºä¸­ï¼Œå‡½æ•°æ˜¯å€¼ã€‚å¯¹å‡½æ•°æ‰§è¡Œ typeof è¿ç®—ä¼šè¿”å›å­—ç¬¦ä¸²â€œfunctionâ€ï¼Œä½†æ˜¯å‡½æ•°æ˜¯ JavaScript ä¸­ç‰¹æ®Šçš„å¯¹è±¡ã€‚å› ä¸ºå‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥æ‹¥æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå°±åƒæ™®é€šçš„å¯¹è±¡å¯ä»¥æ‹¥æœ‰å±æ€§å’Œæ–¹æ³•ä¸€æ ·ã€‚ç”šè‡³å¯ä»¥ç”¨ Function() æ„é€ å‡½æ•°æ¥åˆ›å»ºæ–°çš„å‡½æ•°å¯¹è±¡ã€‚æ¥ä¸‹æ¥å‡ èŠ‚å°±ä¼šç€é‡ä»‹ç»å‡½æ•° lengthã€name å’Œ prototype å±æ€§ï¼›call()ã€ apply()ã€ bind() å’Œ toString() æ–¹æ³•ï¼›ä»¥åŠ Function() æ„é€ å‡½æ•°ã€‚</p>

<h3 id="toc_26">8.7.1 length å±æ€§</h3>

<p>å‡½æ•°çš„åªè¯»å±æ€§ length æŒ‡å®šå‡½æ•°å‚æ•°ä¸ªæ•°--å£°æ˜åœ¨å…¶å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ä¸ªæ•°ï¼Œå¤§å¤šæ•°å‡½æ•°æœŸæœ›çš„å®å‚ä¸ªæ•°ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªå‰©ä½™å‡½æ•°ï¼Œå®ƒçš„å‚æ•°ä¸ªæ•°ä¸è¢«è®¡ç®—å…¥ length å±æ€§ã€‚ï¼ˆç»æµ‹è¯•ï¼Œå¯é€‰å‚æ•°ä¹Ÿä¸è®¡ç®— lengthã€‚ï¼‰</p>

<h3 id="toc_27">8.7.2 name å±æ€§</h3>

<p>å¦‚æœä½¿ç”¨åç§°å®šä¹‰å‡½æ•°ï¼Œåªè¯»å±æ€§ name æŒ‡å®šå‡½æ•°å®šä¹‰æ—¶ç”¨çš„åç§°ï¼Œæˆ–æœªå‘½åå‡½æ•°è¡¨è¾¾å¼åœ¨é¦–æ¬¡åˆ›å»ºæ—¶åˆ†é…ç»™çš„å˜é‡æˆ–å±æ€§çš„åç§°ã€‚æ­¤å±æ€§åœ¨ç¼–å†™è°ƒè¯•æˆ–é”™è¯¯æ¶ˆæ¯æ—¶å¾ˆæœ‰ç”¨ã€‚</p>

<h3 id="toc_28">8.7.3 prototype å±æ€§</h3>

<p>æ‰€æœ‰å‡½æ•°éƒ½åŒ…å«ä¸€ä¸ª prototype å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯æŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™ä¸ªå¯¹è±¡ç§°åšåŸå‹å¯¹è±¡ã€‚æ¯ä¸€ä¸ªå‡½æ•°éƒ½åŒ…å«ä¸åŒçš„åŸå‹å¯¹è±¡ã€‚å½“å°†å‡½æ•°ç”¨ä½œæ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œæ–°åˆ›å»ºçš„å¯¹è±¡ä¼šä»åŸå‹å¯¹è±¡ä¸Šç»§æ‰¿å±æ€§ã€‚Â§6.2.3 è®¨è®ºäº†åŸå‹å’Œ prototype å±æ€§ï¼Œåœ¨ç¬¬9ç« é‡Œä¼šæœ‰è¿›ä¸€æ­¥è®¨è®ºã€‚</p>

<h3 id="toc_29">8.7.4 call() å’Œ apply() æ–¹æ³•</h3>

<p>æˆ‘ä»¬å¯ä»¥å°† call() å’Œ apply () çœ‹åšæ˜¯æŸä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨æ–¹æ³•çš„å½¢å¼æ¥é—´æ¥è°ƒç”¨ï¼ˆè§ Â§8.2.4ï¼‰å‡½æ•°ã€‚call() å’Œ apply() çš„ç¬¬ä¸€ä¸ªå®å‚æ˜¯è¦è°ƒç”¨å‡½æ•°çš„æ¯å¯¹è±¡ï¼Œå®ƒæ˜¯è°ƒç”¨ä¸Šä¸‹æ–‡ï¼Œåœ¨å‡½æ•°ä½“å†…å˜æˆ this å…³é”®å­—çš„å€¼ã€‚è¦æƒ³ä»¥å¯¹è±¡ o çš„æ–¹æ³•æ¥è°ƒç”¨å‡½æ•° f()ï¼ˆæ²¡æœ‰å®å‚ä¼ é€’ï¼‰ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨ call() å’Œ apply()ï¼š</p>

<pre><code class="language-javascript">f.call(o);
f.apply(o);
</code></pre>

<p>æ¯è¡Œä»£ç å’Œä¸‹é¢ä»£ç çš„åŠŸèƒ½ç±»ä¼¼ï¼ˆå‡è®¾å¯¹è±¡ o ä¸­é¢„å…ˆä¸å­˜åœ¨åä¸º m çš„å±æ€§ï¼‰:</p>

<pre><code class="language-javascript">o.m = f;     // Make f a temporary method of o.
o.m();       // Invoke it, passing no arguments.
delete o.m;  // Remove the temporary method.
</code></pre>

<p>ä¸è¦å¿˜äº†ï¼Œç®­å¤´å‡½æ•°ä»å®ƒå®šä¹‰çš„ä½ç½®çš„ä¸Šä¸‹æ–‡ç»§æ‰¿ this å€¼ã€‚è¿™ä¸èƒ½è¢« call() å’Œ apply() æ–¹æ³•é‡å†™ã€‚å¦‚æœé€šè¿‡ç®­å¤´å‡½æ•°è°ƒç”¨å®ƒä¿©ä»»ä½•ä¸€ä¸ªæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå®å‚å®é™…ä¸Šéƒ½è¢«å¿½ç•¥ã€‚</p>

<p>å¯¹äº call() æ¥è¯´ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªä½œä¸ºè°ƒç”¨ä¸Šä¸‹æ–‡å®å‚ï¼Œä¹‹åçš„æ‰€æœ‰å®å‚å°±æ˜¯è¦ä¼ å…¥å¾…è°ƒç”¨å‡½æ•°çš„å€¼ï¼ˆå¹¶ä¸”ï¼Œè¿™éƒ¨åˆ†å®å‚å¯¹äºç®­å¤´å‡½æ•°æ¥è¯´ä¸è¢«å¿½ç•¥ï¼‰ã€‚æ¯”å¦‚ï¼Œä»¥å¯¹è±¡ o çš„æ–¹æ³•çš„å½¢å¼è°ƒç”¨å‡½æ•° f()ï¼Œå¹¶ä¼ å…¥ä¸¤ä¸ªæ•°ï¼Œå¯ä»¥ä½¿ç”¨è¿™æ ·çš„ä»£ç ï¼š</p>

<pre><code class="language-javascript">f.call(o, 1, 2);
</code></pre>

<p>apply() æ–¹æ³•å’Œ call() ç±»ä¼¼ï¼Œä½†ä¼ å…¥å®å‚çš„å½¢å¼å’Œ call() æœ‰æ‰€ä¸åŒï¼Œå®ƒçš„å®å‚éƒ½æ”¾å…¥ä¸€ä¸ªæ•°ç»„ä¸­ï¼š</p>

<pre><code class="language-javascript">f.apply(o, [1,2]);
</code></pre>

<p>å¦‚æœä¸€ä¸ªå‡½æ•°çš„å®å‚å¯ä»¥æ˜¯ä»»æ„æ•°é‡ï¼Œç”¨ apply() æ–¹æ³•å…è®¸ä½ ä¼ å…¥çš„å‚æ•°æ•°ç»„å¯ä»¥æ˜¯ä»»æ„é•¿åº¦çš„ã€‚åœ¨ ES6 ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å±•å¼€è¿ç®—ç¬¦ï¼Œä½†æ˜¯åœ¨ ES5 çš„ä»£ç ä¸­ä½ å¯ä»¥çœ‹åˆ°è¿™ç§æƒ…å†µæ˜¯ç”¨ apply() æ¥æ›¿ä»£ã€‚æ¯”å¦‚ï¼Œä¸ç”¨å±•å¼€è¿ç®—ç¬¦æ‰¾å‡ºæ•°ç»„ä¸­æœ€å¤§çš„æ•°å€¼å…ƒç´ ï¼Œè°ƒç”¨ Math.max() æ–¹æ³•çš„æ—¶å€™å¯ä»¥ç»™  apply() ä¼ å…¥ä¸€ä¸ªåŒ…å«ä»»æ„ä¸ªå…ƒç´ çš„æ•°ç»„ï¼š</p>

<pre><code class="language-javascript">let biggest = Math.max.apply(Math, arrayOfNumbers);
</code></pre>

<p>ä¸‹é¢å®šä¹‰çš„ trace() ä¸ Â§8.3.4 ä¸­å®šä¹‰çš„ timed() å‡½æ•°ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒå¯¹æ–¹æ³•æœ‰æ•ˆè€Œä¸æ˜¯å‡½æ•°ã€‚å®ƒä½¿ç”¨ apply() æ–¹æ³•è€Œä¸æ˜¯å±•å¼€è¿ç®—ç¬¦ï¼Œé€šè¿‡è¿™æ ·åšï¼Œå®ƒèƒ½å¤Ÿè°ƒç”¨å…·æœ‰ç›¸åŒå‚æ•°å’Œä¸è¢«åŒ…è£…æ–¹æ³•ç›¸åŒçš„ this å€¼çš„åŒ…è£…æ–¹æ³•ã€‚</p>

<pre><code class="language-javascript">// Replace the method named m of the object o with a version that logs
// messages before and after invoking the original method.
function trace(o, m) {
    let original = o[m];         // Remember original method in the closure.
    o[m] = function(...args) {   // Now define the new method.
        console.log(new Date(), &quot;Entering:&quot;, m);      // Log message.
        let result = original.apply(this, args);      // Invoke original.
        console.log(new Date(), &quot;Exiting:&quot;, m);       // Log message.
        return result;                                // Return result.
    };
}
</code></pre>

<h3 id="toc_30">8.7.5 bind() æ–¹æ³•</h3>

<p>The primary purpose of bind() is to bind a function to an object. When you invoke the bind() method on a function f and pass an object o, the method returns a new function. Invoking the new function (as a function) invokes the original function f as a method of o. Any arguments you pass to the new function are passed to the original function. For example:</p>

<blockquote>
<p>bind() æ–¹æ³•çš„ä¸»è¦ä½œç”¨å°±æ˜¯å°†å‡½æ•°ç»‘å®šè‡³æŸä¸ªå¯¹è±¡ã€‚å½“åœ¨å‡½æ•° f() ä¸Šè°ƒç”¨ bind() æ–¹æ³•å¹¶ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ o ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªæ–¹æ³•å°†è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚ï¼ˆä»¥å‡½æ•°è°ƒç”¨çš„æ–¹å¼ï¼‰è°ƒç”¨æ–°çš„å‡½æ•°å°†ä¼šæŠŠåŸå§‹çš„å‡½æ•° f() å½“åš o çš„æ–¹æ³•æ¥è°ƒç”¨ã€‚ä¼ å…¥æ–°å‡½æ•°çš„ä»»ä½•å®å‚éƒ½å°†ä¼ å…¥åŸå§‹å‡½æ•°ï¼Œæ¯”å¦‚ï¼š</p>
</blockquote>

<pre><code class="language-javascript">function f(y) { return this.x + y; } // This function needs to be bound
let o = { x: 1 };                    // An object we&#39;ll bind to
let g = f.bind(o);                   // Calling g(x) invokes f() on o
g(2)                                 // =&gt; 3
let p = { x: 10, g };                // Invoke g() as a method of this object
p.g(2)                               // =&gt; 3: g is still bound to o, not p.
</code></pre>

<p>ç®­å¤´å‡½æ•°ä»å®ƒä»¬å®šä¹‰çš„ä¸Šä¸‹æ–‡ä¸­ç»§æ‰¿ this å€¼ï¼Œå¹¶ä¸”å…¶ä¸å¯è¢« bind() æ–¹æ³•é‡å†™ï¼Œæ‰€ä»¥å¦‚æœä¸Šé¢çš„ä»£ç ç”¨ç®­å¤´å‡½æ•°å®šä¹‰å‡½æ•° f()ï¼Œè¿™ä¸ªç»‘å®šä¸ä¼šç”Ÿæ•ˆã€‚è°ƒç”¨ bind() æ–¹æ³•çš„æœ€å¸¸ç”¨åœºæ™¯æ˜¯è®©ä¸å¸¦ç®­å¤´çš„å‡½æ•°çš„è¡Œä¸ºåƒç®­å¤´å‡½æ•°ä¸€æ ·ï¼Œæ‰€ä»¥å®é™…ä¸Šç»‘å®šç®­å¤´å‡½æ•°çš„ this å±€é™æ€§å¹¶ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</p>

<p>ä½†æ˜¯ bind() æ–¹æ³•ä¸ä»…ä»…æ˜¯å°†å‡½æ•°ç»‘å®šè‡³ä¸€ä¸ªå¯¹è±¡ã€‚å®ƒè¿˜é™„å¸¦ä¸€äº›å…¶ä»–åº”ç”¨ï¼šé™¤äº†ç¬¬ä¸€ä¸ªå®å‚ä¹‹å¤–ï¼Œä¼ å…¥ bind() çš„å®å‚ä¹Ÿä¼šç»‘å®šè‡³ this å€¼ã€‚è¿™ä¸ªé™„å¸¦çš„åº”ç”¨åœ¨ç®­å¤´å‡½æ•°ä¸Šä¹ŸåŒæ ·ç”Ÿæ•ˆã€‚æ˜¯ä¸€ç§å¸¸è§çš„å‡½æ•°å¼ç¼–ç¨‹æŠ€æœ¯ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºâ€œæŸ¯é‡ŒåŒ–â€ã€‚å‚ç…§ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­çš„ bind() æ–¹æ³•çš„å®ç°ï¼š</p>

<pre><code class="language-javascript">let sum = (x,y) =&gt; x + y;      // Return the sum of 2 args
let succ = sum.bind(null, 1);  // Bind the first argument to 1
succ(2)  // =&gt; 3: x is bound to 1, and we pass 2 for the y argument

function f(y,z) { return this.x + y + z; }
let g = f.bind({x: 1}, 2);     // Bind this and y
g(3)     // =&gt; 6: this.x is bound to 1, y is bound to 2 and z is 3
</code></pre>

<p>bind() è¿”å›å‡½æ•°çš„åç§°å±æ€§æ˜¯è°ƒç”¨ bind() çš„å‡½æ•°çš„åç§°å±æ€§å‰é¢åŠ ä¸Šå‰ç¼€ä¸ºå•è¯&quot;bound&quot;ã€‚</p>

<h3 id="toc_31">8.7.6 toString() æ–¹æ³•</h3>

<p>å’Œæ‰€æœ‰çš„ JavaScript å¯¹è±¡ä¸€æ ·ï¼Œå‡½æ•°ä¹Ÿæœ‰ toString() æ–¹æ³•ï¼ŒECMAScript è§„èŒƒè§„å®šè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å’Œå‡½æ•°å£°æ˜è¯­å¥çš„è¯­æ³•ç›¸å…³ã€‚å®é™…ä¸Šï¼Œå¤§å¤šæ•°ï¼ˆéå…¨éƒ¨ï¼‰çš„ toString() æ–¹æ³•çš„å®ç°éƒ½è¿”å›å‡½æ•°çš„å®Œæ•´æºç ã€‚å†…ç½®å‡½æ•°å¾€å¾€è¿”å›ä¸€ä¸ªç±»ä¼¼â€[native code]â€çš„å­—ç¬¦ä¸²ä½œä¸ºå‡½æ•°ä½“ã€‚</p>

<h3 id="toc_32">8.7.7 Function() æ„é€ å‡½æ•°</h3>

<p>å› ä¸ºå‡½æ•°æ˜¯å¯¹è±¡ï¼Œæœ‰ä¸€ä¸ª Function() æ„é€ å‡½æ•°å¯ä»¥ç”¨æ¥åˆ›å»ºæ–°çš„å‡½æ•°ï¼š</p>

<pre><code class="language-javascript">const f = new Function(&quot;x&quot;, &quot;y&quot;, &quot;return x*y;&quot;);
</code></pre>

<p>è¿™ä¸€è¡Œä»£ç åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å’Œé€šè¿‡ä¸‹é¢ä»£ç å®šä¹‰çš„å‡½æ•°å‡ ä¹ç­‰ä»·ï¼š</p>

<pre><code class="language-javascript">const f = function(x, y) { return x*y; };
</code></pre>

<p>Function() æ„é€ å‡½æ•°å¯ä»¥ä¼ å…¥ä»»æ„æ•°é‡çš„å­—ç¬¦ä¸²å®å‚ï¼Œæœ€åä¸€ä¸ªå®å‚æ‰€è¡¨ç¤ºçš„æ–‡æœ¬å°±æ˜¯å‡½æ•°ä½“ï¼›å®ƒå¯ä»¥åŒ…å«ä»»æ„çš„ JavaScript è¯­å¥ï¼Œæ¯ä¸¤æ¡è¯­å¥ä¹‹é—´ç”¨åˆ†å·åˆ†éš”ã€‚ä¼ å…¥æ„é€ å‡½æ•°çš„å…¶ä»–æ‰€æœ‰çš„å®å‚å­—ç¬¦ä¸²æ˜¯æŒ‡å®šå‡½æ•°çš„å½¢å‚åå­—çš„å­—ç¬¦ä¸²ã€‚å¦‚æœå®šä¹‰çš„å‡½æ•°ä¸åŒ…å«ä»»ä½•å‚æ•°ï¼Œåªé¡»ç»™æ„é€ å‡½æ•°ç®€å•åœ°ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²â€”â€”å‡½æ•°ä½“â€”â€”å³å¯ã€‚</p>

<p>æ³¨æ„ï¼ŒFunction() æ„é€ å‡½æ•°å¹¶ä¸éœ€è¦é€šè¿‡ä¼ å…¥å®å‚ä»¥æŒ‡å®šå‡½æ•°åã€‚å°±åƒå‡½æ•°å­—é¢é‡ä¸€æ ·ï¼ŒFunction() æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°ã€‚</p>

<p>å…³äº Function() æ„é€ å‡½æ•°æœ‰å‡ ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š</p>

<p>Function() æ„é€ å‡½æ•°å…è®¸ JavaScript åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åˆ›å»ºå¹¶ç¼–è¯‘å‡½æ•°ã€‚</p>

<p>æ¯æ¬¡è°ƒç”¨ Function() æ„é€ å‡½æ•°éƒ½ä¼šè§£æå‡½æ•°ä½“ï¼Œå¹¶åˆ›å»ºæ–°çš„å‡½æ•°å¯¹è±¡ã€‚å¦‚æœæ˜¯åœ¨ä¸€ä¸ªå¾ªç¯æˆ–è€…å¤šæ¬¡è°ƒç”¨çš„å‡½æ•°ä¸­æ‰§è¡Œè¿™ä¸ªæ„é€ å‡½æ•°ï¼Œæ‰§è¡Œæ•ˆç‡ä¼šå—å½±å“ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¾ªç¯ä¸­çš„åµŒå¥—å‡½æ•°å’Œå‡½æ•°å®šä¹‰è¡¨è¾¾å¼åˆ™ä¸ä¼šæ¯æ¬¡æ‰§è¡Œæ—¶éƒ½é‡æ–°ç¼–è¯‘ã€‚</p>

<p>æœ€åä¸€ç‚¹ï¼Œä¹Ÿæ˜¯å…³äº Function() æ„é€ å‡½æ•°éå¸¸é‡è¦çš„ä¸€ç‚¹ï¼Œå°±æ˜¯å®ƒæ‰€åˆ›å»ºçš„å‡½æ•°å¹¶ä¸æ˜¯ä½¿ç”¨è¯æ³•ä½œç”¨åŸŸï¼Œç›¸åï¼Œå‡½æ•°ä½“ä»£ç çš„ç¼–è¯‘ç±»ä¼¼é¡¶å±‚å‡½æ•°ï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š</p>

<pre><code class="language-javascript">let scope = &quot;global&quot;;
function constructFunction() {
    let scope = &quot;local&quot;;
    return new Function(&quot;return scope&quot;);  // Doesn&#39;t capture local scope!
}
// This line returns &quot;global&quot; because the function returned by the
// Function() constructor does not use the local scope.
constructFunction()()  // =&gt; &quot;global&quot;
</code></pre>

<p>æˆ‘ä»¬å¯ä»¥å°† Function() æ„é€ å‡½æ•°è®¤ä¸ºæ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸä¸­æ‰§è¡Œçš„ eval()ï¼ˆè§  Â§4.12.2ï¼‰ï¼Œeval() å¯ä»¥åœ¨è‡ªå·±çš„ç§æœ‰ä½œç”¨åŸŸå†…å®šä¹‰æ–°å˜é‡å’Œå‡½æ•°ï¼ŒFunction() æ„é€ å‡½æ•°åœ¨å®é™…ç¼–ç¨‹è¿‡ç¨‹ä¸­å¾ˆå°‘ä¼šç”¨åˆ°ã€‚</p>

<h2 id="toc_33">8.8 å‡½æ•°å¼ç¼–ç¨‹</h2>

<p>å’Œ Lispã€Haskell ä¸åŒï¼ŒJavaScript å¹¶éå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œä½†åœ¨ JavaScript ä¸­å¯ä»¥åƒæ“æ§å¯¹è±¡ä¸€æ ·æ“æ§å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥åœ¨ JavaScript ä¸­åº”ç”¨å‡½æ•°å¼ç¼–ç¨‹æŠ€æœ¯ã€‚æ•°ç»„æ–¹æ³•è¯¸å¦‚ map() å’Œ reduce() å°±å¯ä»¥éå¸¸é€‚åˆç”¨äºå‡½æ•°å¼ç¼–ç¨‹é£æ ¼ã€‚æ¥ä¸‹æ¥çš„å‡ èŠ‚å°†ä¼šç€é‡ä»‹ç» JavaScript ä¸­çš„å‡½æ•°å¼ç¼–ç¨‹æŠ€æœ¯ã€‚å‡½æ•°å¼ç¼–ç¨‹æ—¨åœ¨æ‰©å±•å¯¹ JavaScript å‡½æ•°åŠŸèƒ½åŠŸèƒ½çš„æ¢ç´¢ï¼Œè€Œä¸æ˜¯ä¸ºäº†è‰¯å¥½çš„ç¼–ç¨‹é£æ ¼ã€‚</p>

<h3 id="toc_34">8.8.1 ç”¨å‡½æ•°å¤„ç†æ•°ç»„</h3>

<p>å‡è®¾æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ éƒ½æ˜¯æ•°å­—ï¼Œæˆ‘ä»¬æƒ³è¦è®¡ç®—è¿™äº›å…ƒç´ çš„å¹³å‡å€¼å’Œæ ‡å‡†å·®ã€‚è‹¥ä½¿ç”¨éå‡½æ•°å¼ç¼–ç¨‹é£æ ¼çš„è¯ï¼Œä»£ç ä¼šæ˜¯è¿™æ ·ï¼š</p>

<pre><code class="language-javascript">let data = [1,1,3,5,5];  // This is our array of numbers

// The mean is the sum of the elements divided by the number of elements
let total = 0;
for(let i = 0; i &lt; data.length; i++) total += data[i];
let mean = total/data.length;  // mean == 3; The mean of our data is 3

// To compute the standard deviation, we first sum the squares of
// the deviation of each element from the mean.
total = 0;
for(let i = 0; i &lt; data.length; i++) {
    let deviation = data[i] - mean;
    total += deviation * deviation;
}
let stddev = Math.sqrt(total/(data.length-1));  // stddev == 2
</code></pre>

<p>å¯ä»¥ä½¿ç”¨æ•°ç»„æ–¹æ³• map() å’Œ reduce() æ¥å®ç°åŒæ ·çš„è®¡ç®—ï¼Œè¿™ç§å®ç°æå…¶ç®€æ´ï¼ˆå‚ç…§ Â§7.8.1 æ¥æŸ¥çœ‹è¿™äº›æ–¹æ³•ï¼‰ï¼š</p>

<pre><code class="language-javascript">// First, define two simple functions
const sum = (x,y) =&gt; x+y;
const square = x =&gt; x*x;

// Then use those functions with Array methods to compute mean and stddev
let data = [1,1,3,5,5];
let mean = data.reduce(sum)/data.length;  // mean == 3
let deviations = data.map(x =&gt; x-mean);
let stddev = Math.sqrt(deviations.map(square).reduce(sum)/(data.length-1));
stddev  // =&gt; 2
</code></pre>

<p>è¿™ä¸ªæ–°ç‰ˆæœ¬çš„ä»£ç çœ‹èµ·æ¥è·Ÿç¬¬ä¸€ç‰ˆæœ‰å¾ˆå¤§ä¸åŒï¼Œä½†æ˜¯å®ƒä»ç„¶è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒè¿˜æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚æ¥ä¸‹æ¥ç”¨å‡½æ•°ç‰ˆæœ¬çš„ map() å’Œ reduce() æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">const map = function(a, ...args) { return a.map(...args); };
const reduce = function(a, ...args) { return a.reduce(...args); };
</code></pre>

<p>ç”¨è¿™ä¸¤ä¸ªå‡½æ•°å®šä¹‰äº† map() å’Œ reduce()ï¼Œæˆ‘ä»¬è®¡ç®—å¹³å‡å€¼å’Œæ ‡å‡†å·®å˜æˆè¿™æ ·ï¼š</p>

<pre><code class="language-javascript">const sum = (x,y) =&gt; x+y;
const square = x =&gt; x*x;

let data = [1,1,3,5,5];
let mean = reduce(data, sum)/data.length;
let deviations = map(data, x =&gt; x-mean);
let stddev = Math.sqrt(reduce(map(deviations, square), sum)/(data.length-1));
stddev  // =&gt; 2
</code></pre>

<h3 id="toc_35">8.8.2 é«˜é˜¶å‡½æ•°</h3>

<p>æ‰€è°“é«˜é˜¶å‡½æ•°å°±æ˜¯æ“ä½œå‡½æ•°çš„å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ã€‚æ¥çœ‹è¿™ä¸ªä¾‹å­ï¼š</p>

<pre><code class="language-javascript">// This higher-order function returns a new function that passes its
// arguments to f and returns the logical negation of f&#39;s return value;
function not(f) {
    return function(...args) {             // Return a new function
        let result = f.apply(this, args);  // that calls f
        return !result;                    // and negates its result.
    };
}

const even = x =&gt; x % 2 === 0; // A function to determine if a number is even
const odd = not(even);         // A new function that does the opposite
[1,1,3,5,5].every(odd)         // =&gt; true: every element of the array is odd
</code></pre>

<p>ä¸Šé¢çš„ not() å‡½æ•°å°±æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå› ä¸ºå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ã€‚å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œæ¥çœ‹ä¸‹é¢çš„ mapper() å‡½æ•°ï¼Œå®ƒä¹Ÿæ˜¯æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå®å‚ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè¿™ä¸ªæ–°å‡½æ•°å°†ä¸€ä¸ªæ•°ç»„æ˜ å°„åˆ°å¦ä¸€ä¸ªä½¿ç”¨è¿™ä¸ªå‡½æ•°çš„æ•°ç»„ä¸Šã€‚è¿™ä¸ªå‡½æ•°ä½¿ç”¨äº†ä¹‹å‰å®šä¹‰çš„ map() å‡½æ•°ï¼Œä½†è¦é¦–å…ˆç†è§£è¿™ä¸¤ä¸ªå‡½æ•°æœ‰å“ªé‡Œä¸ åŒï¼Œç†è§£è¿™ä¸€ç‚¹è‡³å…³é‡è¦ï¼š</p>

<pre><code class="language-javascript">// Return a function that expects an array argument and applies f to
// each element, returning the array of return values.
// Contrast this with the map() function from earlier.
function mapper(f) {
    return a =&gt; map(a, f);
}

const increment = x =&gt; x+1;
const incrementAll = mapper(increment);
incrementAll([1,2,3])  // =&gt; [2,3,4]
</code></pre>

<p>è¿™é‡Œæ˜¯ä¸€ä¸ªæ›´å¸¸è§çš„ä¾‹å­ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ªå‡½æ•° f() å’Œ g()ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ç”¨ä»¥è®¡ç®— f(g())ï¼š</p>

<pre><code class="language-javascript">// Return a new function that computes f(g(...)).
// The returned function h passes all of its arguments to g, then passes
// the return value of g to f, then returns the return value of f.
// Both f and g are invoked with the same this value as h was invoked with.
function compose(f, g) {
    return function(...args) {
        // We use call for f because we&#39;re passing a single value and
        // apply for g because we&#39;re passing an array of values.
        return f.call(this, g.apply(this, args));
    };
}

const sum = (x,y) =&gt; x+y;
const square = x =&gt; x*x;
compose(square, sum)(2,3)  // =&gt; 25; the square of the sum
</code></pre>

<p>æœ¬ç« åç»­å‡ èŠ‚ä¸­å®šä¹‰äº† partial() å’Œ memoize() å‡½æ•°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°æ˜¯éå¸¸é‡è¦çš„é«˜é˜¶å‡½æ•°ã€‚</p>

<h3 id="toc_36">8.8.3 å±€éƒ¨åº”ç”¨å‡½æ•°</h3>

<p>å‡½æ•° f()ï¼ˆè§ Â§8.7.5ï¼‰çš„ bind() æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œç»™æ–°å‡½æ•°ä¼ å…¥ç‰¹å®šçš„ä¸Šä¸‹æ–‡å’Œä¸€ç»„æŒ‡å®šçš„å‚æ•°ï¼Œç„¶åè°ƒç”¨å‡½æ•° f()ã€‚æˆ‘ä»¬è¯´å®ƒæŠŠå‡½æ•°â€œç»‘å®šè‡³â€å¯¹è±¡å¹¶ä¼ å…¥ä¸€éƒ¨åˆ†å‚æ•°ã€‚bind() æ–¹æ³•åªæ˜¯å°†å®å‚æ”¾åœ¨ï¼ˆå®Œæ•´å®å‚åˆ—è¡¨çš„ï¼‰å·¦ä¾§ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼ å…¥ bind() çš„å®å‚éƒ½æ˜¯æ”¾åœ¨ä¼ å…¥åŸå§‹å‡½æ•°çš„å®å‚åˆ—è¡¨å¼€å§‹çš„ä½ç½®ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬æœŸæœ›å°†ä¼ å…¥ bind() çš„å®å‚æ”¾åœ¨ï¼ˆå®Œæ•´å®å‚åˆ—è¡¨çš„ï¼‰å³ä¾§ï¼š</p>

<pre><code class="language-javascript">// The arguments to this function are passed on the left
function partialLeft(f, ...outerArgs) {
    return function(...innerArgs) { // Return this function
        let args = [...outerArgs, ...innerArgs]; // Build the argument list
        return f.apply(this, args);              // Then invoke f with it
    };
}

// The arguments to this function are passed on the right
function partialRight(f, ...outerArgs) {
    return function(...innerArgs) {  // Return this function
        let args = [...innerArgs, ...outerArgs]; // Build the argument list
        return f.apply(this, args);              // Then invoke f with it
    };
}

// The arguments to this function serve as a template. Undefined values
// in the argument list are filled in with values from the inner set.
function partial(f, ...outerArgs) {
    return function(...innerArgs) {
        let args = [...outerArgs]; // local copy of outer args template
        let innerIndex=0;          // which inner arg is next
        // Loop through the args, filling in undefined values from inner args
        for(let i = 0; i &lt; args.length; i++) {
            if (args[i] === undefined) args[i] = innerArgs[innerIndex++];
        }
        // Now append any remaining inner arguments
        args.push(...innerArgs.slice(innerIndex));
        return f.apply(this, args);
    };
}

// Here is a function with three arguments
const f = function(x,y,z) { return x * (y - z); };
// Notice how these three partial applications differ
partialLeft(f, 2)(3,4)         // =&gt; -2: Bind first argument: 2 * (3 - 4)
partialRight(f, 2)(3,4)        // =&gt;  6: Bind last argument: 3 * (4 - 2)
partial(f, undefined, 2)(3,4)  // =&gt; -6: Bind middle argument: 3 * (2 - 4)
</code></pre>

<p>åˆ©ç”¨è¿™ç§ä¸å®Œå…¨å‡½æ•°çš„ç¼–ç¨‹æŠ€å·§ï¼Œå¯ä»¥ç¼–å†™ä¸€äº›æœ‰æ„æ€çš„ä»£ç ï¼Œåˆ©ç”¨å·²æœ‰çš„å‡½æ•°æ¥å®šä¹‰æ–°çš„å‡½æ•°ï¼Œå‚ç…§ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>

<pre><code class="language-javascript">const increment = partialLeft(sum, 1);
const cuberoot = partialRight(Math.pow, 1/3);
cuberoot(increment(26))  // =&gt; 3
</code></pre>

<p>å½“å°†ä¸å®Œå…¨è°ƒç”¨å’Œå…¶ä»–é«˜é˜¶å‡½æ•°æ•´åˆåœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œäº‹æƒ…å°±å˜å¾—æ ¼å¤–æœ‰è¶£äº†ã€‚æ¯”å¦‚ï¼Œè¿™é‡Œçš„ä¾‹å­å®šä¹‰äº† not() å‡½æ•°ï¼Œå®ƒç”¨åˆ°äº†åˆšæ‰æåˆ°çš„ä¸å®Œå…¨è°ƒç”¨ï¼š</p>

<pre><code class="language-javascript">const not = partialLeft(compose, x =&gt; !x);
const even = x =&gt; x % 2 === 0;
const odd = not(even);
const isNumber = not(isNaN);
odd(3) &amp;&amp; isNumber(2)  // =&gt; true
</code></pre>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸å®Œå…¨è°ƒç”¨çš„ç»„åˆæ¥é‡æ–°ç»„ç»‡æ±‚å¹³å‡æ•°å’Œæ ‡å‡†å·®çš„ä»£ç ï¼Œè¿™ç§ç¼–ç é£æ ¼æ˜¯éå¸¸çº¯ç²¹çš„å‡½æ•°å¼ç¼–ç¨‹ï¼š</p>

<pre><code class="language-javascript">// sum() and square() functions are defined above. Here are some more:
const product = (x,y) =&gt; x*y;
const neg = partial(product, -1);
const sqrt = partial(Math.pow, undefined, .5);
const reciprocal = partial(Math.pow, undefined, neg(1));

// Now compute the mean and standard deviation.
let data = [1,1,3,5,5];   // Our data
let mean = product(reduce(data, sum), reciprocal(data.length));
let stddev = sqrt(product(reduce(map(data,
                                     compose(square,
                                             partial(sum, neg(mean)))),
                                 sum),
                          reciprocal(sum(data.length,neg(1)))));
[mean, stddev]  // =&gt; [3, 2]
</code></pre>

<p>æ³¨æ„ï¼Œè¿™æ®µä»£ç è®¡ç®—å¹³å‡å€¼å’Œæ ‡å‡†å·®å®Œå…¨æ˜¯å‡½æ•°è°ƒç”¨;æ²¡æœ‰æ¶‰åŠè¿ç®—ç¬¦ï¼Œå¹¶ä¸”æ‹¬å·çš„æ•°é‡å¢é•¿å¦‚æ­¤ä¹‹å¤§è®© JavaScript å¼€å§‹çœ‹èµ·æ¥åƒ Lisp ä»£ç ã€‚åŒæ ·ï¼Œè¿™ä¸æ˜¯æˆ‘æå€¡çš„ JavaScript ç¼–ç¨‹é£æ ¼ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç»ƒä¹ ï¼Œçœ‹çœ‹ JavaScript ä»£ç çš„åŠŸèƒ½æœ‰å¤šæ·±ã€‚</p>

<h3 id="toc_37">8.8.4 è®°å¿†ï¼ˆMemoizationï¼‰</h3>

<p>åœ¨ Â§8.4.1 ä¸­å®šä¹‰äº†ä¸€ä¸ªé˜¶ä¹˜å‡½æ•°ï¼Œå®ƒå¯ä»¥å°†ä¸Šæ¬¡çš„è®¡ç®—ç»“æœç¼“å­˜èµ·æ¥ã€‚åœ¨å‡½æ•°å¼ç¼–ç¨‹å½“ä¸­ï¼Œè¿™ç§ç¼“å­˜æŠ€å·§å«åšâ€œè®°å¿†â€ï¼ˆmemorizationï¼‰ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œmemorize() æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå®å‚ï¼Œå¹¶è¿”å›å¸¦æœ‰è®°å¿†èƒ½åŠ›çš„å‡½æ•°:</p>

<pre><code class="language-javascript">// Return a memoized version of f.
// It only works if arguments to f all have distinct string representations.
function memoize(f) {
    const cache = new Map();  // Value cache stored in the closure.

    return function(...args) {
        // Create a string version of the arguments to use as a cache key.
        let key = args.length + args.join(&quot;+&quot;);
        if (cache.has(key)) {
            return cache.get(key);
        } else {
            let result = f.apply(this, args);
            cache.set(key, result);
            return result;
        }
    };
}
</code></pre>

<p>memorize() å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è¢«å½“åšç¼“å­˜ï¼ˆçš„å®¿ä¸»ï¼‰å¹¶èµ‹å€¼ç»™ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œå› æ­¤å¯¹äºè¿”å›çš„å‡½æ•°æ¥è¯´å®ƒæ˜¯ç§æœ‰çš„ï¼ˆåœ¨é—­åŒ…ä¸­ï¼‰ã€‚æ‰€è¿”å›çš„å‡½æ•°å°†å®ƒçš„å®å‚æ•°ç»„è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå¹¶å°†å­—ç¬¦ä¸²ç”¨åšç¼“å­˜å¯¹è±¡çš„å±æ€§åã€‚å¦‚æœåœ¨ç¼“å­˜ä¸­å­˜åœ¨è¿™ä¸ªå€¼ï¼Œåˆ™ç›´æ¥è¿”å›å®ƒã€‚å¦åˆ™ï¼Œå°±è°ƒç”¨æ—¢å®šçš„å‡½æ•°å¯¹å®å‚è¿›è¡Œè®¡ç®—ï¼Œå°†è®¡ç®—ç»“æœç¼“å­˜èµ·æ¥å¹¶è¿”å›ï¼Œä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ memorize()ï¼š</p>

<pre><code class="language-javascript">// Return the Greatest Common Divisor of two integers using the Euclidian
// algorithm: http://en.wikipedia.org/wiki/Euclidean_algorithm
function gcd(a,b) {  // Type checking for a and b has been omitted
    if (a &lt; b) {           // Ensure that a &gt;= b when we start
        [a, b] = [b, a];   // Destructuring assignment to swap variables
    }
    while(b !== 0) {       // This is Euclid&#39;s algorithm for GCD
        [a, b] = [b, a%b];
    }
    return a;
}

const gcdmemo = memoize(gcd);
gcdmemo(85, 187)  // =&gt; 17

// Note that when we write a recursive function that we will be memoizing,
// we typically want to recurse to the memoized version, not the original.
const factorial = memoize(function(n) {
    return (n &lt;= 1) ? 1 : n * factorial(n-1);
});
factorial(5)      // =&gt; 120: also caches values for 4, 3, 2 and 1.
</code></pre>

<h2 id="toc_38">8.9 æ€»ç»“</h2>

<p>æœ¬ç« å…³é”®ç‚¹æ€»ç»“å¦‚ä¸‹ï¼š</p>

<ul>
<li>å¯ä»¥ç”¨å‡½æ•°å…³é”®å­—å’Œ ES6 =&gt; ç®­å¤´å‡½æ•°æ¥å®šä¹‰å‡½æ•°ã€‚</li>
<li>å¯ä»¥ä»¥æ–¹æ³•å’Œæ„é€ å‡½æ•°çš„æ–¹å¼è°ƒç”¨å‡½æ•°ã€‚</li>
<li>ä¸€äº› ES6 ç‰¹æ€§ï¼Œå…è®¸å‚æ•°è®¾å®šé»˜è®¤å€¼ï¼Œå¯ä»¥ç”¨å‰©ä½™å‚æ•°å°†å¤šä¸ªå‚æ•°æœé›†åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå¯ä»¥è§£æ„å¯¹è±¡å’Œæ•°ç»„å®å‚åˆ°å‡½æ•°å‚æ•°ä¸­ã€‚</li>
<li>å¯ä»¥ç”¨ ... å±•å¼€è¿ç®—ç¬¦ä¼ é€’æ•°ç»„å…ƒç´ æˆ–è€…å…¶ä»–å¯è¿­ä»£å¯¹è±¡åˆ°å‡½æ•°è°ƒç”¨ã€‚</li>
<li>å°é—­å‡½æ•°å†…éƒ¨å®šä¹‰å¹¶è¿”å›çš„å‡½æ•°ä¿ç•™å¯¹å…¶è¯æ³•ä½œç”¨åŸŸçš„è®¿é—®ï¼Œå› æ­¤å¯ä»¥è¯»å–å’Œå†™å…¥å¤–éƒ¨å‡½æ•°å†…å®šä¹‰çš„å˜é‡ã€‚ç”¨è¿™ç§æ–¹å¼ä½¿ç”¨çš„å‡½æ•°ç§°ä¸ºé—­åŒ…ï¼Œè¿™æ˜¯ä¸€ç§å€¼å¾—ç†è§£çš„æŠ€æœ¯ã€‚</li>
<li>å‡½æ•°æ˜¯å¯ç”± JavaScript æ“ä½œçš„å¯¹è±¡ï¼Œè¿™ä½¿ JavaScript æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ã€‚</li>
</ul>

<div class="footnotes">
<hr/>
<ol>

<li id="fn1">
<p>è¿™ä¸ªæœ¯è¯­æœ€åˆæ˜¯ç”± Martin Fowler æå‡ºçš„ï¼Œå‚è§<a href="http://martinfowler.com/dslwip/MethodChaining.html%E3%80%82">http://martinfowler.com/dslwip/MethodChaining.htmlã€‚</a>&nbsp;<a href="#fnref1" rev="footnote">&#8617;</a></p>
</li>

<li id="fn2">
<p>è¿™çœ‹èµ·æ¥ä¸è¶³ä¸ºå¥‡ï¼Œä½†å¦‚æœä½ å¯¹ Python å¾ˆç†Ÿæ‚‰ï¼Œä½ ä¼šå‘ç° Python ä¸­çš„å‡½æ•°æ˜¯ç¨‹åºçš„ä¸€ éƒ¨åˆ†ï¼Œä½†æ— æ³•è¢«ç¨‹åºæ“ä½œã€‚&nbsp;<a href="#fnref2" rev="footnote">&#8617;</a></p>
</li>

<li id="fn3">
<p>è¿™ä¼¼ä¹å¹¶ä¸æ˜¯ä¸€ä¸ªç‰¹åˆ«æœ‰è¶£çš„ç‚¹ï¼Œé™¤éä½ ç†Ÿæ‚‰æ›´å¤šçš„é™æ€è¯­è¨€ï¼Œå…¶ä¸­å‡½æ•°æ˜¯ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¸èƒ½ç”±ç¨‹åºæ“ä½œã€‚&nbsp;<a href="#fnref3" rev="footnote">&#8617;</a></p>
</li>

</ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¬¬ 9 ç«  ç±»]]></title>
    <link href="2019919.xyz/16118386693796.html"/>
    <updated>2021-01-28T20:57:49+08:00</updated>
    <id>2019919.xyz/16118386693796.html</id>
    <content type="html"><![CDATA[
<ul>
<li>
<a href="#toc_0">9.1 ç±»å’ŒåŸå‹</a>
</li>
<li>
<a href="#toc_1">9.2 ç±»å’Œæ„é€ å‡½æ•°</a>
<ul>
<li>
<a href="#toc_2">9.2.1 æ„é€ å‡½æ•°ã€ç±»æ ‡è¯†å’Œ instanceof</a>
</li>
<li>
<a href="#toc_3">9.2.2 constructor å±æ€§</a>
</li>
</ul>
</li>
<li>
<a href="#toc_4">9.3 ä½¿ç”¨ class å…³é”®å­—çš„ç±»</a>
<ul>
<li>
<a href="#toc_5">9.3.1 é™æ€æ–¹æ³•</a>
</li>
<li>
<a href="#toc_6">9.3.2 Getterã€Setter å’Œå…¶ä»–æ–¹æ³•</a>
</li>
<li>
<a href="#toc_7">9.3.3 å…¬æœ‰ã€ç§æœ‰å’Œé™æ€å­—æ®µ</a>
</li>
<li>
<a href="#toc_8">9.3.4 ç¤ºä¾‹ï¼šä¸€ä¸ªå¤æ•°ç±»</a>
</li>
</ul>
</li>
<li>
<a href="#toc_9">9.4 ä¸ºç±»æ·»åŠ æ–¹æ³•</a>
</li>
<li>
<a href="#toc_10">9.5 å­ç±»</a>
<ul>
<li>
<a href="#toc_11">9.5.1 å­ç±»å’ŒåŸå‹</a>
</li>
<li>
<a href="#toc_12">9.5.2 å­ç±»ä¸ extends å’Œ super</a>
</li>
<li>
<a href="#toc_13">9.5.3 å§”æ‰˜ä»£æ›¿ç»§æ‰¿</a>
</li>
<li>
<a href="#toc_14">9.5.4 Hierarchies ç±»å’ŒæŠ½è±¡ç±»</a>
</li>
</ul>
</li>
<li>
<a href="#toc_15">9.6 æ€»ç»“</a>
</li>
</ul>


<p>ç¬¬ 6 ç« è¯¦ç»†ä»‹ç»äº† JavaScript å¯¹è±¡ï¼Œæ¯ä¸ª JavaScript å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ªå±æ€§é›†åˆï¼Œç›¸äº’ä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»ã€‚åœ¨ JavaScript ä¸­ä¹Ÿå¯ä»¥å®šä¹‰å¯¹è±¡çš„ç±»ï¼Œè®©æ¯ä¸ªå¯¹è±¡éƒ½å…±äº«æŸäº›å±æ€§ï¼Œè¿™ç§â€œå…±äº«â€çš„ç‰¹æ€§æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ç±»çš„æˆå‘˜æˆ–å®ä¾‹éƒ½åŒ…å«ä¸€äº›å±æ€§ï¼Œç”¨ä»¥å­˜æ”¾æˆ–å®šä¹‰å®ƒä»¬çš„çŠ¶æ€ï¼Œå…¶ä¸­æœ‰äº›å±æ€§å®šä¹‰äº†å®ƒä»¬çš„è¡Œä¸ºï¼ˆé€šå¸¸ç§°ä¸ºæ–¹æ³•ï¼‰ã€‚è¿™äº›è¡Œä¸ºé€šå¸¸æ˜¯ç”±ç±»å®šä¹‰çš„ï¼Œè€Œä¸”ä¸ºæ‰€æœ‰å®ä¾‹æ‰€å…±äº«ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªåä¸º Complex çš„ç±»ç”¨æ¥è¡¨ç¤ºå¤æ•°ï¼ŒåŒæ—¶è¿˜å®šä¹‰äº†ä¸€äº›å¤æ•°è¿ç®—ã€‚ä¸€ä¸ª Complex å®ä¾‹åº”å½“åŒ…å«å¤æ•°çš„å®éƒ¨å’Œè™šéƒ¨ï¼ˆçŠ¶æ€ï¼‰ï¼ŒåŒæ · Complex ç±»è¿˜ä¼šå®šä¹‰å¤æ•°çš„åŠ æ³•å’Œä¹˜æ³•æ“ä½œï¼ˆè¡Œä¸ºï¼‰ã€‚</p>

<p>åœ¨ JavaScript ä¸­ï¼Œç±»çš„å®ç°æ˜¯åŸºäºå…¶åŸå‹ç»§æ‰¿æœºåˆ¶çš„ã€‚å¦‚æœä¸¤ä¸ªå®ä¾‹éƒ½ä»åŒä¸€ä¸ªåŸå‹å¯¹è±¡ä¸Šç»§æ‰¿äº†å±æ€§ï¼Œæˆ‘ä»¬è¯´å®ƒä»¬æ˜¯åŒä¸€ä¸ªç±»çš„å®ä¾‹ã€‚JavaScript åŸå‹å’Œç»§æ‰¿åœ¨ Â§6.2.3 å’Œ Â§6.3.2 èŠ‚ä¸­æœ‰è¯¦ç»†è®¨è®ºï¼Œä¸ºäº†æ›´å¥½åœ°ç†è§£æœ¬ç« çš„å†…å®¹ï¼Œè¯·åŠ¡å¿…é¦–å…ˆé˜…è¯»è¿™ä¸¤ä¸ªç« èŠ‚ã€‚æœ¬ç« å°†ä¼šåœ¨ Â§9.1 ä¸­å¯¹åŸå‹åšè¿›ä¸€æ­¥è®¨è®ºã€‚</p>

<p>å¦‚æœä¸¤ä¸ªå¯¹è±¡ç»§æ‰¿è‡ªåŒä¸€ä¸ªåŸå‹ï¼Œå¾€å¾€æ„å‘³ç€ï¼ˆä½†ä¸æ˜¯ç»å¯¹ï¼‰å®ƒä»¬æ˜¯ç”±åŒä¸€ä¸ªæ„é€ å‡½æ•°åˆ›å»ºå¹¶åˆå§‹åŒ–çš„ã€‚æˆ‘ä»¬å·²ç»åœ¨ Â§4.6ã€Â§6.2.2 å’Œ Â§8.2.3 èŠ‚ä¸­è¯¦ç»†è®²è§£äº†æ„é€ å‡½æ•°ï¼ŒÂ§9.2 ä¼šæœ‰è¿›ä¸€æ­¥è®¨è®ºã€‚</p>

<p>JavaScript ä¸€ç›´å…è®¸å®šä¹‰ç±»ã€‚ES6 å¼•å…¥äº†å…¨æ–°çš„è¯­æ³•ï¼ˆåŒ…æ‹¬ class å…³é”®å­—ï¼‰ï¼Œä½¿åˆ›å»ºç±»æ›´åŠ å®¹æ˜“ã€‚è¿™äº›æ–°çš„ JavaScript ç±»çš„å·¥ä½œæ–¹å¼ä¸æ—§å¼ç±»ç›¸åŒï¼Œæœ¬ç« é¦–å…ˆè§£é‡Šåˆ›å»ºç±»çš„æ—§æ–¹æ³•ï¼Œå› ä¸ºè¿™æ›´æ¸…æ¥šåœ°å±•ç¤ºäº†ç±»æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ä¸€æ—¦æˆ‘ä»¬è§£é‡Šäº†è¿™äº›åŸºæœ¬åŸç†ï¼Œæˆ‘ä»¬å°†æ”¹å˜å¹¶å¼€å§‹ä½¿ç”¨æ–°çš„ã€ç®€åŒ–çš„ç±»å®šä¹‰è¯­æ³•ã€‚</p>

<p>å¦‚æœä½ å¯¹è¯¸å¦‚ Java å’Œ C++ è¿™ç§å¼ºç±»å‹çš„é¢å‘å¯¹è±¡ç¼–ç¨‹æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä½ ä¼šå‘ç° JavaScript ä¸­çš„ç±»å’Œ Java ä»¥åŠ C++ ä¸­çš„ç±»æœ‰å¾ˆå¤§ä¸åŒã€‚å°½ç®¡åœ¨å†™æ³•ä¸Šç±»ä¼¼ï¼Œè€Œä¸”åœ¨ JavaScript ä¸­ä¹Ÿèƒ½â€œæ¨¡æ‹Ÿâ€å‡ºå¾ˆå¤šç»å…¸çš„ç±»çš„ç‰¹æ€§ï¼Œä½†æ˜¯æœ€å¥½è¦ç†è§£ JavaScript çš„ç±»å’ŒåŸºäºåŸå‹çš„ç»§æ‰¿æœºåˆ¶ï¼Œä»¥åŠå’Œä¼ ç»Ÿçš„ Javaï¼ˆå½“ç„¶è¿˜æœ‰ç±»ä¼¼ Java çš„è¯­è¨€ï¼‰çš„ç±»å’ŒåŸºäºç±»çš„ç»§æ‰¿æœºåˆ¶çš„ä¸åŒä¹‹å¤„ã€‚</p>

<h2 id="toc_0">9.1 ç±»å’ŒåŸå‹</h2>

<p>åœ¨ JavaScript ä¸­ï¼Œç±»çš„æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½ä»åŒä¸€ä¸ªåŸå‹å¯¹è±¡ä¸Šç»§æ‰¿å±æ€§ã€‚å› æ­¤ï¼ŒåŸå‹å¯¹è±¡æ˜¯ç±»çš„æ ¸å¿ƒã€‚åœ¨ç¤ºä¾‹ 6-1 ä¸­å®šä¹‰äº† inherit() å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œåè€…ç»§æ‰¿è‡ªæŸä¸ªåŸå‹å¯¹è±¡ã€‚å¦‚æœå®šä¹‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œç„¶åé€šè¿‡ inherit() å‡½æ•°åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªå®ƒçš„å¯¹è±¡ï¼Œè¿™æ ·å°±å®šä¹‰äº†ä¸€ä¸ª JavaScript ç±»ã€‚é€šå¸¸ï¼Œç±»çš„å®ä¾‹è¿˜éœ€è¦è¿›ä¸€æ­¥çš„åˆå§‹åŒ–ï¼Œé€šå¸¸æ˜¯é€šè¿‡å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥åˆ›å»ºå¹¶åˆå§‹åŒ–è¿™ä¸ªæ–°å¯¹è±¡ï¼Œå‚ç…§ç¤ºä¾‹ 9-1ã€‚ç¤ºä¾‹ 9-1 ç»™ä¸€ä¸ªè¡¨ç¤ºâ€œå€¼çš„èŒƒå›´â€çš„ç±»å®šä¹‰äº†åŸå‹å¯¹è±¡ï¼Œè¿˜å®šä¹‰äº†ä¸€ä¸ªâ€œå·¥å‚â€å‡½æ•°ç”¨ä»¥åˆ›å»ºå¹¶åˆå§‹åŒ–ç±»çš„å®ä¾‹ã€‚</p>

<p>ç¤ºä¾‹ 9-1ï¼šä¸€ä¸ªç®€å•çš„ JavaScript ç±»</p>

<pre><code class="language-javascript">// This is a factory function that returns a new range object.
function range(from, to) {
    // Use Object.create() to create an object that inherits from the
    // prototype object defined below.  The prototype object is stored as
    // a property of this function, and defines the shared methods (behavior)
    // for all range objects.
    let r = Object.create(range.methods);

    // Store the start and end points (state) of this new range object.
    // These are noninherited properties that are unique to this object.
    r.from = from;
    r.to = to;

    // Finally return the new object
    return r;
}

// This prototype object defines methods inherited by all range objects.
range.methods = {
    // Return true if x is in the range, false otherwise
    // This method works for textual and Date ranges as well as numeric.
    includes(x) { return this.from &lt;= x &amp;&amp; x &lt;= this.to; },

    // A generator function that makes instances of the class iterable.
    // Note that it only works for numeric ranges.
    *[Symbol.iterator]() {
        for(let x = Math.ceil(this.from); x &lt;= this.to; x++) yield x;
    },

    // Return a string representation of the range
    toString() { return &quot;(&quot; + this.from + &quot;...&quot; + this.to + &quot;)&quot;; }
};

// Here are example uses of a range object.
let r = range(1,3);      // Create a range object
r.includes(2)            // =&gt; true: 2 is in the range
r.toString()             // =&gt; &quot;(1...3)&quot;
[...r]                   // =&gt; [1, 2, 3]; convert to an array via iterator
</code></pre>

<p>åœ¨ç¤ºä¾‹ 9-1 çš„ä»£ç ä¸­æœ‰ä¸€ä¸‹å‡ ç‚¹å€¼å¾—æ³¨æ„ï¼š</p>

<p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªå·¥å‚å‡½æ•° range() ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Range å¯¹è±¡ã€‚</p>

<p>ç”¨ range() å‡½æ•°çš„ methods å±æ€§æ¥å­˜æ”¾å®šä¹‰ç±»çš„åŸå‹å¯¹è±¡ã€‚åªæ˜¯å°†åŸå‹å¯¹è±¡éšæ„çš„æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªè§„çº¦æˆ–è€…ä¹ æƒ¯ã€‚</p>

<p>range() å‡½æ•°åœ¨æ¯ä¸ª Range å¯¹è±¡ä¸­éƒ½å®šä¹‰ from å’Œ to å±æ€§ã€‚å®ƒä»¬æ˜¯éå…±äº«ã€éç»§æ‰¿å±æ€§ï¼Œæ˜¯æ¯ä¸ªç‹¬ç«‹çš„ Range å¯¹è±¡çš„ç‹¬ç‰¹è‡ªæœ‰çŠ¶æ€ã€‚</p>

<p>range.methods å¯¹è±¡åº”ç”¨äº† ES6 çš„é€Ÿè®°è¯­æ³•æ¥å®šä¹‰æ–¹æ³•ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆæ²¡æœ‰çœ‹åˆ° function å…³é”®å­—çš„åŸå› ã€‚ï¼ˆå‚ç…§ Â§6.10.5 æ¥å¤ä¹ å¯¹è±¡å­—é¢é‡é€Ÿè®°æ–¹æ³•è¯­æ³•ã€‚ï¼‰</p>

<p>åŸå‹ä¸­çš„ä¸€ä¸ªæ–¹æ³• Symbol.iterator ä½¿ç”¨äº†è®¡ç®—å±æ€§åï¼ˆÂ§6.10.2ï¼‰ï¼Œè¡¨æ˜å®ƒæ˜¯ä¸º Range å¯¹è±¡å®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨ã€‚æ–¹æ³•åç§°å¸¦æœ‰ä¸€ä¸ªå‰ç¼€ *ï¼Œæ ‡è¯†å®ƒæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°è€Œä¸æ˜¯æ™®é€šçš„å‡½æ•°ã€‚è¿­ä»£å™¨å’Œç”Ÿæˆå™¨åœ¨ç¬¬ 12 ç« ä¼šè¯¦ç»†æè¿°ã€‚ç°åœ¨ï¼Œåªéœ€è¦çŸ¥é“ Range ç±»çš„å®ä¾‹å¯ä»¥ç”¨ for/of å¾ªç¯å’Œå¯ä»¥ç”¨ ... å±•å¼€è¿ç®—ç¬¦ã€‚</p>

<p>å®šä¹‰åœ¨ range.methods ä¸­çš„å…±äº«ç»§æ‰¿æ–¹æ³•éƒ½ä½¿ç”¨åœ¨ range() å·¥å‚å‡½æ•°åˆå§‹åŒ–çš„ from å’Œ to å±æ€§ã€‚åœ¨è¿™äº›æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¸ºäº†å¼•ç”¨ from å’Œ to å±æ€§ï¼Œéƒ½ä½¿ç”¨ this å…³é”®å­—æ¥è·å–å¯¹è±¡çš„å¼•ç”¨ã€‚this è¿™ç§ç”¨æ³•æ˜¯ä»»ä½•ç±»ä¸­æ–¹æ³•çš„åŸºæœ¬ç‰¹å¾ã€‚</p>

<h2 id="toc_1">9.2 ç±»å’Œæ„é€ å‡½æ•°</h2>

<p>ç¤ºä¾‹ 9-1 å±•ç¤ºäº†ä¸€ä¸ªç®€å•æ–¹å¼æ¥å®šä¹‰ä¸€ä¸ª JavaScript ç±»ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•å¹¶ä¸å¸¸ç”¨ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚æ„é€ å‡½æ•°æ˜¯ç”¨æ¥åˆå§‹åŒ–æ–°å»ºå¯¹è±¡çš„ã€‚å¦‚ Â§8.2.3 ä¸­æ‰€è¿°æ„é€ å‡½æ•°ç”¨ new å…³é”®å­—æ¥è°ƒç”¨ã€‚ä½¿ç”¨ new è°ƒç”¨æ„é€ å‡½æ•°ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå› æ­¤æ„é€ å‡½æ•°æœ¬èº«åªéœ€åˆå§‹åŒ–è¿™ä¸ªæ–°å¯¹è±¡çš„çŠ¶æ€å³å¯ã€‚Â§6.2.3 ä»‹ç»å¹¶å¼ºè°ƒäº†è™½ç„¶æ‰€æœ‰å¯¹è±¡éƒ½æœ‰åŸå‹ï¼Œä½†æ˜¯åªæœ‰ä¸€éƒ¨åˆ†å¯¹è±¡æœ‰ä¸€ä¸ª prototype å±æ€§ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥æ¾„æ¸…è¿™ä¸€ç‚¹ï¼šæ˜¯å‡½æ•°å¯¹è±¡å…·æœ‰ prototype å±æ€§ã€‚è¿™æ„å‘³ç€æ‰€æœ‰ç”¨åŒä¸€æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡ç»§æ‰¿åŒä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤å®ƒä»¬æ˜¯åŒä¸€ç±»çš„æˆå‘˜ã€‚ç¤ºä¾‹ 9-2 è¯´æ˜äº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªæ„é€ å‡½æ•°æ¥æ›¿ä»£ç¤ºä¾‹ 9-1 ä¸­çš„å·¥å‚å‡½æ•°æ¥ä¿®æ”¹ Range ç±»ã€‚ç¤ºä¾‹ 9-2 æ¼”ç¤ºäº†åœ¨ä¸æ”¯æŒ ES6 class å…³é”®å­—ç‰ˆæœ¬çš„ JavaScript ä¸­åˆ›å»ºä¸€ä¸ªç±»çš„é€šç”¨æ–¹æ³•ã€‚å³ä½¿æ˜¯ class å·²ç»å¾ˆå¥½æ”¯æŒçš„ä»Šå¤©ï¼Œä»ç„¶æœ‰å¾ˆå¤šæ—§ JavaScript ä»£ç ç”¨è¿™ç§æ–¹å¼å®šä¹‰ç±»ï¼Œå¹¶ä¸”ä½ å¿…é¡»ç†Ÿæ‚‰è¿™ç§ä¹ æƒ¯ç”¨æ³•ï¼Œä»¥ä¾¿äºé˜…è¯»æ—§ä»£ç ï¼Œä¹Ÿèƒ½å¤Ÿåœ¨ä½¿ç”¨ class å…³é”®å­—æ—¶æ˜ç™½åœ¨åº•å±‚ä¸­å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p>

<p>ç¤ºä¾‹ 9-2ï¼šä½¿ç”¨æ„é€ å‡½æ•°çš„ Range ç±»</p>

<pre><code class="language-javascript">// This is a constructor function that initializes new Range objects.
// Note that it does not create or return the object. It just initializes this.
function Range(from, to) {
    // Store the start and end points (state) of this new range object.
    // These are noninherited properties that are unique to this object.
    this.from = from;
    this.to = to;
}

// All Range objects inherit from this object.
// Note that the property name must be &quot;prototype&quot; for this to work.
Range.prototype = {
    // Return true if x is in the range, false otherwise
    // This method works for textual and Date ranges as well as numeric.
    includes: function(x) { return this.from &lt;= x &amp;&amp; x &lt;= this.to; },

    // A generator function that makes instances of the class iterable.
    // Note that it only works for numeric ranges.
    [Symbol.iterator]: function*() {
        for(let x = Math.ceil(this.from); x &lt;= this.to; x++) yield x;
    },

    // Return a string representation of the range
    toString: function() { return &quot;(&quot; + this.from + &quot;...&quot; + this.to + &quot;)&quot;; }
};

// Here are example uses of this new Range class
let r = new Range(1,3);   // Create a Range object; note the use of new
r.includes(2)             // =&gt; true: 2 is in the range
r.toString()              // =&gt; &quot;(1...3)&quot;
[...r]                    // =&gt; [1, 2, 3]; convert to an array via iterator
</code></pre>

<p>å°†ç¤ºä¾‹ 9-1 å’Œç¤ºä¾‹ 9-2 ä¸­çš„ä»£ç åšä¸€ä¸ªä»”ç»†çš„å¯¹æ¯”ï¼Œå¯ä»¥å‘ç°ä¸¤ç§ç±»å®šä¹‰æŠ€æœ¯çš„å·®åˆ«ã€‚é¦–å…ˆï¼Œæ³¨æ„å½“å·¥å‚å‡½æ•° range() è½¬åŒ–ä¸ºæ„é€ å‡½æ•°æ—¶è¢«é‡å‘½åä¸º Range()ã€‚è¿™é‡Œéµå¾ªäº†ä¸€ä¸ªå¸¸è§çš„ç¼–ç¨‹çº¦å®šï¼šä»æŸç§æ„ä¹‰ä¸Šè®²ï¼Œå®šä¹‰æ„é€ å‡½æ•°å³æ˜¯å®šä¹‰ç±»ï¼Œå¹¶ä¸”ç±»åé¦–å­—æ¯è¦å¤§å†™ã€‚è€Œæ™®é€šçš„å‡½æ•°å’Œæ–¹æ³•éƒ½æ˜¯é¦–å­—æ¯å°å†™ã€‚</p>

<p>å†è€…ï¼Œæ³¨æ„ Range() æ„é€ å‡½æ•°æ˜¯é€šè¿‡ new å…³é”®å­—è°ƒç”¨çš„ï¼ˆåœ¨ç¤ºä¾‹ä»£ç çš„æœ«å°¾ï¼‰ï¼Œ è€Œ range() å·¥å‚å‡½æ•°åˆ™ä¸å¿…ä½¿ç”¨ newã€‚ç¤ºä¾‹ 9-1 é€šè¿‡è°ƒç”¨æ™®é€šå‡½æ•°ï¼ˆÂ§8.2.1ï¼‰æ¥åˆ›å»ºæ–°å¯¹è±¡ï¼Œç¤ºä¾‹ 9-2 åˆ™ä½¿ç”¨æ„é€ å‡½æ•°è°ƒç”¨ï¼ˆÂ§8.2.3ï¼‰æ¥åˆ›å»ºæ–°å¯¹è±¡ã€‚ç”±äº Range() æ„é€ å‡½æ•°æ˜¯é€šè¿‡ new å…³é”®å­—è°ƒç”¨çš„ï¼Œå› æ­¤ä¸å¿…è°ƒç”¨ Object.create() æˆ–å…¶ä»–ä»€ä¹ˆé€»è¾‘æ¥åˆ›å»ºæ–°å¯¹è±¡ã€‚åœ¨è°ƒç”¨æ„é€ å‡½æ•°ä¹‹å‰å°±å·²ç»åˆ›å»ºäº†æ–°å¯¹è±¡ï¼Œå¹¶ä¸”é€šè¿‡ this å…³é”®å­—å¯ä»¥è·å–è¿™ä¸ªæ–°å¯¹è±¡ã€‚Range() æ„é€ å‡½æ•°åªä¸è¿‡æ˜¯åˆå§‹åŒ– this è€Œå·²ã€‚æ„é€ å‡½æ•°ç”šè‡³ä¸å¿…è¿”å›è¿™ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œæ„é€ å‡½æ•°ä¼šè‡ªåŠ¨åˆ›å»ºå¯¹è±¡ï¼Œç„¶åå°†æ„é€ å‡½æ•°ä½œä¸ºè¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•æ¥è°ƒç”¨ä¸€æ¬¡ï¼Œæœ€åè¿”å›è¿™ä¸ªæ–°å¯¹è±¡ã€‚æ„é€ å‡½æ•°è°ƒç”¨ä¸å¸¸è§„å‡½æ•°è°ƒç”¨å¦‚æ­¤ä¸åŒï¼Œå®é™…ä¸Šï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸ºæ„é€ å‡½æ•°å‘½åä»¥å¤§å†™å­—æ¯ä¸ºåçš„å¦ä¸€ä¸ªåŸå› ã€‚æ„é€ å‡½æ•°å°±æ˜¯ç”¨æ¥â€œæ„é€ æ–°å¯¹è±¡â€çš„ï¼Œå®ƒå¿…é¡»é€šè¿‡å…³é”®å­— new è°ƒç”¨ï¼Œå¦‚æœå°†æ„é€ å‡½æ•°ç”¨åšæ™®é€šå‡½æ•°çš„è¯ï¼Œå¾€å¾€ä¸ä¼šæ­£å¸¸å·¥ä½œã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡å‘½åè§„çº¦æ¥ï¼ˆæ„é€ å‡½æ•°é¦–å­—æ¯å¤§å†™ï¼Œæ™®é€šæ–¹æ³•é¦–å­—æ¯å°å†™ï¼‰åˆ¤æ–­æ˜¯å¦åº”å½“åœ¨å‡½æ•°ä¹‹å‰å† ä»¥å…³é”®å­— newã€‚</p>

<p><strong>æ„é€ å‡½æ•°å’Œ new.target</strong></p>

<p>åœ¨å‡½æ•°æ­£æ–‡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ç‰¹æ®Šçš„è¡¨è¾¾å¼ new.target æ¥åˆ¤æ–­å‡½æ•°æ˜¯å¦ä»¥æ„é€ å‡½æ•°çš„æ–¹å¼è°ƒç”¨ã€‚å¦‚æœå®šä¹‰äº†è¯¥è¡¨è¾¾å¼çš„å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°æ˜¯é€šè¿‡ new å…³é”®å­—è°ƒç”¨çš„æ„é€ å‡½æ•°ã€‚å½“æˆ‘ä»¬åœ¨ Â§9.5 ä¸­è®¨è®ºå­ç±»æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° new.target ä¸æ€»æ˜¯å…¶æ‰€åœ¨çš„æ„é€ å‡½æ•°çš„å¼•ç”¨ï¼šå®ƒå¯èƒ½è¿˜å¼•ç”¨å­ç±»çš„æ„é€ å‡½æ•°ã€‚</p>

<p>å¦‚æœ new.target æ˜¯ undefinedï¼Œé‚£ä¹ˆåŒ…å«å®ƒçš„å‡½æ•°æ˜¯ä½œä¸ºå‡½æ•°è°ƒç”¨çš„ï¼Œæ²¡æœ‰ä½¿ç”¨ new å…³é”®å­—ã€‚JavaScript å¾ˆå¤šå¼‚å¸¸æ„é€ å‡½æ•°å¯ä»¥ä¸ä½¿ç”¨ new æ¥è°ƒç”¨ï¼Œå¦‚æœæƒ³æ¨¡ä»¿è¿™ä¸ªç‰¹æ€§å¯ä»¥è¿™æ ·å†™ï¼š</p>

<pre><code class="language-javascript">function C() {
    if (!new.target) return new C();
    // initialization code goes here
}
</code></pre>

<p>è¿™ä¸ªè€å¼æŠ€å·§åªåœ¨æ„é€ å‡½æ•°å®šä¹‰æ—¶ç”Ÿæ•ˆã€‚ç±»ä½¿ç”¨ class å…³é”®å­—åˆ›å»ºï¼Œä¸å…è®¸ä¸ä½¿ç”¨ new è°ƒç”¨å®ƒçš„æ„é€ å‡½æ•°ã€‚</p>

<p>ç¤ºä¾‹ 9-1 å’Œ 9-2 ä¹‹é—´çš„å¦ä¸€ä¸ªå…³é”®åŒºåˆ«æ˜¯åŸå‹å¯¹è±¡çš„å‘½åæ–¹å¼ã€‚åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼ŒåŸå‹æ˜¯ range.methodsã€‚è¿™æ˜¯ä¸€ä¸ªæ–¹ä¾¿å’Œæè¿°æ€§çš„åç§°ï¼Œä½†éšæ„ã€‚åœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­ï¼ŒåŸå‹ä¸º Range.prototypeï¼Œæ­¤åç§°æ˜¯è§„å®šçš„ã€‚Range() æ„é€ å‡½æ•°çš„è°ƒç”¨è‡ªåŠ¨ä½¿ç”¨ Range.prototype ä½œä¸ºæ–° Range å¯¹è±¡çš„åŸå‹ã€‚</p>

<p>æœ€åï¼Œè¿˜è¦æ³¨æ„ç¤ºä¾‹ 9-1 å’Œ 9-2 ä¹‹é—´ä¸å˜çš„éƒ¨åˆ†ï¼šå¯¹ä¸¤ä¸ªç±»æ¥è¯´ï¼Œrange æ–¹æ³•ä»¥ç›¸åŒçš„æ–¹å¼å®šä¹‰å’Œè°ƒç”¨ã€‚ç”±äºç¤ºä¾‹ 9-2 æ¼”ç¤ºäº†åœ¨ ES6 ä¹‹å‰åœ¨ JavaScript ç‰ˆæœ¬ä¸­åˆ›å»ºç±»çš„æƒ¯ç”¨æ–¹æ³•ï¼Œå› æ­¤å®ƒæ²¡åŸå‹å¯¹è±¡ä¸­ä½¿ç”¨ ES6 é€Ÿè®°æ–¹æ³•è¯­æ³•ï¼Œå¹¶ä¸”ä½¿ç”¨ function å…³é”®å­—æ˜¾å¼æ‹¼å‡ºæ–¹æ³•åã€‚ä½†æ˜¯ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œæ–¹æ³•çš„å®ç°æ˜¯ç›¸åŒçš„ã€‚</p>

<p>è¯·æ³¨æ„ï¼Œåœ¨å®šä¹‰æ„é€ å‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œä¸¤ä¸ª range ç¤ºä¾‹éƒ½æ²¡ä½¿ç”¨ç®­å¤´å‡½æ•°ã€‚å›æƒ³ä¸€ä¸‹ï¼Œä» Â§8.1.3 ä¸­ï¼Œç”¨è¿™ç§æ–¹å¼å®šä¹‰çš„å‡½æ•°æ²¡æœ‰åŸå‹å±æ€§ï¼Œå› æ­¤ä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°ã€‚æ­¤å¤–ï¼Œç®­å¤´å‡½æ•°ä»å®šä¹‰å®ƒä»¬çš„ä¸Šä¸‹æ–‡ä¸­ç»§æ‰¿ this å…³é”®å­—ï¼Œè€Œä¸æ˜¯åŸºäºè°ƒç”¨å®ƒä»¬çš„å¯¹è±¡è®¾ç½® this å€¼ï¼Œè¿™ä½¿å¾—ç®­å¤´å‡½æ•°å¯¹æ–¹æ³•æ¯«æ— ç”¨å¤„ï¼Œå› ä¸ºæ–¹æ³•çš„å®šä¹‰ç‰¹å¾æ˜¯æ–¹æ³•ä½¿ç”¨ this å…³é”®å­—æ¥å¼•ç”¨è°ƒç”¨æ–¹æ³•çš„å®ä¾‹ã€‚</p>

<p>å¹¸è¿çš„æ˜¯ï¼Œæ–°çš„ ES6 ç±»è¯­æ³•ä¸å…è®¸ä½¿ç”¨ arrow å‡½æ•°å®šä¹‰æ–¹æ³•ï¼Œå› æ­¤è¿™ä¸æ˜¯ä½¿ç”¨è¯¥è¯­æ³•æ—¶å¯èƒ½ä¼šæ„å¤–çŠ¯çš„é”™è¯¯ã€‚æˆ‘ä»¬å°†å¾ˆå¿«ä»‹ç» ES6 ç±»å…³é”®å­—ï¼Œä½†é¦–å…ˆï¼Œæœ‰æ›´å¤šå…³äºæ„é€ å‡½æ•°çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>

<h3 id="toc_2">9.2.1 æ„é€ å‡½æ•°ã€ç±»æ ‡è¯†å’Œ instanceof</h3>

<p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒåŸå‹å¯¹è±¡æ˜¯ç±»çš„åŸºæœ¬æ ‡è¯†ï¼šåªæœ‰ä¸¤ä¸ªå¯¹è±¡ç»§æ‰¿åŒä¸€åŸå‹å¯¹è±¡æ—¶ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡æ˜¯åŒä¸€ç±»å®ä¾‹ã€‚æ„é€ å‡½æ•°çš„å…³é”®ç‚¹ä¸æ˜¯åˆå§‹åŒ–æ–°åˆ›å»ºå¯¹è±¡çš„çŠ¶æ€ï¼šä¸¤ä¸ªæ„é€ å‡½æ•°å¯èƒ½å…·æœ‰æŒ‡å‘åŒä¸€åŸå‹å¯¹è±¡çš„åŸå‹å±æ€§ã€‚é‚£ä¹ˆï¼Œä¸¤ä¸ªæ„é€ å‡½æ•°éƒ½å¯ç”¨äºåˆ›å»ºåŒä¸€ç±»çš„å®ä¾‹ã€‚</p>

<p>å°½ç®¡æ„é€ å‡½æ•°ä¸åƒåŸå‹é‚£æ ·é‡è¦ï¼Œä½†æ˜¯æ„é€ å‡½æ•°å……å½“ class çš„å¤§ä¼—è„¸ã€‚æœ€æ˜æ˜¾çš„æ˜¯ï¼Œæ„é€ å‡½æ•°çš„åç§°é€šå¸¸ç”¨ä½œç±»çš„åç§°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¯´ Range() æ„é€ å‡½æ•°åˆ›å»º Range å¯¹è±¡ã€‚ç„¶è€Œï¼Œæ›´é‡è¦çš„æ˜¯æµ‹è¯•ç±»ä¸­å¯¹è±¡çš„æˆå‘˜å…³ç³»ï¼Œæ„é€ å‡½æ•°åœ¨å³è¾¹è¢«ç”¨ä½œ instanceof è¿ç®—ç¬¦çš„æ“ä½œæ•°ã€‚å¦‚æœæœ‰ä¸€ä¸ªå¯¹è±¡ rï¼Œå¹¶ä¸”æƒ³çŸ¥é“å®ƒæ˜¯ä¸æ˜¯ä¸€ä¸ª Range å¯¹è±¡ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>

<pre><code class="language-javascript">r instanceof Range   // =&gt; true: r inherits from Range.prototype
</code></pre>

<p>instanceof è¿ç®—ç¬¦åœ¨ Â§4.9.4 ä¸­æœ‰æè¿°ã€‚å·¦è¾¹çš„æ“ä½œæ•°æ˜¯æƒ³è¦æµ‹è¯•çš„å¯¹è±¡ï¼Œå³è¾¹çš„æ“ä½œæ•°æ˜¯å‘½åç±»çš„æ„é€ å‡½æ•°ã€‚è¡¨è¾¾å¼ <code>o instanceof C</code> è®¡ç®—ç»“æœä¸º true æ—¶ï¼Œo ç»§æ‰¿è‡ª C.prototypeã€‚ä¸éœ€è¦ç›´æ¥ç»§æ‰¿ï¼šå¦‚æœ o ç»§æ‰¿äºä¸€ä¸ªç»§æ‰¿äº† C.prototype çš„å¯¹è±¡ï¼Œè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¹Ÿä»ä¼šæ˜¯ trueã€‚</p>

<p>ä»æŠ€æœ¯ä¸Šè®²ï¼Œåœ¨ä¸Šä¸€ä¸ªä»£ç ç¤ºä¾‹ä¸­ï¼Œinstanceof è¿ç®—ç¬¦çš„å®ä¾‹æ²¡æœ‰æ£€æŸ¥ r æ˜¯å¦å®é™…ç”± Range æ„é€ å‡½æ•°åˆå§‹åŒ–ã€‚ç›¸åï¼Œå®ƒæ˜¯æ£€æŸ¥ r æ˜¯å¦ç»§æ‰¿ Range.prototypeã€‚å¦‚æœæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•° Strange() å¹¶å°†å…¶åŸå‹è®¾ç½®ä¸ Range.prototype ç›¸åŒï¼Œåˆ™ä½¿ç”¨æ–° Strange() åˆ›å»ºçš„å¯¹è±¡ç”¨ instanceof è¿ç®—ç¬¦å°†ç®—ä½œ Range å¯¹è±¡ï¼ˆä½†æ˜¯ï¼Œå®ƒä»¬å®é™…ä¸Šä¸ä¼šä½œä¸º Range å¯¹è±¡å·¥ä½œï¼Œå› ä¸ºå®ƒä»¬çš„ from å’Œ to å±æ€§å°šæœªåˆå§‹åŒ–ï¼‰ï¼š</p>

<pre><code class="language-javascript">function Strange() {}
Strange.prototype = Range.prototype;
new Strange() instanceof Range   // =&gt; true
</code></pre>

<p>å®é™…ä¸Šå³ä½¿ instanceof ä¸èƒ½éªŒè¯ä½¿ç”¨äº†æ„é€ å‡½æ•°ï¼Œå®ƒä»ç„¶ä½¿ç”¨æ„é€ å‡½æ•°ä½œä¸ºå…¶å³ä¾§ï¼Œå› ä¸ºæ„é€ å‡½æ•°æ˜¯ç±»çš„å…¬å…±æ ‡è¯†ã€‚</p>

<p>å¦‚æœè¦ä¸ºç‰¹å®šåŸå‹æµ‹è¯•å¯¹è±¡çš„åŸå‹é“¾ï¼Œå¹¶ä¸”ä¸æƒ³å°†æ„é€ å‡½æ•°ç”¨ä½œåª’ä»‹ï¼Œå¯ä»¥ä½¿ç”¨ isPrototypeOf() æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨ç¤ºä¾‹ 9-1 ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ²¡æœ‰æ„é€ å‡½æ•°çš„ç±»ï¼Œå› æ­¤æ— æ³•å°† instanceof ä¸è¯¥ç±»ä¸€èµ·ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•å¯¹è±¡ r æ˜¯å¦æ˜¯å…·æœ‰æ­¤ä»£ç çš„æ— æ„é€ å‡½æ•°ç±»çš„æˆå‘˜ï¼š</p>

<pre><code class="language-javascript">range.methods.isPrototypeOf(r);  // range.methods is the prototype object.
</code></pre>

<h3 id="toc_3">9.2.2 constructor å±æ€§</h3>

<p>åœ¨ç¤ºä¾‹ 9-2 ä¸­ï¼Œå°† Range.prototype å®šä¹‰ä¸ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«ç±»æ‰€éœ€è¦çš„æ–¹æ³•ã€‚å…¶å®æ²¡æœ‰å¿…è¦æ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç”¨å•ä¸ªå¯¹è±¡å­—é¢é‡çš„å±æ€§å°±å¯ä»¥æ–¹ä¾¿åœ°å®šä¹‰åŸå‹ä¸Šçš„æ–¹æ³•ã€‚ä»»ä½•æ™®é€š JavaScript å‡½æ•°ï¼ˆé™¤ç®­å¤´å‡½æ•°ã€ç”Ÿæˆå™¨å‡½æ•°å’Œå¼‚æ­¥å‡½æ•°ä¹‹å¤–ï¼‰éƒ½å¯ä»¥ç”¨åšæ„é€ å‡½æ•°ï¼Œå¹¶ä¸”è°ƒç”¨æ„é€ å‡½æ•°æ˜¯éœ€è¦ä¸€ä¸ª prototype å±æ€§çš„ã€‚å› æ­¤ï¼Œæ¯ä¸ª JavaScript å‡½æ•°éƒ½è‡ªåŠ¨æ‹¥æœ‰ä¸€ä¸ª prototype å±æ€§ã€‚è¿™ä¸ªå±æ€§çš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«å”¯ä¸€ä¸€ä¸ªä¸å¯æšä¸¾å±æ€§ constructorã€‚constructor å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼š</p>

<pre><code class="language-javascript">let F = function() {}; // This is a function object.
let p = F.prototype;   // This is the prototype object associated with F.
let c = p.constructor; // This is the function associated with the prototype.
c === F                // =&gt; true: F.prototype.constructor === F for any F
</code></pre>

<p>å¯ä»¥çœ‹åˆ°æ„é€ å‡½æ•°çš„åŸå‹ä¸­å­˜åœ¨é¢„å…ˆå®šä¹‰å¥½çš„ constructor å±æ€§ï¼Œè¿™æ„å‘³ç€å¯¹è±¡é€šå¸¸ç»§æ‰¿çš„ constructor æ˜¯å®ƒä»¬çš„æ„é€ å‡½æ•°çš„å¼•ç”¨ã€‚ç”±äºæ„é€ å‡½æ•°æ˜¯ç±»çš„â€œå…¬å…±æ ‡è¯†â€ï¼Œ å› æ­¤è¿™ä¸ª constructor å±æ€§ä¸ºå¯¹è±¡æä¾›äº†ç±»ã€‚</p>

<pre><code class="language-javascript">let o = new F();      // Create an object o of class F
o.constructor === F   // =&gt; true: the constructor property specifies the class
</code></pre>

<p>å¦‚å›¾ 9-1 æ‰€ç¤ºï¼Œå›¾ 9-1 å±•ç¤ºäº†æ„é€ å‡½æ•°å’ŒåŸå‹å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼ŒåŒ…æ‹¬åŸå‹åˆ°æ„é€ å‡½æ•°çš„åå‘å¼•ç”¨ä»¥åŠæ„é€ å‡½æ•°åˆ›å»ºçš„å®ä¾‹ã€‚</p>

<p>å›¾ 9-1ï¼šæ„é€ å‡½æ•°ï¼ŒåŸå‹ï¼Œå®ä¾‹</p>

<p><img src="media/16101520446472/16118384534713.jpg" alt="å›¾ 9-1ï¼šæ„é€ å‡½æ•°ï¼ŒåŸå‹ï¼Œå®ä¾‹"/></p>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå›¾ 9-1 ç”¨ Range() æ„é€ å‡½æ•°ä½œä¸ºç¤ºä¾‹ã€‚ä½†å®é™…ä¸Šï¼Œç¤ºä¾‹ 9-2 ä¸­å®šä¹‰çš„ Range ç±»ä½¿ç”¨å®ƒè‡ªèº«çš„ä¸€ä¸ªæ–°å¯¹è±¡é‡å†™äº†é¢„å®šä¹‰çš„ Range.prototype å¯¹è±¡ã€‚è¿™ä¸ªæ–°å®šä¹‰çš„åŸå‹å¯¹è±¡ä¸å«æœ‰ constructor å±æ€§ã€‚å› æ­¤ Range ç±»çš„å®ä¾‹ä¹Ÿä¸å«æœ‰ constructor å±æ€§ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¡¥æ•‘æªæ–½æ¥ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œæ˜¾å¼ç»™åŸå‹æ·»åŠ ä¸€ä¸ªæ„é€ å‡½æ•°ï¼š</p>

<pre><code class="language-javascript">Range.prototype = {
    constructor: Range,  // Explicitly set the constructor back-reference

    /* method definitions go here */
};
</code></pre>

<p>å¦ä¸€ç§å¸¸è§çš„è§£å†³åŠæ³•æ˜¯ä½¿ç”¨é¢„å®šä¹‰çš„åŸå‹å¯¹è±¡ï¼Œé¢„å®šä¹‰çš„åŸå‹å¯¹è±¡åŒ…å« constructor å±æ€§ï¼Œç„¶åä¾æ¬¡ç»™åŸå‹å¯¹è±¡æ·»åŠ æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">// Extend the predefined Range.prototype object so we don&#39;t overwrite
// the automatically created Range.prototype.constructor property.
Range.prototype.includes = function(x) {
    return this.from &lt;= x &amp;&amp; x &lt;= this.to;
};
Range.prototype.toString = function() {
    return &quot;(&quot; + this.from + &quot;...&quot; + this.to + &quot;)&quot;;
};
</code></pre>

<h2 id="toc_4">9.3 ä½¿ç”¨ class å…³é”®å­—çš„ç±»</h2>

<p>ç±»è‡ªç¬¬ä¸€ä¸ªç‰ˆæœ¬ä»¥æ¥ä¸€ç›´æ˜¯ JavaScript çš„ä¸€éƒ¨åˆ†ï¼Œä½†åœ¨ ES6 ä¸­ï¼Œå®ƒä»¬æœ€ç»ˆå¼•å…¥ class å…³é”®å­—å¾—åˆ°äº†è‡ªå·±çš„è¯­æ³•ã€‚ç¤ºä¾‹ 9-3 æ˜¾ç¤ºäº†ä½¿ç”¨æ­¤æ–°è¯­æ³•ç¼–å†™ Range ç±»çš„å®ç°ã€‚</p>

<p>ç¤ºä¾‹ 9-3ï¼šä½¿ç”¨ class ç¼–å†™ Range ç±»</p>

<pre><code class="language-javascript">class Range {
    constructor(from, to) {
        // Store the start and end points (state) of this new range object.
        // These are noninherited properties that are unique to this object.
        this.from = from;
        this.to = to;
    }

    // Return true if x is in the range, false otherwise
    // This method works for textual and Date ranges as well as numeric.
    includes(x) { return this.from &lt;= x &amp;&amp; x &lt;= this.to; }

    // A generator function that makes instances of the class iterable.
    // Note that it only works for numeric ranges.
    *[Symbol.iterator]() {
        for(let x = Math.ceil(this.from); x &lt;= this.to; x++) yield x;
    }

    // Return a string representation of the range
    toString() { return `(${this.from}...${this.to})`; }
}

// Here are example uses of this new Range class
let r = new Range(1,3);   // Create a Range object
r.includes(2)             // =&gt; true: 2 is in the range
r.toString()              // =&gt; &quot;(1...3)&quot;
[...r]                    // =&gt; [1, 2, 3]; convert to an array via iterator
</code></pre>

<p>é‡è¦çš„æ˜¯è¦äº†è§£ï¼Œåœ¨ç¤ºä¾‹ 9-2 å’Œ 9-3 ä¸­å®šä¹‰çš„ç±»çš„å·¥ä½œæ–¹å¼å®Œå…¨ç›¸åŒã€‚å°† class å…³é”®å­—å¼•å…¥è¯­è¨€å¹¶ä¸ä¼šæ”¹å˜ JavaScript åŸºäºåŸå‹çš„ç±»çš„åŸºæœ¬æ€§è´¨ã€‚å°½ç®¡ç¤ºä¾‹ 9-3 ä½¿ç”¨ class å…³é”®å­—ï¼Œä½†ç”Ÿæˆçš„ Range å¯¹è±¡æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå°±åƒç¤ºä¾‹ 9-2 ä¸­å®šä¹‰çš„ç‰ˆæœ¬ä¸€æ ·ã€‚æ–°çš„ class è¯­æ³•æ›´æ¸…æ´æ–¹ä¾¿ï¼Œä½†æ˜¯æœ€å¥½å°†å…¶çœ‹ä½œç¤ºä¾‹ 9-2 æ‰€ç¤ºçš„åŸºæœ¬ç±»å®šä¹‰æœºåˆ¶çš„è¯­æ³•ç³–ã€‚</p>

<p>æ³¨æ„åœ¨ç¤ºä¾‹ 9-3 ä¸­å…³äº class è¯­æ³•çš„ä¸€ä¸‹å‡ ç‚¹ï¼š</p>

<p>ç”¨ class å…³é”®å­—å£°æ˜ç±»ï¼Œåé¢æ¥ä¸€ä¸ªç±»åï¼Œæœ€åæ˜¯èŠ±æ‹¬å·åŒ…å«ç±»çš„æ­£æ–‡ã€‚</p>

<p>ç±»æ­£æ–‡åŒ…æ‹¬ä½¿ç”¨å¯¹è±¡å­—é¢é‡æ–¹æ³•é€Ÿè®°å®šä¹‰çš„æ–¹æ³•ï¼ˆæˆ‘ä»¬åœ¨ç¤ºä¾‹ 9-1 ä¸­ä¹Ÿä½¿ç”¨äº†ï¼‰ï¼Œå…¶ä¸­çœç•¥äº†å‡½æ•°å…³é”®å­—ã€‚ä½†æ˜¯ï¼Œä¸å¯¹è±¡å­—é¢é‡ä¸åŒï¼Œæ²¡æœ‰ç”¨é€—å·å°†æ–¹æ³•å½¼æ­¤åˆ†å¼€ã€‚ï¼ˆè™½ç„¶ç±»æ­£æ–‡è¡¨é¢ä¸Šä¸å¯¹è±¡å­—é¢é‡ç›¸ä¼¼ï¼Œä½†å®ƒä»¬ä¸æ˜¯ä¸€å›äº‹ã€‚ä¸å¯¹è±¡ä¸åŒï¼Œç±»ä¸æ”¯æŒå…·æœ‰å/å€¼å¯¹çš„å±æ€§çš„å®šä¹‰ã€‚</p>

<p>å…³é”®å­— constructor ç”¨äºå®šä¹‰ç±»çš„æ„é€ å‡½æ•°ã€‚ä½†æ˜¯ï¼Œå®šä¹‰çš„å‡½æ•°å®é™…ä¸Šå¹¶ä¸å‘½åä¸º constructorã€‚ç±»å£°æ˜è¯­å¥å®šä¹‰ä¸€ä¸ªæ–°çš„å˜é‡ Rangeï¼Œå¹¶å°†æ­¤ç‰¹æ®Šæ„é€ å‡½æ•°çš„å€¼åˆ†é…ç»™è¯¥å˜é‡ã€‚</p>

<p>å¦‚æœç±»ä¸éœ€è¦æ‰§è¡Œä»»ä½•åˆå§‹åŒ–ï¼Œå¯ä»¥çœç•¥æ„é€ å‡½æ•°å…³é”®å­—åŠå…¶æ­£æ–‡ï¼Œå¹¶å°†éšå¼åˆ›å»ºä¸€ä¸ªç©ºæ„é€ å‡½æ•°ã€‚</p>

<p>å¦‚æœè¦å®šä¹‰å­ç±»ï¼ˆæˆ–ç»§æ‰¿æ¥è‡ªå¦ä¸€ä¸ªç±»çš„ç±»ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ extends å…³é”®å­—ä¸ class å…³é”®å­—ï¼š</p>

<pre><code class="language-javascript">// A Span is like a Range, but instead of initializing it with
// a start and an end, we initialize it with a start and a length
class Span extends Range {
    constructor(start, length) {
        if (length &gt;= 0) {
            super(start, start + length);
        } else {
            super(start + length, start);
        }
    }
}
</code></pre>

<p>åˆ›å»ºå­ç±»æ˜¯å®Œæ•´çš„ä¸€èŠ‚ã€‚æˆ‘ä»¬å°†åœ¨ Â§9.5 é‡æ–°è®²åˆ°å®ƒï¼Œå¹¶è§£é‡Šè¿™é‡Œçš„ extends å’Œ super å…³é”®å­—ã€‚</p>

<p>ä¸å‡½æ•°å£°æ˜ä¸€æ ·ï¼Œç±»å£°æ˜åŒæ—¶å…·æœ‰è¯­å¥å’Œè¡¨è¾¾å¼å½¢å¼ã€‚æ­£å¦‚æˆ‘ä»¬å¯ä»¥å†™ï¼š</p>

<pre><code class="language-javascript">let square = function(x) { return x * x; };
square(3)  // =&gt; 9
we can also write:

let Square = class { constructor(x) { this.area = x * x; } };
new Square(3).area  // =&gt; 9
</code></pre>

<p>ä¸å‡½æ•°å®šä¹‰è¡¨è¾¾å¼ä¸€æ ·ï¼Œç±»å®šä¹‰è¡¨è¾¾å¼å¯ä»¥åŒ…å«å¯é€‰ç±»åã€‚å¦‚æœæä¾›è¿™æ ·çš„åç§°ï¼Œåˆ™è¯¥åç§°ä»…åœ¨ç±»æ­£æ–‡æœ¬èº«ä¸­æœ‰å®šä¹‰ã€‚</p>

<p>å°½ç®¡å‡½æ•°è¡¨è¾¾å¼å¾ˆå¸¸è§ï¼ˆå°¤å…¶æ˜¯ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼‰ï¼Œä½† JavaScript ç¼–ç¨‹ä¸­ï¼Œç±»å®šä¹‰è¡¨è¾¾å¼å¯èƒ½å¹¶ä¸æ˜¯ç»å¸¸ä½¿ç”¨ï¼Œé™¤éæ­£åœ¨ç¼–å†™ä¸€ä¸ªä»¥ç±»ä¸ºå®å‚å¹¶è¿”å›å­ç±»çš„å‡½æ•°ã€‚</p>

<p>ç»“æŸå¯¹ class å…³é”®å­—çš„ä»‹ç»å‰ï¼Œæœ€åæå‡ ä¸ªé‡è¦ä½†æ˜¯ä¸æ˜“æ³¨æ„çš„ç±»è¯­æ³•ï¼š</p>

<p>ç±»å£°æ˜æ­£æ–‡ä¸­çš„æ‰€æœ‰ä»£ç éƒ½éšå¼é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼ï¼ˆÂ§5.6.3ï¼‰ï¼Œå³ä½¿æœªå‡ºç°&quot;use strict&quot;æŒ‡ä»¤ã€‚ä¾‹å¦‚ï¼Œè¿™æ„å‘³ç€ä¸èƒ½åœ¨ç±»æ­£æ–‡ä¸­ä½¿ç”¨å…«è¿›åˆ¶æ•´æ•°å­—é¢é‡æˆ– with è¯­å¥ï¼Œå¹¶ä¸”å¦‚æœåœ¨ä½¿ç”¨å˜é‡ä¹‹å‰å¿˜è®°å£°æ˜å˜é‡ï¼Œåˆ™æ›´æœ‰å¯èƒ½å‡ºç°è¯­æ³•é”™è¯¯ã€‚</p>

<p>ä¸å‡½æ•°å£°æ˜ä¸åŒï¼Œç±»å£°æ˜ä¸æ˜¯&quot;å£°æ˜æå‰&quot;çš„ã€‚å›æƒ³ä¸€ä¸‹ Â§8.1.1 ä¸­ï¼Œå‡½æ•°å®šä¹‰çš„è¡Œä¸ºå°±åƒå®ƒä»¬è¢«ç§»åŠ¨åˆ°å°é—­æ–‡ä»¶çš„é¡¶éƒ¨æˆ–å°é—­å‡½æ•°çš„é¡¶éƒ¨ä¸€æ ·ï¼Œè¿™æ„å‘³ç€å¯ä»¥åœ¨å‡½æ•°å®é™…å®šä¹‰ä¹‹å‰çš„ä»£ç ä¸­è°ƒç”¨å‡½æ•°ã€‚å°½ç®¡ç±»å£°æ˜åœ¨æŸäº›æ–¹é¢ä¸å‡½æ•°å£°æ˜ä¸€æ ·ï¼Œä½†å®ƒä»¬ä¸å…±äº«è¿™ç§æå‰è¡Œä¸ºï¼šåœ¨å£°æ˜ç±»ä¹‹å‰ï¼Œä¸èƒ½å®ä¾‹åŒ–ç±»ã€‚</p>

<h3 id="toc_5">9.3.1 é™æ€æ–¹æ³•</h3>

<p>å¯ä»¥é€šè¿‡ä½¿ç”¨ static å…³é”®å­—ä½œä¸ºæ–¹æ³•å£°æ˜å‰ç¼€æ¥å®šä¹‰ç±»æ­£æ–‡ä¸­çš„é™æ€æ–¹æ³•ã€‚é™æ€æ–¹æ³•å®šä¹‰ä¸ºæ„é€ å‡½æ•°çš„å±æ€§ï¼Œè€Œä¸æ˜¯åŸå‹å¯¹è±¡çš„å±æ€§ã€‚</p>

<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°ç¤ºä¾‹ 9-3 ä¸­ï¼š</p>

<pre><code class="language-javascript">static parse(s) {
    let matches = s.match(/^\((\d+)\.\.\.(\d+)\)$/);
    if (!matches) {
        throw new TypeError(`Cannot parse Range from &quot;${s}&quot;.`)
    }
    return new Range(parseInt(matches[1]), parseInt(matches[2]));
}
</code></pre>

<p>æ­¤ä»£ç å®šä¹‰çš„æ–¹æ³•æ˜¯ Range.parse()ï¼Œ è€Œä¸æ˜¯ Range.prototype.parse()ï¼Œ å¿…é¡»é€šè¿‡æ„é€ å‡½æ•°è€Œä¸æ˜¯é€šè¿‡å®ä¾‹è°ƒç”¨å®ƒï¼š</p>

<pre><code class="language-javascript">let r = Range.parse(&#39;(1...10)&#39;); // Returns a new Range object
r.parse(&#39;(1...10)&#39;);             // TypeError: r.parse is not a function
</code></pre>

<p>æœ‰æ—¶ä¼šçœ‹åˆ°é™æ€æ–¹æ³•ç§°ä¸ºç±»æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä½¿ç”¨ç±»/æ„é€ å‡½æ•°çš„åç§°è°ƒç”¨çš„ã€‚ä½¿ç”¨æ­¤æœ¯è¯­æ—¶ï¼Œå°†ç±»æ–¹æ³•ä¸åœ¨ç±»å®ä¾‹ä¸Šè°ƒç”¨çš„å¸¸è§„å®ä¾‹æ–¹æ³•è¿›è¡Œå¯¹æ¯”ï¼Œç”±äºé™æ€æ–¹æ³•åœ¨æ„é€ å‡½æ•°ä¸Šè°ƒç”¨ï¼Œè€Œä¸æ˜¯åœ¨ä»»ä½•ç‰¹å®šå®ä¾‹ä¸Šè°ƒç”¨ï¼Œå› æ­¤åœ¨é™æ€æ–¹æ³•ä¸­ä½¿ç”¨ this å…³é”®å­—å‡ ä¹ä»æ¥å°±æ²¡æœ‰æ„ä¹‰ã€‚</p>

<p>æˆ‘ä»¬å°†åœ¨ç¤ºä¾‹ 9-4 ä¸­çœ‹åˆ°é™æ€æ–¹æ³•çš„ç¤ºä¾‹ã€‚</p>

<h3 id="toc_6">9.3.2 Getterã€Setter å’Œå…¶ä»–æ–¹æ³•</h3>

<p>åœ¨ç±»æ­£æ–‡ä¸­ï¼Œå¯ä»¥å®šä¹‰ getter å’Œ setter æ–¹æ³•ï¼ˆÂ§6.10.6ï¼‰ï¼Œå°±åƒåœ¨å¯¹è±¡å­—é¢é‡ä¸­ä¸€æ ·ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œåœ¨ç±»æ­£æ–‡ä¸­ï¼Œä¸ä¼šå°†é€—å·æ”¾åœ¨ getter æˆ– setter ä¹‹åã€‚ç¤ºä¾‹ 9-4 åŒ…æ‹¬ç±»ä¸­ getter æ–¹æ³•çš„å®é™…ç¤ºä¾‹ã€‚</p>

<p>é€šå¸¸ï¼Œå¯¹è±¡å­—é¢é‡ä¸­å…è®¸çš„æ‰€æœ‰é€Ÿè®°æ–¹æ³•å®šä¹‰è¯­æ³•ä¹Ÿå…è®¸åœ¨ç±»æ­£æ–‡ä¸­ä½¿ç”¨ã€‚è¿™åŒ…æ‹¬ç”Ÿæˆå™¨æ–¹æ³•ï¼ˆç”¨ * æ ‡è®°ï¼‰å’Œåç§°ä¸ºæ–¹æ‹¬å·ä¸­è¡¨è¾¾å¼å€¼çš„æ–¹æ³•ã€‚äº‹å®ä¸Šï¼Œå·²ç»çœ‹åˆ°äº†ï¼ˆåœ¨ç¤ºä¾‹ 9-3 ä¸­ï¼‰å…·æœ‰è®¡ç®—åç§°çš„ç”Ÿæˆå™¨æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ Range ç±»å¯é‡å¤ï¼š</p>

<pre><code class="language-javascript">*[Symbol.iterator]() {
    for(let x = Math.ceil(this.from); x &lt;= this.to; x++) yield x;
}
</code></pre>

<h3 id="toc_7">9.3.3 å…¬æœ‰ã€ç§æœ‰å’Œé™æ€å­—æ®µ</h3>

<p>åœ¨æ­¤å¤„å¯¹ä½¿ç”¨ class å…³é”®å­—å®šä¹‰çš„ç±»çš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬åªæè¿°äº†ç±»æ­£æ–‡ä¸­æ–¹æ³•çš„å®šä¹‰ã€‚ES6 æ ‡å‡†åªå…è®¸åˆ›å»ºæ–¹æ³•ï¼ˆåŒ…æ‹¬ getterã€setter å’Œç”Ÿæˆå™¨ï¼‰å’Œé™æ€æ–¹æ³•ï¼›å®ƒä¸åŒ…æ‹¬ç”¨äºå®šä¹‰å­—æ®µçš„è¯­æ³•ã€‚å¦‚æœè¦åœ¨ç±»å®ä¾‹ä¸Šå®šä¹‰å­—æ®µï¼ˆè¿™åªæ˜¯é¢å‘å¯¹è±¡ä¸­&quot;å±æ€§&quot;çš„åŒä¹‰è¯ï¼‰ï¼Œåˆ™å¿…é¡»åœ¨æ„é€ å‡½æ•°å‡½æ•°æˆ–å…¶ä¸­ä¸€ä¸ªæ–¹æ³•ä¸­è¿™æ ·åšã€‚å¿…é¡»åœ¨ç±»æ­£æ–‡ä¹‹å¤–ç±»å®šä¹‰åï¼Œæ‰èƒ½ä¸ºç±»å®šä¹‰é™æ€å­—æ®µã€‚ç¤ºä¾‹ 9-4 åŒ…æ‹¬è¿™å„ç§å­—æ®µçš„ç¤ºä¾‹ã€‚</p>

<p>ä½†æ˜¯ï¼Œå¯¹äºå…è®¸ä»¥å…¬æœ‰å’Œç§æœ‰å½¢å¼å®šä¹‰å®ä¾‹å’Œé™æ€å­—æ®µçš„æ‰©å±•ç±»è¯­æ³•æ­£åœ¨è¿›è¡Œæ ‡å‡†åŒ–ã€‚æœ¬èŠ‚å…¶ä½™éƒ¨åˆ†ä¸­æ˜¾ç¤ºçš„ä»£ç åœ¨ 2020 å¹´åˆè¿˜ä¸æ˜¯æ ‡å‡† JavaScriptï¼Œä½†åœ¨ Chrome ä¸­å·²ç»æ”¯æŒï¼Œå¹¶ä¸” Firefox ä¸­å·²éƒ¨åˆ†æ”¯æŒï¼ˆä»…ä½¿å…¬æœ‰å®ä¾‹å­—æ®µï¼‰ã€‚ä½¿ç”¨ React æ¡†æ¶å’Œ Babel ç¼–è¯‘å™¨çš„ JavaScript ç¨‹åºå‘˜å¸¸ç”¨å…¬æœ‰å®ä¾‹å­—æ®µçš„è¯­æ³•ã€‚</p>

<p>å‡è®¾ä½ æ­£åœ¨ç¼–å†™ä¸€ä¸ªè¿™æ ·çš„ç±»ï¼Œå…¶ä¸­ä¸€ä¸ªæ„é€ å‡½æ•°åˆå§‹åŒ–äº†ä¸‰ä¸ªå­—æ®µï¼š</p>

<pre><code class="language-javascript">class Buffer {
    constructor() {
        this.size = 0;
        this.capacity = 4096;
        this.buffer = new Uint8Array(this.capacity);
    }
}
</code></pre>

<p>ä½¿ç”¨å¯èƒ½æ ‡å‡†åŒ–çš„æ–°å®ä¾‹å­—æ®µè¯­æ³•ï¼Œå¯ä»¥è¿™æ ·ç¼–å†™ï¼š</p>

<pre><code class="language-javascript">class Buffer {
    size = 0;
    capacity = 4096;
    buffer = new Uint8Array(this.capacity);
}
</code></pre>

<p>å­—æ®µåˆå§‹åŒ–ä»£ç å·²ç§»å‡ºæ„é€ å‡½æ•°ï¼Œç°åœ¨ç›´æ¥æ˜¾ç¤ºåœ¨ç±»æ­£æ–‡ä¸­ã€‚ï¼ˆå½“ç„¶ï¼Œè¯¥ä»£ç ä»ä½œä¸ºæ„é€ å‡½æ•°çš„ä¸€éƒ¨åˆ†è¿è¡Œã€‚å¦‚æœä¸å®šä¹‰æ„é€ å‡½æ•°ï¼Œåˆ™å­—æ®µåˆå§‹åŒ–ä¸ºéšå¼åˆ›å»ºçš„æ„é€ å‡½æ•°çš„ä¸€éƒ¨åˆ†ã€‚èµ‹å€¼å·¦ä¾§çš„ this. å‰ç¼€æ¶ˆå¤±ï¼Œä½†è¯·æ³¨æ„å³ä½¿æ˜¯åœ¨åˆå§‹åŒ–èµ‹å€¼çš„å³ä¾§ï¼Œä»å¿…é¡»ä½¿ç”¨ this. å‰ç¼€å¼•ç”¨è¿™äº›å­—æ®µã€‚è¿™ç§æ–¹å¼åˆå§‹åŒ–å®ä¾‹å­—æ®µçš„ä¼˜ç‚¹æ˜¯ï¼Œæ­¤è¯­æ³•å…è®¸ï¼ˆä½†ä¸éœ€è¦ï¼‰å°†åˆå§‹åŒ–æ”¾åœ¨ç±»å®šä¹‰çš„é¡¶éƒ¨ï¼Œä½¿è¯»è€…æ¸…æ¥šåœ°äº†è§£å­—æ®µåœ¨æ¯ä¸ªå®ä¾‹å°†ä¿å­˜çš„çŠ¶æ€ã€‚å¯ä»¥é€šè¿‡å­—æ®µååé¢è·Ÿä¸€ä¸ªåˆ†å·æ¥åªå£°æ˜ä¸åˆå§‹åŒ–ä¸€ä¸ªå­—æ®µã€‚å¦‚æœè¿™æ ·åšï¼Œå­—æ®µçš„åˆå§‹å€¼å°†æ˜¯ undefinedã€‚æ˜¾å¼è®¾å®šåˆå§‹åŒ–å­—æ®µçš„å€¼æ˜¯æ¯”è¾ƒå¥½çš„é£æ ¼ã€‚</p>

<p>åœ¨æ·»åŠ å­—æ®µè¯­æ³•ä¹‹å‰ï¼Œç±»æ­£æ–‡çœ‹èµ·æ¥å¾ˆåƒä½¿ç”¨å¿«æ·æ–¹æ³•è¯­æ³•çš„å¯¹è±¡å­—é¢é‡ï¼Œåªä¸è¿‡é€—å·è¢«åˆ é™¤ã€‚å­—æ®µè¯­æ³•ï¼ˆä½¿ç”¨ç­‰å·å’Œåˆ†å·ä»£æ›¿å†’å·å’Œé€—å·ï¼‰æ¸…æ¥šåœ°è¡¨æ˜ç±»æ­£æ–‡ä¸å¯¹è±¡å­—é¢é‡ä¸å®Œå…¨ç›¸åŒã€‚</p>

<p>æ ‡å‡†åŒ–ä¸­çš„å®ä¾‹å­—æ®µåŒæ—¶ä¹Ÿå®šä¹‰äº†ç§æœ‰å®ä¾‹å­—æ®µã€‚å¦‚æœä½¿ç”¨ä¸Šä¾‹ä¸­æ‰€ç¤ºçš„å®ä¾‹å­—æ®µåˆå§‹åŒ–è¯­æ³•æ¥å®šä¹‰å…¶åç§°ä»¥ # å¼€å¤´çš„å­—æ®µï¼ˆåœ¨ JavaScript æ ‡è¯†ç¬¦ä¸­é€šå¸¸ä¸æ˜¯åˆæ³•å­—ç¬¦ï¼‰ï¼Œåˆ™è¯¥å­—æ®µåœ¨ç±»æ­£æ–‡ä¸­å¯ç”¨ï¼ˆä½¿ç”¨ # å‰ç¼€ï¼‰ï¼Œä½†å¯¹ç±»æ­£æ–‡ä¹‹å¤–çš„ä»»ä½•ä»£ç ä¸å¯è§ä¸”ä¸å¯è®¿é—®ï¼ˆå› æ­¤ä¸å¯å˜ï¼‰ã€‚å¦‚æœå¯¹äºå‰é¢çš„ Buffer ç±»ï¼Œè¦ç¡®ä¿ç±»çš„ç”¨æˆ·ä¸ä¼šæ— æ„ä¸­ä¿®æ”¹å®ä¾‹çš„ size å­—æ®µï¼Œå¯ä»¥æ”¹ä¸ºä½¿ç”¨ç§æœ‰ #size å­—æ®µï¼Œç„¶åå®šä¹‰ getter å‡½æ•°ä»¥æä¾›å¯¹å€¼çš„åªè¯»è®¿é—®ï¼š</p>

<pre><code class="language-javascript">class Buffer {
    #size = 0;
    get size() { return this.#size; }
}
</code></pre>

<p>è¯·æ³¨æ„ï¼Œå¿…é¡»å…ˆä½¿ç”¨æ–°å­—æ®µè¯­æ³•å£°æ˜ç§æœ‰å­—æ®µï¼Œç„¶åæ‰èƒ½ä½¿ç”¨å®ƒä»¬ã€‚ä½ ä¸èƒ½åªåœ¨ç±»çš„æ„é€ å‡½æ•°ä¸­å†™ <code>this.#size = 0;</code>ï¼Œé™¤éç›´æ¥åœ¨ç±»æ­£æ–‡ä¸­åŒ…å«å­—æ®µçš„&quot;å£°æ˜&quot;ã€‚</p>

<p>æœ€åï¼Œåœ¨æ ‡å‡†åŒ–è¿‡ç¨‹ä¸­ç›¸å…³å»ºè®®å­—æ®µä½¿ç”¨ static å…³é”®å­—ã€‚å¦‚æœåœ¨å…¬æœ‰æˆ–ç§æœ‰å­—æ®µå£°æ˜ä¹‹å‰æ·»åŠ é™æ€å­—æ®µï¼Œè¿™äº›å­—æ®µå°†åˆ›å»ºä¸ºæ„é€ å‡½æ•°çš„å±æ€§ï¼Œè€Œä¸æ˜¯å®ä¾‹çš„å±æ€§ã€‚æ€è€ƒæˆ‘ä»¬å®šä¹‰çš„é™æ€ Range.parse() æ–¹æ³•ã€‚å®ƒåŒ…æ‹¬ä¸€ä¸ªç›¸å½“å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå°†å…¶æ‹†åˆ†åˆ°å®ƒè‡ªæœ‰çš„é™æ€å­—æ®µä¸­å¯èƒ½ä¼šæ›´å¥½ã€‚ä½¿ç”¨å»ºè®®çš„æ–°é™æ€å­—æ®µè¯­æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ç¼–å†™ï¼š</p>

<pre><code class="language-javascript">static integerRangePattern = /^\((\d+)\.\.\.(\d+)\)$/;
static parse(s) {
    let matches = s.match(Range.integerRangePattern);
    if (!matches) {
        throw new TypeError(`Cannot parse Range from &quot;${s}&quot;.`)
    }
    return new Range(parseInt(matches[1]), matches[2]);
}
</code></pre>

<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›æ­¤é™æ€å­—æ®µåªèƒ½åœ¨ç±»ä¸­è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åƒ #pattern è¿™æ ·çš„åç§°å°†å…¶ç§æœ‰åŒ–ã€‚</p>

<h3 id="toc_8">9.3.4 ç¤ºä¾‹ï¼šä¸€ä¸ªå¤æ•°ç±»</h3>

<p>ç¤ºä¾‹ 9-4 å®šä¹‰äº†ä¸€ä¸ªè¡¨ç¤ºå¤æ•°çš„ç±»ã€‚è¯¥ç±»ç›¸å¯¹ç®€å•ï¼Œä½†å®ƒåŒ…æ‹¬å®ä¾‹æ–¹æ³•ï¼ˆåŒ…æ‹¬ gettersï¼‰ã€é™æ€æ–¹æ³•ã€å®ä¾‹å­—æ®µå’Œé™æ€å­—æ®µã€‚å®ƒåŒ…æ‹¬ä¸€äº›æ³¨é‡Šæ‰çš„ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å°šæœªåŠ å…¥æ ‡å‡†çš„è¯­æ³•å®šä¹‰ç±»æ­£æ–‡ä¸­çš„å®ä¾‹å­—æ®µå’Œé™æ€å­—æ®µã€‚</p>

<p>ç¤ºä¾‹ 9-4ï¼šComplex.jsï¼šä¸€ä¸ªå¤æ•°ç±»</p>

<pre><code class="language-javascript">/**
 * Instances of this Complex class represent complex numbers.
 * Recall that a complex number is the sum of a real number and an
 * imaginary number and that the imaginary number i is the square root of -1.
 */
class Complex {
    // Once class field declarations are standardized, we could declare
    // private fields to hold the real and imaginary parts of a complex number
    // here, with code like this:
    //
    // #r = 0;
    // #i = 0;

    // This constructor function defines the instance fields r and i on every
    // instance it creates. These fields hold the real and imaginary parts of
    // the complex number: they are the state of the object.
    constructor(real, imaginary) {
        this.r = real;       // This field holds the real part of the number.
        this.i = imaginary;  // This field holds the imaginary part.
    }

    // Here are two instance methods for addition and multiplication
    // of complex numbers. If c and d are instances of this class, we
    // might write c.plus(d) or d.times(c)
    plus(that) {
        return new Complex(this.r + that.r, this.i + that.i);
    }
    times(that) {
        return new Complex(this.r * that.r - this.i * that.i,
                           this.r * that.i + this.i * that.r);
    }

    // And here are static variants of the complex arithmetic methods.
    // We could write Complex.sum(c,d) and Complex.product(c,d)
    static sum(c, d) { return c.plus(d); }
    static product(c, d) { return c.times(d); }

    // These are some instance methods that are defined as getters
    // so they&#39;re used like fields. The real and imaginary getters would
    // be useful if we were using private fields this.#r and this.#i
    get real() { return this.r; }
    get imaginary() { return this.i; }
    get magnitude() { return Math.hypot(this.r, this.i); }

    // Classes should almost always have a toString() method
    toString() { return `{${this.r},${this.i}}`; }

    // It is often useful to define a method for testing whether
    // two instances of your class represent the same value
    equals(that) {
        return that instanceof Complex &amp;&amp;
            this.r === that.r &amp;&amp;
            this.i === that.i;
    }

    // Once static fields are supported inside class bodies, we could
    // define a useful Complex.ZERO constant like this:
    // static ZERO = new Complex(0,0);
}

// Here are some class fields that hold useful predefined complex numbers.
Complex.ZERO = new Complex(0,0);
Complex.ONE = new Complex(1,0);
Complex.I = new Complex(0,1);
</code></pre>

<p>å®šä¹‰äº†ç¤ºä¾‹ 9-4 çš„ Complex ç±»åï¼Œæˆ‘ä»¬å¯ä»¥å°†æ„é€ å‡½æ•°ã€å®ä¾‹å­—æ®µã€å®ä¾‹æ–¹æ³•ã€ç±»å­—æ®µå’Œç±»æ–¹æ³•å¦‚ä¸‹ä½¿ç”¨ï¼š</p>

<pre><code class="language-javascript">let c = new Complex(2, 3);     // Create a new object with the constructor
let d = new Complex(c.i, c.r); // Use instance fields of c
c.plus(d).toString()           // =&gt; &quot;{5,5}&quot;; use instance methods
c.magnitude                    // =&gt; Math.hypot(2,3); use a getter function
Complex.product(c, d)          // =&gt; new Complex(0, 13); a static method
Complex.ZERO.toString()        // =&gt; &quot;{0,0}&quot;; a static property
</code></pre>

<h2 id="toc_9">9.4 ä¸ºç±»æ·»åŠ æ–¹æ³•</h2>

<p>JavaScript åŸºäºåŸå‹çš„ç»§æ‰¿æœºåˆ¶æ˜¯åŠ¨æ€çš„ï¼šå¯¹è±¡ä»å…¶åŸå‹ç»§æ‰¿å±æ€§ï¼Œå³ä½¿åŸå‹çš„å±æ€§åœ¨åˆ›å»ºå¯¹è±¡åå‘ç”Ÿæ›´æ”¹ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åªéœ€å‘åŸå‹å¯¹è±¡æ·»åŠ æ–°æ–¹æ³•ï¼Œå³å¯æ‰©å±• JavaScript ç±»ã€‚</p>

<p>ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯å°†è®¡ç®—å…±è½­å¤æ•°çš„æ–¹æ³•æ·»åŠ åˆ°ç¤ºä¾‹ 9-4 çš„ Complex ç±»çš„ä»£ç ï¼š</p>

<pre><code class="language-javascript">// Return a complex number that is the complex conjugate of this one.
Complex.prototype.conj = function() { return new Complex(this.r, -this.i); };
</code></pre>

<p>JavaScript ç±»å†…ç½®çš„åŸå‹å¯¹è±¡ä¹Ÿæ˜¯è¿™æ ·å±•ç°çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å‘æ•°å­—ã€å­—ç¬¦ä¸²ã€æ•°ç»„ã€å‡½æ•°ç­‰æ·»åŠ æ–¹æ³•ã€‚è¿™å¯¹äºåœ¨æ—§ç‰ˆæœ¬çš„è¯­è¨€ä¸­å®ç°æ–°ç‰¹æ€§éå¸¸æœ‰ç”¨ï¼š</p>

<pre><code class="language-javascript">// If the new String method startsWith() is not already defined...
if (!String.prototype.startsWith) {
    // ...then define it like this using the older indexOf() method.
    String.prototype.startsWith = function(s) {
        return this.indexOf(s) === 0;
    };
}
</code></pre>

<p>è¿™æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ï¼š</p>

<pre><code class="language-javascript">// Invoke the function f this many times, passing the iteration number
// For example, to print &quot;hello&quot; 3 times:
//     let n = 3;
//     n.times(i =&gt; { console.log(`hello ${i}`); });
Number.prototype.times = function(f, context) {
    let n = this.valueOf();
    for(let i = 0; i &lt; n; i++) f.call(context, i);
};
</code></pre>

<p>å‘è¿™æ ·åœ¨å†…ç½®ç±»å‹çš„åŸå‹æ·»åŠ æ–¹æ³•é€šå¸¸è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªåä¸»æ„ï¼Œå› ä¸ºå¦‚æœæ–°ç‰ˆæœ¬çš„ JavaScript å®šä¹‰å…·æœ‰ç›¸åŒåç§°çš„æ–¹æ³•ï¼Œå°†æ¥å°±ä¼šé€ æˆæ··æ·†å’Œå…¼å®¹æ€§é—®é¢˜ã€‚ç”šè‡³å¯ä»¥å‘ Object.prototype æ·»åŠ æ–¹æ³•ï¼Œä½¿å®ƒä»¬å¯ä½œç”¨äºæ‰€æœ‰å¯¹è±¡ã€‚ä½†è¿™ä»æ¥å°±ä¸æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œå› ä¸ºæ·»åŠ åˆ° Object.prototype çš„å±æ€§å¯¹ for/in å¾ªç¯å¯è§ï¼ˆå°½ç®¡å¯ä»¥ä½¿ç”¨ Object.defineProperty()ï¼ˆÂ§14.1ï¼‰æ¥ä½¿æ–°å±æ€§ä¸å¯æšä¸¾æ¥é¿å…è¿™ç§æƒ…å†µï¼‰ã€‚</p>

<h2 id="toc_10">9.5 å­ç±»</h2>

<p>åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ä¸­ï¼ŒB ç±»å¯ä»¥æ‰©å±• A ç±»æˆ–æˆä¸º A ç±»å­ç±»ã€‚æˆ‘ä»¬ç§° A æ˜¯çˆ¶ç±»ï¼ŒB æ˜¯å­ç±»ã€‚B çš„å®ä¾‹ç»§æ‰¿ A çš„æ–¹æ³•ã€‚B ç±»å¯ä»¥å®šä¹‰è‡ªæœ‰æ–¹æ³•ï¼Œä½¿ç”¨ç›¸åŒåç§°å¯ä»¥é‡å†™ç±» A ä¸­çš„æ–¹æ³•ã€‚å¦‚æœ B çš„æ–¹æ³•é‡å†™ A æ–¹æ³•ï¼Œåˆ™ B ä¸­çš„é‡å†™æ–¹æ³•é€šå¸¸éœ€è¦è°ƒç”¨ A ä¸­çš„é‡å†™æ–¹æ³•ã€‚åŒæ ·ï¼Œå­ç±»æ„é€ å‡½æ•° B() é€šå¸¸å¿…é¡»è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•° A()ï¼Œä»¥ç¡®ä¿å®ä¾‹å®Œå…¨åˆå§‹åŒ–ã€‚</p>

<p>æœ¬èŠ‚é¦–å…ˆæ¼”ç¤º ES6 ä¹‹å‰å¦‚ä½•å®šä¹‰å­ç±»ï¼Œç„¶åæ¼”ç¤ºä½¿ç”¨ class å’Œ extends å…³é”®å­—çš„å­ç±»å’Œä½¿ç”¨ super å…³é”®å­—è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ã€‚å†æ¥ä¸‹æ¥ä¸€èŠ‚æ˜¯å…³äºé¿å…ä½¿ç”¨å­ç±»è€Œä¾é å¯¹è±¡ç»„åˆä»£æ›¿ç»§æ‰¿ã€‚æœ¬ç« æœ€åç»“æŸäºä¸€ä¸ªæ‰©å±•çš„ç¤ºä¾‹ï¼Œå®šä¹‰ Set ç±»çš„å±‚æ¬¡ç»“æ„å’Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨æŠ½è±¡ç±»å°†æ¥å£ä¸å®ç°åˆ†ç¦»ã€‚</p>

<h3 id="toc_11">9.5.1 å­ç±»å’ŒåŸå‹</h3>

<p>å‡è®¾æˆ‘ä»¬æƒ³è¦ç»™ç¤ºä¾‹ 9-2 ä¸­ Range ç±»å®šä¹‰ Span å­ç±»ã€‚æ­¤å­ç±»çš„å·¥ä½œæ–¹å¼ä¸ Range ä¸€æ ·ï¼Œä½†æˆ‘ä»¬åˆå§‹åŒ–æ”¹ä¸ºæŒ‡å®šå¼€å§‹å’ŒèŒƒå›´ï¼Œè€Œä¸æ˜¯åˆ¶å®šå¼€å§‹å’Œç»“æŸã€‚Span ç±»çš„å®ä¾‹ä¹Ÿæ˜¯çˆ¶ç±» Range çš„å®ä¾‹ã€‚Span å®ä¾‹ä» Span.prototype ç»§æ‰¿è‡ªå®šä¹‰çš„ toString() æ–¹æ³•ï¼Œä½†ä¸ºäº†æˆä¸º Range çš„å­ç±»ï¼Œå®ƒè¿˜å¿…é¡»ä» Range.prototype ç»§æ‰¿æ–¹æ³•ï¼ˆå¦‚ includes()ï¼‰ã€‚</p>

<p>å®ä¾‹ 9-5ï¼šSpan.jsï¼šRange ä¸€ä¸ªç®€å•çš„å­ç±»</p>

<pre><code class="language-javascript">// This is the constructor function for our subclass
function Span(start, span) {
    if (span &gt;= 0) {
        this.from = start;
        this.to = start + span;
    } else {
        this.to = start;
        this.from = start + span;
    }
}

// Ensure that the Span prototype inherits from the Range prototype
Span.prototype = Object.create(Range.prototype);

// We don&#39;t want to inherit Range.prototype.constructor, so we
// define our own constructor property.
Span.prototype.constructor = Span;

// By defining its own toString() method, Span overrides the
// toString() method that it would otherwise inherit from Range.
Span.prototype.toString = function() {
    return `(${this.from}... +${this.to - this.from})`;
};
</code></pre>

<p>ä¸ºäº†ä½¿ Span æˆä¸º Range çš„å­ç±»ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ Span.prototype ä» Range.prototype ç»§æ‰¿ã€‚å‰é¢ç¤ºä¾‹ä¸­çš„å…³é”®ä»£ç è¡Œæ˜¯æ­¤ä»£ç è¡Œï¼Œå¦‚æœèƒ½ç†è§£å­ç±»ä½¿å¦‚ä½•å·¥ä½œçš„ï¼Œå®ƒæ˜¯éå¸¸æœ‰æ„ä¹‰çš„ï¼š</p>

<pre><code class="language-javascript">Span.prototype = Object.create(Range.prototype);
</code></pre>

<p>ä½¿ç”¨ Span() æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡å°†ä» Span.prototype å¯¹è±¡ç»§æ‰¿ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬åˆ›å»ºäº†è¯¥å¯¹è±¡å¹¶ç»§æ‰¿ Range.prototypeï¼Œå› æ­¤ Span å¯¹è±¡å°†åŒæ—¶ä» Span.prototype å’Œ Range.prototype ç»§æ‰¿ã€‚</p>

<p>å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œæˆ‘ä»¬çš„ Span() æ„é€ å‡½æ•°è®¾ç½®ä¸ Range() æ„é€ å‡½æ•°ç›¸åŒçš„ from å’Œ to å±æ€§ï¼Œå› æ­¤ä¸éœ€è¦è°ƒç”¨ Range() æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–æ–°å¯¹è±¡ã€‚åŒæ ·ï¼ŒSpan çš„ toString() æ–¹æ³•å®Œå…¨é‡æ–°å®ç°å­—ç¬¦ä¸²è½¬æ¢ï¼Œè€Œæ— éœ€è°ƒç”¨ Range ç‰ˆæœ¬çš„ toString()ã€‚è¿™ä½¿å¾— Span æˆä¸ºç‰¹ä¾‹ï¼Œæˆ‘ä»¬å¿…é¡»æ‘†è„±è¿™ç§å­ç±»ï¼Œå› ä¸ºè¿™ç§æƒ…å†µæ˜¯æˆ‘ä»¬çŸ¥é“çˆ¶ç±»çš„å®ç°ç»†èŠ‚ã€‚ä¸€ä¸ªå¥å£®çš„å­ç±»æœºåˆ¶éœ€è¦å…è®¸ç±»è°ƒç”¨å…¶çˆ¶ç±»çš„æ–¹æ³•å’Œæ„é€ å‡½æ•°ï¼Œä½†åœ¨ ES6 ä¹‹å‰ï¼ŒJavaScript æ²¡æœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ¥æ‰§è¡Œè¿™äº›æ“ä½œã€‚</p>

<p>å¹¸è¿çš„æ˜¯ï¼ŒES6 ç”¨ super å…³é”®å­—ä½œä¸ºç±»è¯­æ³•ä¸€éƒ¨åˆ†è§£å†³äº†è¿™äº›é—®é¢˜ã€‚ä¸‹ä¸€èŠ‚æ¼”ç¤ºå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>

<h3 id="toc_12">9.5.2 å­ç±»ä¸ extends å’Œ super</h3>

<p>åœ¨ ES6 ä¹‹åï¼Œå¯ä»¥ç®€å•çš„åœ¨ç±»å£°æ˜æ—¶æ¥ä¸€ä¸ª extends ä»å¥æ·»åŠ ä¸€ä¸ªçˆ¶ç±»ï¼Œå³ä½¿å¯¹äºå†…ç½®ç±»ä¹Ÿå¯ä»¥è¿™æ ·åšï¼š</p>

<pre><code class="language-javascript">// A trivial Array subclass that adds getters for the first and last elements.
class EZArray extends Array {
    get first() { return this[0]; }
    get last() { return this[this.length-1]; }
}

let a = new EZArray();
a instanceof EZArray  // =&gt; true: a is subclass instance
a instanceof Array    // =&gt; true: a is also a superclass instance.
a.push(1,2,3,4);      // a.length == 4; we can use inherited methods
a.pop()               // =&gt; 4: another inherited method
a.first               // =&gt; 1: first getter defined by subclass
a.last                // =&gt; 3: last getter defined by subclass
a[1]                  // =&gt; 2: regular array access syntax still works.
Array.isArray(a)      // =&gt; true: subclass instance really is an array
EZArray.isArray(a)    // =&gt; true: subclass inherits static methods, too!
</code></pre>

<p>EZArray å­ç±»å®šä¹‰äº†ä¸¤ä¸ªç®€å•çš„ getter æ–¹æ³•ã€‚EZArray å®ä¾‹çš„è¡Œä¸ºç±»ä¼¼äºæ™®é€šæ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»§æ‰¿çš„æ–¹æ³•å’Œå±æ€§ï¼Œå¦‚ push()ã€pop() å’Œ lengthã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å­ç±»ä¸­å®šä¹‰çš„ first å’Œ last getter æ–¹æ³•ã€‚ä¸ä»…ç»§æ‰¿å®ä¾‹æ–¹æ³•å¦‚ pop() ï¼Œä¹Ÿç»§æ‰¿ Array.isArray ç­‰é™æ€æ–¹æ³•ã€‚è¿™æ˜¯ ES6 ç±»è¯­æ³•å¯ç”¨çš„æ–°ç‰¹æ€§ï¼šEZArray() æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä½†å®ƒä» Array() ç»§æ‰¿ï¼š</p>

<pre><code class="language-javascript">// EZArray inherits instance methods because EZArray.prototype
// inherits from Array.prototype
Array.prototype.isPrototypeOf(EZArray.prototype) // =&gt; true

// And EZArray inherits static methods and properties because
// EZArray inherits from Array. This is a special feature of the
// extends keyword and is not possible before ES6.
Array.isPrototypeOf(EZArray) // =&gt; true
</code></pre>

<p>EZArray å­ç±»å¤ªç®€å•äº†ï¼Œæ²¡æœ‰æ•™è‚²æ„ä¹‰ã€‚ç¤ºä¾‹ 9-6 æ˜¯ä¸€ä¸ªæ›´å……å®çš„ç¤ºä¾‹ã€‚å®ƒå®šä¹‰äº†å†…ç½® Map ç±»çš„ TypedMap å­ç±»ï¼Œè¯¥å­ç±»æ·»åŠ ç±»å‹æ£€æŸ¥ä»¥ç¡®ä¿æ˜ å°„çš„é”®å’Œå€¼æ˜¯æŒ‡å®šçš„ç±»å‹ï¼ˆæ ¹æ® typeofï¼‰ã€‚é‡è¦çš„æ˜¯ï¼Œæ­¤ç¤ºä¾‹æ¼”ç¤ºäº†ä½¿ç”¨ super å…³é”®å­—æ¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°å’Œæ–¹æ³•ã€‚</p>

<p>ç¤ºä¾‹ 9-6ï¼šTypedMap.jsï¼šä¸€ä¸ªæ£€æµ‹ key å’Œ value ç±»å‹çš„ Map å­ç±»</p>

<pre><code class="language-javascript">class TypedMap extends Map {
    constructor(keyType, valueType, entries) {
        // If entries are specified, check their types
        if (entries) {
            for(let [k, v] of entries) {
                if (typeof k !== keyType || typeof v !== valueType) {
                    throw new TypeError(`Wrong type for entry [${k}, ${v}]`);
                }
            }
        }

        // Initialize the superclass with the (type-checked) initial entries
        super(entries);

        // And then initialize this subclass by storing the types
        this.keyType = keyType;
        this.valueType = valueType;
    }

    // Now redefine the set() method to add type checking for any
    // new entries added to the map.
    set(key, value) {
        // Throw an error if the key or value are of the wrong type
        if (this.keyType &amp;&amp; typeof key !== this.keyType) {
            throw new TypeError(`${key} is not of type ${this.keyType}`);
        }
        if (this.valueType &amp;&amp; typeof value !== this.valueType) {
            throw new TypeError(`${value} is not of type ${this.valueType}`);
        }

        // If the types are correct, we invoke the superclass&#39;s version of
        // the set() method, to actually add the entry to the map. And we
        // return whatever the superclass method returns.
        return super.set(key, value);
    }
}
</code></pre>

<p>TypedMap() æ„é€ å‡½æ•°çš„å‰ä¸¤ä¸ªå®å‚æ˜¯æ‰€éœ€çš„é”®å’Œå€¼ç±»å‹ã€‚è¿™äº›å®å‚åº”è¯¥æ˜¯å­—ç¬¦ä¸²ï¼Œå¦‚&quot;number&quot;å’Œ&quot;boolean&quot;ï¼Œè¿™äº›å­—ç¬¦ä¸²åº”è¯¥æ˜¯ typeof è¿ç®—ç¬¦çš„è¿”å›å€¼ã€‚è¿˜å¯ä»¥æŒ‡å®šç¬¬ä¸‰ä¸ªå®å‚ï¼šæŒ‡å®š map ä¸­åˆå§‹æ¡ç›®çš„ [key,value] æ•°ç»„ï¼ˆæˆ–ä»»ä½•å¯è¿­ä»£å¯¹è±¡ï¼‰ã€‚å¦‚æœæŒ‡å®šä»»ä½•åˆå§‹æ¡ç›®ï¼Œåˆ™æ„é€ å‡½æ•°è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯éªŒè¯å…¶ç±»å‹æ˜¯å¦æ­£ç¡®ã€‚æ¥ä¸‹æ¥ï¼Œæ„é€ å‡½æ•°è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œä½¿ç”¨ super å…³é”®å­—ï¼Œå°±åƒå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°åç§°ä¸€æ ·ã€‚Map() æ„é€ å‡½æ•°é‡‡ç”¨ä¸€ä¸ªå¯é€‰å®å‚ï¼šå¯è¿­ä»£å¯¹è±¡ [key,value] çš„æ•°ç»„ã€‚å› æ­¤ï¼ŒTypedMap() æ„é€ å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå¯é€‰å®å‚æ˜¯ Map() æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå¯é€‰å®å‚ï¼Œæˆ‘ä»¬ç”¨ <code>super(entries)</code> å°†å®ƒä¼ é€’ç»™çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚</p>

<p>è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°åˆå§‹åŒ–çˆ¶ç±»çŠ¶æ€åï¼Œæ¥ä¸‹æ¥ TypedMap() æ„é€ å‡½æ•°åˆå§‹åŒ–å…¶è‡ªå·±çš„å­ç±»çŠ¶æ€ this.keyType å’Œ this.valueTypeã€‚å®ƒéœ€è¦è®¾ç½®è¿™äº›å±æ€§ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åœ¨ set() æ–¹æ³•ä¸­å†æ¬¡ä½¿ç”¨å®ƒä»¬ã€‚</p>

<p>åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ super() éœ€è¦äº†è§£ä¸€äº›é‡è¦è§„åˆ™ï¼š</p>

<p>å¦‚æœä½¿ç”¨ extends å…³é”®å­—å®šä¹‰ç±»ï¼Œåˆ™ç±»çš„æ„é€ å‡½æ•°å¿…é¡»ä½¿ç”¨ super() è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ã€‚</p>

<p>å¦‚æœæœªåœ¨å­ç±»ä¸­å®šä¹‰æ„é€ å‡½æ•°ï¼Œå°†è‡ªåŠ¨ä¸ºä½ å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚æ­¤éšå¼å®šä¹‰çš„æ„é€ å‡½æ•°åªå°†ä¼ é€’ç»™å®ƒå€¼ä¼ é€’ç»™ super()ã€‚</p>

<p>åœ¨ä½¿ç”¨ super() è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ä¹‹å‰ï¼Œä¸èƒ½åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ this å…³é”®å­—ã€‚è¿™ä¸ªå¼ºåˆ¶è§„åˆ™ç¡®ä¿çˆ¶ç±»å…ˆäºå­ç±»åˆå§‹åŒ–ã€‚</p>

<p>åœ¨æœªä½¿ç”¨ new å…³é”®å­—è°ƒç”¨çš„å‡½æ•°ä¸­ï¼Œnew.target è¡¨è¾¾å¼æ˜¯ undefinedã€‚ä½†æ˜¯ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­ï¼Œnew.target æ˜¯å¼•ç”¨è°ƒç”¨çš„æ„é€ å‡½æ•°ã€‚å½“è°ƒç”¨å­ç±»æ„é€ å‡½æ•°å¹¶ä½¿ç”¨ super() è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°æ—¶ï¼Œè¯¥çˆ¶ç±»æ„é€ å‡½æ•°å°†çœ‹åˆ°å­ç±»æ„é€ å‡½æ•°ä½œä¸º new.target çš„å€¼ã€‚è™½ç„¶è®¾è®¡è‰¯å¥½çš„çˆ¶ç±»ä¸éœ€è¦çŸ¥é“å®ƒæ˜¯å¦æœ‰å­ç±»ï¼Œä½†ï¼Œåœ¨æ—¥å¿—è®°å½•æ¶ˆæ¯çš„åœºæ™¯ä¸­ä½¿ç”¨ new.target.name ä¼šå¾ˆæœ‰ç”¨ã€‚</p>

<p>åœ¨æ„é€ å‡½æ•°ä¹‹åï¼Œç¤ºä¾‹ 9-6 çš„ä¸‹ä¸€éƒ¨åˆ†æ˜¯åä¸º set() çš„æ–¹æ³•ã€‚Map çˆ¶ç±»å®šä¹‰äº†åä¸º set() çš„æ–¹æ³•ï¼Œä»¥å‘ Map æ·»åŠ æ–°æ¡ç›®ã€‚TypedMap ä¸­çš„ set() æ–¹æ³•å°†é‡å†™å…¶çˆ¶ç±»çš„ set() æ–¹æ³•ã€‚è¿™ä¸ªç®€å•çš„ TypedMap å­ç±»å¯¹å‘ Map æ·»åŠ æ–°æ¡ç›®ä¸€æ— æ‰€çŸ¥ï¼Œä½†å®ƒçŸ¥é“å¦‚ä½•æ£€æŸ¥ç±»å‹ï¼Œå› æ­¤å®ƒé¦–å…ˆä¼šè¿™æ ·åšï¼ŒéªŒè¯è¦æ·»åŠ åˆ°åœ°å›¾ä¸­çš„é”®å’Œå€¼çš„ç±»å‹æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœå®ƒä»¬ä¸æ­£ç¡®åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚æ­¤ set() æ–¹æ³•æ— æ³•å°†é”®å’Œå€¼æ·»åŠ åˆ° Map æœ¬èº«ï¼Œä½†è¿™å°±æ˜¯çˆ¶ç±» set() æ–¹æ³•çš„ç”¨é€”ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å†æ¬¡ä½¿ç”¨ super å…³é”®å­—æ¥è°ƒç”¨çˆ¶ç±»ç‰ˆæœ¬çš„ set() æ–¹æ³•ã€‚åœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ï¼Œsuper çš„å·¥ä½œæ–¹å¼ä¸ this å…³é”®å­—çš„å·¥ä½œæ–¹å¼éå¸¸ç›¸ä¼¼ï¼šå®ƒå¼•ç”¨å½“å‰å¯¹è±¡ï¼Œä½†å…è®¸è®¿é—®åœ¨çˆ¶çº§ç±»ä¸­å®šä¹‰çš„è¢«é‡å†™æ–¹æ³•ã€‚</p>

<p>åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œéœ€è¦å…ˆè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œç„¶åæ‰èƒ½è®¿é—® this å’Œåˆå§‹åŒ–æ–°å¯¹è±¡ã€‚ä½†é‡å†™æ–¹æ³•æ—¶æ²¡æœ‰æ­¤ç±»è§„åˆ™ã€‚è°ƒç”¨é‡å†™çˆ¶ç±»æ–¹æ³•æ—¶ä¸éœ€è¦è°ƒç”¨çˆ¶ç±»æ–¹æ³•ã€‚å¦‚æœå®ƒç¡®å®ä½¿ç”¨ super æ¥è°ƒç”¨çˆ¶ç±»ä¸­çš„é‡å†™æ–¹æ³•ï¼ˆæˆ–ä»»ä½•æ–¹æ³•ï¼‰ï¼Œå®ƒå¯ä»¥åœ¨é‡å†™æ–¹æ³•çš„å¼€å¤´ã€ä¸­é—´æˆ–æœ«å°¾è°ƒç”¨ã€‚</p>

<p>æœ€åï¼Œåœ¨å°† TypedMap ç¤ºä¾‹æŠ›åœ¨è„‘åä¹‹å‰ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­¤ç±»æ˜¯ä½¿ç”¨ç§æœ‰å­—æ®µçš„ç†æƒ³åœºæ™¯ã€‚ç°åœ¨ç¼–å†™ç±»æ—¶ï¼Œç”¨æˆ·å¯ä»¥æ›´æ”¹ keyType æˆ– valueType å±æ€§ä»¥ç ´åç±»å‹æ£€æŸ¥ã€‚ä¸€æ—¦æ”¯æŒç§æœ‰å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›å±æ€§æ”¹ä¸º #keyType å’Œ #valueTypeï¼Œä»¥ä¾¿å®ƒä»¬ä¸èƒ½ä»å¤–éƒ¨æ›´æ”¹ã€‚</p>

<h3 id="toc_13">9.5.3 å§”æ‰˜ä»£æ›¿ç»§æ‰¿</h3>

<p>extends å…³é”®å­—ä¾¿äºåˆ›å»ºå­ç±»ã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€åº”è¯¥åˆ›å»ºå¤§é‡çš„å­ç±»ã€‚å¦‚æœè¦ç¼–å†™æŸäº›å…¶ä»–ç±»å…±äº«çš„è¡Œä¸ºçš„ç±»ï¼Œå¯ä»¥å°è¯•é€šè¿‡åˆ›å»ºå­ç±»æ¥ç»§æ‰¿è¯¥è¡Œä¸ºã€‚ä½†æ˜¯ï¼Œé€šå¸¸å°†æœŸæœ›çš„è¡Œä¸ºç¼–å†™åœ¨ç±»ä¸­æ¯”ç”¨ç±»åˆ›å»ºå…¶ä»–ç±»çš„å®ä¾‹å¹¶æ ¹æ®éœ€è¦å§”æ‰˜ç»™è¯¥å®ä¾‹æ›´ç®€å•ä¹Ÿæ›´çµæ´»ã€‚åˆ›å»ºæ–°ç±»ä¸å°†å…¶ä½œä¸ºå­ç±»ï¼Œè€Œæ˜¯é€šè¿‡åŒ…è£…æˆ–&quot;ç»„åˆ&quot;å…¶ä»–ç±»ã€‚è¿™ç§å§”æ‰˜æ–¹æ³•é€šå¸¸ç§°ä¸º&quot;ç»„åˆ&quot;ï¼Œå®ƒæ˜¯ä¸€ç§é¢å‘å¯¹è±¡ç¼–ç¨‹ç»å¸¸è¢«å¼•ç”¨çš„åº§å³é“­&quot;å€¾å‘äºç»„åˆè€Œä¸æ˜¯ç»§æ‰¿&quot;ã€‚ <sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup></p>

<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦ä¸€ä¸ªè¡Œä¸ºç±»ä¼¼äº JavaScript çš„ Set ç±»çš„ Histogram ç±»ï¼Œåªä¸è¿‡ï¼Œå®ƒä¸åªæ˜¯è·Ÿè¸ªæ˜¯å¦ç»™é›†åˆæ·»åŠ äº†å€¼ï¼Œè¿˜ç»´æŠ¤è¯¥å€¼æ·»åŠ æ¬¡æ•°çš„è®¡æ•°ã€‚ç”±äº Histogram ç±»çš„ API ä¸ Set ç±»ä¼¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘ Set å­ç±»å¹¶æ·»åŠ  count() æ–¹æ³•ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸€æ—¦æˆ‘ä»¬å¼€å§‹è€ƒè™‘å¦‚ä½•å®ç° count() æ–¹æ³•ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ„è¯†åˆ° Histogram ç±»æ›´åƒæ˜¯ä¸€ä¸ª Map è€Œä¸æ˜¯ä¸€ä¸ª Setï¼Œå› ä¸ºå®ƒéœ€è¦ç»´æŠ¤å€¼ä¸æ·»åŠ å®ƒä»¬æ¬¡æ•°ä¹‹é—´çš„æ˜ å°„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»ï¼Œè¯¥ç±»å®šä¹‰ä¸€ä¸ªç±»ä¼¼ Set çš„ APIï¼Œä½†å§”æ‰˜å†…éƒ¨ Map å¯¹è±¡æ¥å®ç°è¿™äº›æ–¹æ³•ï¼Œè€Œä¸æ˜¯åˆ›å»º Set çš„å­ç±»ã€‚ç¤ºä¾‹ 9-7 æ˜¾ç¤ºäº†æˆ‘ä»¬å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>

<p>ç¤ºä¾‹ 9-7ï¼šHistogram.jsï¼šä½¿ç”¨å§”æ‰˜å®ç°ä¸€ä¸ªç±»ä¼¼ Set çš„ç±»</p>

<pre><code class="language-javascript">/**
 * A Set-like class that keeps track of how many times a value has
 * been added. Call add() and remove() like you would for a Set, and
 * call count() to find out how many times a given value has been added.
 * The default iterator yields the values that have been added at least
 * once. Use entries() if you want to iterate [value, count] pairs.
 */
class Histogram {
    // To initialize, we just create a Map object to delegate to
    constructor() { this.map = new Map(); }

    // For any given key, the count is the value in the Map, or zero
    // if the key does not appear in the Map.
    count(key) { return this.map.get(key) || 0; }

    // The Set-like method has() returns true if the count is non-zero
    has(key) { return this.count(key) &gt; 0; }

    // The size of the histogram is just the number of entries in the Map.
    get size() { return this.map.size; }

    // To add a key, just increment its count in the Map.
    add(key) { this.map.set(key, this.count(key) + 1); }

    // Deleting a key is a little trickier because we have to delete
    // the key from the Map if the count goes back down to zero.
    delete(key) {
        let count = this.count(key);
        if (count === 1) {
            this.map.delete(key);
        } else if (count &gt; 1) {
            this.map.set(key, count - 1);
        }
    }

    // Iterating a Histogram just returns the keys stored in it
    [Symbol.iterator]() { return this.map.keys(); }

    // These other iterator methods just delegate to the Map object
    keys() { return this.map.keys(); }
    values() { return this.map.values(); }
    entries() { return this.map.entries(); }
}
</code></pre>

<p>åœ¨ç¤ºä¾‹ 9-7 ä¸­ï¼ŒHistogram() æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ª Map å¯¹è±¡ã€‚å¤§å¤šæ•°æ–¹æ³•éƒ½æ˜¯å•è¡Œï¼Œå®ƒä»¬åªæ˜¯å§”æ‰˜ç»™ Map çš„æ–¹æ³•ï¼Œä½¿å¾—å®ç°å˜å¾—éå¸¸ç®€å•ã€‚å› ä¸ºæˆ‘ä»¬ä½¿ç”¨å§”æ‰˜è€Œä¸æ˜¯ç»§æ‰¿ï¼Œæ‰€ä»¥ Histogram å¯¹è±¡ä¸æ˜¯ Set æˆ– Map çš„å®ä¾‹ã€‚ä½†æ˜¯ï¼ŒHistogram å®ç°äº†è®¸å¤šå¸¸ç”¨çš„ Set æ–¹æ³•ï¼Œå¹¶æ²¡æœ‰è¿‡å¤šçš„ä½¿ç”¨é¢å¤–çš„ JavaScriptï¼Œè¿™é€šå¸¸è¶³å¤Ÿå¥½ï¼šæœ‰æ¡ç†çš„ç»§æ‰¿å…³ç³»æœ‰æ—¶æ˜¯ä¸é”™ï¼Œä½†é€šå¸¸æ˜¯å¯é€‰çš„ã€‚</p>

<h3 id="toc_14">9.5.4 Hierarchies ç±»å’ŒæŠ½è±¡ç±»</h3>

<p>ç¤ºä¾‹ 9-6 æ¼”ç¤ºäº†å¦‚åˆ›å»º Map çš„å­ç±»ã€‚ç¤ºä¾‹ 9-7 æ¼”ç¤ºäº†å¦‚ä½•åœ¨ä¸åˆ›å»ºå­ç±»çš„æƒ…å†µä¸‹å°†å§”æ‰˜ç»™ Map å¯¹è±¡ã€‚ä½¿ç”¨ JavaScript ç±»å°è£…æ•°æ®å’Œæ¨¡å—åŒ–ä»£ç é€šå¸¸æ˜¯ä¸€ç§å¾ˆå¥½çš„æŠ€æœ¯ï¼Œä½ å¯èƒ½ä¼šå‘ç°è‡ªå·±ç»å¸¸ä½¿ç”¨ç±»å…³é”®å­—ã€‚ä½†æ˜¯ï¼Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œä½ æ›´å–œæ¬¢ç»„åˆè€Œä¸æ˜¯ç»§æ‰¿ï¼Œè€Œä¸”å¾ˆå°‘éœ€è¦ä½¿ç”¨ extendsï¼ˆé™¤éä½¿ç”¨éœ€è¦æ‰©å±•çš„åº“æˆ–æ¡†æ¶ï¼‰ã€‚</p>

<p>ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¤šä¸ªçº§åˆ«çš„å­ç±»æ˜¯åˆé€‚çš„ï¼Œæˆ‘ä»¬å°†ä¸¾ä¸€ä¸ªæ‰©å±•ç¤ºä¾‹æ¥ç»“æŸæœ¬ç« ï¼Œé€šè¿‡æè¿°ä¸åŒç§ç±»çš„é›†åˆæ¥æ¼”ç¤ºç±»çš„å±‚æ¬¡ç»“æ„ã€‚ï¼ˆç¤ºä¾‹ 9-8 ä¸­å®šä¹‰çš„ç±»è·Ÿ JavaScript ä¸­çš„å†…ç½® Set ç±»å¾ˆç›¸ä¼¼ï¼Œä½†ä¸å®Œå…¨å…¼å®¹ã€‚ï¼‰</p>

<p>ç¤ºä¾‹ 9-8 å®šä¹‰äº†å¤§é‡å­ç±»ï¼Œä½†å®ƒä¹Ÿæ¼”ç¤ºäº†å¦‚ä½•å®šä¹‰æŠ½è±¡ç±»ï¼ˆä¸åŒ…æ‹¬å®Œæ•´å®ç°çš„ç±»ï¼‰ä½œä¸ºä¸€ç»„ç›¸å…³å­ç±»çš„é€šç”¨çˆ¶ç±»ã€‚æŠ½è±¡çˆ¶ç±»å¯ä»¥å®šä¹‰æ‰€æœ‰å­ç±»ç»§æ‰¿å’Œå…±äº«çš„éƒ¨åˆ†å®ç°ã€‚å› æ­¤ï¼Œå­ç±»åªéœ€è¦é€šè¿‡å®ç°çˆ¶ç±»å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ï¼ˆæ²¡æœ‰å®ç°ï¼‰æ¥å®šä¹‰å®ƒä»¬è‡ªå·±çš„ç‹¬ç‰¹è¡Œä¸ºã€‚è¯·æ³¨æ„ï¼ŒJavaScript å¯¹æŠ½è±¡æ–¹æ³•æˆ–æŠ½è±¡ç±»æ²¡æœ‰ä»»ä½•æ­£å¼å®šä¹‰ï¼›æˆ‘åªæ˜¯å°†è¿™ä¸ªåå­—ç”¨äºæœªå®ç°çš„æ–¹æ³•å’Œä¸å®Œå…¨å®ç°çš„ç±»ã€‚</p>

<p>ç¤ºä¾‹ 9-8 è¯„è®ºè‰¯å¥½ï¼Œå¹¶ä¸”ç‹¬ç«‹ã€‚æˆ‘é¼“åŠ±ä½ æŠŠå®ƒä½œä¸ºæœ¬ç« å…³äºç±»çš„é¡¶çº§ç¤ºä¾‹ã€‚ç¤ºä¾‹ 9-8 ç”¨ &amp;ã€| å’Œ ~ è¿ç®—ç¬¦æ‰§è¡Œå¤§é‡ä½æ“ä½œï¼Œå¯ä»¥åœ¨ Â§4.8.3 ä¸­æŸ¥çœ‹è¿™äº›è¿ç®—ç¬¦ã€‚</p>

<p>ç¤ºä¾‹ 9-8ï¼šSets.jsï¼šæŠ½è±¡ç±»å’Œå®ä½“ç±»çš„å±‚æ¬¡</p>

<pre><code class="language-javascript">/**
 * The AbstractSet class defines a single abstract method, has().
 */
class AbstractSet {
    // Throw an error here so that subclasses are forced
    // to define their own working version of this method.
    has(x) { throw new Error(&quot;Abstract method&quot;); }
}

/**
 * NotSet is a concrete subclass of AbstractSet.
 * The members of this set are all values that are not members of some
 * other set. Because it is defined in terms of another set it is not
 * writable, and because it has infinite members, it is not enumerable.
 * All we can do with it is test for membership and convert it to a
 * string using mathematical notation.
 */
class NotSet extends AbstractSet {
    constructor(set) {
        super();
        this.set = set;
    }

    // Our implementation of the abstract method we inherited
    has(x) { return !this.set.has(x); }
    // And we also override this Object method
    toString() { return `{ x| x âˆ‰ ${this.set.toString()} }`; }
}

/**
 * Range set is a concrete subclass of AbstractSet. Its members are
 * all values that are between the from and to bounds, inclusive.
 * Since its members can be floating point numbers, it is not
 * enumerable and does not have a meaningful size.
 */
class RangeSet extends AbstractSet {
    constructor(from, to) {
        super();
        this.from = from;
        this.to = to;
    }

    has(x) { return x &gt;= this.from &amp;&amp; x &lt;= this.to; }
    toString() { return `{ x| ${this.from} â‰¤ x â‰¤ ${this.to} }`; }
}

/*
 * AbstractEnumerableSet is an abstract subclass of AbstractSet.  It defines
 * an abstract getter that returns the size of the set and also defines an
 * abstract iterator. And it then implements concrete isEmpty(), toString(),
 * and equals() methods on top of those. Subclasses that implement the
 * iterator, the size getter, and the has() method get these concrete
 * methods for free.
 */
class AbstractEnumerableSet extends AbstractSet {
    get size() { throw new Error(&quot;Abstract method&quot;); }
    [Symbol.iterator]() { throw new Error(&quot;Abstract method&quot;); }

    isEmpty() { return this.size === 0; }
    toString() { return `{${Array.from(this).join(&quot;, &quot;)}}`; }
    equals(set) {
        // If the other set is not also Enumerable, it isn&#39;t equal to this one
        if (!(set instanceof AbstractEnumerableSet)) return false;

        // If they don&#39;t have the same size, they&#39;re not equal
        if (this.size !== set.size) return false;

        // Loop through the elements of this set
        for(let element of this) {
            // If an element isn&#39;t in the other set, they aren&#39;t equal
            if (!set.has(element)) return false;
        }

        // The elements matched, so the sets are equal
        return true;
    }
}

/*
 * SingletonSet is a concrete subclass of AbstractEnumerableSet.
 * A singleton set is a read-only set with a single member.
 */
class SingletonSet extends AbstractEnumerableSet {
    constructor(member) {
        super();
        this.member = member;
    }

    // We implement these three methods, and inherit isEmpty, equals()
    // and toString() implementations based on these methods.
    has(x) { return x === this.member; }
    get size() { return 1; }
    *[Symbol.iterator]() { yield this.member; }
}

/*
 * AbstractWritableSet is an abstract subclass of AbstractEnumerableSet.
 * It defines the abstract methods insert() and remove() that insert and
 * remove individual elements from the set, and then implements concrete
 * add(), subtract(), and intersect() methods on top of those. Note that
 * our API diverges here from the standard JavaScript Set class.
 */
class AbstractWritableSet extends  AbstractEnumerableSet {
    insert(x) { throw new Error(&quot;Abstract method&quot;); }
    remove(x) { throw new Error(&quot;Abstract method&quot;); }

    add(set) {
        for(let element of set) {
            this.insert(element);
        }
    }

    subtract(set) {
        for(let element of set) {
            this.remove(element);
        }
    }

    intersect(set) {
        for(let element of this) {
            if (!set.has(element)) {
                this.remove(element);
            }
        }
    }
}

/**
 * A BitSet is a concrete subclass of AbstractWritableSet with a
 * very efficient fixed-size set implementation for sets whose
 * elements are non-negative integers less than some maximum size.
 */
class BitSet extends AbstractWritableSet {
    constructor(max) {
        super();
        this.max = max;  // The maximum integer we can store.
        this.n = 0;      // How many integers are in the set
        this.numBytes = Math.floor(max / 8) + 1;   // How many bytes we need
        this.data = new Uint8Array(this.numBytes); // The bytes
    }

    // Internal method to check if a value is a legal member of this set
    _valid(x) { return Number.isInteger(x) &amp;&amp; x &gt;= 0 &amp;&amp; x &lt;= this.max; }

    // Tests whether the specified bit of the specified byte of our
    // data array is set or not. Returns true or false.
    _has(byte, bit) { return (this.data[byte] &amp; BitSet.bits[bit]) !== 0; }

    // Is the value x in this BitSet?
    has(x) {
        if (this._valid(x)) {
            let byte = Math.floor(x / 8);
            let bit = x % 8;
            return this._has(byte, bit);
        } else {
            return false;
        }
    }

    // Insert the value x into the BitSet
    insert(x) {
        if (this._valid(x)) {               // If the value is valid
            let byte = Math.floor(x / 8);   // convert to byte and bit
            let bit = x % 8;
            if (!this._has(byte, bit)) {    // If that bit is not set yet
                this.data[byte] |= BitSet.bits[bit]; // then set it
                this.n++;                            // and increment set size
            }
        } else {
            throw new TypeError(&quot;Invalid set element: &quot; + x );
        }
    }

    remove(x) {
        if (this._valid(x)) {              // If the value is valid
            let byte = Math.floor(x / 8);  // compute the byte and bit
            let bit = x % 8;
            if (this._has(byte, bit)) {    // If that bit is already set
                this.data[byte] &amp;= BitSet.masks[bit];  // then unset it
                this.n--;                              // and decrement size
            }
        } else {
            throw new TypeError(&quot;Invalid set element: &quot; + x );
        }
    }

    // A getter to return the size of the set
    get size() { return this.n; }

    // Iterate the set by just checking each bit in turn.
    // (We could be a lot more clever and optimize this substantially)
    *[Symbol.iterator]() {
        for(let i = 0; i &lt;= this.max; i++) {
            if (this.has(i)) {
                yield i;
            }
        }
    }
}

// Some pre-computed values used by the has(), insert() and remove() methods
BitSet.bits = new Uint8Array([1, 2, 4, 8, 16, 32, 64, 128]);
BitSet.masks = new Uint8Array([~1, ~2, ~4, ~8, ~16, ~32, ~64, ~128]);
</code></pre>

<h2 id="toc_15">9.6 æ€»ç»“</h2>

<p>æœ¬ç« è¯´æ˜äº† JavaScript ç±»çš„ä¸»è¦åŠŸèƒ½ï¼š</p>

<ul>
<li>åŒä¸€ç±»çš„æˆå‘˜å¯¹è±¡ä»åŒä¸€åŸå‹å¯¹è±¡ç»§æ‰¿å±æ€§ã€‚åŸå‹å¯¹è±¡æ˜¯ JavaScript ç±»çš„å…³é”®ç‰¹æ€§ï¼Œåªæœ‰ Object.create() æ–¹æ³•å¯ä»¥å®šä¹‰ç±»ã€‚</li>
<li>åœ¨ ES6 ä¹‹å‰ï¼Œå…¸å‹çš„ç±»å®šä¹‰å…ˆå®šä¹‰æ„é€ å‡½æ•°ã€‚ä½¿ç”¨ function å…³é”®å­—åˆ›å»ºçš„å‡½æ•°å…·æœ‰åŸå‹å±æ€§ï¼Œthis å±æ€§çš„å€¼æ˜¯ä½¿ç”¨ new å°†å‡½æ•°ç”¨ä½œæ„é€ å‡½æ•°è°ƒç”¨æ—¶åˆ›å»ºçš„å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚é€šè¿‡åˆå§‹åŒ–æ­¤åŸå‹å¯¹è±¡ï¼Œå¯ä»¥å®šä¹‰ç±»çš„å…±äº«æ–¹æ³•ã€‚è™½ç„¶åŸå‹å¯¹è±¡æ˜¯ç±»çš„å…³é”®ç‰¹æ€§ï¼Œä½†æ„é€ å‡½æ•°æ˜¯ç±»çš„å…¬å…±æ ‡è¯†ã€‚</li>
<li>ES6 å¼•å…¥äº†ä¸€ä¸ª class å…³é”®å­—ï¼Œå®ƒä½¿å®šä¹‰ç±»æ›´åŠ å®¹æ˜“ï¼Œä½†å®ƒåªæ˜¯ä¸ªè¯­æ³•ç³–ï¼Œæ„é€ å‡½æ•°å’ŒåŸå‹æœºåˆ¶ä¿æŒä¸å˜ã€‚</li>
<li>å­ç±»ä½¿ç”¨ç±»å£°æ˜ä¸­çš„ extends å…³é”®å­—å®šä¹‰ã€‚</li>
<li>å­ç±»å¯ä»¥ä½¿ç”¨ super å…³é”®å­—è°ƒç”¨å…¶çˆ¶ç±»çš„æ„é€ å‡½æ•°æˆ–çˆ¶ç±»çš„é‡å†™æ–¹æ³•ã€‚</li>
</ul>

<div class="footnotes">
<hr/>
<ol>

<li id="fn1">
<p>ä¾‹å¦‚ï¼Œè§ã€ŠDesign Patterns (Addison-Wesley Professional)ã€‹ä½œè€… Erich Gamma ç­‰ï¼Œæˆ–è€…ã€ŠEffective Java (Addison-Wesley Professional)ã€‹ä½œè€… Joshua Blochã€‚&nbsp;<a href="#fnref1" rev="footnote">&#8617;</a></p>
</li>

</ol>
</div>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JavaScript åŸå‹å’ŒåŸå‹é“¾]]></title>
    <link href="2019919.xyz/16080322533005.html"/>
    <updated>2020-12-15T19:37:33+08:00</updated>
    <id>2019919.xyz/16080322533005.html</id>
    <content type="html"><![CDATA[
<p>ä»Šå¤©åˆšå¼€å§‹å­¦ä¹ ã€é‡å­¦å‰ç«¯ã€‘çš„è¯¾ç¨‹ï¼Œè®²åˆ°è£…ç®±è½¬æ¢çš„æ—¶å€™æåˆ°äº†å‡½æ•°çš„ call æ–¹æ³•ï¼Œè€Œ call æ–¹æ³•åœ¨æˆ‘çš„å°è±¡ä¸­å°±åªæœ‰ call çº¦ç­‰äº apply ï¼Œç„¶åå°±å†æ²¡æœ‰ç„¶åäº†ã€‚åœ¨æˆ‘æƒ³æ·±å…¥äº†è§£ä¸‹ call æ–¹æ³•çš„æ—¶å€™åˆå‘ç°äº†æœ‰äººåœ¨åŒæ—¶è®²è§£åŸå‹ï¼Œå¸¦ç€å„ç§å¿ƒæƒ…èµ¶ç´§å­¦ä¹ ä¸‹åˆ°åº•ä»€ä¹ˆæ˜¯åŸå‹å’ŒåŸå‹é“¾ã€‚</p>

<h2 id="toc_0">åŸå‹</h2>

<pre><code class="language-text">prototype  [ËˆproÊŠtÉ™taÉªp]  åŸå‹
</code></pre>

<p>ä¸‹é¢è¿™ä¸ªå›¾å¾ˆå¤šå¤§ç¥éƒ½æœ‰ç”»è¿‡ï¼Œè®°å½•ä¸‹æˆ‘è‡ªå·±çš„ç†è§£å’Œå®éªŒã€‚Â Â </p>

<p><img src="media/16080322533005/16080400429560.jpg" alt="" style="width:450px;"/></p>

<h3 id="toc_1">æ„é€ å‡½æ•°è§†è§’</h3>

<p>å‡½æ•°å¯ä»¥ç”¨æ¥åšæ„é€ å™¨ï¼Œä¹Ÿå°±æ˜¯ constructorï¼Œè€Œæ„é€ å™¨ä¹Ÿå¯ä»¥ç§°ä¸ºç±»ã€‚<br/>
é€šè¿‡æ„é€ å™¨ Apple æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¯¹è±¡ appleã€‚</p>

<p><img src="media/16080322533005/16080397593797.jpg" alt="" style="width:198px;"/></p>

<p><strong>æ„é€ å‡½æ•°åˆ›å»ºäº†å®ä¾‹å¯¹è±¡</strong>ï¼Œè¿™æ˜¯æ„é€ å‡½æ•°ä¸å®ä¾‹å¯¹è±¡çš„å…³ç³»ã€‚</p>

<hr/>

<p><strong>æ„é€ å‡½æ•°æœ‰ä¸€ä¸ªå±æ€§å«åš propotypeï¼Œä»–æŒ‡å‘äº†åŸå‹å¯¹è±¡ã€‚</strong></p>

<p><img src="media/16080322533005/16080405364424.jpg" alt="" style="width:299px;"/></p>

<p>è¿™é‡Œçš„åŸå‹å¯¹è±¡å†™åš [[propotype]]ï¼Œè¿™é‡Œæˆ‘çŒœæµ‹æ˜¯ä¸ºäº†åŒºåˆ† propotype çš„å±æ€§ã€‚<br/>
ç°åœ¨æˆ‘çŸ¥é“äº†ï¼ŒåŸæ¥è¿™é‡Œä¸¤ä¸ªä¸­æ‹¬å·æ˜¯ ECMA æ–‡æ¡£ä¸­çš„ä¹¦å†™æ–¹å¼ã€‚</p>

<h3 id="toc_2">åŸå‹å¯¹è±¡è§†è§’</h3>

<p><strong>åŸå‹å¯¹è±¡çš„ constructor å±æ€§æŒ‡å‘äº†æ„é€ å‡½æ•°</strong>ã€‚</p>

<p><img src="media/16080322533005/16080407735350.jpg" alt="" style="width:382px;"/></p>

<p>è¿™é‡Œç”¨æ„é€ å™¨çš„åŸå‹å¯¹è±¡çš„ constructor æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª badApple ï¼Œä¼šå‘ç°å®ƒå’Œ apple çš„ç±»å‹æ˜¯ç›¸ç­‰çš„ã€‚</p>

<h3 id="toc_3">å®ä¾‹å¯¹è±¡è§†è§’</h3>

<p>å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªå±æ€§ __propo__ï¼Œè¿™æ˜¯ä¸€ä¸ªéšå¼å±æ€§ï¼Œ<strong>å¯¹è±¡çš„ __propo__ æŒ‡å‘äº†ä»–çš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚</strong>ä¹Ÿå°±æ˜¯è¯´ Apple çš„ propotype å±æ€§å’Œ appleã€badApple çš„ __propo__ æŒ‡å‘äº†åŒä¸€ä¸ªåœ°å€ã€‚</p>

<p><img src="media/16080322533005/16080419126552.jpg" alt="" style="width:318px;"/></p>

<h3 id="toc_4">ç”±å‡½æ•°å¼•å‡ºåŸå‹é“¾</h3>

<p>å‡½æ•°æ˜¯ JS ä¸­çš„ç¬¬ä¸€ç±»å¯¹è±¡ï¼Œåœ¨ Javascript ä¸­ï¼Œå¯¹è±¡æ‰€æ‹¥æœ‰çš„å‡½æ•°ä¹ŸåŒæ ·æ‹¥æœ‰ï¼Œä¹Ÿå°±æ˜¯è¯´æ„é€ å‡½æ•° Apple ä¹ŸåŒæ ·ä¼šæœ‰ __propo__ å±æ€§å»æŒ‡å‘ä»–çš„çˆ¶ç±»çš„åŸå‹å¯¹è±¡ï¼Œä¸ºäº†ç†æ¸…è¿™ä¹±ä¸ƒå…«ç³Ÿçš„å…³ç³»ï¼Œå°±æœ‰äº†ä¸‹é¢â€œå¯¹è±¡-å‡½æ•°-æ„é€ å‡½æ•°-å®ä¾‹å¯¹è±¡â€è¿™æ ·çš„ä¸€ä¸ªå…³ç³»å›¾ï¼Œä¹Ÿå°±æ˜¯åŸå‹é“¾å›¾ã€‚</p>

<h2 id="toc_5">åŸå‹é“¾</h2>

<p><img src="media/16080322533005/16080423510561.jpg" alt=""/></p>

<p>è¿™å¼ å›¾ç†è§£äº†ä¸Šé¢çš„å†…å®¹ä¹‹åå°±æ„Ÿè§‰å®¹æ˜“å¤šäº†ï¼Œæ€»ç»“ä¸€ä¸‹æœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ã€‚</p>

<ul>
<li>ä»»ä½•å‡½æ•°çš„çˆ¶ç±»éƒ½æ˜¯ Function æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä»»ä½•å‡½æ•°çš„ __proto__ æŒ‡å‘ Function.prototypeï¼Œè¿™é‡ŒåŒæ ·åŒ…å«äº† Function æ„é€ å‡½æ•°è‡ªå·±ã€‚</li>
<li>Object æ„é€ å‡½æ•°å®ƒä¹Ÿæ˜¯å‡½æ•°ï¼Œå®ƒçš„çš„ __proto__ ä¹ŸæŒ‡å‘ Function.prototypeã€‚</li>
<li>Function.prototype çš„ __proto__ æŒ‡å‘ Object.prototypeï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¯´å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ã€‚</li>
<li>Object.prototype çš„ __proto__ æ˜¯ nullã€‚</li>
</ul>

<h2 id="toc_6">Â ES6 ä¸­çš„ç±»</h2>

<p>ç±»çš„å†™æ³•ä¹Ÿæ˜¯ç”±åŸå‹è¿è¡Œæ—¶æ¥æ‰¿è½½çš„ï¼Œé€»è¾‘ä¸Š JavaScript è®¤ä¸ºæ¯ä¸ªç±»æ˜¯æœ‰å…±åŒåŸå‹çš„ä¸€ç»„å¯¹è±¡ï¼Œç±»ä¸­å®šä¹‰çš„æ–¹æ³•å’Œå±æ€§ä¼šè¢«å¸è½½åŸå‹å¯¹è±¡ä¹‹ä¸Šã€‚æ­¤å¤–æœ€é‡è¦çš„æ˜¯ç±»æä¾›äº†ç»§æ‰¿èƒ½åŠ›ã€‚</p>

<pre><code class="language-javascript">classÂ AnimalÂ {Â 
Â Â constructor(name)Â {
Â Â Â Â this.nameÂ =Â name;
Â Â }
Â Â 
Â Â speak()Â {
Â Â Â Â console.log(this.nameÂ +Â &#39;Â makesÂ aÂ noise.&#39;);
Â Â }
}
classÂ DogÂ extendsÂ AnimalÂ {
Â Â constructor(name)Â {
Â Â Â Â super(name);Â //Â callÂ theÂ superÂ classÂ constructorÂ andÂ passÂ inÂ theÂ nameÂ parameter
Â Â }
Â Â speak()Â {
Â Â Â Â console.log(this.nameÂ +Â &#39;Â barks.&#39;);
Â Â }
}
letÂ dÂ =Â newÂ Dog(&#39;Mitzie&#39;);
d.speak();Â //Â MitzieÂ barks.
</code></pre>

<p>ä»¥ä¸Šä»£ç åˆ›é€ äº†Â AnimalÂ ç±»ï¼Œå¹¶ä¸”é€šè¿‡Â extendsÂ å…³é”®å­—è®©Â DogÂ ç»§æ‰¿äº†å®ƒï¼Œå±•ç¤ºäº†æœ€ç»ˆè°ƒç”¨å­ç±»çš„Â speakÂ æ–¹æ³•è·å–äº†çˆ¶ç±»çš„Â nameã€‚æ¯”èµ·æ—©æœŸçš„åŸå‹æ¨¡æ‹Ÿæ–¹å¼ï¼Œä½¿ç”¨Â extendsÂ å…³é”®å­—è‡ªåŠ¨è®¾ç½®äº†Â constructorï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ç§æ›´å°‘å‘çš„è®¾è®¡ã€‚æ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨ç±»çš„æ€æƒ³æ¥è®¾è®¡ä»£ç æ—¶ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨Â classÂ æ¥å£°æ˜ç±»ï¼Œè€Œä¸æ˜¯ç”¨æ—§è¯­æ³•ï¼Œæ‹¿å‡½æ•°æ¥æ¨¡æ‹Ÿå¯¹è±¡ã€‚</p>

<blockquote>
<p>super å…³é”®å­—ç”¨äºè®¿é—®å’Œè°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„çˆ¶å¯¹è±¡ä¸Šçš„å‡½æ•°ã€‚<br/>
åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨æ—¶ï¼Œsuper å…³é”®å­—å°†å•ç‹¬å‡ºç°ï¼Œå¹¶ä¸”å¿…é¡»åœ¨ä½¿ç”¨thiså…³é”®å­—ä¹‹å‰ä½¿ç”¨ã€‚</p>
</blockquote>

<pre><code class="language-javascript">super([arguments]);
//Â è°ƒç”¨Â çˆ¶å¯¹è±¡/çˆ¶ç±»Â çš„æ„é€ å‡½æ•°
super.functionOnParent([arguments]);
//Â è°ƒç”¨Â çˆ¶å¯¹è±¡/çˆ¶ç±»Â ä¸Šçš„æ–¹æ³•
</code></pre>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¬¬ 10 ç«  æ¨¡å—]]></title>
    <link href="2019919.xyz/16130963383709.html"/>
    <updated>2021-02-12T10:18:58+08:00</updated>
    <id>2019919.xyz/16130963383709.html</id>
    <content type="html"><![CDATA[
<ul>
<li>
<a href="#toc_0">10.1 ç±»ã€å¯¹è±¡å’Œé—­åŒ…å……å½“æ¨¡å—</a>
<ul>
<li>
<a href="#toc_1">10.1.1 åŸºäºé—­åŒ…çš„è‡ªåŠ¨æ¨¡å—åŒ–</a>
</li>
</ul>
</li>
<li>
<a href="#toc_2">10.2 Node ä¸­çš„æ¨¡å—</a>
<ul>
<li>
<a href="#toc_3">10.2.1 Node Exports</a>
</li>
<li>
<a href="#toc_4">10.2.2 Node Imports</a>
</li>
<li>
<a href="#toc_5">10.2.3 Web ä¸­çš„ Node é£æ ¼æ¨¡å—</a>
</li>
</ul>
</li>
<li>
<a href="#toc_6">10.3 ES6 ä¸­çš„æ¨¡å—</a>
<ul>
<li>
<a href="#toc_7">10.3.1 ES6 å¯¼å‡º</a>
</li>
<li>
<a href="#toc_8">10.3.2 ES6 å¯¼å…¥</a>
</li>
<li>
<a href="#toc_9">10.3.3 å¯¼å…¥å¯¼å‡ºé‡å‘½å</a>
</li>
<li>
<a href="#toc_10">10.3.4 å†å¯¼å‡º</a>
</li>
<li>
<a href="#toc_11">10.3.5 JavaScript Modules on the Web</a>
</li>
<li>
<a href="#toc_12">10.3.6 Dynamic Imports with import()</a>
</li>
<li>
<a href="#toc_13">10.3.7 import.meta.url</a>
</li>
</ul>
</li>
<li>
<a href="#toc_14">10.4 Summary</a>
</li>
</ul>


<p>æ¨¡å—åŒ–ç¼–ç¨‹çš„ç›®æ ‡æ˜¯å…è®¸ä½¿ç”¨æ¥è‡ªä¸åŒä½œè€…å’Œæºçš„ä»£ç æ¨¡å—æ¥ç»„è£…å¤§å‹ç¨‹åºï¼Œå¹¶ä¸”å³ä½¿å‡ºç°äº†ä¸åŒæ¨¡å—ä½œè€…æ²¡æœ‰é¢„æ–™åˆ°çš„ä»£ç ï¼Œæ‰€æœ‰è¿™äº›ä»£ç ä¹Ÿèƒ½æ­£ç¡®è¿è¡Œã€‚ä½œä¸ºä¸€ä¸ªå®é™…é—®é¢˜ï¼Œæ¨¡å—åŒ–ä¸»è¦æ˜¯å…³äºå°è£…æˆ–éšè—ç§æœ‰å®ç°ç»†èŠ‚å’Œä¿æŒå…¨å±€åç§°ç©ºé—´æ•´æ´ï¼Œä»¥ä¾¿æ¨¡å—ä¸ä¼šæ„å¤–åœ°ä¿®æ”¹å…¶ä»–æ¨¡å—å®šä¹‰çš„å˜é‡ã€å‡½æ•°å’Œç±»ã€‚</p>

<p>ç›´åˆ°æœ€è¿‘ï¼ŒJavaScript è¿˜æ²¡æœ‰å¯¹æ¨¡å—çš„å†…ç½®æ”¯æŒï¼Œåœ¨å¤§å‹ä»£ç åº“ä¸Šå·¥ä½œçš„ç¨‹åºå‘˜å°½åŠ›ä½¿ç”¨ç±»ã€å¯¹è±¡å’Œé—­åŒ…çš„å¼±æ¨¡å—æ€§ã€‚åŸºäºé—­åŒ…çš„æ¨¡å—åŒ–åœ¨ä»£ç æ†ç»‘å·¥å…·çš„æ”¯æŒä¸‹ï¼Œå®é™…ä½¿ç”¨ä¸­å½¢æˆäº†ä¸€ç§åŸºäº require() å‡½æ•°çš„æ¨¡å—åŒ–å½¢å¼ï¼ŒNode é‡‡ç”¨äº†è¿™ç§å½¢å¼ã€‚åŸºäº require() çš„æ¨¡å—æ˜¯ Node ç¼–ç¨‹ç¯å¢ƒçš„åŸºæœ¬éƒ¨åˆ†ï¼Œä½†ä»æœªè¢«ä½œä¸º JavaScript è¯­è¨€çš„æ­£å¼éƒ¨åˆ†é‡‡ç”¨ã€‚ç›¸åï¼ŒES6 ä½¿ç”¨ import å’Œ import å…³é”®å­—å®šä¹‰æ¨¡å—ã€‚è™½ç„¶ import å’Œ export å·²ç»æˆä¸ºè¯­è¨€çš„ä¸€éƒ¨åˆ†å¾ˆå¤šå¹´äº†ï¼Œä½†æ˜¯å®ƒä»¬åªæ˜¯æœ€è¿‘æ‰è¢« web æµè§ˆå™¨å’Œ Node å®ç°ã€‚è€Œä¸”ï¼Œä½œä¸ºä¸€ä¸ªå®é™…é—®é¢˜ï¼ŒJavaScript æ¨¡å—åŒ–ä»ç„¶ä¾èµ–äºä»£ç æ†ç»‘å·¥å…·ã€‚</p>

<p>ä»¥ä¸‹å„èŠ‚åŒ…æ‹¬:</p>

<ul>
<li>ä½¿ç”¨ç±»ã€å¯¹è±¡å’Œé—­åŒ…è‡ªå·±åšæ¨¡å—</li>
<li>ä½¿ç”¨ require() çš„ Node æ¨¡å—</li>
<li>ä½¿ç”¨ exportã€import å’Œ import() çš„ES6æ¨¡å—</li>
</ul>

<h2 id="toc_0">10.1 ç±»ã€å¯¹è±¡å’Œé—­åŒ…å……å½“æ¨¡å—</h2>

<p>å°½ç®¡è¿™å¯èƒ½å¾ˆæ˜æ˜¾ï¼Œä½†å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼Œç±»çš„é‡è¦ç‰¹æ€§ä¹‹ä¸€æ˜¯å®ƒä»¬å……å½“å…¶æ–¹æ³•çš„æ¨¡å—ã€‚å›æƒ³ä¸€ä¸‹ç¤ºä¾‹ 9-8ã€‚è¯¥ç¤ºä¾‹å®šä¹‰äº†è®¸å¤šä¸åŒçš„ç±»ï¼Œæ‰€æœ‰è¿™äº›ç±»éƒ½æœ‰ä¸€ä¸ªåä¸º has() çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œåœ¨ç¼–å†™ä½¿ç”¨è¯¥ç¤ºä¾‹ä¸­çš„å¤šä¸ª set ç±»çš„ç¨‹åºæ—¶æ²¡æœ‰é—®é¢˜ï¼šä¾‹å¦‚ï¼ŒSingletonSet çš„ has() å®ç°ä¸ä¼šè¦†ç›– BitSet çš„ has() æ–¹æ³•ã€‚</p>

<p>ä¸€ä¸ªç±»çš„æ–¹æ³•ç‹¬ç«‹äºå…¶ä»–ä¸ç›¸å…³ç±»çš„æ–¹æ³•çš„åŸå› æ˜¯ï¼Œæ¯ä¸ªç±»çš„æ–¹æ³•éƒ½è¢«å®šä¹‰ä¸ºç‹¬ç«‹åŸå‹å¯¹è±¡çš„å±æ€§ã€‚ç±»æ˜¯æ¨¡å—åŒ–çš„åŸå› æ˜¯å¯¹è±¡æ˜¯æ¨¡å—åŒ–çš„ï¼šåœ¨ JavaScript å¯¹è±¡ä¸­å®šä¹‰å±æ€§éå¸¸ç±»ä¼¼äºå£°æ˜å˜é‡ï¼Œä½†æ˜¯å‘å¯¹è±¡æ·»åŠ å±æ€§ä¸ä¼šå½±å“ç¨‹åºçš„å…¨å±€å‘½åç©ºé—´ï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–å¯¹è±¡çš„å±æ€§ã€‚JavaScript å®šä¹‰äº†å¾ˆå¤šæ•°å­¦å‡½æ•°å’Œå¸¸é‡ï¼Œä½†å®ƒä»¬ä¸æ˜¯å…¨å±€å®šä¹‰çš„ï¼Œè€Œæ˜¯åˆ†ç»„ä¸º Math å…¨å±€å¯¹è±¡çš„å•ä¸ªå±æ€§ã€‚åŒæ ·çš„æŠ€æœ¯ä¹Ÿå¯ä»¥ç”¨åœ¨ç¤ºä¾‹ 9-8 ä¸­ã€‚ä¸ä½¿ç”¨ SingletonSet å’Œ BitSet è¿™æ ·çš„åç§°å®šä¹‰å…¨å±€ç±»ï¼Œè¿™ä¸ªç¤ºä¾‹å¯ä»¥ç¼–å†™ä¸ºåªæœ‰ä¸€ä¸ª Sets å…¨å±€å¯¹è±¡ï¼ŒSets çš„å±æ€§å¼•ç”¨å„ç§ç±»ã€‚ç„¶åï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨è¿™ä¸ª Sets åº“é€šè¿‡ Sets.Singleton å’Œ Sets.Bit çš„åç§°æ¥è·å–ç±»çš„å¼•ç”¨ã€‚</p>

<p>ä½¿ç”¨ç±»å’Œå¯¹è±¡å®ç°æ¨¡å—åŒ–æ˜¯ JavaScript ç¼–ç¨‹ä¸­å¸¸è§è€Œæœ‰ç”¨çš„æŠ€æœ¯ï¼Œä½†è¿™è¿˜ä¸å¤Ÿã€‚ç‰¹åˆ«æ˜¯ï¼Œå®ƒæ²¡æœ‰æä¾›ä»»ä½•æ–¹æ³•æ¥éšè—æ¨¡å—å†…éƒ¨çš„å®ç°ç»†èŠ‚ã€‚å†æ¬¡è€ƒè™‘ç¤ºä¾‹ 9-8ã€‚å¦‚æœæˆ‘ä»¬å°†è¯¥ç¤ºä¾‹ä½œä¸ºä¸€ä¸ªæ¨¡å—æ¥ç¼–å†™ï¼Œä¹Ÿè®¸æˆ‘ä»¬ä¼šå¸Œæœ›å°†å„ç§æŠ½è±¡ç±»ä¿ç•™åœ¨æ¨¡å—å†…éƒ¨ï¼Œåªè®©å…·ä½“çš„å­ç±»å¯¹æ¨¡å—çš„ç”¨æˆ·å¯ç”¨ã€‚åŒæ ·ï¼Œåœ¨ BitSet ç±»ä¸­ï¼Œ_valid() å’Œ _has() æ–¹æ³•æ˜¯å†…éƒ¨å®ç”¨ç¨‹åºï¼Œä¸åº”è¯¥å‘ç±»çš„ç”¨æˆ·å…¬å¼€å®ƒä»¬ã€‚BitSet.bits å’Œ BitSet.masks æ˜¯å®ç°ç»†èŠ‚ï¼Œæœ€å¥½éšè—èµ·æ¥ã€‚</p>

<p>æ­£å¦‚æˆ‘ä»¬åœ¨ Â§8.6 ä¸­çœ‹åˆ°çš„ï¼Œåœ¨å‡½æ•°ä¸­å£°æ˜çš„å±€éƒ¨å˜é‡å’ŒåµŒå¥—å‡½æ•°æ˜¯è¯¥å‡½æ•°ç§æœ‰çš„ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼æ¥å®ç°ä¸€ç§æ¨¡å—åŒ–ï¼Œæ–¹æ³•æ˜¯å°†å®ç°ç»†èŠ‚å’Œå®ç”¨å‡½æ•°éšè—åœ¨å°è£…çš„å‡½æ•°ä¸­ï¼Œè€Œå°†æ¨¡å—çš„å…¬å…± API ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ã€‚åœ¨ BitSet ç±»çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åƒè¿™æ ·æ„é€ æ¨¡å—:</p>

<pre><code class="language-javascript">const BitSet = (function() { // Set BitSet to the return value of this function
    // Private implementation details here
    function isValid(set, n) { ... }
    function has(set, byte, bit) { ... }
    const BITS = new Uint8Array([1, 2, 4, 8, 16, 32, 64, 128]);
    const MASKS = new Uint8Array([~1, ~2, ~4, ~8, ~16, ~32, ~64, ~128]);

    // The public API of the module is just the BitSet class, which we define
    // and return here. The class can use the private functions and constants
    // defined above, but they will be hidden from users of the class
    return class BitSet extends AbstractWritableSet {
        // ... implementation omitted ...
    };
}());
</code></pre>

<p>å½“æ¨¡å—ä¸­æœ‰å¤šä¸ªæ¡ç›®æ—¶ï¼Œè¿™ç§æ¨¡å—åŒ–æ–¹æ³•å°±å˜å¾—æ›´æœ‰è¶£äº†ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªè¿·ä½ ç»Ÿè®¡æ¨¡å—ï¼Œå®ƒå¯¼å‡º mean() å’Œ stddev() å‡½æ•°ï¼ŒåŒæ—¶éšè—å®ç°ç»†èŠ‚:</p>

<pre><code class="language-javascript">// This is how we could define a stats module
const stats = (function() {
    // Utility functions private to the module
    const sum = (x, y) =&gt; x + y;
    const square = x =&gt; x * x;

    // A public function that will be exported
    function mean(data) {
        return data.reduce(sum)/data.length;
    }

    // A public function that we will export
    function stddev(data) {
        let m = mean(data);
        return Math.sqrt(
            data.map(x =&gt; x - m).map(square).reduce(sum)/(data.length-1)
        );
    }

    // We export the public function as properties of an object
    return { mean, stddev };
}());

// And here is how we might use the module
stats.mean([1, 3, 5, 7, 9])   // =&gt; 5
stats.stddev([1, 3, 5, 7, 9]) // =&gt; Math.sqrt(10)
</code></pre>

<h3 id="toc_1">10.1.1 åŸºäºé—­åŒ…çš„è‡ªåŠ¨æ¨¡å—åŒ–</h3>

<p>è¯·æ³¨æ„ï¼Œé€šè¿‡åœ¨æ–‡ä»¶çš„å¼€å¤´å’Œç»“å°¾æ’å…¥ä¸€äº›æ–‡æœ¬æ¥å°† JavaScript ä»£ç æ–‡ä»¶è½¬æ¢ä¸ºè¿™ç§æ¨¡å—æ˜¯ç›¸å½“æœºæ¢°çš„è¿‡ç¨‹ã€‚æ‰€éœ€è¦åšçš„åªæ˜¯ä¸º JavaScript ä»£ç æ–‡ä»¶æä¾›ä¸€äº›çº¦å®šï¼Œä»¥æŒ‡ç¤ºè¦å¯¼å‡ºçš„å€¼å’Œä¸å¯¼å‡ºçš„å€¼ã€‚</p>

<p>æƒ³è±¡ä¸€ä¸‹ä¸€ä¸ªå·¥å…·ï¼Œå®ƒéœ€è¦ä¸€ç»„æ–‡ä»¶ï¼Œå°†æ¯ä¸ªæ–‡ä»¶çš„å†…å®¹åŒ…è£…åœ¨ç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼ä¸­ï¼Œè·Ÿè¸ªæ¯ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œå¹¶å°†æ‰€æœ‰å†…å®¹è¿æ¥åˆ°ä¸€ä¸ªå¤§æ–‡ä»¶ä¸­ã€‚ç»“æœå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>

<pre><code class="language-javascript">const modules = {};
function require(moduleName) { return modules[moduleName]; }

modules[&quot;sets.js&quot;] = (function() {
    const exports = {};

    // The contents of the sets.js file go here:
    exports.BitSet = class BitSet { ... };

    return exports;
}());

modules[&quot;stats.js&quot;] = (function() {
    const exports = {};

    // The contents of the stats.js file go here:
    const sum = (x, y) =&gt; x + y;
    const square = x = &gt; x * x;
    exports.mean = function(data) { ... };
    exports.stddev = function(data) { ... };

    return exports;
}());
</code></pre>

<p>å¦‚ä¸Šä¸€ä¸ªç¤ºä¾‹æ‰€ç¤ºï¼Œå°†æ¨¡å—æ†ç»‘åˆ°å•ä¸ªæ–‡ä»¶ä¸­ï¼Œå¯ä»¥æƒ³è±¡ç¼–å†™å¦‚ä¸‹ä»£ç æ¥åˆ©ç”¨è¿™äº›æ¨¡å—ï¼š</p>

<pre><code class="language-javascript">// Get references to the modules (or the module content) that we need
const stats = require(&quot;stats.js&quot;);
const BitSet = require(&quot;sets.js&quot;).BitSet;

// Now write code using those modules
let s = new BitSet(100);
s.insert(10);
s.insert(20);
s.insert(30);
let average = stats.mean([...s]); // average is 20
</code></pre>

<p>è¿™æ®µä»£ç æ¦‚è¿°äº†ç”¨äºç½‘ç»œæµè§ˆå™¨çš„ä»£ç æ†ç»‘å·¥å…·ï¼ˆä¾‹å¦‚ webpack å’Œ Parcelï¼‰çš„å·¥ä½œæ–¹å¼ï¼Œå¹¶ä¸”æ˜¯å¯¹ require() å‡½æ•°ï¼ˆå¦‚ Node ç¨‹åºä¸­ä½¿ç”¨çš„å‡½æ•°ï¼‰çš„ç®€å•ä»‹ç»ã€‚</p>

<h2 id="toc_2">10.2 Node ä¸­çš„æ¨¡å—</h2>

<p>In Node programming, it is normal to split programs into as many files as seems natural. These files of JavaScript code are assumed to all live on a fast filesystem. Unlike web browsers, which have to read files of JavaScript over a relatively slow network connection, there is no need or benefit to bundling a Node program into a single JavaScript file.</p>

<p>In Node, each file is an independent module with a private namespace. Constants, variables, functions, and classes defined in one file are private to that file unless the file exports them. And values exported by one module are only visible in another module if that module explicitly imports them.</p>

<p>Node modules import other modules with the require() function and export their public API by setting properties of the Exports object or by replacing the module.exportsobject entirely.</p>

<h3 id="toc_3">10.2.1 Node Exports</h3>

<p>Node defines a global exports object that is always defined. If you are writing a Node module that exports multiple values, you can simply assign them to the properties of this object:</p>

<pre><code class="language-javascript">const sum = (x, y) =&gt; x + y;
const square = x =&gt; x * x;

exports.mean = data =&gt; data.reduce(sum)/data.length;
exports.stddev = function(d) {
    let m = exports.mean(d);
    return Math.sqrt(d.map(x =&gt; x - m).map(square).reduce(sum)/(d.length-1));
};
</code></pre>

<p>Often, however, you want to define a module that exports only a single function or class rather than an object full of functions or classes. To do this, you simply assign the single value you want to export to module.exports:</p>

<pre><code class="language-javascript">module.exports = class BitSet extends AbstractWritableSet {
    // implementation omitted
};
</code></pre>

<p>The default value of module.exports is the same object that exports refers to. In the previous stats module, we could have assigned the mean function to module.exports.mean instead of exports.mean. Another approach with modules like the stats module is to export a single object at the end of the module rather than exporting functions one by one as you go:</p>

<pre><code class="language-javascript">// Define all the functions, public and private
const sum = (x, y) =&gt; x + y;
const square = x =&gt; x * x;
const mean = data =&gt; data.reduce(sum)/data.length;
const stddev = d =&gt; {
    let m = mean(d);
    return Math.sqrt(d.map(x =&gt; x - m).map(square).reduce(sum)/(d.length-1));
};

// Now export only the public ones
module.exports = { mean, stddev };
</code></pre>

<h3 id="toc_4">10.2.2 Node Imports</h3>

<p>A Node module imports another module by calling the require() function. The argument to this function is the name of the module to be imported, and the return value is whatever value (typically a function, class, or object) that module exports.</p>

<p>If you want to import a system module built in to Node or a module that you have installed on your system via a package manager, then you simply use the unqualified name of the module, without any â€œ/â€ characters that would turn it into a filesystem path:</p>

<pre><code class="language-javascript">// These modules are built in to Node
const fs = require(&quot;fs&quot;);           // The built-in filesystem module
const http = require(&quot;http&quot;);       // The built-in HTTP module

// The Express HTTP server framework is a third-party module.
// It is not part of Node but has been installed locally
const express = require(&quot;express&quot;);
</code></pre>

<p>When you want to import a module of your own code, the module name should be the path to the file that contains that code, relative to the current moduleâ€™s file. It is legal to use absolute paths that begin with a / character, but typically, when importing modules that are part of your own program, the module names will begin with ./ or sometimes ../ to indicate that they are relative to the current directory or the parent directory. For example:</p>

<pre><code class="language-javascript">const stats = require(&#39;./stats.js&#39;);
const BitSet = require(&#39;./utils/bitset.js&#39;);
</code></pre>

<p>(You can also omit the .js suffix on the files youâ€™re importing and Node will still find the files, but it is common to see these file extensions explicitly included.)</p>

<p>When a module exports just a single function or class, all you have to do is require it. When a module exports an object with multiple properties, you have a choice: you can import the entire object, or just import the specific properties (using destructuring assignment) of the object that you plan to use. Compare these two approaches:</p>

<pre><code class="language-javascript">// Import the entire stats object, with all of its functions
const stats = require(&#39;./stats.js&#39;);

// We&#39;ve got more functions than we need, but they&#39;re neatly
// organized into a convenient &quot;stats&quot; namespace.
let average = stats.mean(data);

// Alternatively, we can use idiomatic destructuring assignment to import
// exactly the functions we want directly into the local namespace:
const { stddev } = require(&#39;./stats.js&#39;);

// This is nice and succinct, though we lose a bit of context
// without the &#39;stats&#39; prefix as a namspace for the stddev() function.
let sd = stddev(data);
</code></pre>

<h3 id="toc_5">10.2.3 Web ä¸­çš„ Node é£æ ¼æ¨¡å—</h3>

<p>Node ä¸­å†…ç½®äº†å¸¦æœ‰ Exports å¯¹è±¡å’Œ require() å‡½æ•°çš„æ¨¡å—ã€‚ ä½†æ˜¯ï¼Œå¦‚æœè¦ä½¿ç”¨è¯¸å¦‚ webpack ä¹‹ç±»çš„æ†ç»‘å·¥å…·æ¥å¤„ç†ä»£ç ï¼Œåˆ™ä¹Ÿå¯ä»¥å°†è¿™ç§æ ·å¼çš„æ¨¡å—ç”¨äºè¦åœ¨ç½‘ç»œæµè§ˆå™¨ä¸­è¿è¡Œçš„ä»£ç ã€‚ç›´åˆ°æœ€è¿‘ï¼Œè¿™è¿˜æ˜¯ä¸€ç§éå¸¸å¸¸ç”¨çš„åšæ³•ï¼Œå¯èƒ½ä¼šçœ‹åˆ°å¾ˆå¤šåŸºäº Web çš„ä»£ç ä»ç„¶è¿™æ ·åšã€‚</p>

<p>ç°åœ¨ï¼ŒJavaScript å…·æœ‰è‡ªå·±çš„æ ‡å‡†æ¨¡å—è¯­æ³•ï¼Œä½†æ˜¯ä½¿ç”¨æ†ç»‘ç¨‹åºçš„å¼€å‘äººå‘˜æ›´å–œæ¬¢å°†æ­£å¼çš„ JavaScript æ¨¡å—ä¸ import å’Œ export è¯­å¥ä¸€èµ·ä½¿ç”¨ã€‚</p>

<h2 id="toc_6">10.3 ES6 ä¸­çš„æ¨¡å—</h2>

<p>ES6 ç»™ JavaScript æ·»åŠ äº† import å’Œ export å…³é”®å­—ï¼Œå¹¶ä¸”æœ€ç»ˆæ”¯æŒçœŸæ­£çš„æ¨¡å—åŒ–ï¼Œå°†å…¶ä½œä¸ºæ ¸å¿ƒè¯­è¨€ç‰¹æ€§ã€‚ES6 æ¨¡å—åŒ–æ¦‚å¿µä¸Šå’Œ Node çš„æ¨¡å—åŒ–ç›¸åŒï¼šæ¯ä¸ªæ–‡ä»¶æ˜¯å®ƒä»¬è‡ªå·±çš„æ¨¡å—ï¼Œå®šä¹‰åœ¨æ–‡ä»¶ä¸­çš„å¸¸é‡ã€å˜é‡ã€å‡½æ•°å’Œç±»æ˜¯æ¨¡å—ç§æœ‰æˆå‘˜ï¼Œé™¤éå®ƒä»¬æ˜¯è¢«æ˜¾ç¤ºå¯¼å‡ºã€‚</p>

<p>é¦–å…ˆï¼Œè¯·æ³¨æ„ï¼ŒES6 æ¨¡å—åœ¨æŸäº›é‡è¦æ–¹é¢ä¹Ÿä¸å¸¸è§„ JavaScript â€œè„šæœ¬â€ä¸åŒã€‚æœ€æ˜æ˜¾çš„åŒºåˆ«æ˜¯æ¨¡å—åŒ–æœ¬èº«ï¼šåœ¨å¸¸è§„è„šæœ¬ä¸­ï¼Œå˜é‡ï¼Œå‡½æ•°å’Œç±»çš„é¡¶çº§å£°æ˜åœ¨æ‰€æœ‰è„šæœ¬å…±äº«çš„ä¸€ä¸ªå…¨å±€ä¸Šä¸‹æ–‡ä¸­ã€‚æ¨¡å—æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰å…¶è‡ªå·±çš„ä¸“ç”¨ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ import å’Œ export è¯­å¥ã€‚ä½†æ˜¯æ¨¡å—å’Œè„šæœ¬ä¹‹é—´ä¹Ÿå­˜åœ¨å…¶ä»–å·®å¼‚ã€‚ES6 æ¨¡å—å†…çš„ä»£ç ï¼ˆç±»ä¼¼ ES6 ç±»å†…å®šä¹‰çš„ä»£ç ï¼‰å°†è‡ªåŠ¨è¿›å…¥ä¸¥æ ¼æ¨¡å¼ï¼ˆè¯·å‚è§ Â§5.6.3ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä½¿ç”¨ ES6 æ¨¡å—æ—¶ï¼Œæ— éœ€å†å†™â€œuse strictâ€ã€‚è¿™æ„å‘³ç€æ¨¡å—ä¸­çš„ä»£ç ä¸èƒ½ä½¿ç”¨ with è¯­å¥æˆ– arguments å¯¹è±¡æˆ–æœªå£°æ˜çš„å˜é‡ã€‚ES6 æ¨¡å—ç”šè‡³æ¯”ä¸¥æ ¼æ¨¡å¼ç¨å¾®ä¸¥æ ¼ï¼šåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œåœ¨ä½œä¸ºå‡½æ•°è°ƒç”¨çš„å‡½æ•°ä¸­ï¼Œthis æ˜¯ undefinedã€‚åœ¨æ¨¡å—ä¸­ï¼Œthis åœ¨é¡¶å±‚ä»£ç ä¸­ä¹Ÿæ˜¯ undefinedã€‚ï¼ˆç›¸æ¯”ä¹‹ä¸‹ï¼ŒWeb æµè§ˆå™¨å’Œ Node ä¸­çš„è„šæœ¬å°† this è®¾ç½®ä¸ºå…¨å±€å¯¹è±¡ã€‚ï¼‰</p>

<p><strong>WEB å’Œ NODE ä¸­çš„ ES6 æ¨¡å—</strong></p>

<p>ES6æ¨¡å—åœ¨è¯¸å¦‚ webpack ä¹‹ç±»çš„ä»£ç æ‰“åŒ…å™¨çš„å¸®åŠ©ä¸‹å·²åœ¨ Web ä¸Šä½¿ç”¨å¤šå¹´ï¼Œè¯¥æ‰“åŒ…å™¨å°† JavaScript ä»£ç çš„ç‹¬ç«‹æ¨¡å—ç»„åˆæˆé€‚åˆäºåŒ…å«åœ¨ç½‘é¡µä¸­çš„å¤§å‹éæ¨¡å—åŒ–æ†ç»‘åŒ…ã€‚ä½†æ˜¯ï¼Œåœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œé™¤ Internet Explorer ä¹‹å¤–ï¼Œæ‰€æœ‰ Web æµè§ˆå™¨éƒ½æ”¯æŒ ES6 æ¨¡å—ã€‚æœ¬åœ°ä½¿ç”¨æ—¶ï¼ŒES6 æ¨¡å—é€šè¿‡ç‰¹æ®Šçš„ <code>&lt;script type=&quot;module&quot;&gt;</code> æ ‡ç­¾æ·»åŠ åˆ°HTMLé¡µé¢ä¸­ï¼Œæœ¬ç« ç¨åå°†è¿›è¡Œä»‹ç»ã€‚</p>

<p>åŒæ—¶ï¼Œç”±äºæ‹¥æœ‰ JavaScript æ¨¡å—åŒ–çš„å…ˆé©±ï¼ŒNode å¤„äºå¿…é¡»æ”¯æŒä¸¤ä¸ªä¸å®Œå…¨å…¼å®¹çš„æ¨¡å—ç³»ç»Ÿçš„å°´å°¬å¢ƒåœ°ã€‚Node 13 æ”¯æŒ ES6 æ¨¡å—ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œç»å¤§å¤šæ•° Node ç¨‹åºä»åœ¨ä½¿ç”¨ Node æ¨¡å—ã€‚</p>

<h3 id="toc_7">10.3.1 ES6 å¯¼å‡º</h3>

<p>è¦ä» ES6 æ¨¡å—å¯¼å‡ºå¸¸é‡ï¼Œå˜é‡ï¼Œå‡½æ•°æˆ–ç±»ï¼Œåªéœ€åœ¨å£°æ˜ä¹‹å‰æ·»åŠ å…³é”®å­— exportï¼š</p>

<pre><code class="language-javascript">export const PI = Math.PI;

export function degreesToRadians(d) { return d * PI / 180; }

export class Circle {
    constructor(r) { this.r = r; }
    area() { return PI * this.r * this.r; }
}
</code></pre>

<p>ä½œä¸ºåœ¨æ•´ä¸ªæ¨¡å—ä¸­æ•£æ’­ export å…³é”®å­—çš„æ›¿ä»£æ–¹æ³•ï¼Œå¯ä»¥åƒå¹³å¸¸ä¸€æ ·å®šä¹‰å¸¸é‡ã€å˜é‡ã€å‡½æ•°å’Œç±»ï¼Œæ— éœ€å¯¼å‡ºè¯­å¥ï¼Œç„¶åï¼ˆé€šå¸¸åœ¨æ¨¡å—æœ«å°¾ï¼‰ç¼–å†™ä¸€ä¸ªå¯¼å‡ºè¯­å¥ï¼Œåœ¨ä¸€ä¸ªä½ç½®ç²¾ç¡®çš„å£°æ˜è¦å¯¼å‡ºçš„æ‰€æœ‰å†…å®¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æœ«å°¾å†™å…¥ä¸€è¡Œä»£ç ï¼Œè€Œä¸æ˜¯åœ¨ä¸Šè¿°ä»£ç ä¸­ç¼–å†™ä¸‰ä¸ªå•ç‹¬çš„å¯¼å‡ºï¼š</p>

<pre><code class="language-javascript">export { Circle, degreesToRadians, PI };
</code></pre>

<p>è¿™ç§è¯­æ³•çœ‹èµ·æ¥åƒå¯¼å‡ºå…³é”®å­—ï¼Œåè·Ÿå¯¹è±¡å­—é¢é‡ï¼ˆä½¿ç”¨é€Ÿè®°ç¬¦å·ï¼‰ã€‚ä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒèŠ±æ‹¬å·å®é™…ä¸Šå¹¶ä¸æ˜¯å®šä¹‰å¯¹è±¡å­—é¢é‡ã€‚æ­¤å¯¼å‡ºè¯­æ³•åªéœ€è¦åœ¨å¤§æ‹¬å·ä¸­çš„æ ‡è¯†ç¬¦åˆ—è¡¨ç”¨é€—å·åˆ†éš”ã€‚</p>

<p>ç¼–å†™åªå¯¼å‡ºä¸€ä¸ªå€¼ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–ç±»ï¼‰çš„æ¨¡å—æ˜¯å¾ˆå¸¸è§çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ export default è€Œä¸æ˜¯ exportï¼š</p>

<pre><code class="language-javascript">export default class BitSet {
    // implementation omitted
}
</code></pre>

<p>é»˜è®¤å¯¼å‡ºæ¯”éé»˜è®¤å¯¼å‡ºæ›´å®¹æ˜“å¯¼å…¥ï¼Œå› æ­¤ï¼Œå½“åªæœ‰ä¸€ä¸ªå¯¼å‡ºå€¼æ—¶ï¼Œä½¿ç”¨é»˜è®¤å¯¼å‡ºå¯ä»¥ä½¿æ¨¡å—çš„ä½¿ç”¨æ›´å®¹æ˜“ã€‚</p>

<p>å¸¦ export çš„å¸¸è§„å¯¼å‡ºåªèƒ½åœ¨å…·æœ‰åç§°çš„å£°æ˜ä¸Šè¿›è¡Œã€‚export default é»˜è®¤å¯¼å‡ºå¯ä»¥å¯¼å‡ºä»»ä½•è¡¨è¾¾å¼ï¼ŒåŒ…æ‹¬åŒ¿åå‡½æ•°è¡¨è¾¾å¼å’ŒåŒ¿åç±»è¡¨è¾¾å¼ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½¿ç”¨é»˜è®¤å¯¼å‡ºï¼Œåˆ™å¯ä»¥å¯¼å‡ºå¯¹è±¡å­—é¢é‡ã€‚å› æ­¤ï¼Œä¸å¯¼å‡ºè¯­æ³•ä¸åŒï¼Œå¦‚æœåœ¨é»˜è®¤å¯¼å‡ºåçœ‹åˆ°èŠ±æ‹¬å·ï¼Œåˆ™å®ƒå®é™…ä¸Šæ˜¯è¦å¯¼å‡ºçš„å¯¹è±¡å­—é¢é‡ã€‚</p>

<p>åŒæ—¶æœ‰ export å’Œ export default çš„æ¨¡å—æ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯ä¸å¸¸ç”¨ã€‚å¦‚æœæ¨¡å—çš„é»˜è®¤å¯¼å‡ºæœ€å¤šä»…æœ‰ä¸€ä¸ªã€‚</p>

<p>æœ€åï¼Œè¯·æ³¨æ„ export å…³é”®å­—åªèƒ½å‡ºç°åœ¨ JavaScript ä»£ç çš„é¡¶å±‚ã€‚ ä¸èƒ½ä»ç±»ï¼Œå‡½æ•°ï¼Œå¾ªç¯æˆ–æ¡ä»¶å†…å¯¼å‡ºå€¼ã€‚ï¼ˆè¿™æ˜¯ ES6 æ¨¡å—ç³»ç»Ÿçš„é‡è¦ç‰¹æ€§ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œé™æ€åˆ†æï¼šæ¯æ¬¡è¿è¡Œæ—¶æ¨¡å—å¯¼å‡ºéƒ½æ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ¨¡å—å®é™…è¿è¡Œä¹‹å‰ç¡®å®šå¯¼å‡ºçš„ç¬¦å·ã€‚ï¼‰</p>

<h3 id="toc_8">10.3.2 ES6 å¯¼å…¥</h3>

<p>ä½¿ç”¨ import å…³é”®å­—å¯¼å…¥å…¶ä»–æ¨¡å—å¯¼å‡ºçš„å€¼ã€‚æœ€ç®€å•çš„å¯¼å…¥å½¢å¼æ˜¯å¯¼å…¥é»˜è®¤å¯¼å‡ºå®šä¹‰çš„æ¨¡å—ï¼š</p>

<pre><code class="language-javascript">import BitSet from &#39;./bitset.js&#39;;
</code></pre>

<p>import å…³é”®å­—åé¢è·Ÿä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œç„¶åæ˜¯ from å…³é”®å­—ï¼Œåæ¥è¦å¯¼å…¥çš„é»˜è®¤å¯¼å‡ºå­—ç¬¦ä¸²å­—é¢é‡æ¨¡å—åç§°ã€‚æ¨¡å—æŒ‡å®šçš„é»˜è®¤å¯¼å‡ºå€¼å°†ç¼–ç¨‹å½“å‰æ¨¡å—å†…æŒ‡å®šçš„æ ‡è¯†ç¬¦çš„å€¼ã€‚</p>

<p>èµ‹å¯¼å…¥å€¼çš„æ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå°±åƒå®ƒä½¿ç”¨äº† const å…³é”®å­—å£°æ˜ä¸€æ ·ã€‚å’Œå¯¼å‡ºä¸€æ ·ï¼Œåªèƒ½åœ¨æ¨¡å—çš„é¡¶å±‚å¯¼å…¥ï¼Œä¸èƒ½åœ¨ç±»ã€å‡½æ•°ã€å¾ªç¯æˆ–æ¡ä»¶ä¸­å¯¼å…¥ã€‚æ ¹æ®è¿‘ä¼¼é€šç”¨è§„çº¦ï¼Œéœ€è¦åœ¨æ¨¡å—çš„å¼€å¤´è¿›è¡Œæ¨¡å—å¯¼å…¥ã€‚ä½†æœ‰è¶£çš„æ˜¯ï¼Œè¿™ä¸æ˜¯å¿…é¡»çš„ï¼šå°±åƒå‡½æ•°å£°æ˜ï¼Œå¯¼å…¥â€œæå‰â€åˆ°é¡¶éƒ¨ï¼Œæ‰€æœ‰çš„å¯¼å…¥å€¼åœ¨æ•´ä¸ªæ¨¡å—ä»£ç ä¸­è¿è¡Œæ—¶å¯ä»¥ä½¿ç”¨ã€‚</p>

<p>è¢«å¯¼å…¥çš„æ¨¡å—ç”¨å•å¼•å·æˆ–åŒå¼•å·æ‹¬ä¸Šçš„å­—ç¬¦ä¸²å­—é¢é‡å¸¸é‡æŒ‡å®šã€‚ï¼ˆä¸å¯ä»¥ä½¿ç”¨å˜é‡æˆ–å…¶ä»–å€¼ä¸ºå­—ç¬¦ä¸²çš„è¡¨è¾¾å¼ï¼Œä¹Ÿä¸å¯ä»¥ä½¿ç”¨å¸¦åå¼•å·çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºæ¨¡æ¿å­—é¢é‡å¯ä»¥æ’å…¥å˜é‡ï¼Œå®ƒä¸æ€»æ˜¯ä¸€ä¸ªå¸¸é‡å€¼ã€‚ï¼‰åœ¨ Web æµè§ˆå™¨ä¸­ï¼Œå­—ç¬¦ä¸²åƒ URL ä¸€æ ·æè¿°å¯¼å…¥æ¨¡å—çš„ç›¸å¯¹ä½ç½®ã€‚ï¼ˆåœ¨ Nodeä¸­ï¼Œæˆ–è€…ä½¿ç”¨ä»£ç æ†ç»‘å·¥å…·æ—¶ï¼Œå­—ç¬¦ä¸²æè¿°ä¸€ä¸ªå¯¹äºå½“å‰æ¨¡å—çš„ç›¸å¯¹æ–‡ä»¶åï¼Œè¿™åœ¨äº‹ä»¶ä¸­ç•¥æœ‰ä¸åŒã€‚ï¼‰ä»¥â€œ/â€å¼€å§‹çš„æ¨¡å—æŒ‡å®šå­—ç¬¦ä¸²æ—¶ç»å¯¹è·¯å¾„ï¼Œâ€œ./â€å’Œâ€œ../â€å¼€å¤´çš„æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œæˆ–è€…æ˜¯å¸¦æœ‰åè®®å’Œä¸»æœºåçš„å®Œæ•´ URLã€‚ES6 æ˜ç¡®è§„å®šä¸å…è®¸ä½¿ç”¨è¯¸å¦‚â€œutil.jsâ€è¿™æ ·çš„ä¸åˆè§„èŒƒçš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºå®ƒæ˜¯å¦æ˜¯ç›¸å¯¹è·¯å¾„è¿˜æ˜¯ç»å¯¹è·¯å¾„ä¸Šæœ‰æ­§ä¹‰ã€‚ï¼ˆè¯¸å¦‚ webpack ä¹‹ç±»çš„ä»£ç æ†ç»‘å·¥å…·ä¸èƒ½æ»¡è¶³å¯¹â€œè£¸æ¨¡å—è¯´æ˜ç¬¦â€çš„è¿™ç§é™åˆ¶ï¼Œå¯ä»¥å°†å…¶è½»æ¾é…ç½®ä¸ºåœ¨æŒ‡å®šçš„åº“ä¸­æŸ¥æ‰¾è£¸æ¨¡å—ã€‚ï¼‰æœªæ¥ç‰ˆæœ¬ JavaScript å¯èƒ½å…è®¸ä½¿ç”¨â€œè£¸æ¨¡å—è¯´æ˜ç¬¦â€ï¼Œä½†ç›®å‰ä¸å…è®¸è¿™æ ·åšã€‚ å¦‚æœè¦ä»ä¸å½“å‰ç›®å½•ç›¸åŒçš„ç›®å½•ä¸­å¯¼å…¥æ¨¡å—ï¼Œåªéœ€åœ¨æ¨¡å—åç§°å‰æ”¾ç½®â€œ./â€ï¼Œç„¶åä»â€œ./util.jsâ€è€Œä¸æ˜¯â€œ util.jsâ€å¯¼å…¥ã€‚</p>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»…è€ƒè™‘äº†ä»ä½¿ç”¨é»˜è®¤å¯¼å‡ºçš„æ¨¡å—ä¸­å¯¼å…¥å•ä¸ªå€¼çš„æƒ…å†µã€‚è¦ä»å¯¼å‡ºå¤šä¸ªå€¼çš„æ¨¡å—å¯¼å…¥å€¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ç•¥æœ‰ä¸åŒçš„è¯­æ³•ï¼š</p>

<pre><code class="language-javascript">import { mean, stddev } from &quot;./stats.js&quot;;
</code></pre>

<p>å›æƒ³ä¸€ä¸‹ï¼Œé»˜è®¤å¯¼å‡ºä¸éœ€è¦åœ¨å®šä¹‰å®ƒä»¬çš„æ¨¡å—ä¸­å…·æœ‰åç§°ã€‚è€Œæ˜¯åœ¨å¯¼å…¥è¿™äº›å€¼æ—¶æä¾›ä¸€ä¸ªæœ¬åœ°åç§°ã€‚ä½†æ˜¯ï¼Œæ¨¡å—çš„éé»˜è®¤å¯¼å‡ºåœ¨å¯¼å‡ºæ¨¡å—ä¸­å…·æœ‰åç§°ï¼Œå¹¶ä¸”å½“æˆ‘ä»¬å¯¼å…¥è¿™äº›å€¼æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡è¿™äº›åç§°æ¥å¼•ç”¨å®ƒä»¬ã€‚å¯¼å‡ºæ¨¡å—å¯ä»¥å¯¼å‡ºä»»æ„æ•°é‡çš„å‘½åå€¼ã€‚å¯¼å…¥è¯­å¥å¼•ç”¨æ¨¡å—ï¼Œå¯ä»¥ç®€å•åœ°é€šè¿‡åœ¨èŠ±æ‹¬å·ä¸­åˆ—å‡ºå®ƒä»¬çš„åç§°æ¥å¯¼å…¥è¿™äº›åç§°å¯¹åº”çš„å€¼çš„ä»»ä½•å­é›†ã€‚èŠ±æ‹¬å·ä½¿è¿™ç§å¯¼å…¥è¯­å¥çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªè§£æ„èµ‹å€¼ï¼Œè€Œè§£æ„èµ‹å€¼å®é™…ä¸Šæ˜¯å¾ˆå¥½çš„æ¡ˆä¾‹æ¥è§£é‡Šå¯¼å…¥çš„è¿™ç§é£æ ¼ã€‚èŠ±æ‹¬å·ä¸­çš„æ ‡è¯†ç¬¦éƒ½è¢«æå‰åˆ°å¯¼å…¥æ¨¡å—çš„é¡¶éƒ¨ï¼Œå¹¶ä¸”è¡Œä¸ºå¦‚åŒå¸¸é‡ã€‚</p>

<p>æœ‰æ—¶ï¼Œé£æ ¼æŒ‡å—å»ºè®®æ˜¾ç¤ºå¯¼å…¥æ¨¡å—å°†ä½¿ç”¨çš„æ¯ä¸ªç¬¦å·ã€‚ä½†æ˜¯ï¼Œä»å®šä¹‰è®¸å¤šå¯¼å‡ºçš„æ¨¡å—è¿›è¡Œå¯¼å…¥æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„ import è¯­å¥è½»æ¾å¯¼å…¥æ‰€æœ‰å†…å®¹ï¼š</p>

<pre><code class="language-javascript">import * as stats from &quot;./stats.js&quot;;
</code></pre>

<p>åƒè¿™æ ·çš„å¯¼å…¥è¯­å¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡å¹¶å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªåä¸º stats çš„å¸¸é‡ã€‚æ¨¡å—ä¸­æ¯ä¸€ä¸ªéé»˜è®¤å¯¼å‡ºè¢«å¯¼å…¥æˆ stats å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ã€‚éé»˜è®¤å¯¼å‡ºå§‹ç»ˆæœ‰åç§°ï¼Œåœ¨å¯¹è±¡ä¸­å®ƒä»¬è¢«ç”¨ä½œå±æ€§åã€‚é‚£äº›å±æ€§å®é™…ä¸Šæ˜¯å¸¸é‡ï¼šå®ƒä»¬ä¸èƒ½è¢«é‡å†™æˆ–åˆ é™¤ã€‚é€šè¿‡å‰é¢ä¾‹å­ä¸­å±•ç¤ºçš„é€šé…ç¬¦å¯¼å…¥ï¼Œå¯¼å…¥çš„æ¨¡å—é€šè¿‡ stats å¯¹è±¡ä½¿ç”¨ mean() å’Œ stddev() å‡½æ•°ï¼Œç”¨ stats.mean() å’Œ stats.stddev() æ¥è°ƒç”¨å®ƒä»¬ã€‚</p>

<p>æ¨¡å—é€šå¸¸å®šä¹‰ä¸€ä¸ªé»˜è®¤å¯¼å‡ºæˆ–è€…å¤šä¸ªå‘½åå¯¼å‡ºã€‚æ¨¡å—å†…åŒæ—¶ä½¿ç”¨å¯¼å‡ºå’Œé»˜è®¤å¯¼å‡ºæ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯ä¸å¸¸è§ã€‚ä½†æ˜¯å½“ä¸€ä¸ªæ¨¡å—è¿™æ ·åšäº†ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢è¿™ç§æ–¹å¼å°†é»˜è®¤å€¼å’Œå‘½åå€¼é€šè¿‡ä¸€ä¸ªå¯¼å…¥è¯­å¥å¯¼å…¥ï¼š</p>

<pre><code class="language-javascript">import Histogram, { mean, stddev } from &quot;./histogram-stats.js&quot;;
</code></pre>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•ä»å…·æœ‰é»˜è®¤å¯¼å‡ºçš„æ¨¡å—ä»¥åŠå…·æœ‰éé»˜è®¤æˆ–å‘½åå¯¼å‡ºçš„æ¨¡å—å¯¼å…¥ã€‚ä½†æ˜¯ import è¯­å¥è¿˜æœ‰å¦ä¸€ç§å½¢å¼ï¼Œå¯ä»¥ç”¨äºæ²¡æœ‰å¯¼å‡ºçš„æ¨¡å—ã€‚è¦å°†æ— å¯¼å‡ºæ¨¡å—åŒ…å«åˆ°ç¨‹åºä¸­ï¼Œåªéœ€ä½¿ç”¨ import å…³é”®å­—å’Œæ¨¡å—è¯´æ˜ç¬¦ï¼š</p>

<pre><code class="language-javascript">import &quot;./analytics.js&quot;;
</code></pre>

<p>è¿™æ ·çš„æ¨¡å—åœ¨é¦–æ¬¡è¿è¡Œæ—¶å¯¼å…¥ã€‚ï¼ˆå¹¶ä¸”éšåçš„å¯¼å…¥ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ï¼‰ä»…å®šä¹‰å‡½æ•°çš„æ¨¡å—åªæœ‰åœ¨å¯¼å‡ºè‡³å°‘ä¸€ä¸ªå‡½æ•°æ—¶æ‰æœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ¨¡å—è¿è¡Œä¸€äº›ä»£ç ï¼Œé‚£ä¹ˆå³ä½¿æ²¡æœ‰ç¬¦å·ä¹Ÿå¯ä»¥å¯¼å…¥ã€‚Web åº”ç”¨ç¨‹åºçš„åˆ†ææ¨¡å—å¯èƒ½ä¼šè¿è¡Œä»£ç æ¥æ³¨å†Œå„ç§äº‹ä»¶å¤„ç†å™¨ï¼Œç„¶åä½¿ç”¨è¿™äº›äº‹ä»¶å¤„ç†ç¨‹åºåœ¨é€‚å½“çš„æ—¶é—´å°†é¥æµ‹æ•°æ®å‘é€å›æœåŠ¡å™¨ã€‚è¯¥æ¨¡å—æ˜¯ç‹¬ç«‹çš„ï¼Œä¸éœ€è¦å¯¼å‡ºä»»ä½•ä¸œè¥¿ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦å¯¼å…¥å®ƒï¼Œä»¥ä¾¿å®ƒå®é™…ä¸Šå¯ä»¥ä½œä¸ºç¨‹åºçš„ä¸€éƒ¨åˆ†è¿è¡Œã€‚</p>

<p>è¯·æ³¨æ„ï¼Œå³ä½¿å¯¹äºå…·æœ‰å¯¼å‡ºçš„æ¨¡å—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸å¯¼å…¥ä»»ä½•å†…å®¹çš„å¯¼å…¥è¯­æ³•ã€‚å¦‚æœæ¨¡å—å®šä¹‰çš„æœ‰ç”¨è¡Œä¸ºä¸å¯¼å‡ºçš„å€¼æ— å…³ï¼Œå¹¶ä¸”ç¨‹åºä¸éœ€è¦ä»»ä½•å¯¼å‡ºçš„å€¼ï¼Œåˆ™ä»å¯ä»¥ç”¨ . å¯¼å…¥æ¨¡å—ï¼Œè¿™ä»…ç”¨äºé»˜è®¤å¯¼å‡ºã€‚</p>

<h3 id="toc_9">10.3.3 å¯¼å…¥å¯¼å‡ºé‡å‘½å</h3>

<p>å¦‚æœä¸¤ä¸ªæ¨¡å—ä½¿ç”¨ç›¸åŒçš„åç§°å¯¼å‡ºä¸¤ä¸ªä¸åŒçš„å€¼ï¼Œå¹¶ä¸”è¦å¯¼å…¥è¿™ä¸¤ä¸ªå€¼ï¼Œåˆ™åœ¨å¯¼å…¥æ—¶å¿…é¡»é‡å‘½åä¸€ä¸ªæˆ–ä¸¤ä¸ªå€¼ã€‚åŒæ ·ï¼Œå¦‚æœæ¨¡å—è¦å¯¼å…¥å€¼çš„åç§°å·²åœ¨æ¨¡å—ä¸­ä½¿ç”¨ï¼Œåˆ™éœ€è¦é‡å‘½åå¯¼å…¥çš„å€¼ã€‚å¯ä»¥åœ¨å‘½åå¯¼å…¥ä¸­ä½¿ç”¨ as å…³é”®å­—ï¼Œä»¥åœ¨å¯¼å…¥å®ƒä»¬æ—¶é‡å‘½åå®ƒä»¬ï¼š</p>

<pre><code class="language-javascript">import { render as renderImage } from &quot;./imageutils.js&quot;;
import { render as renderUI } from &quot;./ui.js&quot;;
</code></pre>

<p>è¿™äº›è¡Œå°†ä¸¤ä¸ªåŠŸèƒ½å¯¼å…¥å½“å‰æ¨¡å—ã€‚è¿™äº›å‡½æ•°åœ¨å®šä¹‰å®ƒä»¬çš„æ¨¡å—ä¸­éƒ½è¢«å‘½åä¸º render()ï¼Œä½†ä½¿ç”¨æ›´å…·æè¿°æ€§å’Œæ¶ˆé™¤æ­§ä¹‰æ€§çš„ renderImage() å’Œ renderUI() åç§°å¯¼å…¥ã€‚</p>

<p>å›æƒ³ä¸€ä¸‹ï¼Œé»˜è®¤å¯¼å‡ºæ²¡æœ‰åç§°ã€‚å¯¼å…¥é»˜è®¤å¯¼å‡ºæ—¶ï¼Œå¯¼å…¥æ¨¡å—å§‹ç»ˆé€‰æ‹©åç§°ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„è¯­æ³•æ¥é‡å‘½åã€‚</p>

<p>è¯è™½å¦‚æ­¤ï¼Œå¯¼å…¥é‡å‘½åçš„å¯èƒ½æ€§æä¾›å¦å¤–ä¸€ç§å¯¼å…¥ï¼Œä»æ¨¡å—å¯¼å…¥åŒæ—¶å®šä¹‰é»˜è®¤å¯¼å‡ºå’Œå‘½åå¯¼å‡ºã€‚å›é¡¾ä¸Šä¸€èŠ‚ä¸­çš„â€œ ./histogram-stats.jsâ€æ¨¡å—ã€‚è¿™æ˜¯åŒæ—¶å¯¼å…¥è¯¥æ¨¡å—çš„é»˜è®¤å¯¼å‡ºå’Œå‘½åå¯¼å‡ºçš„å¦ä¸€ç§æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">import { default as Histogram, mean, stddev } from &quot;./histogram-stats.js&quot;;
</code></pre>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJavaScript å…³é”®å­— default ç”¨ä½œå ä½ç¬¦ï¼Œå¹¶å…è®¸æˆ‘ä»¬æŒ‡ç¤ºæˆ‘ä»¬è¦å¯¼å…¥å¹¶ä¸ºæ¨¡å—çš„é»˜è®¤å¯¼å‡ºæä¾›åç§°ã€‚</p>

<p>ä¹Ÿå¯ä»¥åœ¨å¯¼å‡ºæ—¶é‡å‘½åå€¼ï¼Œä½†ä»…åœ¨ä½¿ç”¨ export è¯­å¥çš„èŠ±æ‹¬å·æ—¶æ‰å¯ä»¥ã€‚è¿™æ ·åšé€šå¸¸å¹¶ä¸å¸¸è§ï¼Œä½†æ˜¯å¦‚æœé€‰æ‹©åœ¨æ¨¡å—å†…éƒ¨ä½¿ç”¨ç®€çŸ­çš„ç®€çŸ­åç§°ï¼Œåˆ™å¯èƒ½æ›´å–œæ¬¢ä½¿ç”¨æè¿°æ€§è¾ƒå¼ºçš„åç§°å¯¼å‡ºå€¼ï¼Œè¿™äº›åç§°ä¸å¤ªå¯èƒ½ä¸å…¶ä»–æ¨¡å—å‘ç”Ÿå†²çªã€‚ä¸å¯¼å…¥ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨ as å…³é”®å­—æ‰§è¡Œæ­¤æ“ä½œï¼š</p>

<pre><code class="language-javascript">export {
    layout as calculateLayout,
    render as renderLayout
};
</code></pre>

<p>è¯·è®°ä½ï¼Œå°½ç®¡èŠ±æ‹¬å·çœ‹èµ·æ¥åƒå¯¹è±¡å­—é¢é‡ï¼Œä½†å®é™…ä¸Šå¹¶éå¦‚æ­¤ï¼Œå¹¶ä¸” export å…³é”®å­—æœŸæœ›åœ¨ as ä¹‹å‰æœ‰ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œè€Œä¸æ˜¯è¡¨è¾¾å¼ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ„å‘³ç€ä¸èƒ½åƒè¿™æ ·ä½¿ç”¨å¯¼å‡ºé‡å‘½åï¼š</p>

<pre><code class="language-javascript">export { Math.sin as sin, Math.cos as cos }; // SyntaxError
</code></pre>

<h3 id="toc_10">10.3.4 å†å¯¼å‡º</h3>

<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸€ä¸ªå‡å®šçš„â€œ./stats.jsâ€æ¨¡å—ï¼Œè¯¥æ¨¡å—å¯¼å‡ºäº† mean() å’Œ stddev() å‡½æ•°ã€‚å¦‚æœæˆ‘ä»¬æ­£åœ¨ç¼–å†™è¿™æ ·ä¸€ä¸ªæ¨¡å—ï¼Œå¹¶ä¸”è¯¥æ¨¡å—çš„ç”¨æˆ·åªæƒ³è¦ä¸€ä¸ªå‡½æ•°æˆ–å¦ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½æƒ³åœ¨â€œ./stats/mean.jsâ€æ¨¡å—ä¸­å®šä¹‰ mean()ï¼Œå¹¶å®šä¹‰åœ¨â€œ./stats/stddev.jsâ€æ¨¡å—ä¸­çš„ stddev()ã€‚è¿™æ ·ï¼Œç¨‹åºä»…éœ€è¦å®Œå…¨å¯¼å…¥æ‰€éœ€çš„åŠŸèƒ½ï¼Œè€Œä¸ä¼šå› å¯¼å…¥ä¸éœ€è¦çš„ä»£ç è€Œè‚¿ã€‚</p>

<p>ä½†æ˜¯ï¼Œå³ä½¿æˆ‘ä»¬åœ¨å•ä¸ªæ¨¡å—ä¸­å®šä¹‰äº†è¿™äº›ç»Ÿè®¡å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯èƒ½æœ‰å¾ˆå¤šç¨‹åºéœ€è¦è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼Œå¹¶ä¸”å¸Œæœ›ä½¿ç”¨ä¸€è¡Œä»£ç æ–¹ä¾¿çš„å¯¼å…¥â€œ./stats.jsâ€æ¨¡å—ã€‚</p>

<p>é‰´äºå®ç°ç°åœ¨ä½äºå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œå› æ­¤å®šä¹‰è¿™æ ·çš„â€œ./stat.jsâ€æ¨¡å—ä¼šéå¸¸ç®€å•ï¼š</p>

<pre><code class="language-javascript">import { mean } from &quot;./stats/mean.js&quot;;
import { stddev } from &quot;./stats/stddev.js&quot;;
export { mean, stdev };
</code></pre>

<p>ES6 æ¨¡å—é¢„è§äº†è¿™ç§ä½¿ç”¨åœºæ™¯ï¼Œå¹¶ä¸ºæ­¤æä¾›äº†ä¸€ç§ç‰¹æ®Šçš„è¯­æ³•ã€‚å¯ä»¥ä½¿ç”¨ export å’Œ from å…³é”®å­—åˆå¹¶å¯¼å…¥å’Œå¯¼å‡ºåˆ°ä¸€ä¸ªå•ç‹¬çš„â€œå†å¯¼å‡ºâ€è¯­å¥ä¸­ï¼Œè€Œä¸æ˜¯ç®€å•åœ°å†æ¬¡å¯¼å…¥å³å¯å¯¼å…¥ç¬¦å·ï¼š</p>

<pre><code class="language-javascript">export { mean } from &quot;./stats/mean.js&quot;;
export { stddev } from &quot;./stats/stddev.js&quot;;
</code></pre>

<p>è¯·æ³¨æ„ï¼Œæ­¤ä»£ç ä¸­å¹¶æœªå®é™…ä½¿ç”¨åç§° mean å’Œ stddevã€‚å¦‚æœæˆ‘ä»¬ä¸é€‰æ‹©å†å¯¼å‡ºï¼Œè€Œåªæ˜¯æƒ³ä»å¦ä¸€ä¸ªæ¨¡å—ä¸­å¯¼å‡ºæ‰€æœ‰å‘½åå€¼ï¼Œåˆ™å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼š</p>

<pre><code class="language-javascript">export * from &quot;./stats/mean.js&quot;;
export * from &quot;./stats/stddev.js&quot;;
</code></pre>

<p>å†å¯¼å‡ºè¯­æ³•å…è®¸é‡å‘½åï¼Œå°±åƒå¸¸è§„çš„å¯¼å…¥å’Œå¯¼å‡ºè¯­å¥ä¸€æ ·ã€‚ å‡è®¾æˆ‘ä»¬è¦å†å¯¼å‡º mean() å‡½æ•°ï¼Œä½†è¿˜è¦å°†è¯¥å‡½æ•°å®šä¹‰ä¸º average()ã€‚ æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p>

<pre><code class="language-javascript">export { mean, mean as average } from &quot;./stats/mean.js&quot;;
export { stddev } from &quot;./stats/stddev.js&quot;;
</code></pre>

<p>æ‰€æœ‰çš„å†å¯¼å‡ºç¤ºä¾‹ä¸­ï¼Œâ€œ./stats/mean.jsâ€å’Œâ€œ./stats/stddev.jsâ€æ¨¡å—éƒ½ä½¿ç”¨å¯¼å‡ºè€Œä¸æ˜¯é»˜è®¤å¯¼å‡ºæ¥å¯¼å‡ºå®ƒä»¬çš„å‡½æ•°ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œç”±äºè¿™äº›æ¨¡å—ä»…å…·æœ‰å•ä¸ªå¯¼å‡ºï¼Œå› æ­¤ä½¿ç”¨å¯¼å‡ºé»˜è®¤å®šä¹‰å®ƒä»¬æ˜¯æ›´æ˜æ™ºçš„ã€‚å¦‚æœæˆ‘ä»¬è¿™æ ·åšï¼Œé‚£ä¹ˆå†å¯¼å‡ºè¯­æ³•ä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸ºæœªå‘½åçš„é»˜è®¤å¯¼å‡ºå®šä¹‰ä¸€ä¸ªåç§°ã€‚ æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p>

<pre><code class="language-javascript">export { default as mean } from &quot;./stats/mean.js&quot;;
export { default as stddev } from &quot;./stats/stddev.js&quot;;
</code></pre>

<p>å¦‚æœè¦ä»å¦ä¸€ä¸ªæ¨¡å—ä¸­å†å¯¼å‡ºå‘½åç¬¦å·ä½œä¸ºæ¨¡å—çš„é»˜è®¤å¯¼å‡ºï¼Œåˆ™å¯ä»¥å…ˆè¿›è¡Œå¯¼å…¥ï¼Œç„¶åå†é»˜è®¤å¯¼å‡ºï¼Œæˆ–è€…å¯ä»¥å°†ä»¥ä¸‹ä¸¤ä¸ªè¯­å¥ç»„åˆåœ¨ä¸€èµ·ï¼š</p>

<pre><code class="language-javascript">// Import the mean() function from ./stats.js and make it the
// default export of this module
export { mean as default } from &quot;./stats.js&quot;
</code></pre>

<p>æœ€åï¼Œè¦å°†å¦ä¸€ä¸ªæ¨¡å—çš„é»˜è®¤å¯¼å‡ºå†å¯¼å‡ºä¸ºæ¨¡å—çš„é»˜è®¤å¯¼å‡ºï¼ˆå°½ç®¡ä¸æ¸…æ¥šä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Œå› ä¸ºç”¨æˆ·å¯ä»¥ç›´æ¥å¯¼å…¥å¦ä¸€ä¸ªæ¨¡å—ï¼‰ï¼Œå¯ä»¥è¿™æ ·ç¼–å†™ï¼š</p>

<pre><code class="language-javascript">// The average.js module simply re-exports the stats/mean.js default export
export { default } from &quot;./stats/mean.js&quot;
</code></pre>

<h3 id="toc_11">10.3.5 JavaScript Modules on the Web</h3>

<p>The preceding sections have described ES6 modules and their import and export declarations in a somewhat abstract manner. In this section and the next, weâ€™ll be discussing how they actually work in web browsers, and if you are not already an experienced web developer, you may find the rest of this chapter easier to understand after you have read Chapter 15.</p>

<blockquote>
<p>å‰é¢çš„ç« èŠ‚ä»¥æŸç§æŠ½è±¡çš„æ–¹å¼æè¿°äº† ES6 æ¨¡å—åŠå…¶å¯¼å…¥å’Œå¯¼å‡ºå£°æ˜ã€‚åœ¨æœ¬èŠ‚å’Œä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå®ƒä»¬åœ¨ Web æµè§ˆå™¨ä¸­çš„å®é™…å·¥ä½œæ–¹å¼ï¼Œå¦‚æœæ‚¨è¿˜ä¸æ˜¯ç»éªŒä¸°å¯Œçš„ Web å¼€å‘äººå‘˜ï¼Œåˆ™åœ¨é˜…è¯»ç¬¬ 15 ç« ä¹‹åï¼Œå¯èƒ½ä¼šå‘ç°æœ¬ç« çš„å…¶ä½™éƒ¨åˆ†æ›´å®¹æ˜“ç†è§£ã€‚</p>
</blockquote>

<p>As of early 2020, production code using ES6 modules is still generally bundled with a tool like webpack. There are trade-offs to doing this, [<sup>1]</sup> but on the whole, code bundling tends to give better performance. That may well change in the future as network speeds grow and browser vendors continue to optimize their ES6 module implementations.</p>

<blockquote>
<p>æˆªè‡³ 2020 å¹´åˆï¼Œä½¿ç”¨ ES6 æ¨¡å—çš„ç”Ÿäº§ä»£ç é€šå¸¸ä»ä¸ webpack ä¹‹ç±»çš„å·¥å…·æ†ç»‘åœ¨ä¸€èµ·ã€‚ è¿™æ ·åšæ˜¯æœ‰æŠ˜è¡·çš„ [<sup>1]ï¼Œä½†æ˜¯æ€»çš„æ¥è¯´ï¼Œä»£ç æ†ç»‘å¾€å¾€ä¼šæä¾›æ›´å¥½çš„æ€§èƒ½ã€‚éšç€ç½‘ç»œé€Ÿåº¦çš„å¢é•¿ä»¥åŠæµè§ˆå™¨ä¾›åº”å•†ç»§ç»­ä¼˜åŒ–å…¶</sup> ES6 æ¨¡å—çš„å®ç°ï¼Œå°†æ¥è¿™ç§æƒ…å†µå¯èƒ½ä¼šå‘ç”Ÿå¾ˆå¤§çš„å˜åŒ–ã€‚</p>
</blockquote>

<p>Even though bundling tools may still be desirable in production, they are no longer required in development since all current browsers provide native support for JavaScript modules. Recall that modules use strict mode by default, this does not refer to a global object, and top-level declarations are not shared globally by default. Since modules must be executed differently than legacy non-module code, their introduction requires changes to HTML as well as JavaScript. If you want to natively use import directives in a web browser, you must tell the web browser that your code is a module by using a <code>&lt;script type=&quot;module&quot;&gt;</code> tag.</p>

<blockquote>
<p>å³ä½¿åœ¨ç”Ÿäº§ä¸­ä»å¯èƒ½éœ€è¦æ†ç»‘å·¥å…·ï¼Œä½†ç”±äºå½“å‰æ‰€æœ‰çš„æµè§ˆå™¨éƒ½ä¸º JavaScript æ¨¡å—æä¾›äº†æœ¬æœºæ”¯æŒï¼Œå› æ­¤åœ¨å¼€å‘ä¸­ä¸å†éœ€è¦æ†ç»‘å·¥å…·ã€‚å›æƒ³ä¸€ä¸‹ï¼Œé»˜è®¤æƒ…å†µä¸‹æ¨¡å—ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œthis ä¸å¼•ç”¨å…¨å±€å¯¹è±¡ï¼Œå¹¶ä¸”é¡¶çº§å£°æ˜é»˜è®¤ä¸å…¨å±€å…±äº«ã€‚ç”±äºæ¨¡å—çš„æ‰§è¡Œæ–¹å¼å¿…é¡»ä¸åŒäºä¼ ç»Ÿçš„éæ¨¡å—ä»£ç ï¼Œå› æ­¤å…¶å¼•å…¥ requires å¯¹ HTML å’Œ JavaScript è¿›è¡Œæ›´æ”¹ã€‚å¦‚æœè¦åœ¨ Web æµè§ˆå™¨æœ¬åœ°ä½¿ç”¨ import æŒ‡ä»¤ï¼Œåˆ™å¿…é¡»é€šè¿‡ä½¿ç”¨ <code>&lt;script type =â€œ moduleâ€&gt;</code> æ ‡è®°æ¥å‘ŠçŸ¥ Web æµè§ˆå™¨æ‚¨çš„ä»£ç æ˜¯æ¨¡å—ã€‚</p>
</blockquote>

<p>One of the nice features of ES6 modules is that each module has a static set of imports. So given a single starting module, a web browser can load all of its imported modules and then load all of the modules imported by that first batch of modules, and so on, until a complete program has been loaded. Weâ€™ve seen that the module specifier in an import statement can be treated as a relative URL. A <code>&lt;script type=&quot;module&quot;&gt;</code> tag marks the starting point of a modular program. None of the modules it imports are expected to be in <code>&lt;script&gt;</code> tags, however: instead, they are loaded on demand as regular JavaScript files and are executed in strict mode as regular ES6 modules. Using a <code>&lt;script type=&quot;module&quot;&gt;</code> tag to define the main entry point for a modular JavaScript program can be as simple as this:</p>

<pre><code class="language-javascript">&lt;script type=&quot;module&quot;&gt;import &quot;./main.js&quot;;&lt;/script&gt;
</code></pre>

<p>Code inside an inline <code>&lt;script type=&quot;module&quot;&gt;</code> tag is an ES6 module, and as such can use the export statement. There is not any point in doing so, however, because the HTML <code>&lt;script&gt;</code> tag syntax does not provide any way to define a name for inline modules, so even if such a module does export a value, there is no way for another module to import it.</p>

<p>Scripts with the type=&quot;module&quot; attribute are loaded and executed like scripts with the defer attribute. Loading of the code begins as soon as the HTML parser encounters the <code>&lt;script&gt;</code> tag (in the case of modules, this code-loading step may be a recursive process that loads multiple JavaScript files). But code execution does not begin until HTML parsing is complete. And once HTML parsing is complete, scripts (both modular and non) are executed in the order in which they appear in the HTML document.</p>

<p>You can modify the execution time of modules with the async attribute, which works the same way for modules that it does for regular scripts. An async module will execute as soon as the code is loaded, even if HTML parsing is not complete and even if this changes the relative ordering of the scripts.</p>

<p>Web browsers that support <code>&lt;script type=&quot;module&quot;&gt;</code> must also support <code>&lt;script nomodule&gt;</code>. Browsers that are module-aware ignore any script with the nomodule attribute and will not execute it. Browsers that do not support modules will not recognize the nomodule attribute, so they will ignore it and run the script. This provides a powerful technique for dealing with browser compatibility issues. Browsers that support ES6 modules also support other modern JavaScript features like classes, arrow functions, and the for/of loop. If you write modern JavaScript and load it with <code>&lt;script type=&quot;module&quot;&gt;</code>, you know that it will only be loaded by browsers that can support it. And as a fallback for IE11 (which, in 2020, is effectively the only remaining browser that does not support ES6), you can use tools like Babel and webpack to transform your code into non-modular ES5 code, then load that less-efficient transformed code via <code>&lt;script nomodule&gt;</code>.</p>

<p>Another important difference between regular scripts and module scripts has to do with cross-origin loading. A regular <code>&lt;script&gt;</code> tag will load a file of JavaScript code from any server on the internet, and the internetâ€™s infrastructure of advertising, analytics, and tracking code depends on that fact. But <code>&lt;script type=&quot;module&quot;&gt;</code> provides an opportunity to tighten this up, and modules can only be loaded from the same origin as the containing HTML document or when proper CORS headers are in place to securely allow cross-origin loads. An unfortunate side effect of this new security restriction is that it makes it difficult to test ES6 modules in development mode using file: URLs. When using ES6 modules, you will likely need to set up a static web server for testing.</p>

<p>Some programmers like to use the filename extension .mjs to distinguish their modular JavaScript files from their regular, non-modular JavaScript files with the traditional .js extension. For the purposes of web browsers and <code>&lt;script&gt;</code> tags, the file extension is actually irrelevant. (The MIME type is relevant, however, so if you use .mjs files, you may need to configure your web server to serve them with the same MIME type as .js files.) Nodeâ€™s support for ES6 does use the filename extension as a hint to distinguish which module system is used by each file it loads. So if you are writing ES6 modules and want them to be usable with Node, then it may be helpful to adopt the .mjs naming convention.</p>

<h3 id="toc_12">10.3.6 Dynamic Imports with import()</h3>

<p>Weâ€™ve seen that the ES6 import and export directives are completely static and enable JavaScript interpreters and other JavaScript tools to determine the relationships between modules with simple text analysis while the modules are being loaded without having to actually execute any of the code in the modules. With statically imported modules, you are guaranteed that the values you import into a module will be ready for use before any of the code in your module begins to run.</p>

<p>On the web, code has to be transferred over a network instead of being read from the filesystem. And once transfered, that code is often executed on mobile devices with relatively slow CPUs. This is not the kind of environment where static module importsâ€”which require an entire program to be loaded before any of it runsâ€”make a lot of sense.</p>

<p>It is common for web applications to initially load only enough of their code to render the first page displayed to the user. Then, once the user has some preliminary content to interact with, they can begin to load the often much larger amount of code needed for the rest of the web app. Web browsers make it easy to dynamically load code by using the DOM API to inject a new <code>&lt;script&gt;</code> tag into the current HTML document, and web apps have been doing this for many years.</p>

<p>Although dynamic loading has been possible for a long time, it has not been part of the language itself. That changes with the introduction of import() in ES2020 (as of early 2020, dynamic import is supported by all browsers that support ES6 modules). You pass a module specifier to import() and it returns a Promise object that represents the asynchronous process of loading and running the specified module. When the dynamic import is complete, the Promise is â€œfulfilledâ€ (see Chapter 13 for complete details on asynchronous programming and Promises) and produces an object like the one you would get with the import * as form of the static import statement.</p>

<p>So instead of importing the â€œ./stats.jsâ€ module statically, like this:</p>

<pre><code class="language-javascript">import * as stats from &quot;./stats.js&quot;;
we might import it and use it dynamically, like this:

import(&quot;./stats.js&quot;).then(stats =&gt; {
    let average = stats.mean(data);
})
</code></pre>

<p>Or, in an async function (again, you may need to read Chapter 13 before youâ€™ll understand this code), we can simplify the code with await:</p>

<pre><code class="language-javascript">async analyzeData(data) {
    let stats = await import(&quot;./stats.js&quot;);
    return {
        average: stats.mean(data),
        stddev: stats.stddev(data)
    };
}
</code></pre>

<p>The argument to import() should be a module specifier, exactly like one youâ€™d use with a static import directive. But with import(), you are not constrained to use a constant string literal: any expression that evaluates to a string in the proper form will do.</p>

<p>Dynamic import() looks like a function invocation, but it actually is not. Instead, import() is an operator and the parentheses are a required part of the operator syntax. The reason for this unusual bit of syntax is that import() needs to be able to resolve module specifiers as URLs relative to the currently running module, and this requires a bit of implementation magic that would not be legal to put in a JavaScript function. The function versus operator distinction rarely makes a difference in practice, but youâ€™ll notice it if you try writing code like console.log(import); or let require = import;.</p>

<p>Finally, note that dynamic import() is not just for web browsers. Code-packaging tools like webpack can also make good use of it. The most straightforward way to use a code bundler is to tell it the main entry point for your program and let it find all the static import directives and assemble everything into one large file. By strategically using dynamic import() calls, however, you can break that one monolithic bundle up into a set of smaller bundles that can be loaded on demand.</p>

<h3 id="toc_13">10.3.7 import.meta.url</h3>

<p>There is one final feature of the ES6 module system to discuss. Within an ES6 module (but not within a regular <code>&lt;script&gt;</code>or a Node module loaded with require()), the special syntax import.meta refers to an object that contains metadata about the currently executing module. The url property of this object is the URL from which the module was loaded. (In Node, this will be a file:// URL.)</p>

<p>The primary use case of import.meta.url is to be able to refer to images, data files, or other resources that are stored in the same directory as (or relative to) the module. The URL() constructor makes it easy to resolve a relative URL against an absolute URL like import.meta.url. Suppose, for example, that you have written a module that includes strings that need to be localized and that the localization files are stored in an l10n/ directory, which is in the same directory as the module itself. Your module could load its strings using a URL created with a function, like this:</p>

<pre><code class="language-javascript">function localStringsURL(locale) {
    return new URL(`l10n/${locale}.json`, import.meta.url);
}
</code></pre>

<h2 id="toc_14">10.4 Summary</h2>

<p>The goal of modularity is to allow programmers to hide the implementation details of their code so that chunks of code from various sources can be assembled into large programs without worrying that one chunk will overwrite functions or variables of another. This chapter has explained three different JavaScript module systems:</p>

<ul>
<li>In the early days of JavaScript, modularity could only be achieved through the clever use of immediately invoked function expressions.</li>
<li>Node added its own module system on top of the JavaScript language. Node modules are imported with require() and define their exports by setting properties of the Exports object, or by setting the module.exports property.</li>
<li>In ES6, JavaScript finally got its own module system with import and export keywords, and ES2020 is adding support for dynamic imports with import().</li>
</ul>

<hr/>

<ol>
<li>For example: web apps that have frequent incremental updates and users who make frequent return visits may find that using small modules instead of large bundles can result in better average load times because of better utilization of the userâ€™s browser cache.</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¬¬ 12 ç«  è¿­ä»£å™¨å’Œç”Ÿæˆå™¨]]></title>
    <link href="2019919.xyz/16135261093456.html"/>
    <updated>2021-02-17T09:41:49+08:00</updated>
    <id>2019919.xyz/16135261093456.html</id>
    <content type="html"><![CDATA[
<ul>
<li>
<a href="#toc_0">12.1 è¿­ä»£å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„</a>
</li>
<li>
<a href="#toc_1">12.2 å¯è¿­ä»£å¯¹è±¡çš„å®ç°</a>
<ul>
<li>
<a href="#toc_2">12.2.1 å…³é—­è¿­ä»£å™¨ï¼šReturn æ–¹æ³•</a>
</li>
</ul>
</li>
<li>
<a href="#toc_3">12.3 ç”Ÿæˆå™¨</a>
<ul>
<li>
<a href="#toc_4">12.3.1 ç”Ÿæˆå™¨ç¤ºä¾‹</a>
</li>
<li>
<a href="#toc_5">12.3.2 yield* å’Œé€’å½’ç”Ÿæˆå™¨</a>
</li>
</ul>
</li>
<li>
<a href="#toc_6">12.4 é«˜çº§ç”Ÿæˆå™¨ç‰¹æ€§</a>
<ul>
<li>
<a href="#toc_7">12.4.1 ç”Ÿæˆå™¨å‡½æ•°çš„è¿”å›å€¼</a>
</li>
<li>
<a href="#toc_8">12.4.2 yield è¡¨è¾¾å¼çš„å€¼</a>
</li>
<li>
<a href="#toc_9">12.4.3 ç”Ÿæˆå™¨çš„ return() å’Œ throw() æ–¹æ³•</a>
</li>
<li>
<a href="#toc_10">12.4.4 å…³äºç”Ÿæˆå™¨çš„æœ€åä¸€ä¸ªæ³¨æ„ç‚¹</a>
</li>
</ul>
</li>
<li>
<a href="#toc_11">12.5 æ€»ç»“</a>
</li>
</ul>


<p>å¯è¿­ä»£å¯¹è±¡åŠå…¶å…³è”çš„è¿­ä»£å™¨æ˜¯ ES6 çš„ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨æœ¬ä¹¦ä¸­æˆ‘ä»¬å·²ç»å¤šæ¬¡çœ‹åˆ°ã€‚æ•°ç»„ï¼ˆåŒ…æ‹¬ typedarrayï¼‰æ˜¯å¯è¿­ä»£çš„ï¼Œå­—ç¬¦ä¸²ã€Set å’Œ Map å¯¹è±¡ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™æ„å‘³ç€è¿™äº›æ•°æ®ç»“æ„çš„å†…å®¹å¯ä»¥è¢« for/of å¾ªç¯éå†ï¼Œå°±åƒæˆ‘ä»¬åœ¨ Â§5.4.4 ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼š</p>

<pre><code class="language-javascript">let sum = 0;
for(let i of [1,2,3]) { // Loop once for each of these values
    sum += i;
}
sum   // =&gt; 6
</code></pre>

<p>è¿­ä»£å™¨è¿˜å¯ä»¥ç”¨ ... è¿ç®—ç¬¦å°†å¯è¿­ä»£å¯¹è±¡å±•å¼€æˆ–â€œæ‰©å±•â€åˆ°æ•°ç»„åˆå§‹åŒ–æˆ–å‡½æ•°è°ƒç”¨ä¸­ï¼Œå¦‚ Â§7.1.2 æ‰€ç¤ºï¼š</p>

<pre><code class="language-javascript">let chars = [...&quot;abcd&quot;]; // chars == [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]
let data = [1, 2, 3, 4, 5];
Math.max(...data)        // =&gt; 5
</code></pre>

<p>è¿­ä»£å™¨å¯ä»¥ä¸ææ„èµ‹å€¼ä¸€èµ·ä½¿ç”¨ï¼š</p>

<pre><code class="language-javascript">let purpleHaze = Uint8Array.of(255, 0, 255, 128);
let [r, g, b, a] = purpleHaze; // a == 128
</code></pre>

<p>å½“ä½ è¿­ä»£ä¸€ä¸ª Map å¯¹è±¡æ—¶ï¼Œè¿”å›çš„å€¼æ˜¯ [key, value] å¯¹ï¼Œè¿™åœ¨ for/of å¾ªç¯çš„è§£æ„èµ‹å€¼ä¸­å¾ˆå¥½ç”¨ï¼š</p>

<pre><code class="language-javascript">let m = new Map([[&quot;one&quot;, 1], [&quot;two&quot;, 2]]);
for(let [k,v] of m) console.log(k, v); // Logs &#39;one 1&#39; and &#39;two 2&#39;
</code></pre>

<p>å¦‚æœåªè¿­ä»£é”®æˆ–åªè¿­ä»£å€¼è€Œä¸æ˜¯ä¸€å¯¹ï¼Œå¯ä»¥ä½¿ç”¨ keys() å’Œ values() æ–¹æ³•:</p>

<pre><code class="language-javascript">[...m]            // =&gt; [[&quot;one&quot;, 1], [&quot;two&quot;, 2]]: default iteration
[...m.entries()]  // =&gt; [[&quot;one&quot;, 1], [&quot;two&quot;, 2]]: entries() method is the same
[...m.keys()]     // =&gt; [&quot;one&quot;, &quot;two&quot;]: keys() method iterates just map keys
[...m.values()]   // =&gt; [1, 2]: values() method iterates just map values
</code></pre>

<p>æœ€åï¼Œé€šå¸¸ç”¨äºæ•°ç»„å¯¹è±¡çš„è®¸å¤šå†…ç½®å‡½æ•°å’Œæ„é€ å‡½æ•°å®é™…ä¸Šè¢«ç¼–å†™ï¼ˆåœ¨ES6åŠä»¥åç‰ˆæœ¬ä¸­ï¼‰ä¸ºæ¥å—ä»»æ„å®å‚çš„è¿­ä»£å™¨ã€‚Set() æ„é€ å‡½æ•°å°±æ˜¯è¿™æ ·ä¸€ç§APIï¼š</p>

<pre><code class="language-javascript">// Strings are iterable, so the two sets are the same:
new Set(&quot;abc&quot;) // =&gt; new Set([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;])
</code></pre>

<p>æœ¬ç« è¯´æ˜äº†è¿­ä»£å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå¹¶æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºè‡ªå·±çš„å¯è¿­ä»£çš„æ•°æ®ç»“æ„ã€‚åœ¨è¯´æ˜äº†åŸºæœ¬çš„è¿­ä»£å™¨ä¹‹åï¼Œæœ¬ç« å°†ä»‹ç»ç”Ÿæˆå™¨ï¼Œè¿™æ˜¯ ES6 çš„ä¸€ä¸ªå¼ºå¤§çš„æ–°ç‰¹æ€§ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹åˆ«ç®€å•çš„æ–¹æ³•åˆ›å»ºè¿­ä»£å™¨ã€‚</p>

<h2 id="toc_0">12.1 è¿­ä»£å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„</h2>

<p>for/of å¾ªç¯å’Œå±•å¼€è¿ç®—ç¬¦å¯ä¸å¯è¿­ä»£å¯¹è±¡æ— ç¼é…åˆï¼Œä½†æ˜¯å€¼å¾—äº†è§£ä½¿è¿­ä»£å·¥ä½œçš„å®é™…æƒ…å†µã€‚éœ€è¦äº†è§£ä¸‰ç§ç‹¬ç«‹çš„ç±»å‹æ‰èƒ½ç†è§£ JavaScript ä¸­çš„è¿­ä»£ã€‚é¦–å…ˆï¼Œå¯è¿­ä»£çš„å¯¹è±¡ï¼šå¯ä»¥è¿­ä»£çš„æ˜¯è¯¸å¦‚ Arrayï¼ŒSet å’Œ Map ä¹‹ç±»çš„ç±»å‹ã€‚å…¶æ¬¡ï¼Œè¿­ä»£å™¨å¯¹è±¡æœ¬èº«ï¼Œå®ƒæ‰§è¡Œè¿­ä»£ã€‚ç¬¬ä¸‰ï¼Œä¸€ä¸ªè¿­ä»£ç»“æœå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¿å­˜è¿­ä»£çš„æ¯ä¸ªæ­¥éª¤çš„ç»“æœã€‚</p>

<p>ä»»ä½•å¯¹è±¡å…·æœ‰ç‰¹æ®Šè¿­ä»£å™¨æ–¹æ³•ï¼Œå¹¶ä¸”è¯¥æ–¹æ³•è¿”å›è¿­ä»£å™¨å¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡ä¸ºå¯è¿­ä»£å¯¹è±¡ã€‚è¿­ä»£å™¨å¯¹è±¡å…·æœ‰ next() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›è¿­ä»£ç»“æœå¯¹è±¡ã€‚è¿­ä»£ç»“æœå¯¹è±¡æ˜¯å…·æœ‰åä¸º value å’Œ done çš„å±æ€§çš„å¯¹è±¡ã€‚è¦è¿­ä»£ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ï¼Œé¦–å…ˆè¦è°ƒç”¨å…¶è¿­ä»£å™¨æ–¹æ³•ä»¥è·å–ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ã€‚ç„¶åï¼Œé‡å¤è°ƒç”¨è¿­ä»£å™¨å¯¹è±¡çš„ next() æ–¹æ³•ï¼Œç›´åˆ°è¿”å›çš„å€¼çš„ done å±æ€§è®¾ç½®ä¸º trueã€‚æ£˜æ‰‹çš„äº‹æƒ…æ˜¯ï¼Œå¯è¿­ä»£å¯¹è±¡çš„è¿­ä»£å™¨æ–¹æ³•æ²¡æœ‰å¸¸è§„åç§°ï¼Œè€Œæ˜¯ä½¿ç”¨ Symbol Symbol.iterator ä½œä¸ºå…¶åç§°ã€‚å› æ­¤ï¼Œä¹Ÿå¯ä»¥ç”¨å¾ˆå¤æ‚çš„æ–¹å¼ç¼–å†™å¯è¿­ä»£å¯¹è±¡çš„ç®€å• for/of å¾ªç¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="language-javascript">let iterable = [99];
let iterator = iterable[Symbol.iterator]();
for(let result = iterator.next(); !result.done; result = iterator.next()) {
    console.log(result.value)  // result.value == 99
}
</code></pre>

<p>å†…ç½®å¯è¿­ä»£æ•°æ®ç±»å‹çš„è¿­ä»£å™¨å¯¹è±¡æœ¬èº«æ˜¯å¯è¿­ä»£çš„ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå…·æœ‰ä¸€ä¸ªåä¸º Symbol.iterator çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè‡ªè¡Œè¿”å›ã€‚ï¼‰å½“è¦é€šè¿‡â€œéƒ¨åˆ†ä½¿ç”¨â€çš„è¿­ä»£å™¨è¿›è¡Œè¿­ä»£æ—¶ï¼Œä»¥ä¸‹ä»£ç ä¸­æœ‰æ—¶ä¼šå¾ˆæœ‰ç”¨ï¼š</p>

<pre><code class="language-javascript">let list = [1,2,3,4,5];
let iter = list[Symbol.iterator]();
let head = iter.next().value;  // head == 1
let tail = [...iter];          // tail == [2,3,4,5]
</code></pre>

<h2 id="toc_1">12.2 å¯è¿­ä»£å¯¹è±¡çš„å®ç°</h2>

<p>å¯è¿­ä»£å¯¹è±¡åœ¨ ES6 ä¸­éå¸¸æœ‰ç”¨ï¼Œåº”è¯¥è€ƒè™‘ä½¿è‡ªå·±çš„æ•°æ®ç±»å‹åœ¨å¯ä»¥è¡¨ç¤ºè¿­ä»£çš„ä»»ä½•æ—¶å€™éƒ½å¯è¿­ä»£ã€‚ç¬¬ 9 ç« ç¤ºä¾‹ 9-2 å’Œ 9-3 ä¸­æ˜¾ç¤ºçš„ Range ç±»æ˜¯å¯è¿­ä»£çš„ã€‚è¿™äº›ç±»ä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°ä½¿å…¶å¯è¿­ä»£ã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç« ç¨åä»‹ç»ç”Ÿæˆå™¨ï¼Œä½†é¦–å…ˆï¼Œæˆ‘ä»¬å°†å†æ¬¡å®ç° Range ç±»ï¼Œä½¿å…¶æ— éœ€ä¾èµ–ç”Ÿæˆå™¨å³å¯è¿­ä»£ã€‚</p>

<p>ä¸ºäº†ä½¿ç±»å¯è¿­ä»£ï¼Œå¿…é¡»å®ç°ä¸€ä¸ªåç§°ä¸º Symbol Symbol.iterator çš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå…·æœ‰ next() æ–¹æ³•çš„è¿­ä»£å™¨å¯¹è±¡ã€‚å¹¶ä¸” next() æ–¹æ³•å¿…é¡»è¿”å›å…·æœ‰ value å±æ€§å’Œæˆ–æˆ–å¸ƒå°”å‹ done å±æ€§çš„è¿­ä»£ç»“æœå¯¹è±¡ã€‚ç¤ºä¾‹ 12-1 å®ç°äº†ä¸€ä¸ªå¯è¿­ä»£çš„ Range ç±»ï¼Œå¹¶æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»ºå¯è¿­ä»£çš„ã€è¿­ä»£å™¨å’Œè¿­ä»£ç»“æœå¯¹è±¡ã€‚</p>

<p>ç¤ºä¾‹ 12-1 ä¸€ä¸ªå¯è¿­ä»£æ•°å€¼èŒƒå›´ç±»</p>

<pre><code class="language-javascript">/*
 * A Range object represents a range of numbers {x: from &lt;= x &lt;= to}
 * Range defines a has() method for testing whether a given number is a member
 * of the range. Range is iterable and iterates all integers within the range.
 */
class Range {
    constructor (from, to) {
        this.from = from;
        this.to = to;
    }

    // Make a Range act like a Set of numbers
    has(x) { return typeof x === &quot;number&quot; &amp;&amp; this.from &lt;= x &amp;&amp; x &lt;= this.to; }

    // Return string representation of the range using set notation
    toString() { return `{ x | ${this.from} â‰¤ x â‰¤ ${this.to} }`; }

    // Make a Range iterable by returning an iterator object.
    // Note that the name of this method is a special symbol, not a string.
    [Symbol.iterator]() {
        // Each iterator instance must iterate the range independently of
        // others. So we need a state variable to track our location in the
        // iteration. We start at the first integer &gt;= from.
        let next = Math.ceil(this.from);  // This is the next value we return
        let last = this.to;               // We won&#39;t return anything &gt; this
        return {                          // This is the iterator object
            // This next() method is what makes this an iterator object.
            // It must return an iterator result object.
            next() {
                return (next &lt;= last)   // If we haven&#39;t returned last value yet
                    ? { value: next++ } // return next value and increment it
                    : { done: true };   // otherwise indicate that we&#39;re done.
            },

            // As a convenience, we make the iterator itself iterable.
            [Symbol.iterator]() { return this; }
        };
    }
}

for(let x of new Range(1,10)) console.log(x); // Logs numbers 1 to 10
[...new Range(-2,2)]                          // =&gt; [-2, -1, 0, 1, 2]
</code></pre>

<p>é™¤äº†ä½¿ç±»å¯è¿­ä»£å¤–ï¼Œå®šä¹‰è¿”å›å¯è¿­ä»£å€¼çš„å‡½æ•°ä¹Ÿéå¸¸æœ‰ç”¨ã€‚è€ƒè™‘ JavaScript æ•°ç»„çš„ map() å’Œ filter() æ–¹æ³•çš„è¿™äº›åŸºäºè¿­ä»£çš„æ›¿ä»£æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">// Return an iterable object that iterates the result of applying f()
// to each value from the source iterable
function map(iterable, f) {
    let iterator = iterable[Symbol.iterator]();
    return {     // This object is both iterator and iterable
        [Symbol.iterator]() { return this; },
        next() {
            let v = iterator.next();
            if (v.done) {
                return v;
            } else {
                return { value: f(v.value) };
            }
        }
    };
}

// Map a range of integers to their squares and convert to an array
[...map(new Range(1,4), x =&gt; x*x)]  // =&gt; [1, 4, 9, 16]

// Return an iterable object that filters the specified iterable,
// iterating only those elements for which the predicate returns true
function filter(iterable, predicate) {
    let iterator = iterable[Symbol.iterator]();
    return { // This object is both iterator and iterable
        [Symbol.iterator]() { return this; },
        next() {
            for(;;) {
                let v = iterator.next();
                if (v.done || predicate(v.value)) {
                    return v;
                }
            }
        }
    };
}

// Filter a range so we&#39;re left with only even numbers
[...filter(new Range(1,10), x =&gt; x % 2 === 0)]  // =&gt; [2,4,6,8,10]
</code></pre>

<p>å¯è¿­ä»£å¯¹è±¡å’Œè¿­ä»£å™¨çš„ä¸€ä¸ªå…³é”®ç‰¹æ€§æ˜¯å®ƒä»¬å›ºæœ‰çš„æƒ°æ€§ï¼šå½“éœ€è¦è®¡ç®—æ‰èƒ½è®¡ç®—ä¸‹ä¸€ä¸ªå€¼æ—¶ï¼Œå¯ä»¥å°†è®¡ç®—æ¨è¿Ÿåˆ°å®é™…éœ€è¦è¯¥å€¼æ—¶è¿›è¡Œã€‚ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªå¾ˆé•¿çš„æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œæƒ³å°†å…¶æ ‡è®°ä¸ºä»¥ç©ºæ ¼åˆ†éš”çš„å•è¯ã€‚å¯ä»¥ç®€å•åœ°ä½¿ç”¨å­—ç¬¦ä¸²çš„ split() æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœè¿™æ ·åšï¼Œåˆ™å¿…é¡»å…ˆå¤„ç†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰èƒ½ä½¿ç”¨ç¬¬ä¸€ä¸ªå•è¯ã€‚æœ€åï¼Œå°†ä¸ºè¿”å›çš„æ•°ç»„åŠå…¶ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²åˆ†é…å¤§é‡å†…å­˜ã€‚è¿™æ˜¯ä¸€ä¸ªå…è®¸æ‡’æƒ°åœ°è¿­ä»£å­—ç¬¦ä¸²çš„ç¥–æ¯è€Œæ— éœ€ä¸€æ¬¡å°†æ‰€æœ‰å•è¯éƒ½ä¿ç•™åœ¨å†…å­˜ä¸­çš„å‡½æ•°ï¼ˆåœ¨ ES2020 ä¸­ï¼Œä½¿ç”¨ Â§11.3.2 ä¸­æè¿°çš„è¿­ä»£å™¨è¿”å› matchAll() æ–¹æ³•å¯ä»¥æ›´è½»æ¾åœ°å®ç°æ­¤å‡½æ•°ã€‚ï¼‰ï¼š</p>

<pre><code class="language-javascript">function words(s) {
    var r = /\s+|$/g;                     // Match one or more spaces or end
    r.lastIndex = s.match(/[^ ]/).index;  // Start matching at first nonspace
    return {                              // Return an iterable iterator object
        [Symbol.iterator]() {             // This makes us iterable
            return this;
        },
        next() {                          // This makes us an iterator
            let start = r.lastIndex;      // Resume where the last match ended
            if (start &lt; s.length) {       // If we&#39;re not done
                let match = r.exec(s);    // Match the next word boundary
                if (match) {              // If we found one, return the word
                    return { value: s.substring(start, match.index) };
                }
            }
            return { done: true };        // Otherwise, say that we&#39;re done
        }
    };
}

[...words(&quot; abc def  ghi! &quot;)] // =&gt; [&quot;abc&quot;, &quot;def&quot;, &quot;ghi!&quot;]
</code></pre>

<h3 id="toc_2">12.2.1 å…³é—­è¿­ä»£å™¨ï¼šReturn æ–¹æ³•</h3>

<p>æƒ³è±¡ä¸€ä¸‹ words() è¿­ä»£å™¨çš„ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰JavaScript å˜ä½“ï¼Œå®ƒä¸ç”¨æºå­—ç¬¦ä¸²ä½œä¸ºå®å‚ï¼Œè€Œæ˜¯ä½¿ç”¨æ–‡ä»¶åï¼Œæ‰“å¼€æ–‡ä»¶ï¼Œä»æ–‡ä»¶ä¸­è¯»å–è¡Œï¼Œç„¶åä»è¿™äº›è¡Œä¸­è¿­ä»£å•è¯ã€‚åœ¨å¤§å¤šæ•°æ“ä½œç³»ç»Ÿä¸­ï¼Œæ‰“å¼€æ–‡ä»¶ä»¥ä»å…¶ä¸­è¯»å–æ–‡ä»¶çš„ç¨‹åºéœ€è¦è®°ä½åœ¨å®Œæˆè¯»å–åå…³é—­è¿™äº›æ–‡ä»¶ï¼Œå› æ­¤ï¼Œè¿™ä¸ªå‡è®¾çš„è¿­ä»£å™¨å°†ç¡®ä¿åœ¨ next() æ–¹æ³•è¿”å›æ–‡ä»¶ä¸­çš„æœ€åä¸€ä¸ªå­—ä¹‹åå…³é—­æ–‡ä»¶ã€‚</p>

<p>ä½†æ˜¯è¿­ä»£å™¨å¹¶ä¸æ€»æ˜¯ä¸€ç›´è¿è¡Œåˆ°æœ€åï¼šfor/of å¾ªç¯å¯èƒ½ä¼šå› ä¸­æ–­æˆ–è¿”å›æˆ–å¼‚å¸¸è€Œç»ˆæ­¢ã€‚åŒæ ·ï¼Œå½“è¿­ä»£å™¨ç”¨äºè§£æ„èµ‹å€¼æ—¶ï¼Œä»…è°ƒç”¨ next() æ–¹æ³•è¶³å¤Ÿå¤šæ¬¡ï¼Œä»¥è·å–æ¯ä¸ªæŒ‡å®šå˜é‡çš„å€¼ã€‚è¿­ä»£å™¨å¯èƒ½æœ‰æ›´å¤šå¯èƒ½è¿”å›çš„å€¼ï¼Œä½†æ˜¯å®ƒä»¬æ°¸è¿œä¸ä¼šè¢«è¯·æ±‚ã€‚</p>

<p>å¦‚æœæˆ‘ä»¬å‡è®¾çš„æ–‡ä»¶ä¸­å•è¯è¿­ä»£å™¨ä»æœªä¸€ç›´è¿è¡Œåˆ°æœ€åï¼Œå®ƒä»ç„¶éœ€è¦å…³é—­å®ƒæ‰“å¼€çš„æ–‡ä»¶ã€‚å› æ­¤ï¼Œè¿­ä»£å™¨å¯¹è±¡å¯ä»¥å®ç° return() æ–¹æ³•ä¸ next() æ–¹æ³•ä¸€èµ·ä½¿ç”¨ã€‚å¦‚æœè¿­ä»£åœ¨ next() è¿”å›å®Œäº†å±æ€§è®¾ç½®ä¸º true çš„è¿­ä»£ç»“æœä¹‹å‰åœæ­¢ï¼ˆé€šå¸¸æ˜¯å› ä¸ºé€šè¿‡ break è¯­å¥æå‰ç¦»å¼€äº† for/of å¾ªç¯ï¼‰ï¼Œåˆ™è§£é‡Šå™¨å°†æ£€æŸ¥è¿­ä»£å™¨å¯¹è±¡æ˜¯å¦å…·æœ‰ return() æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨æ­¤æ–¹æ³•ï¼Œåˆ™è§£é‡Šå™¨å°†ä¸å¸¦ä»»ä½•å‚æ•°è°ƒç”¨å®ƒï¼Œä»è€Œä½¿è¿­ä»£å™¨æœ‰æœºä¼šå…³é—­æ–‡ä»¶ï¼Œé‡Šæ”¾å†…å­˜ä»¥åŠè‡ªè¡Œæ¸…ç†ã€‚return() æ–¹æ³•å¿…é¡»è¿”å›è¿­ä»£å™¨ç»“æœå¯¹è±¡ã€‚å¯¹è±¡çš„å±æ€§è¢«å¿½ç•¥ï¼Œä½†æ˜¯è¿”å›éå¯¹è±¡å€¼æ˜¯é”™è¯¯çš„ã€‚</p>

<p>for/of å¾ªç¯å’Œå±•å¼€è¿ç®—ç¬¦æ˜¯ JavaScript çœŸæ­£å®ç”¨åŠŸèƒ½ï¼Œå› æ­¤åœ¨åˆ›å»º API æ—¶ï¼Œæœ€å¥½åœ¨å°½å¯èƒ½çš„ä½¿ç”¨å®ƒä»¬ã€‚ä½†æ˜¯å¿…é¡»ä½¿ç”¨ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ï¼Œå…¶è¿­ä»£å™¨å¯¹è±¡ä»¥åŠè¿­ä»£å™¨çš„ç»“æœå¯¹è±¡ï¼Œè¿™ä¼šä½¿è¿‡ç¨‹å˜å¾—æœ‰äº›å¤æ‚ã€‚å¹¸è¿çš„æ˜¯ï¼Œç”Ÿæˆå™¨å¯ä»¥æå¤§åœ°ç®€åŒ–è‡ªå®šä¹‰è¿­ä»£å™¨çš„åˆ›å»ºï¼Œè¿™å°†åœ¨æœ¬ç« çš„å…¶ä½™éƒ¨åˆ†ä¸­çœ‹åˆ°ã€‚</p>

<h2 id="toc_3">12.3 ç”Ÿæˆå™¨</h2>

<p>ç”Ÿæˆå™¨æ˜¯ä¸€ç§ä½¿ç”¨å¼ºå¤§çš„æ–° ES6 è¯­æ³•å®šä¹‰çš„è¿­ä»£å™¨ï¼›å½“è¦è¿­ä»£çš„å€¼ä¸æ˜¯æ•°æ®ç»“æ„çš„å…ƒç´ è€Œæ˜¯è®¡ç®—ç»“æœæ—¶ï¼Œæ­¤åŠŸèƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚</p>

<p>è¦åˆ›å»ºç”Ÿæˆå™¨ï¼Œå¿…é¡»é¦–å…ˆå®šä¹‰ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨è¯­æ³•ä¸Šç±»ä¼¼äºå¸¸è§„ JavaScript å‡½æ•°ï¼Œä½†ä½¿ç”¨å…³é”®å­— function* è€Œä¸æ˜¯ function å®šä¹‰ã€‚ï¼ˆä»æŠ€æœ¯ä¸Šè®²ï¼Œè¿™ä¸æ˜¯æ–°å…³é”®å­—ï¼Œåªæ˜¯å…³é”®å­— function ä¹‹åå’Œå‡½æ•°åç§°ä¹‹å‰çš„ *ã€‚ï¼‰è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°æ—¶ï¼Œå®ƒå®é™…ä¸Šå¹¶ä¸æ‰§è¡Œå‡½æ•°ä¸»ä½“ï¼Œè€Œæ˜¯è¿”å›ç”Ÿæˆå™¨å¯¹è±¡ã€‚è¯¥ç”Ÿæˆå™¨å¯¹è±¡æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚è°ƒç”¨å…¶ next() æ–¹æ³•ä¼šä½¿ç”Ÿæˆå™¨å‡½æ•°çš„ä¸»ä½“ä»å¤´å¼€å§‹è¿è¡Œï¼ˆæˆ–æ— è®ºå…¶å½“å‰ä½ç½®æ˜¯ä»€ä¹ˆï¼‰ï¼Œç›´åˆ°åˆ°è¾¾ yield è¯­å¥ä¸ºæ­¢ã€‚yield æ˜¯ ES6 æ–°ç‰¹æ€§ï¼Œç±»ä¼¼äº return è¯­å¥ã€‚yield è¯­å¥çš„å€¼æˆä¸ºè¿­ä»£å™¨ä¸Š next() è°ƒç”¨è¿”å›çš„å€¼ã€‚ä¸€ä¸ªç¤ºä¾‹ä½¿è¿™æ›´åŠ æ¸…æ¥šï¼š</p>

<pre><code class="language-javascript">// A generator function that yields the set of one digit (base-10) primes.
function* oneDigitPrimes() { // Invoking this function does not run the code
    yield 2;                 // but just returns a generator object. Calling
    yield 3;                 // the next() method of that generator runs
    yield 5;                 // the code until a yield statement provides
    yield 7;                 // the return value for the next() method.
}

// When we invoke the generator function, we get a generator
let primes = oneDigitPrimes();

// A generator is an iterator object that iterates the yielded values
primes.next().value          // =&gt; 2
primes.next().value          // =&gt; 3
primes.next().value          // =&gt; 5
primes.next().value          // =&gt; 7
primes.next().done           // =&gt; true

// Generators have a Symbol.iterator method to make them iterable
primes[Symbol.iterator]()    // =&gt; primes

// We can use generators like other iterable types
[...oneDigitPrimes()]        // =&gt; [2,3,5,7]
let sum = 0;
for(let prime of oneDigitPrimes()) sum += prime;
sum                          // =&gt; 17
</code></pre>

<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ function* è¯­å¥å®šä¹‰äº†ç”Ÿæˆå™¨ã€‚ä½†æ˜¯ï¼Œåƒå¸¸è§„å‡½æ•°ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ from è¡¨è¾¾å¼ä¸­å®šä¹‰ç”Ÿæˆå™¨ã€‚å†ä¸€æ¬¡ï¼Œæˆ‘ä»¬åªåœ¨ function å…³é”®å­—ä¹‹ååŠ ä¸Šä¸€ä¸ªæ˜Ÿå·ï¼š</p>

<pre><code class="language-javascript">const seq = function*(from,to) {
    for(let i = from; i &lt;= to; i++) yield i;
};
[...seq(3,5)]  // =&gt; [3, 4, 5]
</code></pre>

<p>åœ¨ç±»å’Œå¯¹è±¡æ–‡å­—ä¸­ï¼Œæˆ‘ä»¬åœ¨å®šä¹‰æ–¹æ³•æ—¶å¯ä»¥ä½¿ç”¨é€Ÿè®°æ ‡è®°æ¥å®Œå…¨çœç•¥ function å…³é”®å­—ã€‚è¦åœ¨è¿™ç§æƒ…å†µä¸‹å®šä¹‰ç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬åªéœ€åœ¨æ–¹æ³•åç§°ä¹‹å‰ä½¿ç”¨æ˜Ÿå·å³å¯ï¼š</p>

<pre><code class="language-javascript">let o = {
    x: 1, y: 2, z: 3,
    // A generator that yields each of the keys of this object
    *g() {
        for(let key of Object.keys(this)) {
            yield key;
        }
    }
};
[...o.g()] // =&gt; [&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;g&quot;]
</code></pre>

<p>è¯·æ³¨æ„ï¼Œæ— æ³•ä½¿ç”¨ç®­å¤´å‡½æ•°è¯­æ³•ç¼–å†™ç”Ÿæˆå™¨å‡½æ•°ã€‚</p>

<p>ç”Ÿæˆå™¨é€šå¸¸ä½¿å®šä¹‰å¯è¿­ä»£ç±»ç‰¹åˆ«å®¹æ˜“ã€‚æˆ‘ä»¬å¯ä»¥ç”¨æ›´çŸ­çš„ <code>*[Symbol.iterator];()</code> ç”Ÿæˆå™¨å‡½æ•°ä»£æ›¿ç¤ºä¾‹ 12-1 ä¸­çš„ <code>[Symbol.iterator]()</code> æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="language-javascript">*[Symbol.iterator]() {
    for(let x = Math.ceil(this.from); x &lt;= this.to; x++) yield x;
}
</code></pre>

<p>è¯·å‚é˜…ç¬¬ 9 ç« ä¸­çš„ç¤ºä¾‹ 9-3ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ä¸Šä¸‹æ–‡ä¸­çœ‹åˆ°æ­¤åŸºäºç”Ÿæˆå™¨çš„è¿­ä»£å™¨å‡½æ•°ã€‚ </p>

<h3 id="toc_4">12.3.1 ç”Ÿæˆå™¨ç¤ºä¾‹</h3>

<p>å¦‚æœç”Ÿæˆå™¨å®é™…ä¸Šé€šè¿‡æ‰§è¡ŒæŸç§è®¡ç®—æ¥ç”Ÿæˆå®ƒä»¬äº§ç”Ÿçš„å€¼ï¼Œåˆ™å®ƒä»¬ä¼šæ›´æœ‰è¶£ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæ˜¯ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°çš„ç”Ÿæˆå™¨å‡½æ•°ï¼š</p>

<pre><code class="language-javascript">function* fibonacciSequence() {
    let x = 0, y = 1;
    for(;;) {
        yield y;
        [x, y] = [y, x+y];  // Note: destructuring assignment
    }
}
</code></pre>

<p>è¯·æ³¨æ„ï¼Œæ­¤å¤„çš„ fibonacciSequence() ç”Ÿæˆå™¨å‡½æ•°å…·æœ‰æ— é™å¾ªç¯ï¼Œå¹¶ä¸”æ°¸ä¹…äº§ç”Ÿå€¼è€Œä¸ä¼šè¿”å›ã€‚å¦‚æœå°†æ­¤ç”Ÿæˆå™¨ä¸ ... å±•å¼€è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ï¼Œå®ƒå°†å¾ªç¯æ’­æ”¾ç›´åˆ°å†…å­˜è€—å°½ä¸”ç¨‹åºå´©æºƒã€‚å°å¿ƒåœ°åœ¨ for/of å¾ªç¯ä¸­ä½¿ç”¨å®ƒï¼š</p>

<pre><code class="language-javascript">// Return the nth Fibonacci number
function fibonacci(n) {
    for(let f of fibonacciSequence()) {
        if (n-- &lt;= 0) return f;
    }
}
fibonacci(20)   // =&gt; 10946
</code></pre>

<p>è¿™ç§æ— é™ç”Ÿæˆå™¨åœ¨ä½¿ç”¨ take() ç”Ÿæˆå™¨æ—¶å˜å¾—æ›´åŠ æœ‰ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="language-javascript">// Yield the first n elements of the specified iterable object
function* take(n, iterable) {
    let it = iterable[Symbol.iterator](); // Get iterator for iterable object
    while(n-- &gt; 0) {           // Loop n times:
        let next = it.next();  // Get the next item from the iterator.
        if (next.done) return; // If there are no more values, return early
        else yield next.value; // otherwise, yield the value
    }
}

// An array of the first 5 Fibonacci numbers
[...take(5, fibonacciSequence())]  // =&gt; [1, 1, 2, 3, 5]
</code></pre>

<p>è¿™æ˜¯å¦ä¸€ä¸ªæœ‰ç”¨çš„ç”Ÿæˆå™¨å‡½æ•°ï¼Œå®ƒäº¤é”™å¤šä¸ªå¯è¿­ä»£å¯¹è±¡çš„å…ƒç´ ï¼š</p>

<pre><code class="language-javascript">// Given an array of iterables, yield their elements in interleaved order.
function* zip(...iterables) {
    // Get an iterator for each iterable
    let iterators = iterables.map(i =&gt; i[Symbol.iterator]());
    let index = 0;
    while(iterators.length &gt; 0) {       // While there are still some iterators
        if (index &gt;= iterators.length) {    // If we reached the last iterator
            index = 0;                      // go back to the first one.
        }
        let item = iterators[index].next(); // Get next item from next iterator.
        if (item.done) {                    // If that iterator is done
            iterators.splice(index, 1);     // then remove it from the array.
        }
        else {                              // Otherwise,
            yield item.value;               // yield the iterated value
            index++;                        // and move on to the next iterator.
        }
    }
}

// Interleave three iterable objects
[...zip(oneDigitPrimes(),&quot;ab&quot;,[0])]     // =&gt; [2,&quot;a&quot;,0,3,&quot;b&quot;,5,7]
</code></pre>

<h3 id="toc_5">12.3.2 yield* å’Œé€’å½’ç”Ÿæˆå™¨</h3>

<p>é™¤äº†å‰é¢ç¤ºä¾‹ä¸­å®šä¹‰çš„ zip() ç”Ÿæˆå™¨ä¹‹å¤–ï¼Œå…·æœ‰ç±»ä¼¼çš„ç”Ÿæˆå™¨åŠŸèƒ½å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ï¼Œè¯¥åŠŸèƒ½å¯ä»¥æŒ‰é¡ºåºç”Ÿæˆå¤šä¸ªå¯è¿­ä»£å¯¹è±¡çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯äº¤ç»‡å®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·ç¼–å†™ç”Ÿæˆå™¨ï¼š</p>

<pre><code class="language-javascript">function* sequence(...iterables) {
    for(let iterable of iterables) {
        for(let item of iterable) {
            yield item;
        }
    }
}

[...sequence(&quot;abc&quot;,oneDigitPrimes())]  // =&gt; [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,2,3,5,7]
</code></pre>

<p>è¿™ç§ç”Ÿæˆå…¶ä»–å¯è¿­ä»£å¯¹è±¡çš„å…ƒç´ çš„è¿‡ç¨‹åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­å·²ç»è¶³å¤Ÿæ™®éï¼Œä»¥è‡³äºä¸ºå®ƒ ES6 å…·æœ‰ç‰¹æ®Šçš„è¯­æ³•ã€‚yield* å…³é”®å­—ç±»ä¼¼äº yieldï¼Œé™¤äº†å®ƒä¸äº§ç”Ÿå•ä¸ªå€¼ï¼Œè€Œæ˜¯è¿­ä»£ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡å¹¶äº§ç”Ÿæ¯ä¸ªç»“æœå€¼ã€‚æˆ‘ä»¬ä½¿ç”¨çš„ sequence() ç”Ÿæˆå™¨å‡½æ•°å¯ä»¥é€šè¿‡ yield* è¿›è¡Œç®€åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="language-javascript">function* sequence(...iterables) {
    for(let iterable of iterables) {
        yield* iterable;
    }
}

[...sequence(&quot;abc&quot;,oneDigitPrimes())]  // =&gt; [&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,2,3,5,7]
</code></pre>

<p>æ•°ç»„ forEach() æ–¹æ³•é€šå¸¸æ˜¯ä¸€ç§å¾ªç¯éå†æ•°ç»„å…ƒç´ çš„å¥½æ–¹æ³•ï¼Œå› æ­¤å¯èƒ½ä¼šå¾ˆæƒ³åƒè¿™æ ·ç¼–å†™ sequence() å‡½æ•°ï¼š</p>

<pre><code class="language-javascript">function* sequence(...iterables) {
    iterables.forEach(iterable =&gt; yield* iterable );  // Error
}
</code></pre>

<p>ä½†æ˜¯ï¼Œè¿™ä¸èµ·ä½œç”¨ã€‚yield å’Œ yield* åªèƒ½åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯æ­¤ä»£ç ä¸­çš„åµŒå¥—ç®­å¤´å‡½æ•°æ˜¯å¸¸è§„å‡½æ•°ï¼Œè€Œä¸æ˜¯ function* ç”Ÿæˆå™¨å‡½æ•°ï¼Œå› æ­¤ä¸å…è®¸ yieldã€‚</p>

<p>yield* å¯ç”¨äºä»»ä½•ç§ç±»çš„å¯è¿­ä»£å¯¹è±¡ï¼ŒåŒ…æ‹¬ä½¿ç”¨ç”Ÿæˆå™¨å®ç°çš„å¯è¿­ä»£å¯¹è±¡ã€‚è¿™æ„å‘³ç€ yield* å…è®¸æˆ‘ä»¬å®šä¹‰é€’å½’ç”Ÿæˆå™¨ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½åœ¨é€’å½’å®šä¹‰çš„æ ‘ç»“æ„ä¸Šè¿›è¡Œç®€å•çš„éé€’å½’è¿­ä»£ã€‚</p>

<h2 id="toc_6">12.4 é«˜çº§ç”Ÿæˆå™¨ç‰¹æ€§</h2>

<p>ç”Ÿæˆå™¨å‡½æ•°æœ€å¸¸è§çš„ç”¨é€”æ˜¯åˆ›å»ºè¿­ä»£å™¨ï¼Œä½†æ˜¯ç”Ÿæˆå™¨çš„åŸºæœ¬ç‰¹æ€§æ˜¯å®ƒä»¬å…è®¸æˆ‘ä»¬æš‚åœè®¡ç®—ï¼Œäº§ç”Ÿä¸­é—´ç»“æœï¼Œç„¶ååœ¨ä»¥åæ¢å¤è®¡ç®—ã€‚è¿™æ„å‘³ç€ç”Ÿæˆå™¨å…·æœ‰çš„åŠŸèƒ½è¶…å‡ºäº†è¿­ä»£å™¨çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†åœ¨ä»¥ä¸‹å„èŠ‚ä¸­æ¢è®¨è¿™äº›åŠŸèƒ½ã€‚</p>

<h3 id="toc_7">12.4.1 ç”Ÿæˆå™¨å‡½æ•°çš„è¿”å›å€¼</h3>

<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„ç”Ÿæˆå™¨å‡½æ•°è¿˜æ²¡æœ‰ return è¯­å¥ï¼Œæˆ–è€…ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œå®ƒä»¬åªæ˜¯è¢«ç”¨æ¥å¼•èµ·è¾ƒæ—©çš„è¿”å›ï¼Œè€Œä¸æ˜¯äº§ç”Ÿè¿”å›å€¼ã€‚ä½†æ˜¯ï¼Œåƒä»»ä½•å‡½æ•°ä¸€æ ·ï¼Œç”Ÿæˆå™¨å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªå€¼ã€‚ä¸ºäº†äº†è§£åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œè¯·å›å¿†ä¸€ä¸‹è¿­ä»£æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚next() å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå…·æœ‰ value å±æ€§å’Œæˆ–æˆ– done å±æ€§çš„å¯¹è±¡ã€‚å¯¹äºå…¸å‹çš„è¿­ä»£å™¨å’Œç”Ÿæˆå™¨ï¼Œå¦‚æœå®šä¹‰äº† value å±æ€§ï¼Œåˆ™ done å±æ€§æ˜¯ undefined æˆ–ä¸º falseã€‚å¦‚æœ done ä¸º trueï¼Œé‚£ä¹ˆå€¼å°±æ˜¯ undefinedã€‚ä½†æ˜¯ï¼Œå¦‚æœç”Ÿæˆå™¨è¿”å›ä¸€ä¸ªå€¼ï¼Œåˆ™å¯¹ next çš„æœ€ç»ˆè°ƒç”¨å°†è¿”å›ä¸€ä¸ªåŒæ—¶å…·æœ‰ value â€‹â€‹å’Œ done å®šä¹‰çš„å¯¹è±¡ã€‚ value å±æ€§ä¿å­˜ç”Ÿæˆå™¨å‡½æ•°çš„è¿”å›å€¼ï¼Œå¹¶ä¸” done å±æ€§ä¸º trueï¼Œè¡¨ç¤ºæ²¡æœ‰æ›´å¤šçš„å€¼å¯ä»¥è¿­ä»£ã€‚æœ€ç»ˆå€¼å°†è¢« for/of å¾ªç¯å’Œå±•å¼€è¿ç®—ç¬¦å¿½ç•¥ï¼Œä½†å¯ç”¨é€šè¿‡å¯¹ next() çš„æ˜¾å¼è°ƒç”¨æ‰‹åŠ¨è¿›è¡Œè¿­ä»£ï¼š</p>

<pre><code class="language-javascript">function *oneAndDone() {
    yield 1;
    return &quot;done&quot;;
}

// The return value does not appear in normal iteration.
[...oneAndDone()]   // =&gt; [1]

// But it is available if you explicitly call next()
let generator = oneAndDone();
generator.next()           // =&gt; { value: 1, done: false}
generator.next()           // =&gt; { value: &quot;done&quot;, done: true }
// If the generator is already done, the return value is not returned again
generator.next()           // =&gt; { value: undefined, done: true }
</code></pre>

<h3 id="toc_8">12.4.2 yield è¡¨è¾¾å¼çš„å€¼</h3>

<p>åœ¨å‰é¢çš„è®¨è®ºä¸­ï¼Œæˆ‘ä»¬å°† yield è§†ä¸ºå¸¦æœ‰å€¼ä½†æ²¡æœ‰è‡ªèº«å€¼çš„è¯­å¥ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šï¼Œyield æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªå€¼ã€‚</p>

<p>è°ƒç”¨ç”Ÿæˆå™¨çš„ next() æ–¹æ³•æ—¶ï¼Œç”Ÿæˆå™¨å‡½æ•°å°†è¿è¡Œç›´è‡³åˆ°è¾¾ yield è¡¨è¾¾å¼ã€‚å°†è¯„ä¼° yield å…³é”®å­—ä¹‹åçš„è¡¨è¾¾å¼ï¼Œè¯¥å€¼å°†æˆä¸º next() è°ƒç”¨çš„è¿”å›å€¼ã€‚æ­¤æ—¶ï¼Œç”Ÿæˆå™¨å‡½æ•°åœ¨è¯„ä¼° yield è¡¨è¾¾å¼çš„ä¸­é—´ç«‹å³åœæ­¢æ‰§è¡Œã€‚ä¸‹æ¬¡è°ƒç”¨ç”Ÿæˆå™¨çš„ next() æ–¹æ³•æ—¶ï¼Œä¼ é€’ç»™ next() çš„å‚æ•°æˆä¸ºå·²æš‚åœçš„ yield è¡¨è¾¾å¼çš„å€¼ã€‚å› æ­¤ï¼Œç”Ÿæˆå™¨å°†æŠŠ yield çš„å€¼è¿”å›ç»™å®ƒçš„è°ƒç”¨è€…ï¼Œç„¶åè°ƒç”¨è€…é€šè¿‡ next() å°†å€¼ä¼ é€’ç»™ç”Ÿæˆå™¨ã€‚ç”Ÿæˆå™¨å’Œè°ƒç”¨è€…æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„æ‰§è¡Œæµï¼Œæ¥å›ä¼ é€’å€¼ï¼ˆå’Œæ§åˆ¶ï¼‰ã€‚ä»¥ä¸‹ä»£ç è¯´æ˜ï¼š </p>

<pre><code class="language-javascript">function* smallNumbers() {
    console.log(&quot;next() invoked the first time; argument discarded&quot;);
    let y1 = yield 1;    // y1 == &quot;b&quot;
    console.log(&quot;next() invoked a second time with argument&quot;, y1);
    let y2 = yield 2;    // y2 == &quot;c&quot;
    console.log(&quot;next() invoked a third time with argument&quot;, y2);
    let y3 = yield 3;    // y3 == &quot;d&quot;
    console.log(&quot;next() invoked a fourth time with argument&quot;, y3);
    return 4;
}

let g = smallNumbers();
console.log(&quot;generator created; no code runs yet&quot;);
let n1 = g.next(&quot;a&quot;);   // n1.value == 1
console.log(&quot;generator yielded&quot;, n1.value);
let n2 = g.next(&quot;b&quot;);   // n2.value == 2
console.log(&quot;generator yielded&quot;, n2.value);
let n3 = g.next(&quot;c&quot;);   // n3.value == 3
console.log(&quot;generator yielded&quot;, n3.value);
let n4 = g.next(&quot;d&quot;);   // n4 == { value: 4, done: true }
console.log(&quot;generator returned&quot;, n4.value);
</code></pre>

<p>æ­¤ä»£ç è¿è¡Œæ—¶ï¼Œå°†äº§ç”Ÿä»¥ä¸‹è¾“å‡ºï¼Œæ¼”ç¤ºä¸¤ä¸ªä»£ç å—ä¹‹é—´çš„æ¥å›äº¤äº’ï¼š</p>

<pre><code class="language-text">generator created; no code runs yet
next() invoked the first time; argument discarded
generator yielded 1
next() invoked a second time with argument b
generator yielded 2
next() invoked a third time with argument c
generator yielded 3
next() invoked a fourth time with argument d
generator returned 4
</code></pre>

<p>æ³¨æ„æ­¤ä»£ç ä¸­çš„ä¸å¯¹ç§°æ€§ã€‚next() çš„é¦–æ¬¡è°ƒç”¨å°†å¯åŠ¨ç”Ÿæˆå™¨ï¼Œä½†æ˜¯ç”Ÿæˆå™¨æ— æ³•è®¿é—®ä¼ é€’ç»™è¯¥è°ƒç”¨çš„å€¼ã€‚</p>

<h3 id="toc_9">12.4.3 ç”Ÿæˆå™¨çš„ return() å’Œ throw() æ–¹æ³•</h3>

<p>æˆ‘ä»¬å·²ç»çœ‹åˆ°å¯ä»¥æ¥æ”¶ç”Ÿæˆå™¨å‡½æ•°äº§ç”Ÿæˆ–è¿”å›çš„å€¼ã€‚å¯ä»¥åœ¨è°ƒç”¨ç”Ÿæˆå™¨çš„ next() æ–¹æ³•æ—¶å°†å€¼ä¼ é€’ç»™æ­£åœ¨è¿è¡Œçš„ç”Ÿæˆå™¨ã€‚</p>

<p>é™¤äº†ä½¿ç”¨ next() å‘ç”Ÿæˆå™¨æä¾›è¾“å…¥ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡è°ƒç”¨ç”Ÿæˆå™¨çš„ return() å’Œ throw() æ–¹æ³•æ¥æ›´æ”¹ç”Ÿæˆå™¨å†…éƒ¨çš„æ§åˆ¶æµã€‚é¡¾åæ€ä¹‰ï¼Œåœ¨ç”Ÿæˆå™¨ä¸Šè°ƒç”¨è¿™äº›æ–¹æ³•ä¼šå¯¼è‡´å…¶è¿”å›å€¼æˆ–å¼•å‘å¼‚å¸¸ï¼Œå°±åƒç”Ÿæˆå™¨ä¸­çš„ä¸‹ä¸€æ¡è¯­å¥æ˜¯ return æˆ– throw ä¸€æ ·ã€‚</p>

<p>ä»æœ¬ç« å‰é¢çš„å†…å®¹å›æƒ³èµ·ï¼Œå¦‚æœè¿­ä»£å™¨å®šä¹‰äº† return() æ–¹æ³•ä¸”è¿­ä»£ææ—©åœæ­¢ï¼Œåˆ™è§£é‡Šå™¨å°†è‡ªåŠ¨è°ƒç”¨ return() æ–¹æ³•ï¼Œä»¥ä½¿è¿­ä»£å™¨æœ‰æœºä¼šå…³é—­æ–‡ä»¶æˆ–è¿›è¡Œå…¶ä»–æ¸…ç†ã€‚å¯¹äºç”Ÿæˆå™¨ï¼Œä¸èƒ½å®šä¹‰è‡ªå®šä¹‰çš„ return() æ–¹æ³•æ¥å¤„ç†æ¸…ç†ï¼Œä½†æ˜¯å¯ä»¥æ„é€ ç”Ÿæˆå™¨ä»£ç ä»¥ä½¿ç”¨ try/finally è¯­å¥ï¼Œä»¥ç¡®ä¿ç”Ÿæˆå™¨è¿”å›æ—¶æ‰§è¡Œæ¸…ç†æ“ä½œï¼ˆåœ¨ finally å—ä¸­ï¼‰ã€‚é€šè¿‡å¼ºåˆ¶ç”Ÿæˆå™¨è¿”å›ï¼Œç”Ÿæˆå™¨çš„å†…ç½® return() æ–¹æ³•å¯ç¡®ä¿åœ¨ä¸å†ä½¿ç”¨ç”Ÿæˆå™¨æ—¶è¿è¡Œæ¸…é™¤ä»£ç ã€‚</p>

<p>æ­£å¦‚ç”Ÿæˆå™¨çš„ next() æ–¹æ³•å…è®¸æˆ‘ä»¬å°†ä»»æ„å€¼ä¼ é€’ç»™æ­£åœ¨è¿è¡Œçš„ç”Ÿæˆå™¨ä¸€æ ·ï¼Œç”Ÿæˆå™¨çš„ throw() æ–¹æ³•ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§å°†ä»»æ„ä¿¡å·ï¼ˆä»¥å¼‚å¸¸å½¢å¼ï¼‰å‘é€åˆ°ç”Ÿæˆå™¨çš„æ–¹æ³•ã€‚è°ƒç”¨ throw() æ–¹æ³•æ€»æ˜¯ä¼šåœ¨ç”Ÿæˆå™¨å†…éƒ¨å¼•èµ·å¼‚å¸¸ã€‚ä½†æ˜¯ï¼Œå¦‚æœç”Ÿæˆå™¨å‡½æ•°æœ‰é€‚å½“çš„å¼‚å¸¸å¤„ç†ä»£ç ç¼–ï¼Œåˆ™è¯¥å¼‚å¸¸æ˜¯è‡´å‘½çš„ï¼Œä¸è¿‡è¿™å¯ä»¥ç”¨ä½œæ›´æ”¹ç”Ÿæˆå™¨è¡Œä¸ºçš„ä¸€ç§æ‰‹æ®µã€‚ä¾‹å¦‚ï¼Œæƒ³è±¡ä¸€ä¸‹äº§ç”Ÿä¸€ä¸ªä¸æ–­å¢åŠ çš„æ•´æ•°åºåˆ—çš„è®¡æ•°å™¨ç”Ÿæˆå™¨ã€‚å¯ä»¥è¿™æ ·ç¼–å†™ï¼Œä½¿ç”¨ throw() å‘é€çš„å¼‚å¸¸å°†è®¡æ•°å™¨é‡ç½®ä¸ºé›¶ã€‚</p>

<p>å½“ç”Ÿæˆå™¨ä½¿ç”¨ yield* ä»å…¶ä»–å¯è¿­ä»£å¯¹è±¡ç”Ÿæˆå€¼æ—¶ï¼Œå¯¹ç”Ÿæˆå™¨çš„ next() æ–¹æ³•çš„è°ƒç”¨ä¼šå¯¼è‡´å¯¹å¯è¿­ä»£å¯¹è±¡çš„ next() æ–¹æ³•çš„è°ƒç”¨ã€‚return() å’Œ throw() æ–¹æ³•ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ å¦‚æœç”Ÿæˆå™¨åœ¨å®šä¹‰äº†è¿™äº›æ–¹æ³•çš„å¯è¿­ä»£å¯¹è±¡ä¸Šä½¿ç”¨ yield*ï¼Œåˆ™åœ¨ç”Ÿæˆå™¨ä¸Šè°ƒç”¨ return() æˆ– throw() ä¼šå¯¼è‡´ä¾æ¬¡è°ƒç”¨è¿­ä»£å™¨çš„ return() æˆ– throw() æ–¹æ³•ã€‚æ‰€æœ‰è¿­ä»£å™¨éƒ½å¿…é¡»å…·æœ‰ next() æ–¹æ³•ã€‚éœ€è¦åœ¨ä¸å®Œæ•´çš„è¿­ä»£åè¿›è¡Œæ¸…ç†çš„è¿­ä»£å™¨åº”å®šä¹‰ä¸€ä¸ª return() æ–¹æ³•ã€‚è€Œä¸”ï¼Œä»»ä½•è¿­ä»£å™¨éƒ½å¯ä»¥å®šä¹‰ throw() æ–¹æ³•ï¼Œå°½ç®¡æˆ‘ä¸çŸ¥é“æœ‰ä»»ä½•å®é™…åŸå› ã€‚</p>

<h3 id="toc_10">12.4.4 å…³äºç”Ÿæˆå™¨çš„æœ€åä¸€ä¸ªæ³¨æ„ç‚¹</h3>

<p>ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„é€šç”¨æ§åˆ¶ç»“æ„ã€‚å®ƒä»¬ä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ yield æš‚åœè®¡ç®—ï¼Œå¹¶åœ¨ä»¥åä»»æ„ä»»æ„æ—¶é—´ä½¿ç”¨ä»»æ„è¾“å…¥å€¼é‡æ–°å¼€å§‹è®¡ç®—ã€‚å¯ä»¥ä½¿ç”¨ç”Ÿæˆå™¨åœ¨å•çº¿ç¨‹ JavaScript ä»£ç ä¸­åˆ›å»ºä¸€ç§åä½œçº¿ç¨‹ç³»ç»Ÿã€‚è€Œä¸”ï¼Œå³ä½¿æŸäº›å‡½æ•°è°ƒç”¨å®é™…ä¸Šæ˜¯å¼‚æ­¥çš„å¹¶ä¸”ä¾èµ–äºç½‘ç»œäº‹ä»¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç”Ÿæˆå™¨æ¥æ©ç›–ç¨‹åºçš„å¼‚æ­¥éƒ¨åˆ†ï¼Œä»è€Œä½¿ä»£ç æ˜¾å¾—é¡ºåºå’ŒåŒæ­¥ã€‚</p>

<p>å°è¯•ä½¿ç”¨ç”Ÿæˆå™¨æ‰§è¡Œè¿™äº›æ“ä½œä¼šå¯¼è‡´ä»£ç éš¾ä»¥ç†è§£æˆ–è§£é‡Šã€‚ä½†æ˜¯ï¼Œå®ƒå·²ç»æˆä¸ºäº†è¿‡å»æ—¶ï¼Œå”¯ä¸€çœŸæ­£å®ç”¨çš„ç”¨ä¾‹æ˜¯ç®¡ç†å¼‚æ­¥ä»£ç ã€‚ä¸ºæ­¤ï¼ŒJavaScript ç°åœ¨å…·æœ‰ async å’Œ await å…³é”®å­—ï¼ˆè¯·å‚é˜…ç¬¬ 13 ç« ï¼‰ï¼Œå¹¶ä¸”ä¸å†æœ‰ä»»ä½•ç†ç”±ä»¥è¿™ç§æ–¹å¼æ»¥ç”¨ç”Ÿæˆå™¨ã€‚</p>

<h2 id="toc_11">12.5 æ€»ç»“</h2>

<p>åœ¨æœ¬ç« ä¸­ï¼Œæ‚¨å­¦ä¹ äº†ï¼š</p>

<p>for/of å¾ªç¯å’Œ ... å±•å¼€è¿ç®—ç¬¦å¯è¿­ä»£å¯¹è±¡ã€‚</p>

<p>å¦‚æœå¯¹è±¡å…·æœ‰ç¬¦å·åç§°ä¸º [Symbol.iterator] çš„æ–¹æ³•ï¼Œåˆ™è¯¥æ–¹æ³•è¿”å›è¿­ä»£å™¨å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯å¯è¿­ä»£çš„ã€‚</p>

<p>è¿­ä»£å™¨å¯¹è±¡å…·æœ‰ next() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›è¿­ä»£ç»“æœå¯¹è±¡ã€‚</p>

<p>è¿­ä»£ç»“æœå¯¹è±¡å…·æœ‰ä¸€ä¸ª value å±æ€§ï¼Œè¯¥å±æ€§ä¿å­˜ä¸‹ä¸€ä¸ªè¿­ä»£å€¼ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚å¦‚æœè¿­ä»£å·²å®Œæˆï¼Œåˆ™ç»“æœå¯¹è±¡å¿…é¡»å°† done å±æ€§è®¾ç½®ä¸º trueã€‚ </p>

<p>å¯ä»¥é€šè¿‡å®šä¹‰è¿”å›å¯¹è±¡çš„ <a href="">Symbol.iterator</a> æ–¹æ³•å’Œè¿”å›è¿­ä»£ç»“æœå¯¹è±¡çš„ next() æ–¹æ³•æ¥å®ç°è‡ªå·±çš„å¯è¿­ä»£å¯¹è±¡ã€‚è¿˜å¯ä»¥å®ç°æ¥å—è¿­ä»£å™¨å‚æ•°å¹¶è¿”å›è¿­ä»£å™¨å€¼çš„å‡½æ•°ã€‚ </p>

<p>ç”Ÿæˆå™¨å‡½æ•°ï¼ˆç”¨ function* ä»£æ›¿ function å®šä¹‰çš„å‡½æ•°ï¼‰æ˜¯å®šä¹‰è¿­ä»£å™¨çš„å¦ä¸€ç§æ–¹æ³•ã€‚</p>

<p>å½“è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°çš„ä¸»ä½“ä¸ä¼šç«‹å³è¿è¡Œã€‚ç›¸åï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªå¯è¿­ä»£çš„è¿­ä»£å™¨å¯¹è±¡ã€‚æ¯æ¬¡è°ƒç”¨è¿­ä»£å™¨çš„ next() æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šè¿è¡Œå¦ä¸€éƒ¨åˆ†ç”Ÿæˆå™¨å‡½æ•°ã€‚</p>

<p>ç”Ÿæˆå™¨å‡½æ•°å¯ä»¥ä½¿ç”¨ yield è¿ç®—ç¬¦æ¥æŒ‡å®šè¿­ä»£å™¨è¿”å›çš„å€¼ã€‚æ¯æ¬¡è°ƒç”¨ next() éƒ½ä¼šä½¿ç”Ÿæˆå™¨å‡½æ•°è¿è¡Œåˆ°ä¸‹ä¸€ä¸ª yield è¡¨è¾¾å¼ã€‚ç„¶åï¼Œè¯¥ yield è¡¨è¾¾å¼çš„å€¼å°†æˆä¸ºè¿­ä»£å™¨è¿”å›çš„å€¼ã€‚å½“æ²¡æœ‰æ›´å¤šçš„ yield è¡¨è¾¾å¼æ—¶ï¼Œç”Ÿæˆå™¨å‡½æ•°å°†è¿”å›ï¼Œå¹¶ä¸”è¿­ä»£å®Œæˆã€‚ </p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç¬¬ 13 ç«  å¼‚æ­¥ JavaScript]]></title>
    <link href="2019919.xyz/16130963623880.html"/>
    <updated>2021-02-12T10:19:22+08:00</updated>
    <id>2019919.xyz/16130963623880.html</id>
    <content type="html"><![CDATA[
<ul>
<li>
<a href="#toc_0">13.1 åŸºäºå›è°ƒçš„å¼‚æ­¥ç¼–ç¨‹</a>
<ul>
<li>
<a href="#toc_1">13.1.1 è®¡æ—¶å™¨</a>
</li>
<li>
<a href="#toc_2">13.1.2 äº‹ä»¶</a>
</li>
<li>
<a href="#toc_3">13.1.3 ç½‘ç»œäº‹ä»¶</a>
</li>
<li>
<a href="#toc_4">13.1.4 Callbacks and Events in Node</a>
</li>
</ul>
</li>
<li>
<a href="#toc_5">13.2 Promise</a>
<ul>
<li>
<a href="#toc_6">13.2.1 ä½¿ç”¨ Promise</a>
<ul>
<li>
<a href="#toc_7">PROMISE å¼‚å¸¸å¤„ç†</a>
</li>
<li>
<a href="#toc_8">PROMISE ä¸“ä¸šæœ¯è¯­</a>
</li>
</ul>
</li>
<li>
<a href="#toc_9">13.2.2 Promise é“¾</a>
</li>
<li>
<a href="#toc_10">13.2.3 Promise å†³è®®</a>
</li>
<li>
<a href="#toc_11">13.2.4 æ›´å¤šå…³äº Promise å’Œå¼‚å¸¸</a>
<ul>
<li>
<a href="#toc_12">CATCH å’Œ FINALLY æ–¹æ³•</a>
</li>
<li>
<a href="#toc_13">ä» PROMISE å›è°ƒå‡½æ•°è¿”å›</a>
</li>
</ul>
</li>
<li>
<a href="#toc_14">13.2.5 å¹¶è¡Œ Promise</a>
</li>
<li>
<a href="#toc_15">13.2.6 æ„é€  Promise</a>
<ul>
<li>
<a href="#toc_16">PROMISE åŸºäºåˆ«çš„ PROMISE</a>
</li>
<li>
<a href="#toc_17">PROMISE åŸºäºåŒæ­¥å€¼</a>
</li>
<li>
<a href="#toc_18">æ„é€ å‡½æ•°åˆ›å»º PROMISE</a>
</li>
</ul>
</li>
<li>
<a href="#toc_19">13.2.7 è¿ç»­çš„ Promise</a>
</li>
</ul>
</li>
<li>
<a href="#toc_20">13.3 async å’Œ await</a>
<ul>
<li>
<a href="#toc_21">13.3.1 await è¡¨è¾¾å¼</a>
</li>
<li>
<a href="#toc_22">13.3.2 async å‡½æ•°</a>
</li>
<li>
<a href="#toc_23">13.3.3 ç­‰å¾…å¤šä¸ª Promise</a>
</li>
<li>
<a href="#toc_24">13.3.4 å®ç°è¯¦ç»†</a>
</li>
</ul>
</li>
<li>
<a href="#toc_25">13.4 å¼‚æ­¥è¿­ä»£</a>
<ul>
<li>
<a href="#toc_26">13.4.1 for/await å¾ªç¯</a>
</li>
<li>
<a href="#toc_27">13.4.2 å¼‚æ­¥è¿­ä»£å™¨</a>
</li>
<li>
<a href="#toc_28">13.4.3 å¼‚æ­¥ç”Ÿæˆå™¨</a>
</li>
<li>
<a href="#toc_29">13.4.4 å®ç°å¼‚æ­¥è¿­ä»£å™¨</a>
</li>
</ul>
</li>
<li>
<a href="#toc_30">13.5 Summary</a>
</li>
</ul>


<p>ä¸€äº›è®¡ç®—æœºç¨‹åºï¼Œå¦‚ç§‘å­¦æ¨¡æ‹Ÿå’Œæœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œæ˜¯è®¡ç®—å—é™çš„ï¼šå®ƒä»¬ä¸åœåœ°è¿è¡Œï¼Œæ²¡æœ‰åœé¡¿ï¼Œç›´åˆ°è®¡ç®—å‡ºç»“æœã€‚ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ç°å®ä¸–ç•Œä¸­çš„å¤§å¤šæ•°è®¡ç®—æœºç¨‹åºéƒ½æ˜¯å¼‚æ­¥çš„ã€‚è¿™æ„å‘³ç€åœ¨ç­‰å¾…æ•°æ®åˆ°è¾¾æˆ–æŸäº›äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå®ƒä»¬å¸¸å¸¸ä¸å¾—ä¸åœæ­¢è®¡ç®—ã€‚web æµè§ˆå™¨ä¸­çš„ JavaScript ç¨‹åºæ˜¯å…¸å‹åœ°äº‹ä»¶é©±åŠ¨çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åœ¨å®é™…æ‰§è¡Œä»»ä½•æ“ä½œä¹‹å‰ç­‰å¾…ç”¨æˆ·å•å‡»æˆ–ç‚¹å‡»ã€‚åŸºäº javascript çš„æœåŠ¡å™¨é€šå¸¸åœ¨æ‰§è¡Œä»»ä½•æ“ä½œä¹‹å‰ç­‰å¾…å®¢æˆ·æœºè¯·æ±‚é€šè¿‡ç½‘ç»œåˆ°è¾¾ã€‚</p>

<p>è¿™ç§å¼‚æ­¥ç¼–ç¨‹åœ¨ JavaScript ä¸­å¾ˆå¸¸è§ï¼Œæœ¬ç« å°†ä»‹ç»ä¸‰ç§é‡è¦çš„è¯­è¨€ç‰¹æ€§ï¼Œå®ƒä»¬æœ‰åŠ©äºç®€åŒ–å¼‚æ­¥ä»£ç çš„ä½¿ç”¨ã€‚Promise æ˜¯ ES6 ä¸­çš„æ–°ç‰¹æ€§ï¼Œæ˜¯è¡¨ç¤ºç›®å‰ä¸å¯ç”¨ç»“æœçš„å¼‚æ­¥æ“ä½œå¯¹è±¡ã€‚å…³é”®å­— async å’Œ await æ˜¯åœ¨ ES2017 ä¸­å¼•å…¥çš„ï¼Œå®ƒä»¬æä¾›äº†æ–°çš„è¯­æ³•ï¼Œé€šè¿‡å…è®¸å°†åŸºäº Promise çš„ä»£ç æ„é€ æˆåŒæ­¥çš„æ–¹å¼æ¥ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹ã€‚æœ€åï¼Œåœ¨ ES2018 ä¸­å¼•å…¥äº†å¼‚æ­¥è¿­ä»£å™¨å’Œ for/await å¾ªç¯ï¼Œå…è®¸ä½¿ç”¨ç®€å•çš„åŒæ­¥å¾ªç¯å¤„ç†å¼‚æ­¥äº‹ä»¶æµã€‚</p>

<p>å…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼Œå°½ç®¡ JavaScript ä¸ºå¤„ç†å¼‚æ­¥ä»£ç æä¾›äº†è¿™äº›å¼ºå¤§çš„ç‰¹æ€§ï¼Œä½†æ ¸å¿ƒè¯­è¨€æœ¬èº«å¹¶æ²¡æœ‰å¼‚æ­¥çš„ç‰¹æ€§ã€‚å› æ­¤ï¼Œä¸ºäº†æ¼”ç¤º Promiseã€asyncã€await å’Œ for/awaitï¼Œæˆ‘ä»¬å°†é¦–å…ˆä½¿ç”¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ JavaScript æ¥è§£é‡Š web æµè§ˆå™¨å’Œ Node çš„ä¸€äº›å¼‚æ­¥ç‰¹æ€§ã€‚ï¼ˆå¯ä»¥åœ¨ç¬¬ 15 ç« å’Œç¬¬ 16 ç« ä¸­äº†è§£æ›´å¤šå…³äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ JavaScript çš„çŸ¥è¯†ã€‚ï¼‰</p>

<h2 id="toc_0">13.1 åŸºäºå›è°ƒçš„å¼‚æ­¥ç¼–ç¨‹</h2>

<p>åœ¨æœ€åŸºæœ¬çš„å±‚æ¬¡ä¸Šï¼ŒJavaScript ä¸­çš„å¼‚æ­¥ç¼–ç¨‹æ˜¯é€šè¿‡å›è°ƒæ¥å®Œæˆçš„ã€‚å›è°ƒæ˜¯ä¸€ä¸ªä½ ç¼–å†™çš„å‡½æ•°ï¼Œç„¶åä¼ é€’ç»™å…¶ä»–å‡½æ•°ã€‚å½“æ»¡è¶³æŸäº›æ¡ä»¶æˆ–å‘ç”ŸæŸäº›ï¼ˆå¼‚æ­¥ï¼‰äº‹ä»¶æ—¶ï¼Œå…¶ä»–å‡½æ•°è°ƒç”¨ï¼ˆâ€œå›è°ƒâ€ï¼‰ä½ çš„å‡½æ•°ã€‚æä¾›çš„å›è°ƒå‡½æ•°çš„è°ƒç”¨ä¼šé€šçŸ¥ä½ æ¡ä»¶æˆ–äº‹ä»¶ï¼Œæœ‰æ—¶ï¼Œè°ƒç”¨å°†æä¾›åŒ…å«é¢å¤–ç»†èŠ‚çš„å‡½æ•°å®å‚ã€‚é€šè¿‡ä¸€äº›å…·ä½“çš„ç¤ºä¾‹ä¼šæ›´å®¹æ˜“ç†è§£ï¼Œä¸‹é¢çš„å­èŠ‚å°†æ¼”ç¤ºä½¿ç”¨å®¢æˆ·ç«¯ JavaScript å’Œ Node çš„å„ç§å½¢å¼çš„åŸºäºå›è°ƒçš„å¼‚æ­¥ç¼–ç¨‹ã€‚</p>

<h3 id="toc_1">13.1.1 è®¡æ—¶å™¨</h3>

<p>å½“å¸Œæœ›åœ¨ç»è¿‡ä¸€å®šæ—¶é—´åè¿è¡ŒæŸäº›ä»£ç æ˜¯ä¸€ç§æœ€ç®€å•çš„å¼‚æ­¥ç±»å‹ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨ Â§11.10 ä¸­çœ‹åˆ°çš„ï¼Œå¯ä»¥é€šè¿‡ setTimeout() å‡½æ•°æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p>

<pre><code class="language-javascript">setTimeout(checkForUpdates, 60000);
</code></pre>

<p>setTimeout() çš„ç¬¬ä¸€ä¸ªå®å‚æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç¬¬äºŒä¸ªå®å‚æ˜¯ä¸€ä¸ªä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´é—´éš”ã€‚å‰é¢çš„ä»£ç ä¸­ï¼Œåœ¨ setTimeout() è°ƒç”¨å 60,000 æ¯«ç§’ï¼ˆ1åˆ†é’Ÿï¼‰åï¼Œå°†è°ƒç”¨ä¸€ä¸ªå‡å®šçš„ checkForUpdates() å‡½æ•°ã€‚checkForUpdates() æ˜¯ç¨‹åºå®šä¹‰çš„ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè€Œ setTimeout() æ˜¯ç”¨äºæ³¨å†Œå›è°ƒå‡½æ•°å¹¶æŒ‡å®šåº”è¯¥åœ¨ä»€ä¹ˆå¼‚æ­¥æ¡ä»¶ä¸‹è°ƒç”¨å®ƒçš„å‡½æ•°ã€‚</p>

<p>setTimeout() è°ƒç”¨ä¸€æ¬¡æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œä¸ä¼ é€’ä»»ä½•å®å‚ï¼Œç„¶åå¿˜è®°å®ƒã€‚å¦‚æœæ­£åœ¨ç¼–å†™ä¸€ä¸ªæ£€æŸ¥æ›´æ–°çš„å‡½æ•°ï¼Œå¯èƒ½å¸Œæœ›å®ƒé‡å¤è¿è¡Œã€‚å¯ä»¥ä½¿ç”¨ setInterval() æ¥ä»£æ›¿ setTimeout()ï¼š</p>

<pre><code class="language-javascript">// Call checkForUpdates in one minute and then again every minute after that
let updateIntervalId = setInterval(checkForUpdates, 60000);

// setInterval() returns a value that we can use to stop the repeated
// invocations by calling clearInterval(). (Similarly, setTimeout()
// returns a value that you can pass to clearTimeout())
function stopCheckingForUpdates() {
    clearInterval(updateIntervalId);
}
</code></pre>

<h3 id="toc_2">13.1.2 äº‹ä»¶</h3>

<p>å®¢æˆ·ç«¯ JavaScript ç¨‹åºå‡ ä¹éƒ½æ˜¯ç”±äº‹ä»¶é©±åŠ¨çš„ï¼šå®ƒä»¬é€šå¸¸ä¸ç­‰å¾…ç”¨æˆ·æ‰§è¡ŒæŸç§é¢„å®šçš„è®¡ç®—ï¼Œè€Œæ˜¯ç­‰å¾…ç”¨æˆ·æ‰§è¡ŒæŸäº›æ“ä½œï¼Œç„¶åå“åº”ç”¨æˆ·çš„æ“ä½œã€‚å½“ç”¨æˆ·æŒ‰ä¸‹é”®ç›˜ä¸Šçš„é”®ï¼Œç§»åŠ¨é¼ æ ‡ï¼Œå•å‡»é¼ æ ‡æŒ‰é’®æˆ–è§¦æ‘¸è§¦æ‘¸å±è®¾å¤‡æ—¶ï¼ŒWeb æµè§ˆå™¨ä¼šå‘ç”Ÿäº‹ä»¶ã€‚äº‹ä»¶é©±åŠ¨çš„ JavaScript ç¨‹åºåœ¨æŒ‡å®šçš„ä¸Šä¸‹æ–‡ä¸­ä¸ºæŒ‡å®šç±»å‹çš„äº‹ä»¶æ³¨å†Œå›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”åªè¦æŒ‡å®šäº‹ä»¶å‘ç”Ÿï¼ŒWeb æµè§ˆå™¨å°±ä¼šè°ƒç”¨è¿™äº›å‡½æ•°ã€‚è¿™äº›å›è°ƒå‡½æ•°ç§°ä¸ºäº‹ä»¶å¥æŸ„æˆ–äº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶ä¸”ä½¿ç”¨ addEventListener() æ³¨å†Œï¼š</p>

<pre><code class="language-javascript">// Ask the web browser to return an object representing the HTML
// &lt;button&gt; element that matches this CSS selector
let okay = document.querySelector(&#39;#confirmUpdateDialog button.okay&#39;);

// Now register a callback function to be invoked when the user
// clicks on that button.
okay.addEventListener(&#39;click&#39;, applyUpdate);
</code></pre>

<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå‡è®¾ applyUpdate() æ˜¯æˆ‘ä»¬åœ¨æŸä¸ªåœ°æ–¹å®ç°çš„å›è°ƒå‡½æ•°ã€‚è°ƒç”¨ document.querySelector() è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¡¨ç¤ºç½‘é¡µä¸­çš„å•ä¸ªæŒ‡å®šå…ƒç´ ã€‚æˆ‘ä»¬åœ¨è¯¥å…ƒç´ ä¸Šè°ƒç”¨ addEventListener() æ¥æ³¨å†Œæˆ‘ä»¬çš„å›è°ƒã€‚ç„¶åï¼ŒaddEventListener() çš„ç¬¬ä¸€ä¸ªå®å‚æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²æŒ‡å®šäº†äº‹ä»¶çš„ç±»å‹ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å•å‡»é¼ æ ‡æˆ–è§¦æ‘¸å±ï¼‰ã€‚å¦‚æœç”¨æˆ·å•å‡»æˆ–ç‚¹å‡»ç½‘é¡µä¸Šçš„ç‰¹å®šå…ƒç´ ï¼Œåˆ™æµè§ˆå™¨å°†è°ƒç”¨æˆ‘ä»¬çš„ applyUpdate() å›è°ƒå‡½æ•°ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªåŒ…å«äº‹ä»¶è¯¦ç»†ä¿¡æ¯ï¼ˆä¾‹å¦‚æ—¶é—´å’Œé¼ æ ‡æŒ‡é’ˆåæ ‡ï¼‰çš„å¯¹è±¡ã€‚</p>

<h3 id="toc_3">13.1.3 ç½‘ç»œäº‹ä»¶</h3>

<p>JavaScript ç¼–ç¨‹ä¸­å¼‚æ­¥çš„å¦ä¸€ä¸ªå¸¸è§æ¥æºæ˜¯ç½‘ç»œè¯·æ±‚ã€‚åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„ JavaScript å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ä» Web æœåŠ¡å™¨è·å–æ•°æ®ï¼š</p>

<pre><code class="language-javascript">function getCurrentVersionNumber(versionCallback) { // Note callback argument
    // Make a scripted HTTP request to a backend version API
    let request = new XMLHttpRequest();
    request.open(&quot;GET&quot;, &quot;http://www.example.com/api/version&quot;);
    request.send();

    // Register a callback that will be invoked when the response arrives
    request.onload = function() {
        if (request.status === 200) {
            // If HTTP status is good, get version number and call callback.
            let currentVersion = parseFloat(request.responseText);
            versionCallback(null, currentVersion);
        } else {
            // Otherwise report an error to the callback
            versionCallback(response.statusText, null);
        }
    };
    // Register another callback that will be invoked for network errors
    request.onerror = request.ontimeout = function(e) {
        versionCallback(e.type, null);
    };
}
</code></pre>

<p>å®¢æˆ·ç«¯ JavaScript ä»£ç å¯ä»¥ä½¿ç”¨ XMLHttpRequest ç±»ä»¥åŠå›è°ƒå‡½æ•°æ¥å‘å‡º HTTP è¯·æ±‚ï¼Œå¹¶åœ¨æœåŠ¡å™¨å“åº”æ—¶å¼‚æ­¥å¤„ç†ã€‚<sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup> è¿™é‡Œå®šä¹‰çš„ getCurrentVersionNumber() å‡½æ•°ï¼ˆæˆ‘ä»¬å¯ä»¥å‡è®¾åœ¨ Â§13.1.1 æåˆ°çš„ checkForUpdates() å‡½æ•°ä½¿ç”¨äº†è¯¥å‡½æ•°ï¼‰å‘å‡º HTTP è¯·æ±‚å¹¶å®šä¹‰äº‹ä»¶å¤„ç†ç¨‹åºï¼Œè¯¥äº‹ä»¶å¤„ç†ç¨‹åºå°†åœ¨æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”æˆ–è¶…æ—¶æˆ–å…¶ä»–å¼‚å¸¸å¯¼è‡´è¯·æ±‚å¤±è´¥æ—¶è¢«è°ƒç”¨ã€‚</p>

<p>è¯·æ³¨æ„ï¼Œä¸Šé¢çš„ä»£ç ç¤ºä¾‹æœªåƒå‰é¢çš„ç¤ºä¾‹é‚£æ ·è°ƒç”¨ addEventListener()ã€‚å¯¹äºå¤§å¤šæ•° Web APIï¼ˆåŒ…æ‹¬æ­¤APIï¼‰ï¼Œå¯ä»¥é€šè¿‡åœ¨ç”Ÿæˆäº‹ä»¶çš„å¯¹è±¡ä¸Šè°ƒç”¨ addEventListener() å¹¶å°†äº‹ä»¶çš„åç§°ä¸å›è°ƒå‡½æ•°ä¸€èµ·ä¼ é€’æ¥å®šä¹‰äº‹ä»¶å¤„ç†ç¨‹åºã€‚ä¸è¿‡ï¼Œé€šå¸¸ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å°†å•ä¸ªäº‹ä»¶ä¾¦å¬å™¨ç›´æ¥åˆ†é…ç»™å¯¹è±¡çš„å±æ€§æ¥æ³¨å†Œå®ƒã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨æ­¤ç¤ºä¾‹ä»£ç ä¸­æ‰€åšçš„ï¼Œå°†å‡½æ•°åˆ†é…ç»™ onloadã€onerror å’Œ ontimeout å±æ€§ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œæ­¤ç±»äº‹ä»¶ä¾¦å¬å™¨å±æ€§çš„åç§°å§‹ç»ˆä»¥ on å¼€å¤´ã€‚ addEventListener() æ˜¯æ›´çµæ´»çš„æŠ€æœ¯ï¼Œå› ä¸ºå®ƒå…è®¸å¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºã€‚ä½†æ˜¯ï¼Œå¦‚æœç¡®å®šæ²¡æœ‰å…¶ä»–ä»£ç éœ€è¦ä¸ºç›¸åŒçš„å¯¹è±¡å’Œäº‹ä»¶ç±»å‹æ³¨å†Œä¸€ä¸ªä¾¦å¬å™¨ï¼Œåˆ™åªéœ€å°†é€‚å½“çš„å±æ€§è®¾ç½®ä¸ºå›è°ƒä¼šæ›´ç®€å•ã€‚</p>

<p>æ­¤ç¤ºä¾‹ä»£ç ä¸­å…³äº getCurrentVersionNumber() å‡½æ•°çš„å¦ä¸€ç‚¹æ³¨æ„äº‹é¡¹æ˜¯ï¼Œç”±äºå®ƒå‘å‡ºå¼‚æ­¥è¯·æ±‚ï¼Œå› æ­¤æ— æ³•åŒæ­¥è¿”å›è°ƒç”¨è€…æ„Ÿå…´è¶£çš„å€¼ï¼ˆå½“å‰ç‰ˆæœ¬å·ï¼‰ã€‚ç›¸åï¼Œè°ƒç”¨è€…ä¼ é€’äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“ç»“æœå‡†å¤‡å°±ç»ªæˆ–å‘ç”Ÿå¼‚å¸¸æ—¶è°ƒç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨æ–¹æä¾›äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ã€‚å¦‚æœ XMLHttpRequest æ­£å¸¸å·¥ä½œï¼Œåˆ™ getCurrentVersionNumber() ä¼šä½¿ç”¨ null ä¸ºç¬¬ä¸€ä¸ªå®å‚å’Œç‰ˆæœ¬å·ä¸ºç¬¬äºŒä¸ªå®å‚è°ƒç”¨å›è°ƒå‡½æ•°ã€‚æˆ–è€…ï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™ getCurrentVersionNumber() ä¼šåœ¨ç¬¬ä¸€ä¸ªå®å‚ä¸­å¸¦æœ‰å¼‚å¸¸è¯¦ç»†ä¿¡æ¯ï¼Œè€Œåœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸­ä½¿ç”¨ nullã€‚</p>

<h3 id="toc_4">13.1.4 Callbacks and Events in Node</h3>

<p>The Node.js server-side JavaScript environment is deeply asynchronous and defines many APIs that use callbacks and events. The default API for reading the contents of a file, for example, is asynchronous and invokes a callback function when the contents of the file have been read:</p>

<pre><code class="language-javascript">const fs = require(&quot;fs&quot;); // The &quot;fs&quot; module has filesystem-related APIs
let options = {           // An object to hold options for our program
    // default options would go here
};

// Read a configuration file, then call the callback function
fs.readFile(&quot;config.json&quot;, &quot;utf-8&quot;, (err, text) =&gt; {
    if (err) {
        // If there was an error, display a warning, but continue
        console.warn(&quot;Could not read config file:&quot;, err);
    } else {
        // Otherwise, parse the file contents and assign to the options object
        Object.assign(options, JSON.parse(text));
    }

    // In either case, we can now start running the program
    startProgram(options);
});
</code></pre>

<p>Nodeâ€™s fs.readFile() function takes a two-parameter callback as its last argument. It reads the specified file asynchronously and then invokes the callback. If the file was read successfully, it passes the file contents as the second callback argument. If there was an error, it passes the error as the first callback argument. In this example, we express the callback as an arrow function, which is a succinct and natural syntax for this kind of simple operation.</p>

<p>Node also defines a number of event-based APIs. The following function shows how to make an HTTP request for the contents of a URL in Node. It has two layers of asynchronous code handled with event listeners. Notice that Node uses an on() method to register event listeners instead of addEventListener():</p>

<pre><code class="language-javascript">const https = require(&quot;https&quot;);

// Read the text content of the URL and asynchronously pass it to the callback.
function getText(url, callback) {
    // Start an HTTP GET request for the URL
    request = https.get(url);

    // Register a function to handle the &quot;response&quot; event.
    request.on(&quot;response&quot;, response =&gt; {
        // The response event means that response headers have been received
        let httpStatus = response.statusCode;

        // The body of the HTTP response has not been received yet.
        // So we register more event handlers to to be called when it arrives.
        response.setEncoding(&quot;utf-8&quot;);  // We&#39;re expecting Unicode text
        let body = &quot;&quot;;                  // which we will accumulate here.

        // This event handler is called when a chunk of the body is ready
        response.on(&quot;data&quot;, chunk =&gt; { body += chunk; });

        // This event handler is called when the response is complete
        response.on(&quot;end&quot;, () =&gt; {
            if (httpStatus === 200) {   // If the HTTP response was good
                callback(null, body);   // Pass response body to the callback
            } else {                    // Otherwise pass an error
                callback(httpStatus, null);
            }
        });
    });

    // We also register an event handler for lower-level network errors
    request.on(&quot;error&quot;, (err) =&gt; {
        callback(err, null);
    });
}
</code></pre>

<h2 id="toc_5">13.2 Promise</h2>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»è§è¿‡äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ JavaScript ç¯å¢ƒä¸­åŸºäºå›è°ƒå’ŒåŸºäºäº‹ä»¶çš„å¼‚æ­¥ç¼–ç¨‹çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬æ¥ç€ä»‹ç» Promiseï¼Œè¿™æ˜¯ä¸€ç§æ—¨åœ¨ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒè¯­è¨€ç‰¹æ€§ã€‚</p>

<p>Promise æ˜¯æè¿°å¼‚æ­¥è®¡ç®—ç»“æœçš„å¯¹è±¡ã€‚è¯¥ç»“æœå¯èƒ½å‡†å¤‡å¥½æˆ–å°šæœªå‡†å¤‡å¥½ï¼ŒPromise API æ•…æ„å¯¹æ­¤å«ç³Šå…¶è¯ï¼šæ— æ³•åŒæ­¥è·å– Promise çš„å€¼ï¼›åªèƒ½è¦æ±‚ promise åœ¨å€¼å‡†å¤‡å¥½æ—¶è°ƒç”¨å›è°ƒå‡½æ•°ã€‚å¦‚æœè¦åƒä¸Šä¸€èŠ‚ä¸­çš„ getText() å‡½æ•°é‚£æ ·å®šä¹‰å¼‚æ­¥ APIï¼Œä½†æƒ³ä½¿å…¶åŸºäº Promiseï¼Œåˆ™çœç•¥ callback å‚æ•°ï¼Œè€Œè¿”å› Promise å¯¹è±¡ã€‚ç„¶åï¼Œè°ƒç”¨è€…å¯ä»¥åœ¨æ­¤ Promise å¯¹è±¡ä¸Šæ³¨å†Œä¸€ä¸ªæˆ–å¤šä¸ªå›è°ƒï¼Œå¹¶ä¸”åœ¨å¼‚æ­¥è®¡ç®—å®Œæˆåå°†è°ƒç”¨å®ƒä»¬ã€‚</p>

<p>å› æ­¤ï¼Œæœ€ç®€å•çš„è¯´ï¼Œpromise åªæ˜¯ä½¿ç”¨å›è°ƒçš„å¦ä¸€ç§æ–¹å¼ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨å®ƒæœ‰å®é™…çš„å¥½å¤„ã€‚åŸºäºå›è°ƒçš„å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ä¸ªçœŸæ­£çš„é—®é¢˜æ˜¯ï¼Œé€šå¸¸åœ¨å›è°ƒå†…éƒ¨åµŒå¥—å¤šå±‚å›è°ƒï¼Œå¹¶ä¸”ä»£ç è¡Œç¼©è¿›ç¨‹åº¦å¾ˆé«˜ï¼Œä»¥è‡³äºå¾ˆéš¾é˜…è¯»ã€‚Promise å…è®¸å°†è¿™ç§åµŒå¥—çš„å›è°ƒä½œä¸ºæ›´çº¿æ€§çš„ Promise é“¾é‡æ–°è¡¨è¾¾ï¼Œè¯¥é“¾å¾€å¾€æ›´æ˜“äºé˜…è¯»å’Œæ¨ç†ã€‚</p>

<p>å›è°ƒçš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå®ƒä»¬ä¼šä½¿å¤„ç†å¼‚å¸¸å˜å¾—å›°éš¾ã€‚å¦‚æœå¼‚æ­¥å‡½æ•°ï¼ˆæˆ–å¼‚æ­¥è°ƒç”¨çš„å›è°ƒï¼‰å¼•å‘å¼‚å¸¸ï¼Œåˆ™è¯¥å¼‚å¸¸æ— æ³•ä¼ æ’­å›å¼‚æ­¥æ“ä½œçš„å‘èµ·è€…ã€‚è¿™æ˜¯å…³äºå¼‚æ­¥ç¼–ç¨‹çš„åŸºæœ¬äº‹å®ï¼šå®ƒç ´åäº†å¼‚å¸¸å¤„ç†ã€‚æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨å›è°ƒå®å‚å’Œè¿”å›å€¼æ¥ç²¾å¿ƒè·Ÿè¸ªå’Œä¼ æ’­å¼‚å¸¸ï¼Œä½†è¿™å¾ˆç¹çä¸”éš¾ä»¥æ­£ç¡®å¤„ç†ã€‚Promise é€šè¿‡æ ‡å‡†åŒ–å¤„ç†å¼‚å¸¸çš„æ–¹å¼ä»¥åŠä¸ºå¼‚å¸¸é€šè¿‡ Promise é“¾æ­£ç¡®ä¼ æ’­çš„æ–¹å¼æä¾›å¸®åŠ©ã€‚</p>

<p>è¯·æ³¨æ„ï¼Œpromise è¡¨ç¤ºå•ä¸ªå¼‚æ­¥è®¡ç®—çš„æœªæ¥ç»“æœã€‚ä½†æ˜¯ï¼Œå®ƒä¸èƒ½ç”¨äºè¡¨ç¤ºé‡å¤çš„å¼‚æ­¥è®¡ç®—ã€‚ä¾‹å¦‚ï¼Œåœ¨æœ¬ç« çš„åé¢ï¼Œæˆ‘ä»¬å°†å†™ä¸€ä¸ªåŸºäº Promise çš„ setTieout() å‡½æ•°æ›¿ä»£æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ Promise æ¥ä»£æ›¿ setInterval()ï¼Œå› ä¸ºè¯¥å‡½æ•°ä¼šåå¤è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œè€Œ Promise å¹¶ä¸æ˜¯ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Promise ä»£æ›¿ XMLHttpRequest å¯¹è±¡çš„â€œloadâ€äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå› ä¸ºè¯¥å›è°ƒä»…è¢«è°ƒç”¨ä¸€æ¬¡ã€‚ä½†æ˜¯æˆ‘ä»¬é€šå¸¸ä¸ä¼šä½¿ç”¨ Promise æ¥ä»£æ›¿ HTML æŒ‰é’®å¯¹è±¡çš„â€œclickâ€äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå› ä¸ºæˆ‘ä»¬é€šå¸¸å¸Œæœ›å…è®¸ç”¨æˆ·å¤šæ¬¡å•å‡»æŒ‰é’®ã€‚</p>

<p>æ¥ä¸‹æ¥çš„å°èŠ‚å°†ï¼š</p>

<ul>
<li>è§£é‡Š Promise æœ¯è¯­å¹¶æ¼”ç¤º Promise çš„åŸºæœ¬ç”¨æ³•</li>
<li>å±•ç¤ºå¦‚ä½•å°† Promise é“¾æ¥èµ·æ¥</li>
<li>æ¼”ç¤ºå¦‚ä½•åˆ›å»ºè‡ªå·±çš„åŸºäº Promise çš„ API</li>
</ul>

<p><strong>é‡ç‚¹</strong><br/>
Promise ä¸€å¼€å§‹ä¼¼ä¹å¾ˆç®€å•ï¼Œå¹¶ä¸” Promise çš„åŸºæœ¬ç”¨ä¾‹å®é™…ä¸Šä¹Ÿæ˜¯ç®€å•æ˜äº†çš„ã€‚ä½†æ˜¯ï¼Œé™¤äº†æœ€ç®€å•çš„ç”¨ä¾‹ä¹‹å¤–ï¼Œå®ƒä»¬è¿˜ä¼šä½¿å…¶ä»–ä»»ä½•äº‹æƒ…å˜å¾—ä»¤äººå›°æƒ‘ã€‚å¯¹äºå¼‚æ­¥ç¼–ç¨‹ï¼ŒPromise æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ä¹ æƒ¯ç”¨æ³•ï¼Œä½†æ˜¯éœ€è¦æ·±åˆ»ç†è§£å®ƒä»¬ï¼Œæ‰èƒ½æ­£ç¡®ã€è‡ªä¿¡åœ°ä½¿ç”¨å®ƒä»¬ã€‚ä½†æ˜¯ï¼Œå®ƒå€¼å¾—èŠ±æ—¶é—´æ¥æ·±å…¥ç†è§£ï¼Œæˆ‘å»ºè®®ä»”ç»†é˜…è¯»è¿™ä¸€é•¿ç¯‡ç« ã€‚</p>

<h3 id="toc_6">13.2.1 ä½¿ç”¨ Promise</h3>

<p>éšç€æ ¸å¿ƒ JavaScript è¯­è¨€ä¸­ Promise çš„å‡ºç°ï¼ŒWeb æµè§ˆå™¨å·²ç»å¼€å§‹å®ç°åŸºäº Promise çš„ APIã€‚åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ª getText() å‡½æ•°ï¼Œè¯¥å‡½æ•°å‘å‡ºä¸€ä¸ªå¼‚æ­¥ HTTP è¯·æ±‚ï¼Œå¹¶å°† HTTP å“åº”çš„ä¸»ä½“ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ç»™æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚æƒ³è±¡ä¸€ä¸‹è¯¥å‡½æ•°çš„ä¸€ä¸ªå˜ä½“ getJSON()ï¼Œå®ƒå¯ä»¥è§£æä¸»ä½“ HTTP å“åº”çš„å½¢å¼ä¸º JSONï¼Œå¹¶è¿”å› Promise è€Œä¸æ˜¯æ¥å—å›è°ƒå‚æ•°ã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç« ç¨åå®ç° getJSON() å‡½æ•°ï¼Œä½†ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨è¿”å› Promise åŠŸèƒ½ç¨‹åºå‡½æ•°ï¼š</p>

<pre><code class="language-javascript">getJSON(url).then(jsonData =&gt; {
    // This is a callback function that will be asynchronously
    // invoked with the parsed JSON value when it becomes available.
});
</code></pre>

<p>getJSON() å¯¹æŒ‡å®šçš„ URL å¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ HTTP è¯·æ±‚ï¼Œå½“è¯¥è¯·æ±‚å¾…å®šæ—¶ï¼Œå®ƒè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ã€‚Promise å¯¹è±¡å®šä¹‰äº† then() å®ä¾‹æ–¹æ³•ã€‚æˆ‘ä»¬æ²¡æœ‰å°†å›è°ƒå‡½æ•°ç›´æ¥ä¼ é€’ç»™ getJSON()ï¼Œè€Œæ˜¯å°†å…¶ä¼ é€’ç»™ then() æ–¹æ³•ã€‚å½“ HTTP å“åº”æ—¶ï¼Œè¯¥å“åº”çš„ä¸»ä½“å°†è§£æä¸º JSONï¼Œå¹¶å°†æ‰€è§£æçš„ç»“æœå€¼ä¼ ç»™æˆ‘ä»¬ä¼ é€’ç»™ then() çš„å›è°ƒå‡½æ•°ã€‚</p>

<p>å¯ä»¥å°† then() æ–¹æ³•è§†ä¸ºå›è°ƒæ³¨å†Œæ–¹æ³•ï¼Œä¾‹å¦‚ç”¨äºåœ¨å®¢æˆ·ç«¯ JavaScript ä¸­æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åºçš„ addEventListener() æ–¹æ³•ã€‚å¦‚æœå¤šæ¬¡è°ƒç”¨ Promise å¯¹è±¡çš„ then() æ–¹æ³•ï¼Œåˆ™åœ¨å®Œæˆ promise çš„è®¡ç®—åå°†è°ƒç”¨æŒ‡å®šçš„æ¯ä¸ªå‡½æ•°ã€‚</p>

<p>ä½†æ˜¯ï¼Œä¸è®¸å¤šäº‹ä»¶ä¾¦å¬å™¨ä¸åŒï¼ŒPromise è¡¨ç¤ºå•ä¸ªè®¡ç®—ï¼Œå¹¶ä¸” then() æ³¨å†Œçš„æ¯ä¸ªå‡½æ•°ä»…è¢«è°ƒç”¨ä¸€æ¬¡ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¼ é€’ç»™ then() çš„å‡½æ•°æ˜¯å¼‚æ­¥è°ƒç”¨çš„ï¼Œå³ä½¿è°ƒç”¨ then() æ—¶å¼‚æ­¥è®¡ç®—å·²ç»å®Œæˆã€‚</p>

<p>åœ¨ç®€å•çš„è¯­æ³•çº§åˆ«ä¸Šï¼Œthen() æ–¹æ³•æ˜¯ Promise ç‹¬æœ‰çš„ç‰¹æ€§ï¼Œç¼–ç ä¸­ä¹ æƒ¯äºå°† .then() ç›´æ¥è·Ÿéšè¿”å› Promise çš„å‡½æ•°ï¼Œè€Œæ— éœ€å°† Promise å¯¹è±¡åˆ†é…ç»™å˜é‡çš„ä¸­é—´æ­¥éª¤ã€‚</p>

<p>å¸¸ç”¨å¸¦æœ‰åŠ¨è¯å‘½åè¿”å› Promise çš„å‡½æ•°å’Œä½¿ç”¨ Promise ç»“æœçš„å‡½æ•°ï¼Œè¿™äº›å¸¸ç”¨è¯­ä½¿ä»£ç ç‰¹åˆ«å®¹æ˜“é˜…è¯»ï¼š</p>

<pre><code class="language-javascript">// Suppose you have a function like this to display a user profile
function displayUserProfile(profile) { /* implementation omitted */ }

// Here&#39;s how you might use that function with a Promise.
// Notice how this line of code reads almost like an English sentence:
getJSON(&quot;/api/user/profile&quot;).then(displayUserProfile);
</code></pre>

<h4 id="toc_7">PROMISE å¼‚å¸¸å¤„ç†</h4>

<p>å¼‚æ­¥æ“ä½œï¼Œå°¤å…¶æ˜¯æ¶‰åŠç½‘ç»œçš„å¼‚æ­¥æ“ä½œï¼Œé€šå¸¸ä¼šä»¥å¤šç§æ–¹å¼å¤±è´¥ï¼Œå¹¶ä¸”å¿…é¡»ç¼–å†™å¥å£®çš„ä»£ç æ¥å¤„ç†ä¸å¯é¿å…åœ°ä¼šå‘ç”Ÿçš„å¼‚å¸¸ã€‚</p>

<p>å¯¹äº Promiseï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ç¬¬äºŒä¸ªå‡½æ•°ä¼ é€’ç»™ then() æ–¹æ³•æ¥å®ç°ï¼š</p>

<pre><code class="language-javascript">getJSON(&quot;/api/user/profile&quot;).then(displayUserProfile, handleProfileError);
</code></pre>

<p>Promise æè¿°åœ¨ Promise å¯¹è±¡åˆ›å»ºä¹‹åå‘ç”Ÿçš„å¼‚æ­¥è®¡ç®—çš„æœªæ¥ç»“æœã€‚ç”±äºè®¡ç®—æ˜¯åœ¨ Promise å¯¹è±¡è¿”å›ç»™æˆ‘ä»¬ä¹‹åæ‰§è¡Œçš„ï¼Œå› æ­¤è¯¥è®¡ç®—æ— æ³•ä¼ ç»Ÿåœ°è¿”å›å€¼æˆ–å¼•å‘æˆ‘ä»¬å¯ä»¥æ•è·çš„å¼‚å¸¸ã€‚æˆ‘ä»¬ä¼ é€’ç»™ then() çš„å‡½æ•°æä¾›äº†æ›¿ä»£æ–¹æ¡ˆã€‚å½“åŒæ­¥è®¡ç®—æ­£å¸¸å®Œæˆæ—¶ï¼Œå®ƒä»…å°†å…¶ç»“æœè¿”å›ç»™å…¶è°ƒç”¨è€…ã€‚å½“åŸºäº Promise çš„å¼‚æ­¥è®¡ç®—æ­£å¸¸å®Œæˆæ—¶ï¼Œå®ƒå°†å…¶ç»“æœä¼ é€’ç»™ then() çš„ç¬¬ä¸€ä¸ªå®å‚å‡½æ•°ã€‚</p>

<p>å½“åŒæ­¥è®¡ç®—ä¸­å‡ºç°é—®é¢˜æ—¶ï¼Œå®ƒå°†å¼•å‘ä¸€ä¸ªå¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸ä¼šæ²¿è°ƒç”¨å †æ ˆä¼ æ’­ï¼Œç›´åˆ°æœ‰ä¸€ä¸ª catch å­å¥æ¥å¤„ç†å®ƒä¸ºæ­¢ã€‚å½“å¼‚æ­¥è®¡ç®—è¿è¡Œæ—¶ï¼Œå®ƒçš„è°ƒç”¨è€…ä¸å†åœ¨å †æ ˆä¸Šï¼Œå› æ­¤ï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼Œåˆ™æ ¹æœ¬ä¸å¯èƒ½å°†å¼‚å¸¸æŠ›å‡ºç»™è°ƒç”¨è€…ã€‚</p>

<p>è€ŒåŸºäº Promise çš„å¼‚æ­¥è®¡ç®—å°†å¼‚å¸¸ï¼ˆé€šå¸¸æ˜¯æŸç§ Error å¯¹è±¡ï¼Œå°½ç®¡è¿™ä¸æ˜¯å¿…éœ€çš„ï¼‰ä¼ é€’ç»™ then() çš„ç¬¬äºŒä¸ªå‡½æ•°ã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚æœ getJSON() æ­£å¸¸è¿è¡Œï¼Œå®ƒå°†å…¶ç»“æœä¼ é€’ç»™ displayUserProfile()ã€‚å¦‚æœå‡ºç°å¼‚å¸¸ï¼ˆç”¨æˆ·æœªç™»å½•ï¼ŒæœåŠ¡å™¨å…³é—­ï¼Œç”¨æˆ·çš„ Internet è¿æ¥æ–­å¼€ï¼Œè¯·æ±‚è¶…æ—¶ç­‰ï¼‰ï¼Œåˆ™ getJSON() ä¼šå°† Error å¯¹è±¡ä¼ é€’ç»™ handleProfileError()ã€‚</p>

<p>å®è·µä¸­ï¼Œå¾ˆå°‘æœ‰ä¸¤ä¸ªå‡½æ•°ä¼ é€’ç»™ then()ã€‚åœ¨å¤„ç† Promise æ—¶ï¼Œæœ‰ä¸€ç§æ›´å¥½æ›´å¸¸ç”¨çš„å¼‚å¸¸å¤„ç†æ–¹å¼ã€‚ä¸ºäº†ç†è§£å®ƒï¼Œé¦–å…ˆè€ƒè™‘å¦‚æœ getJSON() æ­£å¸¸å®Œæˆä½† displayUserProfile() ä¸­å‘ç”Ÿå¼‚å¸¸è¯¥æ€ä¹ˆåŠã€‚å½“ getJSON() è¿”å›æ—¶ï¼Œè¯¥å›è°ƒå‡½æ•°å°†å¼‚æ­¥è°ƒç”¨ï¼Œå› æ­¤å®ƒä¹Ÿæ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”æ— æ³•æœ‰æ„ä¹‰åœ°å¼•å‘å¼‚å¸¸ï¼ˆå› ä¸ºè°ƒç”¨å †æ ˆä¸Šæ²¡æœ‰ä»£ç å¯ä»¥å¤„ç†è¯¥å¼‚å¸¸ï¼‰ã€‚</p>

<p>å¦‚ä¸‹æ‰€ç¤ºï¼Œå¤„ç†æ­¤ä»£ç ä¸­å¼‚å¸¸çš„æ›´å¸¸ç”¨æ–¹å¼ï¼š</p>

<pre><code class="language-javascript">getJSON(&quot;/api/user/profile&quot;).then(displayUserProfile).catch(handleProfileError);
</code></pre>

<p>ä½¿ç”¨æ­¤ä»£ç ï¼ŒgetJSON() çš„æ­£å¸¸ç»“æœä»ä¼šä¼ é€’ç»™ displayUserProfile()ï¼Œä½†æ˜¯ getJSON() æˆ– displayUserProfile() ä¸­çš„ä»»ä½•å¼‚å¸¸ï¼ˆåŒ…æ‹¬ displayUserProfile æŠ›å‡ºçš„ä»»ä½•å¼‚å¸¸ï¼‰éƒ½å°†ä¼ é€’ç»™ handleProfileError()ã€‚è°ƒç”¨ then() ç¬¬ä¸€ä¸ªå®å‚ä¸ºç©ºï¼ŒæŒ‡å®šçš„å¼‚å¸¸å¤„ç†å‡½æ•°ä¸ºç¬¬äºŒä¸ªå®å‚ï¼Œcatch() æ–¹æ³•åªæ˜¯å…¶ç®€å†™ã€‚</p>

<p>åœ¨ä¸‹ä¸€èŠ‚ä¸­è®¨è®º Promise é“¾æ—¶ï¼Œæˆ‘ä»¬å°†å¯¹ catch() å’Œè¿™ä¸ªå¤„ç†å¼‚å¸¸å¸¸ç”¨æ–¹æ³•ä½œæ›´å¤šçš„è¯´æ˜ã€‚</p>

<h4 id="toc_8">PROMISE ä¸“ä¸šæœ¯è¯­</h4>

<p>åœ¨æˆ‘ä»¬è¿›ä¸€æ­¥è®¨è®º Promises ä¹‹å‰ï¼Œéœ€è¦æš‚åœå®šä¹‰ä¸€äº›æœ¯è¯­ã€‚ç°å®ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºä¸‹äººç±»çš„è¯ºè¨€ï¼Œæˆ‘ä»¬è¯´â€œä¿¡å®ˆâ€æˆ–â€œè¿èƒŒâ€è¯ºè¨€ã€‚åœ¨è®¨è®º JavaScript Promise æ—¶ï¼Œç”¨â€œå·²å…‘ç°ï¼ˆfulfilledï¼‰â€å’Œâ€œå·²æ‹’ç»ï¼ˆrejectedï¼‰â€ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå·²ç»è°ƒç”¨äº† Promise çš„ then() æ–¹æ³•ï¼Œå¹¶å‘å…¶ä¼ é€’äº†ä¸¤ä¸ªå›è°ƒå‡½æ•°ã€‚å½“è°ƒç”¨ç¬¬ä¸€ä¸ªå›è°ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬è¯´ Promise å·²å…‘ç°ã€‚å½“è°ƒç”¨ç¬¬äºŒä¸ªå›è°ƒï¼Œæˆ‘ä»¬åˆ™è¯´ Promise å·²è¢«æ‹’ç»ã€‚å¦‚æœä¸€ä¸ª Promise æ—¢ä¸æ˜¯å·²å…‘ç°ä¹Ÿä¸æ˜¯å·²æ‹’ç»ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å¾…å®šï¼ˆpendingï¼‰ã€‚ä¸€æ—¦ Promise å·²å…‘ç°æˆ–å·²æ‹’ç»ï¼Œæˆ‘ä»¬å°±è¯´å®ƒå·²æ•²å®šï¼ˆsettledï¼‰ã€‚è¯·æ³¨æ„ï¼Œä¸€ä¸ª Promise æ°¸è¿œä¸ä¼šåŒæ—¶å·²å…‘ç°å’Œå·²æ‹’ç»ã€‚Promise ä¸€æ—¦æ•²å®šï¼Œå°±æ°¸è¿œä¸ä¼šä»å·²å…‘ç°å˜ä¸ºå·²æ‹’ç»ï¼Œåä¹‹äº¦ç„¶ã€‚</p>

<p>è®°ä½æˆ‘ä»¬åœ¨æœ¬èŠ‚å¼€å§‹æ—¶å¦‚ä½•å®šä¹‰ Promiseï¼šâ€œPromise æ˜¯æè¿°å¼‚æ­¥è®¡ç®—ç»“æœçš„å¯¹è±¡ã€‚â€é‡è¦çš„æ˜¯è¦è®°ä½ï¼ŒPromise ä¸ä»…ä»…æ˜¯æ³¨å†Œåœ¨æŸäº›å¼‚æ­¥ä»£ç å®Œæˆæ—¶è¿è¡Œçš„å›è°ƒçš„æŠ½è±¡æ–¹å¼ï¼Œå®ƒä»¬è¿˜æè¿°äº†å¼‚æ­¥ä»£ç çš„ç»“æœã€‚å¦‚æœå¼‚æ­¥ä»£ç æ­£å¸¸è¿è¡Œï¼ˆå¹¶ä¸” Promise å·²å…‘ç°ï¼‰ï¼Œé‚£ä¹ˆè¯¥ç»“æœå®è´¨ä¸Šå°±æ˜¯ä»£ç çš„è¿”å›å€¼ã€‚è€Œä¸”ï¼Œå¦‚æœå¼‚æ­¥ä»£ç æ— æ³•æ­£å¸¸å®Œæˆï¼ˆå¹¶ä¸” Promise å·²æ‹’ç»ï¼‰ï¼Œé‚£ä¹ˆç»“æœå°†æ˜¯ Error å¯¹è±¡æˆ–å…¶ä»–ä¸æ˜¯å¼‚æ­¥çš„ä»£ç å¯èƒ½ä¼šæŠ›å‡ºçš„å€¼ã€‚ä»»ä½•å·²æ•²å®šçš„ Promise éƒ½æœ‰ä¸å…¶ç›¸å…³çš„å€¼ï¼Œå¹¶ä¸”è¯¥å€¼ä¸ä¼šæ”¹å˜ã€‚å¦‚æœ Promise å·²å…‘ç°ï¼Œåˆ™è¯¥å€¼æ˜¯ä¸€ä¸ªè¿”å›å€¼ï¼Œè¯¥å€¼å°†ä¼ é€’ç»™æ³¨å†Œä¸º then() ç¬¬ä¸€ä¸ªå®å‚çš„å›è°ƒå‡½æ•°ã€‚å¦‚æœ Promise å·²æ‹’ç»ï¼Œåˆ™è¯¥å€¼æ˜¯æŸç§å¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸ä¼šä¼ é€’ç»™ä½¿ç”¨ catch() æˆ– then() çš„ç¬¬äºŒä¸ªå®å‚æ³¨å†Œçš„å›è°ƒå‡½æ•°ã€‚</p>

<p>æˆ‘å¸Œæœ›å¯¹ Promise æœ¯è¯­ä¿æŒç²¾ç¡®çš„åŸå› æ˜¯ Promise è¿˜å¯ä»¥è¢«å†³è®®ã€‚å°†å·²å†³è®®çŠ¶æ€ä¸å·²å…‘ç°çŠ¶æ€æˆ–å·²æ•²å®šçŠ¶æ€æ··æ·†æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œä½†æ˜¯ä¸‰è€…éƒ½ä¸å®Œå…¨ç›¸åŒã€‚ç†è§£å·²å†³è®®çŠ¶æ€æ˜¯æ·±å…¥äº†è§£ Promise çš„å…³é”®ä¹‹ä¸€ï¼Œåœ¨ä¸‹é¢è®¨è®ºäº† Promise é“¾ä¹‹åï¼Œæˆ‘å°†å†æ¬¡ä»‹ç»å®ƒã€‚</p>

<h3 id="toc_9">13.2.2 Promise é“¾</h3>

<p>Promise çš„æœ€é‡è¦çš„å¥½å¤„ä¹‹ä¸€æ˜¯ï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§è‡ªç„¶çš„æ–¹å¼æ¥è¡¨è¾¾ä¸€ç³»åˆ—å¼‚æ­¥æ“ä½œï¼Œè¡¨ç¤º then() æ–¹æ³•è°ƒç”¨çš„çº¿æ€§é“¾ï¼Œè€Œä¸å¿…å°†æ¯ä¸ªæ“ä½œåµŒå¥—åœ¨å‰ä¸€ä¸ªå›è°ƒä¸­ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå‡è®¾çš„ Promise é“¾ï¼š</p>

<pre><code class="language-javascript">fetch(documentURL)                      // Make an HTTP request
    .then(response =&gt; response.json())  // Ask for the JSON body of the response
    .then(document =&gt; {                 // When we get the parsed JSON
        return render(document);        // display the document to the user
    })
    .then(rendered =&gt; {                 // When we get the rendered document
        cacheInDatabase(rendered);      // cache it in the local database.
    })
    .catch(error =&gt; handle(error));     // Handle any errors that occur
</code></pre>

<p>æ­¤ä»£ç è¡¨æ˜äº† Promise é“¾å¦‚ä½•ç®€åŒ–ä¸€ç³»åˆ—å¼‚æ­¥æ“ä½œã€‚æˆ‘ä»¬ä¸ä¼šè®¨è®ºè¿™ä¸ªç‰¹æ®Šçš„ Promise é“¾ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å°†ç»§ç»­æ¢ç´¢ä½¿ç”¨ Promise é“¾å‘å‡º HTTP è¯·æ±‚çš„æƒ³æ³•ã€‚ </p>

<p>åœ¨æœ¬ç« çš„å‰é¢ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† XMLHttpRequest å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç”¨äºåœ¨ JavaScript ä¸­å‘å‡º HTTP è¯·æ±‚ã€‚è¿™ä¸ªå¥‡æ€ªå‘½åçš„å¯¹è±¡å…·æœ‰ä¸€ä¸ªæ—§ä¸”ç¬¨æ‹™çš„ APIï¼Œå¹¶ä¸”åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå·²è¢«è¾ƒæ–°çš„åŸºäº Promise çš„ Fetch APIï¼ˆÂ§15.11.1ï¼‰æ‰€å–ä»£ã€‚ä»¥æœ€ç®€å•çš„å½¢å¼ï¼Œè¿™ä¸ªæ–°çš„ HTTP API åªæ˜¯ fetch() å‡½æ•°ã€‚ç»™å®ƒä¼ é€’ä¸€ä¸ª URLï¼Œç„¶åè¿”å›ä¸€ä¸ª Promiseã€‚å½“ HTTP å¼€å§‹æ”¶åˆ°å“åº”å¹¶ä¸” HTTP çŠ¶æ€å’Œæ ‡å¤´å¯ç”¨æ—¶ï¼Œè¿™ä¸ª promise å·²å…‘ç°ï¼š</p>

<pre><code class="language-javascript">fetch(&quot;/api/user/profile&quot;).then(response =&gt; {
    // When the promise resolves, we have status and headers
    if (response.ok &amp;&amp;
        response.headers.get(&quot;Content-Type&quot;) === &quot;application/json&quot;) {
        // What can we do here? We don&#39;t actually have the response body yet.
    }
});
</code></pre>

<p>å½“ fetch() è¿”å›çš„ Promise å·²å…‘ç°æ—¶ï¼Œå®ƒå°† Response å¯¹è±¡ä¼ é€’ç»™ä¼ é€’ç»™ then() æ–¹æ³•çš„å‡½æ•°ã€‚æ­¤å“åº”å¯¹è±¡å¯ä»¥è®¿é—®è¯·æ±‚çŠ¶æ€å’Œæ ‡å¤´ï¼Œå¹¶ä¸”è¿˜å®šä¹‰äº†è¯¸å¦‚ text() å’Œ json() ä¹‹ç±»çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥åˆ†åˆ«ä»¥æ–‡æœ¬å’Œ JSON çš„å½¢å¼è®¿é—®å“åº”çš„æ­£æ–‡ã€‚ä½†æ˜¯ï¼Œå°½ç®¡æœ€åˆçš„ Promise å·²å…‘ç°ï¼Œä½†å“åº”çš„ä¸»ä½“å¯èƒ½å°šæœªåˆ°è¾¾ã€‚å› æ­¤ï¼Œè¿™äº›ç”¨äºè®¿é—®å“åº”æ­£æ–‡çš„ text() å’Œ json() æ–¹æ³•æœ¬èº«è¿”å› Promiseã€‚è¿™æ˜¯ä½¿ç”¨ fetch() å’Œ response.json() æ–¹æ³•è·å– HTTP Response å“åº”æ­£æ–‡çš„ä¸€ç§ç®€å•æ–¹æ³•ï¼š </p>

<pre><code class="language-javascript">fetch(&quot;/api/user/profile&quot;).then(response =&gt; {
    response.json().then(profile =&gt; {  // Ask for the JSON-parsed body
        // When the body of the response arrives, it will be automatically
        // parsed as JSON and passed to this function.
        displayUserProfile(profile);
    });
});
</code></pre>

<p>è¿™æ˜¯ Promise ä¸€ç§æ²¡ç»éªŒçš„ä½¿ç”¨æ–¹å¼ï¼Œå› ä¸ºæˆ‘ä»¬åƒå›è°ƒä¸€æ ·åµŒå¥—äº†å®ƒä»¬ï¼Œè¿™è¿èƒŒäº†ç›®çš„ã€‚é¦–é€‰å¸¸ç”¨æ–¹æ³•æ˜¯åœ¨é¡ºåºé“¾ä¸­ä½¿ç”¨ Promiseï¼Œå…¶ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š </p>

<pre><code class="language-javascript">fetch(&quot;/api/user/profile&quot;)
    .then(response =&gt; {
        return response.json();
    })
    .then(profile =&gt; {
        displayUserProfile(profile);
    });
</code></pre>

<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™æ®µä»£ç ä¸­çš„æ–¹æ³•è°ƒç”¨ï¼Œå¿½ç•¥ä¼ é€’ç»™æ–¹æ³•çš„å‚æ•°ï¼š </p>

<pre><code class="language-javascript">fetch().then().then()
</code></pre>

<p>å½“åƒè¿™æ ·åœ¨å•ä¸ªè¡¨è¾¾å¼ä¸­è°ƒç”¨å¤šä¸ªæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºæ–¹æ³•é“¾ã€‚æˆ‘ä»¬çŸ¥é“ fetch() å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°è¯¥é“¾ä¸­çš„ç¬¬ä¸€ä¸ª .then() ä½œä¸ºè¿”å›çš„ Promise å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ã€‚ä½†æ˜¯é“¾ä¸­è¿˜æœ‰ç¬¬äºŒä¸ª .then()ï¼Œè¿™æ„å‘³ç€ then() æ–¹æ³•çš„ç¬¬ä¸€æ¬¡è°ƒç”¨æœ¬èº«ä¸€å®šè¿”å› Promiseã€‚</p>

<p>æœ‰æ—¶ï¼Œå½“ä¸€ä¸ª API è®¾è®¡ä¸ºä½¿ç”¨è¿™ç§æ–¹æ³•é“¾æ¥æ—¶ï¼Œåªæœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡çš„æ¯ä¸ªæ–¹æ³•éƒ½è¿”å›è¯¥å¯¹è±¡æœ¬èº«ä»¥ä¾¿äºé“¾æ¥ã€‚ä½†æ˜¯ï¼Œè¿™ä¸æ˜¯ Promise çš„å·¥ä½œæ–¹å¼ã€‚å½“æˆ‘ä»¬ç¼–å†™ä¸€ç³»åˆ—çš„ .then() è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¹¶æœªåœ¨å•ä¸ª Promise å¯¹è±¡ä¸Šæ³¨å†Œå¤šä¸ªå›è°ƒã€‚è€Œæ˜¯ï¼Œå¯¹ then() æ–¹æ³•çš„æ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ã€‚åœ¨ä¼ é€’ç»™ then() çš„å‡½æ•°å®Œæˆä¹‹å‰ï¼Œæ–°çš„ Promise å¯¹è±¡ä¸ä¼šè¢«å…‘ç°ã€‚</p>

<p>è®©æˆ‘ä»¬å›åˆ°ä¸Šé¢åŸå§‹ fetch() é“¾çš„ç®€åŒ–å½¢å¼ã€‚å¦‚æœæˆ‘ä»¬åœ¨å…¶ä»–åœ°æ–¹å®šä¹‰ä¼ é€’ç»™ then() è°ƒç”¨çš„å‡½æ•°ï¼Œåˆ™å¯ä»¥å°†ä»£ç é‡æ„ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p>

<pre><code class="language-javascript">fetch(theURL)          // task 1; returns promise 1
    .then(callback1)   // task 2; returns promise 2
    .then(callback2);  // task 3; returns promise 3
</code></pre>

<p>è®©æˆ‘ä»¬è¯¦ç»†ä»‹ç»è¿™æ®µä»£ç ï¼š</p>

<ol>
<li>åœ¨ç¬¬ä¸€è¡Œï¼Œä½¿ç”¨ URL è°ƒç”¨ fetch()ã€‚å®ƒé’ˆå¯¹è¯¥ URL å‘èµ· HTTP GETè¯·æ±‚å¹¶è¿”å› Promiseã€‚æˆ‘ä»¬å°†è¿™ä¸ª HTTP è¯·æ±‚ç§°ä¸ºâ€œtask 1â€ï¼Œå°† Promise ç§°ä¸ºâ€œpromise 1â€ã€‚</li>
<li>åœ¨ç¬¬äºŒè¡Œï¼Œæˆ‘ä»¬è°ƒç”¨ promise 1 çš„ then() æ–¹æ³•ï¼Œå¹¶ä¼ é€’ promise 1 åœ¨å·²å…‘ç°æ—¶è¦è°ƒç”¨çš„ callback1 å‡½æ•°ã€‚then() æ–¹æ³•å°†å›è°ƒå‡½æ•°å­˜å‚¨åœ¨æŸä¸ªä½ç½®ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–°çš„ Promiseã€‚æˆ‘ä»¬å°†åœ¨è¿™ä¸€æ­¥è¿”å›çš„æ–° Promise ç§°ä¸ºâ€œpromise 2â€ï¼Œå¹¶ä¸”æˆ‘ä»¬è¯´å½“ callback1 è¢«è°ƒç”¨æ—¶â€œtask 2â€å¼€å§‹ã€‚</li>
<li>åœ¨ç¬¬ä¸‰è¡Œï¼Œæˆ‘ä»¬è°ƒç”¨ promise 2 çš„ then() æ–¹æ³•ï¼Œå¹¶ä¼ é€’ promise 2 åœ¨å·²å…‘ç°æ—¶è¦è°ƒç”¨çš„ callback2 å‡½æ•°ã€‚è¿™ä¸ª then() æ–¹æ³•ä¼šè®°ä½æˆ‘ä»¬çš„å›è°ƒå¹¶è¿”å›å¦ä¸€ä¸ª Promiseã€‚æˆ‘ä»¬è¯´â€œtask 3â€æ˜¯åœ¨è°ƒç”¨ callback2 æ—¶å¼€å§‹çš„ã€‚æˆ‘ä»¬å¯ä»¥å°†æœ€æ–°çš„ Promise ç§°ä¸ºâ€œpromise 3â€ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸éœ€è¦å®ƒçš„åç§°ï¼Œå› ä¸ºæˆ‘ä»¬æ ¹æœ¬ä¸ä¼šä½¿ç”¨å®ƒã€‚</li>
<li>æœ€åˆæ‰§è¡Œè¡¨è¾¾å¼æ—¶ï¼Œå‰ä¸‰ä¸ªæ­¥éª¤éƒ½æ˜¯åŒæ­¥å‘ç”Ÿçš„ã€‚ç°åœ¨ï¼Œåœ¨ç¬¬ 1 æ­¥ä¸­å¯åŠ¨çš„ HTTP è¯·æ±‚é€šè¿‡ Internet å‘é€æ—¶ï¼Œæˆ‘ä»¬æœ‰äº†å¼‚æ­¥æš‚åœã€‚</li>
<li>æœ€ç»ˆï¼ŒHTTP å“åº”å¼€å§‹åˆ°è¾¾ã€‚fetch() è°ƒç”¨çš„å¼‚æ­¥éƒ¨åˆ†å°† HTTP çŠ¶æ€å’Œæ ‡å¤´åŒ…è£…åœ¨ Response å¯¹è±¡ä¸­ï¼Œå¹¶ä»¥è¯¥ Response å¯¹è±¡ä½œä¸ºå€¼æ¥å…‘ç° promise 1ã€‚</li>
<li>promise 1 å·²å…‘ç°åï¼Œå…¶å€¼ï¼ˆResponse å¯¹è±¡ï¼‰å°†ä¼ é€’åˆ°æˆ‘ä»¬çš„ callback1() å‡½æ•°ï¼Œtask 2 å¼€å§‹ã€‚ä»¥ Response å¯¹è±¡ä½œä¸ºè¾“å…¥ï¼Œæ­¤ä»»åŠ¡çš„å·¥ä½œæ˜¯è·å¾—å“åº”ä¸»ä½“è½¬åŒ–ä¸º JSON å¯¹è±¡ã€‚</li>
<li>å‡è®¾ task 2 æ­£å¸¸å®Œæˆï¼Œå¹¶ä¸”èƒ½å¤Ÿè§£æ HTTP å“åº”ä¸»ä½“ä»¥ç”Ÿæˆ JSON å¯¹è±¡ã€‚æ­¤ JSON å¯¹è±¡ç”¨äºå…‘ç° promise 2ã€‚</li>
<li>å…‘ç° promise 2 çš„å€¼åœ¨ä¼ é€’ç»™ callback2() å‡½æ•°æ—¶æˆä¸º task 3 çš„è¾“å…¥ã€‚ç°åœ¨ï¼Œç¬¬ä¸‰ä¸ªä»»åŠ¡ä»¥æŸç§æœªæŒ‡å®šçš„æ–¹å¼å‘ç”¨æˆ·æ˜¾ç¤ºæ•°æ®ã€‚å½“ task 3 å®Œæˆæ—¶ï¼ˆå‡è®¾å®ƒæ­£å¸¸å®Œæˆï¼‰ï¼Œåˆ™ promise 3 å°†è¢«å…‘ç°ã€‚ä½†æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬ä»æœªå¯¹ promise 3 åšä»»ä½•äº‹æƒ…ï¼Œæ‰€ä»¥å½“ promise 3 æ•²å®šæ—¶ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœ‰å‘ç”Ÿï¼Œå¹¶ä¸”å¼‚æ­¥è®¡ç®—é“¾åˆ°æ­¤ç»“æŸã€‚ </li>
</ol>

<h3 id="toc_10">13.2.3 Promise å†³è®®</h3>

<p>åœ¨ä¸Šä¸€éƒ¨åˆ†ä¸­ç”¨åˆ—è¡¨è§£é‡Š URL-fetching Promise é“¾æ—¶ï¼Œæˆ‘ä»¬è®¨è®ºäº† promise 1ã€2 å’Œ 3ã€‚ä½†æ˜¯å®é™…ä¸Šä¹Ÿæ¶‰åŠç¬¬å››ä¸ª Promise å¯¹è±¡ï¼Œå¹¶ä¸”è¿™ä¸ºæˆ‘ä»¬å¸¦æ¥é‡è¦çš„è®¨è®ºâ€”â€”â€”â€”ä»€ä¹ˆæ˜¯ Promise çš„â€œå·²å†³è®®ï¼ˆresolvedï¼‰â€çŠ¶æ€ ã€‚ </p>

<p>è¯·è®°ä½ï¼Œfetch() è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå½“å…¶å·²å…‘ç°æ—¶ï¼Œå®ƒå°† Response å¯¹è±¡ä¼ é€’ç»™æˆ‘ä»¬æ³¨å†Œçš„å›è°ƒå‡½æ•°ã€‚æ­¤ Response å¯¹è±¡å…·æœ‰ .text()ã€.json() å’Œå…¶ä»–æ–¹æ³•ï¼Œä»¥å„ç§å½¢å¼è¯·æ±‚ HTTP å“åº”çš„ä¸»ä½“ã€‚ä½†æ˜¯ç”±äºä¸»ä½“å¯èƒ½å°šæœªåˆ°è¾¾ï¼Œå› æ­¤è¿™äº›æ–¹æ³•å¿…é¡»è¿”å› Promise å¯¹è±¡ã€‚åœ¨æˆ‘ä»¬ä¸€ç›´åœ¨ç ”ç©¶çš„ç¤ºä¾‹ä¸­ï¼Œâ€œtask 2â€è°ƒç”¨ .json() æ–¹æ³•å¹¶è¿”å›å…¶å€¼ã€‚è¿™æ˜¯ç¬¬å››ä¸ª Promise å¯¹è±¡ï¼Œå®ƒæ˜¯ callback1() å‡½æ•°çš„è¿”å›å€¼ã€‚</p>

<p>è®©æˆ‘ä»¬ä»¥å†—é•¿ä¸”éå¸¸ç”¨æ–¹å¼å†æ¬¡é‡å†™ URL-fetching ä»£ç ï¼Œä½¿å›è°ƒå’Œ Promise æ˜ç¡®åŒ–ï¼š</p>

<pre><code class="language-javascript">function c1(response) {               // callback 1
    let p4 = response.json();
    return p4;                        // returns promise 4
}

function c2(profile) {                // callback 2
    displayUserProfile(profile);
}

let p1 = fetch(&quot;/api/user/profile&quot;);  // promise 1, task 1
let p2 = p1.then(c1);                 // promise 2, task 2
let p3 = p2.then(c2);                 // promise 3, task 3
</code></pre>

<p>ä¸ºäº†ä½¿ Promise é“¾æœ‰æ•ˆåœ°å·¥ä½œï¼Œtask 2 çš„è¾“å‡ºå¿…é¡»æˆä¸º task 3 çš„è¾“å…¥ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè€ƒè™‘çš„æ˜¯ï¼Œtask 3 çš„è¾“å…¥æ˜¯ä» URL æ‰€è·å–çš„çš„ä¸»ä½“ï¼Œå°†å…¶è§£æä¸º JSON å¯¹è±¡ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚æˆ‘ä»¬åˆšåˆšè®¨è®ºçš„é‚£æ ·ï¼Œå›è°ƒ c1 çš„è¿”å›å€¼ä¸æ˜¯ JSON å¯¹è±¡ï¼Œè€Œæ˜¯è¯¥ JSON å¯¹è±¡çš„ Promise p4ã€‚è¿™ä¼¼ä¹æœ‰çŸ›ç›¾ï¼Œä½†å¹¶éå¦‚æ­¤ï¼šå½“ p1 å·²å…‘ç°æ—¶ï¼Œå°†è°ƒç”¨ c1ï¼Œå¹¶ä¸” task 2 å¼€å§‹ã€‚å½“ p2 å·²å…‘ç°æ—¶ï¼Œc2 è¢«è°ƒç”¨ï¼Œtask 3 å¼€å§‹ã€‚ä½†æ˜¯ï¼Œä»…ä»…å› ä¸º c1 è¢«è°ƒç”¨æ—¶å¼€å§‹ task 2 ï¼Œå¯è¿™å¹¶ä¸æ„å‘³ç€ task 2 å¿…é¡»åœ¨ c1 è¿”å›æ—¶ç»“æŸã€‚æ¯•ç«Ÿï¼ŒPromise æ˜¯å…³äºç®¡ç†å¼‚æ­¥ä»»åŠ¡çš„ï¼Œå¦‚æœ task 2 æ˜¯å¼‚æ­¥çš„ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸ºå¼‚æ­¥ï¼‰ï¼Œåˆ™åœ¨å›è°ƒè¿”å›æ—¶è¯¥ä»»åŠ¡å°†ä¸ä¼šå®Œæˆã€‚</p>

<p>ç°åœ¨æˆ‘ä»¬å‡†å¤‡è®¨è®ºæœ€åçš„ç»†èŠ‚ï¼Œéœ€è¦äº†è§£è¿™äº›æ‰èƒ½çœŸæ­£æŒæ¡ Promiseã€‚å½“å°†å›è°ƒ c ä¼ é€’ç»™ then() æ–¹æ³•æ—¶ï¼Œthen() è¿”å› Promise p å¹¶å®‰æ’åœ¨ä»¥åçš„æŸä¸ªæ—¶é—´å¼‚æ­¥è°ƒç”¨  cã€‚è°ƒæ‰§è¡Œä¸€äº›è®¡ç®—å¹¶è¿”å›å€¼ vã€‚å½“å›è°ƒè¿”å›æ—¶ï¼Œp ç”¨å€¼ v å†³è®®ã€‚å½“ Promise ä½¿ç”¨ä¸æ˜¯æœ¬èº«çš„ Promise å€¼å†³è®®æ—¶ï¼Œç«‹å³ç”¨è¯¥å€¼å…‘ç°ã€‚å› æ­¤ï¼Œå¦‚æœ c è¿”å›ä¸€ä¸ªé Promiseï¼Œåˆ™è¿”å›å€¼æˆä¸º p çš„å€¼ï¼Œåˆ™ p å·²å…‘ç°å¹¶ä¸”ä»»åŠ¡å®Œæˆã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿”å›å€¼ v æœ¬èº«æ˜¯ä¸€ä¸ª Promiseï¼Œåˆ™ p å·²å†³è®®ä½†å°šæœªå…‘ç°ã€‚åœ¨æ­¤é˜¶æ®µï¼Œç›´åˆ° Promise v æ•²å®šï¼Œp æ‰èƒ½æ•²å®šã€‚å¦‚æœ v å·²å…‘ç°ï¼Œåˆ™ p å°†è¢«å…‘ç°ä¸ºç›¸åŒçš„å€¼ã€‚å¦‚æœ v å·²æ‹’ç»ï¼Œåˆ™ p å°†å› ç›¸åŒçš„åŸå› è€Œè¢«æ‹’ç»ã€‚è¿™å°±æ˜¯ä¸€ä¸ª Promise çš„â€œå·²å†³è®®ï¼ˆresolvedï¼‰â€çŠ¶æ€çš„å«ä¹‰ï¼šPromise å·²ä¸å¦ä¸€ä¸ª Promise å…³è”æˆ–â€œé”å®šâ€ã€‚æˆ‘ä»¬å°šä¸çŸ¥é“ p æ˜¯å·²å…‘ç°è¿˜æ˜¯æ‹’ç»ï¼Œä½†æ˜¯æˆ‘ä»¬çš„å›è°ƒ c å¯¹æ­¤ä¸å†å…·æœ‰ä»»ä½•æ§åˆ¶æƒã€‚p æ˜¯â€œå·²å†³è®®â€çš„ï¼Œä»è¿™ä¸€æ–¹é¢æ¥è¯´å®ƒå‘½è¿ç°åœ¨å®Œå…¨å–å†³äº Promise v ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p>

<p>è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ URL-fetching ç¤ºä¾‹ä¸­ã€‚ å½“ c1 è¿”å› p4 æ—¶ï¼Œp2 å·²å†³è®®ã€‚ä½†æ˜¯å·²å†³è®®ä¸å·²å…‘ç°å¹¶ä¸ç›¸åŒï¼Œå› æ­¤ task 3 å°šæœªå¼€å§‹ã€‚å½“ HTTP å“åº”çš„å…¨æ–‡å¯ç”¨æ—¶ï¼Œ.json() æ–¹æ³•å¯ä»¥å¯¹å…¶è¿›è¡Œè§£æï¼Œå¹¶ä½¿ç”¨è¯¥è§£æåçš„å€¼æ¥å·²å…‘ç° p4ã€‚ å½“ p4 å·²å…‘ç°æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨ç›¸åŒçš„å·²è§£æ JSON å€¼è‡ªåŠ¨å·²å…‘ç° p2ã€‚æ­¤æ—¶ï¼Œå·²è§£æçš„ JSON å¯¹è±¡å°†ä¼ é€’ç»™ c2ï¼Œç„¶å task 3 å¼€å§‹ã€‚</p>

<p>è¿™å¯èƒ½æ˜¯ JavaScript æœ€éš¾ç†è§£çš„éƒ¨åˆ†ä¹‹ä¸€ï¼Œå¯èƒ½éœ€è¦å¤šæ¬¡é˜…è¯»æœ¬èŠ‚ã€‚å›¾ 13-1 ä»¥å¯è§†å½¢å¼æ˜¾ç¤ºäº†è¯¥è¿‡ç¨‹ï¼Œå¯èƒ½æœ‰åŠ©äºå¯¹å…¶è¿›è¡Œè¯´æ˜ã€‚</p>

<p>å›¾ 13-1 ç”¨ Promise è·å– URL<br/>
<img src="media/16130963623880/fg13-1.png" alt="fg13-1"/></p>

<h3 id="toc_11">13.2.4 æ›´å¤šå…³äº Promise å’Œå¼‚å¸¸</h3>

<p>åœ¨æœ¬ç« çš„å‰é¢ï¼Œæˆ‘ä»¬çœ‹åˆ°å¯ä»¥å°†ç¬¬äºŒä¸ªå›è°ƒå‡½æ•°ä¼ é€’ç»™ .then() æ–¹æ³•ï¼Œå¹¶ä¸”å¦‚æœ Promise è¢«æ‹’ç»ï¼Œåˆ™å°†è°ƒç”¨è¯¥ç¬¬äºŒä¸ªå‡½æ•°ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œç¬¬äºŒä¸ªå›è°ƒå‡½æ•°çš„å®å‚æ˜¯ä¸€ä¸ªå€¼ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ª Error å¯¹è±¡ï¼‰ï¼Œå®ƒè¡¨ç¤ºæ‹’ç»çš„åŸå› ã€‚æˆ‘ä»¬è¿˜äº†è§£åˆ°ï¼Œå°†ä¸¤ä¸ªå›è°ƒä¼ é€’ç»™ .then() æ–¹æ³•å¹¶ä¸å¸¸è§ï¼ˆç”šè‡³æ˜¯å•ä¾‹çš„ï¼‰ã€‚ç›¸åï¼Œé€šå¸¸é€šè¿‡å‘ Promise é“¾æ·»åŠ  .catch() æ–¹æ³•è°ƒç”¨æ¥å¤„ç†ä¸ Promise ç›¸å…³çš„å¼‚å¸¸ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»æ£€æŸ¥äº† Promise é“¾ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›å¼‚å¸¸å¤„ç†å¹¶æ›´è¯¦ç»†åœ°è®¨è®ºå®ƒã€‚åœ¨å¼€å§‹è®¨è®ºä¹‹å‰ï¼Œæˆ‘æƒ³å¼ºè°ƒæŒ‡å‡ºï¼Œè¿›è¡Œå¼‚æ­¥ç¼–ç¨‹æ—¶ï¼Œä»”ç»†çš„å¼‚å¸¸å¤„ç†éå¸¸é‡è¦ã€‚ä½¿ç”¨åŒæ­¥ä»£ç ï¼Œå¦‚æœçœç•¥äº†å¼‚å¸¸å¤„ç†ä»£ç ï¼Œåˆ™è‡³å°‘ä¼šå¾—åˆ°ä¸€ä¸ªå¼‚å¸¸å’Œä¸€ä¸ªå †æ ˆè·Ÿè¸ªï¼Œå¯ç”¨äºæ‰¾å‡ºé—®é¢˜æ‰€åœ¨ã€‚å¯¹äºå¼‚æ­¥ä»£ç ï¼Œæœªå¤„ç†çš„å¼‚å¸¸é€šå¸¸ä¸ä¼šæŠ¥å‘Šï¼Œå¼‚å¸¸å¯ä»¥é™é»˜å‘ç”Ÿï¼Œä»è€Œä½¿è°ƒè¯•æ›´åŠ å›°éš¾ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œä½¿ç”¨ .catch() æ–¹æ³•å¯ä»¥æ›´è½»æ¾åœ°å¤„ç† Promise çš„å¼‚å¸¸ã€‚</p>

<h4 id="toc_12">CATCH å’Œ FINALLY æ–¹æ³•</h4>

<p>.then() å¯ä»¥å¤„ç†å¼‚å¸¸ï¼Œä½¿ç”¨ null ä¸ºç¬¬ä¸€ä¸ªå®å‚ï¼Œè€Œå¼‚å¸¸å¤„ç†å›è°ƒä¸ºç¬¬äºŒä¸ªå®å‚ï¼ŒPromise çš„ .catch() æ–¹æ³•åªæ˜¯è¿™ç§ .then() è°ƒç”¨çš„ä¸€ç§ç®€ä¾¿å†™æ³•ã€‚ç»™å®š Promise p å’Œå›è°ƒ cï¼Œä»¥ä¸‹ä¸¤è¡Œä»£ç æ˜¯ç­‰æ•ˆçš„ï¼š</p>

<pre><code class="language-javascript">p.then(null, c);
p.catch(c);
</code></pre>

<p>é¦–é€‰ .catch() é€Ÿè®°ï¼Œå› ä¸ºå®ƒæ›´ç®€å•ï¼Œå¹¶ä¸”åç§°ä¸ try/catch å¼‚å¸¸å¤„ç†è¯­å¥ä¸­çš„ catch å­å¥åŒ¹é…ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼Œæ™®é€šä¾‹å¤–ä¸é€‚ç”¨äºå¼‚æ­¥ä»£ç ã€‚Promise çš„ .catch() æ–¹æ³•æ˜¯ä¸€ç§é€‚ç”¨äºå¼‚æ­¥ä»£ç çš„æ›¿ä»£æ–¹æ³•ã€‚å½“åŒæ­¥ä»£ç ä¸­å‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬â€œä½¿è°ƒç”¨å †æ ˆå†’æ³¡â€æè¿°ä¸€ä¸ªå¼‚å¸¸ï¼Œç›´åˆ°æ‰¾åˆ° catch å—ä¸ºæ­¢ã€‚å¯¹äºå¼‚æ­¥çš„ Promise é“¾ï¼Œåˆ™æ˜¯â€œå‘é“¾ä¸‹æ»´â€ï¼Œç›´åˆ°æ‰¾åˆ° .catch() è°ƒç”¨ä¸ºæ­¢ã€‚</p>

<p>åœ¨ ES2018 ä¸­ï¼ŒPromise å¯¹è±¡è¿˜å®šä¹‰äº†ä¸€ä¸ª .finally() æ–¹æ³•ï¼Œå…¶ç›®çš„ç±»ä¼¼äº try/catch/finally è¯­å¥ä¸­çš„ finally å­å¥ã€‚å¦‚æœå°† .finally() è°ƒç”¨æ·»åŠ åˆ° Promise é“¾ä¸­ï¼Œé‚£ä¹ˆ .finally() çš„è°ƒç”¨è€… Promise çš„æ•²å®šçš„æ—¶å€™ï¼Œä¼ é€’ç»™ .finally() çš„å›è°ƒå°†è¢«è°ƒç”¨ã€‚å¦‚æœ Promise å·²å…‘ç°æˆ–å·²æ‹’ç»ï¼Œåˆ™å°†è°ƒç”¨å›è°ƒï¼Œå¹¶ä¸”å®ƒä¸ä¼šå†ä½œä¸ºå®å‚ä¼ é€’ï¼Œå› æ­¤æ— æ³•ç¡®å®šå®ƒæ˜¯å·²å…‘ç°è¿˜æ˜¯å·²æ‹’ç»ã€‚ä½†æ˜¯ï¼Œæ— è®ºå“ªç§æƒ…å†µï¼Œå¦‚æœéƒ½éœ€è¦è¿è¡ŒæŸç§æ¸…ç†ä»£ç ï¼ˆä¾‹å¦‚å…³é—­æ‰“å¼€çš„æ–‡ä»¶æˆ–ç½‘ç»œè¿æ¥ï¼‰ï¼Œåˆ™ .finally() å›è°ƒæ˜¯å®ç°æ­¤ç›®çš„çš„ç†æƒ³æ–¹æ³•ã€‚ä¸ .then() å’Œ .catch() ä¸€æ ·ï¼Œ.finally() è¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ã€‚.finally() å›è°ƒçš„è¿”å›å€¼é€šå¸¸è¢«å¿½ç•¥ï¼Œ.finally() è¿”å›çš„ Promise é€šå¸¸å°†ä»¥è°ƒç”¨ .finally() çš„ Promise ç›¸åŒçš„å€¼æ¥å†³è®®æˆ–æ‹’ç»ã€‚ä½†æ˜¯ï¼Œå¦‚æœ .finally() å›è°ƒå¼•å‘å¼‚å¸¸ï¼Œåˆ™ .finally() è¿”å›çš„ Promise ä»¥è¯¥å¼‚å¸¸å€¼æ‹’ç»ã€‚</p>

<p>æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­ç ”ç©¶çš„ URL-fetching ä»£ç æ²¡æœ‰ä»»ä½•å¼‚å¸¸å¤„ç†ã€‚ç°åœ¨ï¼Œä½¿ç”¨æ›´å¯è¡Œçš„ä»£ç ç‰ˆæœ¬è¿›è¡Œæ›´æ­£ï¼š</p>

<pre><code class="language-javascript">fetch(&quot;/api/user/profile&quot;)    // Start the HTTP request
    .then(response =&gt; {       // Call this when status and headers are ready
        if (!response.ok) {   // If we got a 404 Not Found or similar error
            return null;      // Maybe user is logged out; return null profile
        }

        // Now check the headers to ensure that the server sent us JSON.
        // If not, our server is broken, and this is a serious error!
        let type = response.headers.get(&quot;content-type&quot;);
        if (type !== &quot;application/json&quot;) {
            throw new TypeError(`Expected JSON, got ${type}`);
        }

        // If we get here, then we got a 2xx status and a JSON content-type
        // so we can confidently return a Promise for the response
        // body as a JSON object.
        return response.json();
    })
    .then(profile =&gt; {        // Called with the parsed response body or null
        if (profile) {
            displayUserProfile(profile);
        }
        else { // If we got a 404 error above and returned null we end up here
            displayLoggedOutProfilePage();
        }
    })
    .catch(e =&gt; {
        if (e instanceof NetworkError) {
            // fetch() can fail this way if the internet connection is down
            displayErrorMessage(&quot;Check your internet connection.&quot;);
        }
        else if (e instanceof TypeError) {
            // This happens if we throw TypeError above
            displayErrorMessage(&quot;Something is wrong with our server!&quot;);
        }
        else {
            // This must be some kind of unanticipated error
            console.error(e);
        }
    });
</code></pre>

<p>è®©æˆ‘ä»¬é€šè¿‡å‘ç”Ÿå¼‚å¸¸æƒ…å†µæƒ…å†µæ¥åˆ†ææ­¤ä»£ç ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¹‹å‰ä½¿ç”¨çš„å‘½åæ–¹æ¡ˆï¼šp1 æ˜¯ fetch() è°ƒç”¨è¿”å›çš„ Promiseã€‚p2 æ˜¯ç¬¬ä¸€ä¸ª .then() è°ƒç”¨è¿”å›çš„ Promiseï¼Œè€Œ c1 æ˜¯æˆ‘ä»¬ä¼ é€’ç»™è¯¥ .then() çš„å›è°ƒã€‚p3 æ˜¯ç¬¬äºŒä¸ª .then() è°ƒç”¨è¿”å›çš„ Promiseï¼Œè€Œ c2 æ˜¯æˆ‘ä»¬ä¼ é€’ç»™è¯¥è°ƒç”¨çš„å›è°ƒã€‚æœ€åï¼Œc3 æ˜¯æˆ‘ä»¬ä¼ é€’ç»™ .catch() çš„å›è°ƒã€‚ï¼ˆè¯¥è°ƒç”¨è¿”å›ä¸€ä¸ª Promiseï¼Œä½†æˆ‘ä»¬ä¸éœ€è¦æŒ‰åç§°å¼•ç”¨å®ƒã€‚ï¼‰</p>

<p>ç¬¬ä¸€ä¸ªå¯èƒ½å¤±è´¥çš„æ˜¯ fetch() è¯·æ±‚æœ¬èº«ã€‚å¦‚æœç½‘ç»œè¿æ¥æ–­å¼€ï¼ˆæˆ–ç”±äºæŸäº›å…¶ä»–åŸå› è€Œæ— æ³•å‘å‡º HTTP è¯·æ±‚ï¼‰ï¼Œåˆ™ Promise p1 å°†è¢« NetworkError å¯¹è±¡æ‹’ç»ã€‚æˆ‘ä»¬æ²¡æœ‰å°†å¼‚å¸¸å¤„ç†å›è°ƒå‡½æ•°ä½œä¸º .then() è°ƒç”¨çš„ç¬¬äºŒä¸ªå®å‚ä¼ é€’ï¼Œå› æ­¤ p2 åŒæ ·ä¼šè¢«ç›¸åŒçš„ NetworkError å¯¹è±¡æ‹’ç»ã€‚ï¼ˆå¦‚æœå°†å¼‚å¸¸å¤„ç†ç¨‹åºä¼ é€’ç»™ç¬¬ä¸€ä¸ª .then() è°ƒç”¨ï¼Œåˆ™å°†è°ƒç”¨è¯¥å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œå¹¶ä¸”å¦‚æœè¯¥å¼‚å¸¸å¤„ç†ç¨‹åºæ­£å¸¸è¿”å›ï¼Œä¼´éšå¤„ç†çš„è¿”å›å€¼ï¼Œp2 å˜ä¸ºå·²å†³è®®å’Œæˆ–æˆ–å·²å…‘ç°ã€‚ï¼‰ä½†æ˜¯ï¼Œå‡ºäºç›¸åŒçš„åŸå› ï¼Œp2 è¢«æ‹’ç»ï¼Œç„¶å p3 è¢«æ‹’ç»ã€‚æ­¤æ—¶ï¼Œå°†è°ƒç”¨ c3 å¼‚å¸¸å¤„ç†å›è°ƒï¼Œå¹¶åœ¨å…¶ä¸­è¿è¡Œç‰¹å®šäº NetworkError çš„ä»£ç ã€‚</p>

<p>ä»£ç å¤±è´¥çš„å¦ä¸€ç§æ–¹å¼æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„ HTTP è¯·æ±‚è¿”å› 404 Not Found æˆ–å¦ä¸€ä¸ª HTTP å¼‚å¸¸ã€‚è¿™äº›æ˜¯æœ‰æ•ˆçš„ HTTP å“åº”ï¼Œå› æ­¤ fetch() è°ƒç”¨ä¸ä¼šå°†å…¶è§†ä¸ºå¼‚å¸¸ã€‚fetch() åœ¨ Response å¯¹è±¡ä¸­å°è£…äº†ä¸€ä¸ª 404 Not Foundï¼Œå¹¶ç”¨è¯¥å¯¹è±¡å·²å…‘ç° p1ï¼Œä»è€Œå¯¼è‡´ c1 è¢«è°ƒç”¨ã€‚æˆ‘ä»¬åœ¨ c1 ä¸­çš„ä»£ç æ£€æŸ¥ Response å¯¹è±¡çš„ ok å±æ€§ï¼Œä»¥æ£€æµ‹å®ƒæ²¡æœ‰æ”¶åˆ°æ­£å¸¸çš„ HTTP å“åº”ï¼Œå¹¶é€šè¿‡ç®€å•åœ°è¿”å› null æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚å› ä¸ºæ­¤è¿”å›å€¼ä¸æ˜¯ Promiseï¼Œæ‰€ä»¥å®ƒç«‹å³å·²å…‘ç° p2ï¼Œå¹¶ä½¿ç”¨è¯¥å€¼è°ƒç”¨ c2ã€‚ æˆ‘ä»¬åœ¨ c2 ä¸­çš„ä»£ç æ˜¾å¼æ£€æŸ¥å¹¶å¤„ç†é”™è¯¯å€¼ï¼Œå¹¶å‘ç”¨æˆ·æ˜¾ç¤ºä¸åŒçš„ç»“æœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†å¼‚å¸¸æƒ…å†µè§†ä¸ºéå¼‚å¸¸ï¼Œå¹¶åœ¨ä¸ä½¿ç”¨å¼‚å¸¸å¤„ç†ç¨‹åºçš„æƒ…å†µä¸‹å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</p>

<p>å¦‚æœæˆ‘ä»¬è·å¾—æ­£å¸¸çš„ HTTP å“åº”ä»£ç ï¼Œä½† Content-Type æ ‡å¤´è®¾ç½®ä¸æ­£ç¡®ï¼Œåˆ™ c1 ä¸­ä¼šå‘ç”Ÿæ›´ä¸¥é‡çš„å¼‚å¸¸ã€‚æˆ‘ä»¬çš„ä»£ç éœ€è¦ä¸€ä¸ª JSON æ ¼å¼çš„å“åº”ï¼Œå› æ­¤ï¼Œå¦‚æœæœåŠ¡å™¨å‘é€ç»™æˆ‘ä»¬çš„æ˜¯ HTMLã€XML æˆ–çº¯æ–‡æœ¬ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä¼šé‡åˆ°é—®é¢˜ã€‚c1 åŒ…å«ç”¨äºæ£€æŸ¥ Content-Type æ ‡å¤´çš„ä»£ç ã€‚å¦‚æœæ ‡å¤´é”™è¯¯ï¼Œåˆ™å°†å…¶è§†ä¸ºä¸å¯æ¢å¤çš„é—®é¢˜ï¼Œå¹¶å¼•å‘ TypeErrorã€‚å½“ä¼ é€’ç»™ .then()ï¼ˆæˆ– .catch()ï¼‰çš„å›è°ƒå¼•å‘ä¸€ä¸ªå€¼æ—¶ï¼Œä½œä¸º .then() è°ƒç”¨çš„è¿”å›çš„ Promise å°†è¢«è¯¥æŠ›å‡ºçš„å€¼æ‹’ç»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œc1 ä¸­çš„ä»£ç å¼•å‘ TypeError å¯¼è‡´å¸¦æœ‰ TypeError å¯¹è±¡çš„ p2 ä¸€èµ·è¢«æ‹’ç»ã€‚ç”±äºæˆ‘ä»¬æ²¡æœ‰ä¸º p2 æŒ‡å®šå¼‚å¸¸å¤„ç†ç¨‹åºï¼Œå› æ­¤ p3 ä¹Ÿå°†è¢«æ‹’ç»ã€‚c2 å°†ä¸ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸” TypeError å°†ä¼ é€’ç»™ c3ï¼Œåè€…å…·æœ‰æ˜¾å¼æ£€æŸ¥å’Œå¤„ç†æ­¤ç±»å¼‚å¸¸çš„ä»£ç ã€‚</p>

<p>å…³äºæ­¤ä»£ç æœ‰äº›å¾—æ³¨æ„ã€‚é¦–å…ˆï¼Œè¯·æ³¨æ„ç”¨å¸¸è§„çš„åŒæ­¥ throw è¯­å¥å¼•å‘çš„å¼‚å¸¸å¯¹è±¡æœ€ç»ˆä¼šé€šè¿‡ Promise é“¾ä¸­çš„ .catch() æ–¹æ³•è°ƒç”¨è¿›è¡Œå¼‚æ­¥æ•è·ã€‚è¿™æ¸…æ¥šè¡¨æ˜ä¸ºä»€ä¹ˆä¸å°†ç¬¬äºŒä¸ªå®å‚ä¼ é€’ç»™ .then() ç›¸æ¯”æ›´åå‘ä½¿ç”¨è¿™ç§é€Ÿè®°æ–¹æ³•ï¼Œä»¥åŠä¸ºä»€ä¹ˆä¹ æƒ¯ä»¥ .catch() è°ƒç”¨ç»“æŸ Promise é“¾ã€‚</p>

<p>åœ¨æˆ‘ä»¬ç»“æŸå¼‚å¸¸å¤„ç†ä¸»é¢˜ä¹‹å‰ï¼Œæˆ‘æƒ³æŒ‡å‡ºï¼Œå°½ç®¡ä¹ æƒ¯äºåœ¨æ¯ä¸ª Promise é“¾ä¸­æ·»åŠ ä¸€ä¸ª .catch() æ¥æ¸…ç†ï¼ˆæˆ–è‡³å°‘è®°å½•æ—¥å¿—ï¼‰è¯¥é“¾ä¸­å‘ç”Ÿçš„ä»»ä½•å¼‚å¸¸ï¼Œä½†æ˜¯åœ¨ Promise é“¾ä¸­çš„å…¶ä»–ä½ç½®ä½¿ç”¨ .catch() ä¹Ÿå®Œå…¨æœ‰æ•ˆã€‚å¦‚æœ Promise é“¾ä¸­çš„æŸä¸€é˜¶æ®µå¯èƒ½å› å¼‚å¸¸è€Œå¤±è´¥ï¼Œå¹¶ä¸”è¯¥å¼‚å¸¸æ˜¯æŸç§å¯æ¢å¤çš„å¼‚å¸¸ï¼Œå¹¶ä¸”è¯¥å¼‚å¸¸ä¸ä¼šé˜»æ­¢é“¾çš„å…¶ä½™éƒ¨åˆ†è¿è¡Œï¼Œåˆ™å¯ä»¥åœ¨é“¾ä¸­æ’å…¥ .catch() è°ƒç”¨ï¼Œä»£ç å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<pre><code class="language-javascript">startAsyncOperation()
    .then(doStageTwo)
    .catch(recoverFromStageTwoError)
    .then(doStageThree)
    .then(doStageFour)
    .catch(logStageThreeAndFourErrors);
</code></pre>

<p>è¯·è®°ä½ï¼Œä»…å½“å‰ä¸€é˜¶æ®µçš„å›è°ƒå¼•å‘å¼‚å¸¸æ—¶ï¼Œæ‰ä¼šè°ƒç”¨ä¼ é€’ç»™ catch() çš„å›è°ƒã€‚å¦‚æœè¯¥å›è°ƒæ­£å¸¸è¿”å›ï¼Œåˆ™å°†è·³è¿‡ catch() å›è°ƒï¼Œå¹¶ä¸”å‰ä¸€ä¸ªå›è°ƒçš„è¿”å›å€¼å°†æˆä¸ºä¸‹ä¸€ä¸ª then() å›è°ƒçš„è¾“å…¥ã€‚è¿˜è¯·è®°ä½ï¼Œcatch() å›è°ƒä¸ä»…ç”¨äºå¼‚å¸¸æŠ¥å‘Šï¼Œè€Œä¸”ç”¨äºå¼‚å¸¸å¤„ç†å¹¶ä»å¼‚å¸¸ä¸­æ¢å¤ã€‚å°†å¼‚å¸¸ä¼ é€’ç»™ catch() å›è°ƒåï¼Œå®ƒå°†åœæ­¢æ²¿ Promise é“¾ä¼ æ’­ã€‚catch() å›è°ƒå¯ä»¥å¼•å‘æ–°çš„å¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœå®ƒæ­£å¸¸è¿”å›ï¼Œåˆ™è¯¥è¿”å›å€¼ç”¨äºå†³è®®å’Œæˆ–æˆ–å…‘ç°å…³è”çš„ Promiseï¼Œå¹¶ä¸”å¼‚å¸¸åœæ­¢ä¼ æ’­ã€‚</p>

<p>è®©æˆ‘ä»¬å…·ä½“åœ°è®²ä¸€ä¸‹ï¼šåœ¨å‰é¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œå¦‚æœ startAsyncOperation() æˆ– doStageTwo() å¼•å‘å¼‚å¸¸ï¼Œåˆ™å°†è°ƒç”¨ recoveryFromStageTwoError() å‡½æ•°ã€‚å¦‚æœ restoreFromStageTwoError() æ­£å¸¸è¿”å›ï¼Œåˆ™å…¶è¿”å›å€¼å°†ä¼ é€’ç»™ doStageThree()ï¼Œå¹¶ä¸”å¼‚æ­¥æ“ä½œå°†æ­£å¸¸ç»§ç»­ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœ recoverFromStageTwoError() æ— æ³•æ¢å¤ï¼Œåˆ™å®ƒæœ¬èº«å°†å¼•å‘å¼‚å¸¸ï¼ˆæˆ–è€…é‡æ–°æŠ›å‡ºä¼ å…¥çš„å¼‚å¸¸ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ä¼šè°ƒç”¨ doStageThree() æˆ– doStageFour()ï¼Œå¹¶ä¸” recoverFromStageTwoError() å¼•å‘çš„å¼‚å¸¸å°†ä¼ é€’ç»™ logStageThreeAndFourErrors()ã€‚</p>

<p>æœ‰æ—¶ï¼Œåœ¨å¤æ‚çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œå¼‚å¸¸å¯èƒ½ä¼šæˆ–å¤šæˆ–å°‘åœ°éšæœºå‘ç”Ÿï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ç®€å•åœ°é‡è¯•å¼‚æ­¥è¯·æ±‚æ¥å¤„ç†è¿™äº›å¼‚å¸¸ã€‚å‡è®¾ç¼–å†™äº†ä¸€ä¸ªåŸºäº Promise çš„æ“ä½œæ¥æŸ¥è¯¢æ•°æ®åº“ï¼š</p>

<pre><code class="language-javascript">queryDatabase()
    .then(displayTable)
    .catch(displayDatabaseError);
</code></pre>

<p>ç°åœ¨ï¼Œå‡è®¾å¤§çº¦ 1ï¼… çš„æ¦‚ç‡ç¬æ€ç½‘ç»œè´Ÿè½½é—®é¢˜å¯¼è‡´å…¶å¤±è´¥ã€‚ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆå¯èƒ½æ˜¯ä½¿ç”¨ .catch() è°ƒç”¨é‡è¯•æŸ¥è¯¢ï¼š</p>

<pre><code class="language-javascript">queryDatabase()
    .catch(e =&gt; wait(500).then(queryDatabase))  // On failure, wait and retry
    .then(displayTable)
    .catch(displayDatabaseError);
</code></pre>

<p>å¦‚æœå‡è®¾çš„å¤±è´¥ç¡®å®æ˜¯éšæœºçš„ï¼Œé‚£ä¹ˆæ·»åŠ è¿™ä¸€è¡Œä»£ç åº”ä½¿é”™è¯¯ç‡ä» 1ï¼… é™ä½åˆ° .01ï¼…ã€‚</p>

<h4 id="toc_13">ä» PROMISE å›è°ƒå‡½æ•°è¿”å›</h4>

<p>è®©æˆ‘ä»¬æœ€åä¸€æ¬¡è¿”å›å‰é¢çš„ URL-fetching ç¤ºä¾‹ï¼Œå¹¶è€ƒè™‘ä¼ é€’ç»™ç¬¬ä¸€ä¸ª .then() è°ƒç”¨çš„å›è°ƒ c1ã€‚æ³¨æ„ï¼Œc1 å¯ä»¥é€šè¿‡ä¸‰ç§æ–¹å¼ç»ˆæ­¢ã€‚å®ƒå¯ä»¥é€šè¿‡ .json() è°ƒç”¨è¿”å›çš„ Promise æ­£å¸¸è¿”å›ã€‚è¿™å°†å¯¼è‡´ p2 å˜ä¸ºå·²å†³è®®ï¼Œä½†æ˜¯è¯¥ Promise æ˜¯å·²å…‘ç°è¿˜æ˜¯æ‹’ç»å–å†³äºæ–°è¿”å›çš„ Promise å‘ç”Ÿäº†ä»€ä¹ˆã€‚c1 ä¹Ÿå¯ä»¥æ­£å¸¸è¿”å› null å€¼ï¼Œè¿™å°†å¯¼è‡´ p2 ç«‹å³å˜æˆå·²å…‘ç°ã€‚æœ€åï¼Œc1 å¯ä»¥é€šè¿‡å¼•å‘å¼‚å¸¸æ¥ç»ˆæ­¢ï¼Œä»è€Œå¯¼è‡´ p2 å˜æˆå·²æ‹’ç»ã€‚è¿™æ˜¯ Promise çš„ä¸‰ä¸ªå¯èƒ½ç»“æœï¼Œè€Œ c1 ä¸­çš„ä»£ç æ¼”ç¤ºäº†å›è°ƒå¦‚ä½•å¯¼è‡´æ¯ä¸ªç»“æœã€‚</p>

<p>åœ¨ Promise é“¾ä¸­ï¼Œåœ¨é“¾çš„ä¸€ä¸ªé˜¶æ®µè¿”å›ï¼ˆæˆ–æŠ›å‡ºï¼‰çš„å€¼æˆä¸ºé“¾çš„ä¸‹ä¸€é˜¶æ®µçš„è¾“å…¥ï¼Œå› æ­¤æ­£ç¡®å®ç°è¿™ä¸€ç‚¹è‡³å…³é‡è¦ã€‚å®é™…ä¸Šï¼Œå›è°ƒå‡½æ•°å¿˜è®°è¿”å›å€¼æ˜¯ä¸ Promise ç›¸å…³çš„å¸¸è§é”™è¯¯ï¼Œè€Œ JavaScript çš„ç®­å¤´å‡½æ•°å¿«æ·è¯­æ³•ä¼šåŠ å‰§è¿™ç§æƒ…å†µã€‚å›æƒ³ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ä»¥ä¸‹ä»£ç è¡Œï¼š</p>

<pre><code class="language-javascript">.catch(e =&gt; wait(500).then(queryDatabase))
</code></pre>

<p>å›é¡¾ç¬¬ 8 ç« ï¼Œç®­å¤´å‡½æ•°æä¾›äº†è®¸å¤šå¿«æ·æ–¹å¼ã€‚ç”±äºä»…å­˜åœ¨ä¸€ä¸ªå‚æ•°ï¼ˆå¼‚å¸¸å€¼ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥çœç•¥æ‹¬å·ã€‚ç”±äºå‡½æ•°çš„ä¸»ä½“æ˜¯å•ä¸ªè¡¨è¾¾å¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥çœç•¥å‡½æ•°ä¸»ä½“å‘¨å›´çš„èŠ±æ‹¬å·ï¼Œå¹¶ä¸”è¡¨è¾¾å¼çš„å€¼æˆä¸ºå‡½æ•°çš„è¿”å›å€¼ã€‚ç”±äºè¿™äº›å¿«æ·æ–¹å¼ï¼Œå‰é¢çš„ä»£ç æ˜¯æ­£ç¡®çš„ã€‚ä½†æ˜¯è€ƒè™‘ä¸€ä¸‹è¿™ç§æ— å®³çš„å˜åŒ–ï¼š</p>

<pre><code class="language-javascript">.catch(e =&gt; { wait(500).then(queryDatabase) })
</code></pre>

<p>é€šè¿‡æ·»åŠ èŠ±æ‹¬å·ï¼Œæˆ‘ä»¬ä¸å†è·å¾—è‡ªåŠ¨è¿”å›ã€‚ç°åœ¨ï¼Œæ­¤å‡½æ•°è¿”å› undefined è€Œä¸æ˜¯è¿”å› Promiseï¼Œè¿™æ„å‘³ç€å°†ä»¥ undefined ä½œä¸ºè¾“å…¥è€Œä¸æ˜¯é‡è¯•æŸ¥è¯¢çš„ç»“æœæ¥è°ƒç”¨æ­¤ Promise é“¾ä¸­çš„ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚è¿™æ˜¯ä¸€ä¸ªç»†å¾®çš„é”™è¯¯ï¼Œå¯èƒ½ä¸å®¹æ˜“è°ƒè¯•ã€‚</p>

<h3 id="toc_14">13.2.5 å¹¶è¡Œ Promise</h3>

<p>æˆ‘ä»¬èŠ±äº†å¾ˆå¤šæ—¶é—´è®¨è®º Promise é“¾ï¼Œè¿™äº›é“¾å¯æŒ‰é¡ºåºè¿è¡Œè¾ƒå¤§çš„å¼‚æ­¥çš„æ“ä½œæ­¥éª¤ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶æˆ‘ä»¬æƒ³å¹¶è¡Œæ‰§è¡Œè®¸å¤šå¼‚æ­¥æ“ä½œã€‚å‡½æ•° Promise.all() å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚Promise.all() å°† Promise å¯¹è±¡æ•°ç»„ä½œä¸ºå…¶è¾“å…¥ï¼Œå¹¶è¿”å› Promiseã€‚å¦‚æœä»»ä½•è¾“å…¥çš„ Promise ä¸­æœ‰ä¸€ä¸ªæ˜¯å·²æ‹’ç»çŠ¶æ€ï¼Œåˆ™è¿”å›çš„ Promise å°†è¢«æ‹’ç»ã€‚å¦åˆ™ï¼Œå®ƒå°†ä½¿ç”¨æ¯ä¸ªè¾“å…¥ Promise çš„å…‘ç°å€¼ç»„æˆçš„æ•°ç»„æ¥è¢«å…‘ç°ã€‚å› æ­¤ï¼Œä¾‹å¦‚ï¼Œå¦‚æœè¦è·å–å¤šä¸ª URL çš„æ–‡æœ¬å†…å®¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š</p>

<pre><code class="language-javascript">// We start with an array of URLs
const urls = [ /* zero or more URLs here */ ];
// And convert it to an array of Promise objects
promises = urls.map(url =&gt; fetch(url).then(r =&gt; r.text()));
// Now get a Promise to run all those Promises in parallel
Promise.all(promises)
    .then(bodies =&gt; { /* do something with the array of strings */ })
    .catch(e =&gt; console.error(e));
</code></pre>

<p>Promise.all() æ¯”å‰é¢æè¿°çš„è¦çµæ´»ä¸€äº›ã€‚è¾“å…¥æ•°ç»„å¯ä»¥åŒ…å« Promise å¯¹è±¡å’Œé Promise å€¼ã€‚å¦‚æœæ•°ç»„çš„å…ƒç´ ä¸æ˜¯ Promiseï¼Œåˆ™å°†å…¶è§†ä¸ºå·²å…‘ç°çš„ Promise çš„å€¼ï¼Œå¹¶åŸå°ä¸åŠ¨åœ°å¤åˆ¶åˆ°è¾“å‡ºæ•°ç»„ä¸­ã€‚</p>

<p>å½“ä»»ä½•è¾“å…¥çš„ Promise è¢«æ‹’ç»æ—¶ï¼ŒPromise.all() è¿”å›çš„ Promise ä¹Ÿä¼šè¢«æ‹’ç»ã€‚è¿™åœ¨ç¬¬ä¸€æ¬¡æ‹’ç»æ—¶ç«‹å³å‘ç”Ÿï¼Œå¯èƒ½å…¶ä»–è¾“å…¥ Promise ä»æ˜¯å¾…å®šçŠ¶æ€ã€‚åœ¨ ES2020 ä¸­ï¼ŒPromise.allSettled() æ¥å—è¾“å…¥çš„ Promise æ•°ç»„ï¼Œå¹¶è¿”å› Promiseï¼Œå°±åƒ Promise.all() ä¸€æ ·ã€‚ä½†æ˜¯ Promise.allSettled() æ°¸è¿œä¸ä¼šæ‹’ç»è¿”å›çš„ Promiseï¼Œå¹¶ä¸”ä¸ä¼šå…‘ç°è¿™ä¸ª Promiseï¼Œç›´åˆ°æ‰€æœ‰è¾“å…¥ Promise å…¨éƒ¨å·²æ•²å®šã€‚Promise è§£æä¸ºä¸€ç»„å¯¹è±¡ï¼Œæ¯ä¸ªè¾“å…¥ Promise éƒ½æœ‰ä¸€ä¸ªå¯¹è±¡ã€‚æ¯ä¸ªè¿”å›çš„å¯¹è±¡ä¸­æœ‰ä¸€ä¸ªçŠ¶æ€å±æ€§è®¾ç½®ä¸ºâ€œå·²å…‘ç°â€æˆ–â€œå·²æ‹’ç»â€ã€‚å¦‚æœçŠ¶æ€ä¸ºâ€œå·²å…‘ç°â€ï¼Œåˆ™å¯¹è±¡è¿˜å°†å…·æœ‰ä¸€ä¸ª value å±æ€§ï¼Œè¯¥å±æ€§æä¾›å…‘ç°å€¼ã€‚å¹¶ä¸”ï¼Œå¦‚æœçŠ¶æ€ä¸ºâ€œå·²æ‹’ç»â€ï¼Œåˆ™å¯¹è±¡è¿˜å°†å…·æœ‰ä¸€ä¸ª reason å±æ€§ï¼Œè¯¥å±æ€§ç»™å‡ºç›¸åº”çš„ Promise çš„å¼‚å¸¸æˆ–æ‹’ç»å€¼ï¼š</p>

<pre><code class="language-javascript">Promise.allSettled([Promise.resolve(1), Promise.reject(2), 3]).then(results =&gt; {
    results[0]  // =&gt; { status: &quot;fulfilled&quot;, value: 1 }
    results[1]  // =&gt; { status: &quot;rejected&quot;, reason: 2 }
    results[2]  // =&gt; { status: &quot;fulfilled&quot;, value: 3 }
});
</code></pre>

<p>æœ‰æ—¶ï¼Œå¯èƒ½æƒ³ä¸€æ¬¡è¿è¡Œå¤šä¸ª Promiseï¼Œä½†å¯èƒ½åªå…³å¿ƒç¬¬ä¸€ä¸ªè¦å…‘ç°çš„å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ Promise.race() ä»£æ›¿ Promise.all()ã€‚å½“è¾“å…¥æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ª Promise æ˜¯å·²å…‘ç°æˆ–å·²æ‹’ç»çŠ¶æ€æ—¶ï¼Œå®ƒè¿”å›ä¸€ä¸ªå·²å…‘ç°æˆ–å·²æ‹’ç»çš„ Promiseã€‚ï¼ˆæˆ–è€…ï¼Œå¦‚æœè¾“å…¥æ•°ç»„ä¸­æœ‰ä»»ä½•é Promise å€¼ï¼Œåˆ™åªè¿”å›å…¶ä¸­çš„ç¬¬ä¸€ä¸ªã€‚ï¼‰</p>

<h3 id="toc_15">13.2.6 æ„é€  Promise</h3>

<p>åœ¨ä¹‹å‰çš„è®¸å¤šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨äº† Promise è¿”å›å‡½æ•° fetch()ï¼Œå› ä¸ºå®ƒæ˜¯å†…ç½®äº Web æµè§ˆå™¨ä¸­çš„æœ€ç®€å•çš„è¿”å› Promise çš„å‡½æ•°ä¹‹ä¸€ã€‚æˆ‘ä»¬å¯¹ Promise çš„è®¨è®ºè¿˜ä¾èµ–äºå‡è®¾çš„ Promise è¿”å›å‡½æ•° getJSON() å’Œ wait()ã€‚ç¼–å†™ç”¨äºè¿”å› Promise çš„å‡½æ•°ç¡®å®éå¸¸æœ‰ç”¨ï¼Œæœ¬èŠ‚è¯´æ˜å¦‚ä½•åˆ›å»ºè‡ªå·±çš„åŸºäº Promise çš„ APIã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬å°†å±•ç¤º getJSON() å’Œ wait() çš„å®ç°ã€‚</p>

<h4 id="toc_16">PROMISE åŸºäºåˆ«çš„ PROMISE</h4>

<p>å¦‚æœä»¥ Promise è¿”å›å‡½æ•°ä½œä¸ºå¼€å¤´æ¥å†™ä¸€ä¸ªè¿”å› Promise çš„å‡½æ•°æ˜¯å¾ˆå®¹æ˜“çš„ã€‚æœ‰äº† Promiseï¼Œæ€»æ˜¯å¯ä»¥é€šè¿‡è°ƒç”¨ .then() åˆ›å»ºï¼ˆå¹¶è¿”å›ï¼‰ä¸€ä¸ªæ–°çš„ Promiseã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ç°æœ‰çš„ fetch() å‡½æ•°ä½œä¸ºèµ·ç‚¹ï¼Œåˆ™å¯ä»¥è¿™æ ·ç¼–å†™ getJSON()ï¼š</p>

<pre><code class="language-javascript">function getJSON(url) {
    return fetch(url).then(response =&gt; response.json());
}
</code></pre>

<p>è¯¥ä»£ç å¾ˆç®€å•ï¼Œå› ä¸º fetch() API çš„ Response å¯¹è±¡å…·æœ‰é¢„å®šä¹‰çš„ json() æ–¹æ³•ã€‚æˆ‘ä»¬ä»å›è°ƒï¼ˆè¯¥å›è°ƒæ˜¯å¸¦æœ‰å•ä¸ªè¡¨è¾¾å¼ä¸»ä½“çš„ç®­å¤´å‡½æ•°ï¼Œå› æ­¤è¿”å›å€¼æ˜¯éšå¼çš„ï¼‰ä¸­é€šè¿‡ json() æ–¹æ³•è¿”å›ä¸€ä¸ª Promiseï¼Œå› æ­¤ getJSON() è¿”å›çš„ Promise è§£æä¸º response.json()ã€‚å½“è¯¥ Promise å…‘ç°æ—¶ï¼Œç”± getJSON() è¿”å›çš„ Promise å°†å…‘ç°ä¸ºç›¸åŒçš„å€¼ã€‚è¯·æ³¨æ„ï¼Œæ­¤ getJSON() å®ç°ä¸­æ²¡æœ‰å¼‚å¸¸å¤„ç†ã€‚å¦‚æœä¸èƒ½å°† response ä¸»ä½“è§£æä¸º JSONï¼Œåˆ™æ— éœ€æ£€æŸ¥ response.ok å’Œ Content-Type æ ‡å¤´ï¼Œè€Œåªéœ€å…è®¸ json() æ–¹æ³•æ‹’ç»å®ƒçš„ Promise å¹¶è¿”å› SyntaxErrorã€‚</p>

<p>è®©æˆ‘ä»¬ç¼–å†™å¦ä¸€ä¸ª Promise è¿”å›å‡½æ•°ï¼Œè¿™æ¬¡ä½¿ç”¨ getJSON() ä½œä¸ºåˆå§‹ Promise çš„æ¥æºï¼š</p>

<pre><code class="language-javascript">function getHighScore() {
    return getJSON(&quot;/api/user/profile&quot;).then(profile =&gt; profile.highScore);
}
</code></pre>

<p>æˆ‘ä»¬å‡è®¾æ­¤å‡½æ•°æ˜¯æŸç§åŸºäºç½‘ç»œçš„æ¸¸æˆçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸” URLâ€œ/api/user/profileâ€è¿”å›çš„æ˜¯åŒ…å« highScore å±æ€§çš„ JSON æ ¼å¼çš„æ•°æ®ç»“æ„ã€‚</p>

<h4 id="toc_17">PROMISE åŸºäºåŒæ­¥å€¼</h4>

<p>æœ‰æ—¶ï¼Œå³ä½¿è¦æ‰§è¡Œçš„è®¡ç®—å®é™…ä¸Šä¸éœ€è¦ä»»ä½•å¼‚æ­¥æ“ä½œï¼Œä¹Ÿå¯èƒ½éœ€è¦å®ç°ç°æœ‰çš„åŸºäº Promise çš„ API å¹¶ä»å‡½æ•°è¿”å› Promiseã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé™æ€æ–¹æ³• Promise.resolve() å’Œ Promise.reject() ä¼šåšæ‚¨æƒ³è¦çš„ã€‚Promise.resolve() é‡‡ç”¨ä¸€ä¸ªå•ä¸ªå®å‚å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ª Promiseï¼Œè¯¥ Promise å°†ç«‹å³ï¼ˆä½†å¼‚æ­¥åœ°ï¼‰å…‘ç°ä¸ºè¯¥å€¼ã€‚åŒæ ·ï¼ŒPromise.reject() æ¥å—ä¸€ä¸ªå®å‚å€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ª Promiseï¼Œè¯¥å€¼å°†ä½œä¸ºè¢«æ‹’ç»çš„åŸå› ã€‚ï¼ˆè¯·æ³¨æ„ï¼šè¿™äº›é™æ€æ–¹æ³•è¿”å›çš„ Promise åœ¨è¿”å›æ—¶å°šæœªå…‘ç°æˆ–æ‹’ç»ï¼Œä½†æ˜¯å®ƒä»¬å°†åœ¨å½“å‰åŒæ­¥ä»£ç å—è¿è¡Œå®Œæ¯•åç«‹å³å…‘ç°æˆ–æ‹’ç»ã€‚é€šå¸¸ï¼Œè¿™ç§æƒ…å†µä¼šåœ¨å‡ æ¯«ç§’å†…å‘ç”Ÿï¼Œé™¤éæœ‰è®¸å¤šç­‰å¾…æ‰§è¡Œçš„å¾…å¤„ç†å¼‚æ­¥ä»»åŠ¡ã€‚ï¼‰</p>

<p>å›é¡¾ Â§13.2.3ï¼Œå·²å†³è®®çš„ Promise ä¸å·²å…‘ç°çš„ Promise ä¸åŒã€‚å½“æˆ‘ä»¬è°ƒç”¨ Promise.resolve() æ—¶ï¼Œé€šå¸¸ä¼šä¼ é€’å…‘ç°å€¼ä»¥åˆ›å»ºä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°†å¾ˆå¿«å…‘ç°è¯¥å€¼ã€‚ä½†æ˜¯ï¼Œè¯¥æ–¹æ³•æœªå‘½åä¸º Promise.fulfill()ã€‚å¦‚æœå°† Promise p1 ä¼ é€’ç»™ Promise.resolve()ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªæ–°çš„ Promise p2ï¼Œè¯¥ p2 ç«‹å³è¢«å†³è®®ï¼Œä½†æ˜¯ç›´åˆ° p1 è¢«å…‘ç°æˆ–æ‹’ç»ï¼Œè¯¥ Promise p2 æ‰ä¼šè¢«å…‘ç°æˆ–æ‹’ç»ã€‚ </p>

<p>å¯ä»¥ï¼ˆä½†ä¸å¸¸è§ï¼‰ç¼–å†™ä¸€ä¸ªåŸºäº Promise çš„å‡½æ•°ï¼ŒåŒæ­¥è®¡ç®—çš„å€¼é€šè¿‡é€šè¿‡ Promise.resolve() å¼‚æ­¥è¿”å›ã€‚ä½†æ˜¯ï¼Œåœ¨å¼‚æ­¥å‡½æ•°ä¸­åŒ…å«åŒæ­¥ç‰¹æ®Šæƒ…å†µæ˜¯å¾ˆå¸¸è§çš„ï¼Œå¯ä»¥ä½¿ç”¨ Promise.resolve() å’Œ Promise.reject() å¤„ç†è¿™äº›ç‰¹æ®Šæƒ…å†µã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœåœ¨å¼€å§‹å¼‚æ­¥æ“ä½œä¹‹å‰æ£€æµ‹åˆ°å¼‚å¸¸æ¡ä»¶ï¼ˆä¾‹å¦‚å¼‚å¸¸çš„å®å‚å€¼ï¼‰ï¼Œåˆ™å¯ä»¥é€šè¿‡è¿”å›ä½¿ç”¨ Promise.reject() åˆ›å»ºçš„ Promise æ¥æŠ¥å‘Šè¯¥å¼‚å¸¸ã€‚ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥åŒæ­¥å¼•å‘å¼‚å¸¸ï¼Œä½†è¿™è¢«è®¤ä¸ºæ˜¯è¾ƒå·®çš„å½¢å¼ï¼Œå› ä¸ºå‡½æ•°çš„è°ƒç”¨è€…éœ€è¦åŒæ—¶ç¼–å†™åŒæ­¥ catch å­å¥å¹¶ä½¿ç”¨å¼‚æ­¥ .catch() æ–¹æ³•æ¥å¤„ç†å¼‚å¸¸ã€‚ï¼‰æœ€åï¼ŒPromise.resolve() æœ‰æ—¶å¯ç”¨äºåœ¨ Promise é“¾ä¸­åˆ›å»ºåˆå§‹ Promiseã€‚æˆ‘ä»¬å°†çœ‹åˆ°å‡ ä¸ªä½¿ç”¨è¿™ç§æ–¹å¼çš„ç¤ºä¾‹ã€‚ </p>

<h4 id="toc_18">æ„é€ å‡½æ•°åˆ›å»º PROMISE</h4>

<p>å¯¹äº getJSON() å’Œ getHighScore()ï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨ç°æœ‰å‡½æ•°ä»¥è·å–åˆå§‹ Promiseï¼Œç„¶åé€šè¿‡è°ƒç”¨è¯¥åˆå§‹ Promise çš„ .then() æ–¹æ³•åˆ›å»ºå¹¶è¿”å›æ–°çš„ Promiseã€‚ä½†æ˜¯ï¼Œå½“ä¸èƒ½ä½¿ç”¨å¦ä¸€ä¸ªè¿”å› Promise å‡½æ•°ä½œä¸ºèµ·ç‚¹æ—¶ï¼Œå¦‚ä½•ç¼–å†™è¿”å› Promise å‡½æ•°å‘¢ï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ Promise() æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå¯ä»¥å®Œå…¨æ§åˆ¶çš„æ–° Promise å¯¹è±¡ã€‚å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„ï¼šè°ƒç”¨ Promise() æ„é€ å‡½æ•°å¹¶å°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºå”¯ä¸€å®å‚ä¼ é€’ã€‚ä¼ é€’çš„å‡½æ•°åº”ç¼–å†™ä¸ºåŒ…å«ä¸¤ä¸ªå‚æ•°ï¼ŒæŒ‰ç…§æƒ¯ä¾‹ï¼Œåº”å°†å…¶å‘½åä¸º resolve å’Œ rejectã€‚æ„é€ å‡½æ•°ä¼šåŒæ­¥è°ƒç”¨ä½¿ç”¨ resolve å’Œ reject å‚æ•°çš„å‡½æ•°ã€‚è°ƒç”¨å‡½æ•°åï¼ŒPromise() æ„é€ å‡½æ•°å°†è¿”å›æ–°åˆ›å»ºçš„ Promiseã€‚è¿”å›çš„ Promise å—ä¼ é€’ç»™æ„é€ å‡½æ•°çš„å‡½æ•°çš„æ§åˆ¶ã€‚è¯¥å‡½æ•°åº”è¯¥æ‰§è¡Œä¸€äº›å¼‚æ­¥æ“ä½œï¼Œç„¶åè°ƒç”¨ resolve å‡½æ•°æ¥å†³è®®æˆ–å…‘ç°è¿”å›çš„ Promiseï¼Œæˆ–è€…è°ƒç”¨ reject å‡½æ•°æ¥æ‹’ç»è¿”å›çš„ Promiseã€‚å‡½æ•°ä¸å¿…æ˜¯å¼‚æ­¥çš„ï¼šå®ƒå¯ä»¥åŒæ­¥åœ°è°ƒç”¨ resolve æˆ–æ‹’ç»ï¼Œä½†æ˜¯å¦‚æœè¿™æ ·åšï¼ŒPromise ä»å°†è¢«å¼‚æ­¥åœ°å†³è®®ï¼Œå…‘ç°æˆ–æ‹’ç»ã€‚</p>

<p>ä»…ä»…é˜…è¯»ä¸€ä¸‹å¾ˆéš¾ç†è§£ä¼ é€’ç»™æ„é€ å‡½æ•°çš„å‡½æ•°ï¼Œä½†æ˜¯å¸Œæœ›æœ‰ä¸€äº›ä¾‹å­å¯ä»¥ä½¿è¿™ä¸€ç‚¹å˜å¾—æ¸…æ¥šã€‚è¿™æ˜¯åœ¨æœ¬ç« å‰é¢çš„å„ç§ç¤ºä¾‹ä¸­ä½¿ç”¨çš„åŸºäº Promise çš„ wait() å‡½æ•°çš„ç¼–å†™æ–¹æ³•ï¼š</p>

<pre><code class="language-javascript">function wait(duration) {
    // Create and return a new Promise
    return new Promise((resolve, reject) =&gt; { // These control the Promise
        // If the argument is invalid, reject the Promise
        if (duration &lt; 0) {
            reject(new Error(&quot;Time travel not yet implemented&quot;));
        }
        // Otherwise, wait asynchronously and then resolve the Promise.
        // setTimeout will invoke resolve() with no arguments, which means
        // that the Promise will fulfill with the undefined value.
        setTimeout(resolve, duration);
    });
}
</code></pre>

<p>è¯·æ³¨æ„ï¼Œç”¨äºæ§åˆ¶ç”± Promise() æ„é€ å‡½æ•°åˆ›å»ºçš„ Promise å‘½è¿çš„ä¸€å¯¹å‡½æ•°åˆ†åˆ«å‘½åä¸º resolve() å’Œ reject()ï¼Œè€Œä¸æ˜¯ fulfill() å’Œ reject()ã€‚å¦‚æœä¼ é€’ä¸€ä¸ª Promise ç»™ resolve()ï¼Œåˆ™è¿”å›çš„ Promise å°†å†³è®®äºè¯¥æ–°çš„ Promiseã€‚ä½†æ˜¯ï¼Œé€šå¸¸ä¼šä¼ é€’ä¸€ä¸ªé Promise å€¼ï¼Œè¿”å›çš„ Promise ä¼šå…‘ç°è¿™ä¸ªå€¼ã€‚</p>

<p>ç¤ºä¾‹ 13-1 æ˜¯ä½¿ç”¨ Promise() æ„é€ å‡½æ•°çš„å¦ä¸€ä¸ªç¤ºä¾‹ã€‚è¿™ä¸€èŠ‚å®ç°äº† Node ä¸­åœ¨æœªå†…ç½® fetch() API ä½¿ç”¨çš„ getJSON() å‡½æ•°ã€‚è¯·è®°ä½ï¼Œæœ¬ç« å¼€å§‹æ—¶è®¨è®ºäº†å¼‚æ­¥å›è°ƒå’Œäº‹ä»¶ã€‚æ­¤ç¤ºä¾‹åŒæ—¶ä½¿ç”¨äº†å›è°ƒå’Œäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå› æ­¤å¾ˆå¥½åœ°æ¼”ç¤ºäº†å¦‚ä½•åœ¨å…¶ä»–é£æ ¼çš„å¼‚æ­¥ç¼–ç¨‹ä¹‹ä¸Šå®ç°åŸºäº Promise çš„ APIã€‚</p>

<p>ç¤ºä¾‹ 13-1 å¼‚æ­¥ getJSON() å‡½æ•°</p>

<pre><code class="language-javascript">const http = require(&quot;http&quot;);

function getJSON(url) {
    // Create and return a new Promise
    return new Promise((resolve, reject) =&gt; {
        // Start an HTTP GET request for the specified URL
        request = http.get(url, response =&gt; { // called when response starts
            // Reject the Promise if the HTTP status is wrong
            if (response.statusCode !== 200) {
                reject(new Error(`HTTP status ${response.statusCode}`));
                response.resume();  // so we don&#39;t leak memory
            }
            // And reject if the response headers are wrong
            else if (response.headers[&quot;content-type&quot;] !== &quot;application/json&quot;) {
                reject(new Error(&quot;Invalid content-type&quot;));
                response.resume();  // don&#39;t leak memory
            }
            else {
                // Otherwise, register events to read the body of the response
                let body = &quot;&quot;;
                response.setEncoding(&quot;utf-8&quot;);
                response.on(&quot;data&quot;, chunk =&gt; { body += chunk; });
                response.on(&quot;end&quot;, () =&gt; {
                    // When the response body is complete, try to parse it
                    try {
                        let parsed = JSON.parse(body);
                        // If it parsed successfully, fulfill the Promise
                        resolve(parsed);
                    } catch(e) {
                        // If parsing failed, reject the Promise
                        reject(e);
                    }
                });
            }
        });
        // We also reject the Promise if the request fails before we
        // even get a response (such as when the network is down)
        request.on(&quot;error&quot;, error =&gt; {
            reject(error);
        });
    });
}
</code></pre>

<h3 id="toc_19">13.2.7 è¿ç»­çš„ Promise</h3>

<p>Promise.all() ä½¿å¾—å¹¶è¡Œè¿è¡Œä»»æ„æ•°é‡çš„ Promise å˜å¾—å®¹æ˜“ã€‚Promise é“¾ä½¿è¡¨è¾¾å›ºå®šæ•°é‡çš„ Promise åºåˆ—å˜å¾—å®¹æ˜“ã€‚ä½†æ˜¯ï¼Œä¾æ¬¡æ‰§è¡Œä»»æ„æ•°é‡çš„ Promise ä¼šæ¯”è¾ƒæ£˜æ‰‹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨è¦è·å–ä¸€ç»„ URLï¼Œä½†æ˜¯ä¸ºäº†é¿å…ç½‘ç»œè¿‡è½½ï¼Œå¸Œæœ›ä¸€æ¬¡è·å–ä¸€ä¸ª URLã€‚å¦‚æœæ•°ç»„çš„é•¿åº¦æ˜¯ä»»æ„çš„ä¸”å†…å®¹æœªçŸ¥ï¼Œåˆ™æ— æ³•æå‰å†™å‡º Promise é“¾ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ä»¥ä¸‹ä»£ç åŠ¨æ€æ„å»ºä¸€ä¸ªï¼š</p>

<pre><code class="language-javascript">function fetchSequentially(urls) {
    // We&#39;ll store the URL bodies here as we fetch them
    const bodies = [];

    // Here&#39;s a Promise-returning function that fetches one body
    function fetchOne(url) {
        return fetch(url)
            .then(response =&gt; response.text())
            .then(body =&gt; {
                // We save the body to the array, and we&#39;re purposely
                // omitting a return value here (returning undefined)
                bodies.push(body);
            });
    }

    // Start with a Promise that will fulfill right away (with value undefined)
    let p = Promise.resolve(undefined);

    // Now loop through the desired URLs, building a Promise chain
    // of arbitrary length, fetching one URL at each stage of the chain
    for(url of urls) {
        p = p.then(() =&gt; fetchOne(url));
    }

    // When the last Promise in that chain is fulfilled, then the
    // bodies array is ready. So let&#39;s return a Promise for that
    // bodies array. Note that we don&#39;t include any error handlers:
    // we want to allow errors to propagate to the caller.
    return p.then(() =&gt; bodies);
}
</code></pre>

<p>å®šä¹‰äº†è¿™ä¸ª fetchSequentially() å‡½æ•°ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªä»£ç ä¸€æ¬¡æ¥è·å–å¤šä¸ª URLï¼Œå°±åƒæˆ‘ä»¬ä¹‹å‰ç”¨æ¥æ¼”ç¤º Promise.all() çš„å¹¶è¡Œè·å–ä»£ç ä¸€æ ·ï¼š</p>

<pre><code class="language-javascript">fetchSequentially(urls)
    .then(bodies =&gt; { /* do something with the array of strings */ })
    .catch(e =&gt; console.error(e));
</code></pre>

<p>fetchSequentially() å‡½æ•°é¦–å…ˆåˆ›å»ºä¸€ä¸ª Promiseï¼Œè¯¥ Promise å°†åœ¨è¿”å›åç«‹å³å…‘ç°ã€‚ç„¶åï¼Œå®ƒä»è¯¥åˆå§‹ Promise æ„å»ºä¸€ä¸ªé•¿çš„çº¿æ€§ Promise é“¾ï¼Œå¹¶è¿”å›é“¾ä¸­çš„æœ€åä¸€ä¸ª Promiseã€‚è¿™å°±åƒè®¾ç½®ä¸€æ’å¤šç±³è¯ºéª¨ç‰Œï¼Œç„¶åå°†ç¬¬ä¸€ä¸ªå¤šç±³è¯ºéª¨ç‰Œæ’å€’ä¸€æ ·ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¦ä¸€ç§æ–¹æ³•ï¼ˆå¯èƒ½æ›´ä¼˜é›…ï¼‰ã€‚é™¤äº†æå‰åˆ›å»º Promise å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºæ¯ä¸ª Promise åˆ›å»ºå›è°ƒï¼Œå¹¶è¿”å›ä¸‹ä¸€ä¸ª Promiseã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ²¡æœ‰åˆ›å»ºå’Œé“¾æ¥ä¸€å † Promiseï¼Œè€Œæ˜¯åˆ›å»ºäº†å†³è®®äºå…¶ä»–æ‰¿è¯ºçš„æ‰¿è¯ºã€‚ä¸å…¶åˆ›å»ºç±»ä¼¼å¤šç±³è¯ºéª¨ç‰Œçš„ Promise é“¾ï¼Œä¸å¦‚åˆ›å»ºä¸€ç³»åˆ—å½¼æ­¤åµŒå¥—åœ¨ä¸€èµ·çš„ Promise åºåˆ—ï¼Œå°±åƒä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬çš„ä»£ç å¯ä»¥çŸ¥é“ç¬¬ä¸€ä¸ªï¼ˆæœ€å¤–é¢çš„ï¼‰Promise æœ€ç»ˆå°†å…‘ç°ï¼ˆæˆ–æ‹’ç»ï¼ï¼‰ï¼Œä½¿å…¶è¿”å›åºåˆ—ä¸­æœ€åä¸€ä¸ªï¼ˆæœ€é‡Œé¢çš„ï¼‰Promise ç›¸åŒçš„å€¼ã€‚åé¢æ˜¯é€šç”¨çš„ promiseSequence() å‡½æ•°ï¼Œå¹¶ä¸ç‰¹å®šäº URL æå–ã€‚å› ä¸ºå®ƒå¾ˆå¤æ‚ï¼Œæ‰€ä»¥å°†å®ƒæ”¾åœ¨æˆ‘ä»¬å¯¹ Promise çš„è®¨è®ºçš„ç»“å°¾ã€‚ä½†æ˜¯ï¼Œå¦‚æœä»”ç»†é˜…è¯»äº†æœ¬ç« ï¼Œå¸Œæœ›èƒ½ç†è§£å®ƒçš„å·¥ä½œåŸç†ã€‚ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯ï¼ŒpromiseSequence() ä¸­çš„åµŒå¥—å‡½æ•°ç±»ä¼¼é€’å½’åœ°è°ƒç”¨è‡ªèº«ï¼Œä½†æ˜¯ç”±äºâ€œé€’å½’â€è°ƒç”¨æ˜¯é€šè¿‡ then() æ–¹æ³•è¿›è¡Œçš„ï¼Œå› æ­¤å®é™…ä¸Šæ²¡æœ‰å‘ç”Ÿä»»ä½•ä¼ ç»Ÿçš„é€’å½’ï¼š</p>

<pre><code class="language-javascript">// This function takes an array of input values and a &quot;promiseMaker&quot; function.
// For any input value x in the array, promiseMaker(x) should return a Promise
// that will fulfill to an output value. This function returns a Promise
// that fulfills to an array of the computed output values.
//
// Rather than creating the Promises all at once and letting them run in
// parallel, however, promiseSequence() only runs one Promise at a time
// and does not call promiseMaker() for a value until the previous Promise
// has fulfilled.
function promiseSequence(inputs, promiseMaker) {
    // Make a private copy of the array that we can modify
    inputs = [...inputs];

    // Here&#39;s the function that we&#39;ll use as a Promise callback
    // This is the pseudorecursive magic that makes this all work.
    function handleNextInput(outputs) {
        if (inputs.length === 0) {
            // If there are no more inputs left, then return the array
            // of outputs, finally fulfilling this Promise and all the
            // previous resolved-but-not-fulfilled Promises.
            return outputs;
        } else {
            // If there are still input values to process, then we&#39;ll
            // return a Promise object, resolving the current Promise
            // with the future value from a new Promise.
            let nextInput = inputs.shift(); // Get the next input value,
            return promiseMaker(nextInput)  // compute the next output value,
                // Then create a new outputs array with the new output value
                .then(output =&gt; outputs.concat(output))
                // Then &quot;recurse&quot;, passing the new, longer, outputs array
                .then(handleNextInput);
        }
    }

    // Start with a Promise that fulfills to an empty array and use
    // the function above as its callback.
    return Promise.resolve([]).then(handleNextInput);
}
</code></pre>

<p>promiseSequence() å‡½æ•°æ˜¯é€šç”¨çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒé€šè¿‡ä»¥ä¸‹ä»£ç æ¥è·å– URLï¼š</p>

<pre><code class="language-javascript">// Given a URL, return a Promise that fulfills to the URL body text
function fetchBody(url) { return fetch(url).then(r =&gt; r.text()); }
// Use it to sequentially fetch a bunch of URL bodies
promiseSequence(urls, fetchBody)
    .then(bodies =&gt; { /* do something with the array of strings */ })
    .catch(console.error);
</code></pre>

<h2 id="toc_20">13.3 async å’Œ await</h2>

<p>ES2017 å¼•å…¥äº†ä¸¤ä¸ªæ–°çš„å…³é”®å­—ï¼ˆasync å’Œ awaitï¼‰æè¿°å¼‚æ­¥ JavaScript ç¼–ç¨‹ä¸­çš„æ¨¡å¼è½¬å˜ã€‚è¿™äº›æ–°å…³é”®å­—æå¤§åœ°ç®€åŒ–äº† Promises çš„ä½¿ç”¨ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿç¼–å†™åŸºäº Promise çš„å¼‚æ­¥ä»£ç çœ‹èµ·æ¥åƒæ˜¯ç­‰å¾…ç½‘ç»œå“åº”æˆ–å…¶ä»–å¼‚æ­¥äº‹ä»¶è€Œé˜»å¡çš„åŒæ­¥ä»£ç ã€‚å°½ç®¡äº†è§£ Promises çš„å·¥ä½œåŸç†ä»ç„¶å¾ˆé‡è¦ï¼Œä½†æ˜¯å½“å°†å®ƒä»¬ä¸ async å’Œ await ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå®ƒä»¬çš„å¤§éƒ¨åˆ†å¤æ‚æ€§ï¼ˆæœ‰æ—¶ç”šè‡³æ˜¯å®ƒä»¬çš„å­˜åœ¨ï¼ï¼‰å°±æ¶ˆå¤±äº†ã€‚ </p>

<p>å¦‚æœ¬ç« å‰é¢æ‰€è¿°ï¼Œå¼‚æ­¥ä»£ç æ— æ³•åƒå¸¸è§„åŒæ­¥ä»£ç é‚£æ ·è¿”å›å€¼æˆ–å¼•å‘å¼‚å¸¸ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Promise å¦‚æ­¤è®¾è®¡çš„åŸå› ã€‚å·²å…‘ç°çš„ Promise çš„å€¼ç±»ä¼¼äºåŒæ­¥å‡½æ•°çš„è¿”å›å€¼ã€‚è€Œä¸”å·²æ‹’ç»çš„ Promise çš„å€¼å°±åƒåŒæ­¥å‡½æ•°æŠ›å‡ºçš„å€¼ã€‚åè€…é€šè¿‡ç±»ä¼¼çš„ .catch() æ–¹æ³•å‘½åï¼Œä½¿å¾—è¡¨è¿°æ›´æ¸…æ™°ã€‚async å’Œ await ä½¿ç”¨é«˜æ•ˆçš„ã€åŸºäº Promise çš„ä»£ç å¹¶éšè— Promiseï¼Œä»¥ä¾¿å¼‚æ­¥ä»£ç å¯ä»¥åƒä½æ•ˆã€é˜»å¡ã€åŒæ­¥ä»£ç ä¸€æ ·å®¹æ˜“é˜…è¯»å’Œæ¨ç†ã€‚ </p>

<h3 id="toc_21">13.3.1 await è¡¨è¾¾å¼</h3>

<p>å…³é”®å­— await æ¥å—ä¸€ä¸ª Promiseï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºè¿”å›å€¼æˆ–å¼•å‘çš„å¼‚å¸¸ã€‚ç»™å®šä¸€ä¸ª Promise å¯¹è±¡ pï¼Œè¡¨è¾¾å¼ await p ç­‰å¾…ç›´åˆ° p æ•²å®šã€‚å¦‚æœ p å…‘ç°ï¼Œåˆ™ç­‰å¾… p çš„å€¼å°±æ˜¯ p çš„å…‘ç°å€¼ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœ p è¢«æ‹’ç»ï¼Œåˆ™ await p è¡¨è¾¾å¼å°†æŠ›å‡º p çš„æ‹’ç»å€¼ã€‚æˆ‘ä»¬é€šå¸¸ä¸å°† await ä¸ä¿å­˜ Promise çš„å˜é‡ä¸€èµ·ä½¿ç”¨ï¼›ç›¸åï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨è¿”å› Promise çš„å‡½æ•°ä¹‹å‰ä½¿ç”¨å®ƒï¼š</p>

<pre><code class="language-javascript">let response = await fetch(&quot;/api/user/profile&quot;);
let profile = await response.json();
</code></pre>

<p>ç«‹å³äº†è§£è‡³å…³é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨æŒ‡å®šçš„ Promise æ•²å®šä¹‹å‰ï¼Œawait å…³é”®å­—ä¸ä¼šå¯¼è‡´ç¨‹åºé˜»å¡ï¼Œå¹¶ä¸”å®é™…ä¸Šä»€ä¹ˆä¹Ÿä¸åšã€‚ä»£ç ä¿æŒå¼‚æ­¥ï¼Œå¹¶ä¸” await åªæ˜¯æ©ç›–äº†è¿™ä¸€äº‹å®ã€‚è¿™æ„å‘³ç€ä½¿ç”¨ await çš„ä»»ä½•ä»£ç æœ¬èº«éƒ½æ˜¯å¼‚æ­¥çš„ã€‚ </p>

<h3 id="toc_22">13.3.2 async å‡½æ•°</h3>

<p>å› ä¸ºä»»ä½•ä½¿ç”¨ await çš„ä»£ç éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªå…³é”®è§„åˆ™ï¼šåªèƒ½åœ¨ä½¿ç”¨ async å…³é”®å­—å£°æ˜çš„å‡½æ•°ä¸­ä½¿ç”¨ await å…³é”®å­—ã€‚ä¸‹é¢æ˜¯æœ¬ç« å‰é¢çš„ getHighScore() å‡½æ•°çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œä½¿ç”¨ async å’Œ await é‡å†™ï¼š</p>

<pre><code class="language-javascript">async function getHighScore() {
    let response = await fetch(&quot;/api/user/profile&quot;);
    let profile = await response.json();
    return profile.highScore;
}
</code></pre>

<p>å¼‚æ­¥å£°æ˜å‡½æ•°æ„å‘³ç€å‡½æ•°çš„è¿”å›å€¼å°†æ˜¯ä¸€ä¸ª Promiseï¼Œå³ä½¿å‡½æ•°ä½“ä¸­æ²¡æœ‰å‡ºç°ä¸ Promise ç›¸å…³çš„ä»£ç ã€‚å¦‚æœå¼‚æ­¥å‡½æ•°çœ‹èµ·æ¥æ­£å¸¸è¿”å›ï¼Œé‚£ä¹ˆä½œä¸ºå‡½æ•°å®é™…è¿”å›å€¼çš„ Promise å¯¹è±¡å°†å†³è®®ä¸ºè¯¥è¿”å›å€¼ã€‚å¦‚æœä¸€ä¸ªå¼‚æ­¥å‡½æ•°å‡ºç°æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆå®ƒè¿”å›çš„ Promise å¯¹è±¡å°†è¢«é‚£ä¸ªå¼‚å¸¸æ‹’ç»ã€‚</p>

<p>getHighScore() å‡½æ•°è¢«å£°æ˜ä¸ºå¼‚æ­¥ï¼Œå› æ­¤å®ƒè¿”å›ä¸€ä¸ªæ‰¿è¯ºã€‚å› ä¸ºå®ƒè¿”å›ä¸€ä¸ªæ‰¿è¯ºï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ await å…³é”®å­—ï¼š</p>

<pre><code class="language-javascript">displayHighScore(await getHighScore());
</code></pre>

<p>ä½†æ˜¯è¯·è®°ä½ï¼Œåªæœ‰åœ¨å¦ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ä¸­ï¼Œè¯¥è¡Œä»£ç æ‰æœ‰æ•ˆï¼å¯ä»¥æ ¹æ®éœ€è¦åœ¨å¼‚æ­¥å‡½æ•°ä¸­åµŒå¥—ä»»ä½•å±‚ await è¡¨è¾¾å¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¤„äºæœ€é«˜çº§åˆ« <sup id="fnref2"><a href="#fn2" rel="footnote">2</a></sup> æˆ–ç”±äºæŸç§åŸå› è€Œå¤„äºä¸å¼‚æ­¥çš„å‡½æ•°å†…ï¼Œé‚£ä¹ˆæ‚¨æ— æ³•ä½¿ç”¨ await å¹¶ä¸”å¿…é¡»ä»¥å¸¸è§„æ–¹å¼å¤„ç†è¿”å›çš„ Promiseï¼š </p>

<pre><code class="language-javascript">getHighScore().then(displayHighScore).catch(console.error);
</code></pre>

<p>å¯ä»¥å°† async å…³é”®å­—ä¸ä»»ä½•å‡½æ•°ä¸€èµ·ä½¿ç”¨ã€‚å®ƒç”¨ä½œäº function å…³é”®å­—ä½œä¸ºè¯­å¥æˆ–è¡¨è¾¾å¼ã€‚å®ƒå¯ä¸ç®­å¤´å‡½æ•°ä»¥åŠç±»å’Œå¯¹è±¡å­—é¢é‡ä¸­çš„é€Ÿè®°æ–¹æ³•æ–¹å¼ä¸€èµ·ä½¿ç”¨ã€‚ï¼ˆæœ‰å…³å¦‚ä½•ç¼–å†™å‡½æ•°çš„å„ç§æ–¹æ³•ï¼Œè¯·å‚è§ç¬¬ 8 ç« ã€‚ï¼‰ </p>

<h3 id="toc_23">13.3.3 ç­‰å¾…å¤šä¸ª Promise</h3>

<p>å‡è®¾æˆ‘ä»¬å·²ç»ä½¿ç”¨ async ç¼–å†™äº† getJSON() å‡½æ•°ï¼š </p>

<pre><code class="language-javascript">async function getJSON(url) {
    let response = await fetch(url);
    let body = await response.json();
    return body;
}
</code></pre>

<p>å¹¶ä¸”ç°åœ¨å‡è®¾æˆ‘ä»¬è¦ç”¨è¿™ä¸ªæ–¹æ³•è·å–ä¸¤ä¸ª JSON å€¼ï¼š</p>

<pre><code class="language-javascript">let value1 = await getJSON(url1);
let value2 = await getJSON(url2);
</code></pre>

<p>æ­¤ä»£ç çš„é—®é¢˜åœ¨äºï¼Œå®ƒä¸å¿…è¦åœ°æ˜¯è¿ç»­çš„ï¼šç¬¬äºŒä¸ª URL çš„è·å–è¦ç­‰åˆ°ç¬¬ä¸€æ¬¡è·å–å®Œæˆåæ‰èƒ½å¼€å§‹ã€‚å¦‚æœç¬¬äºŒä¸ª URL ä¸ä¾èµ–äºä»ç¬¬ä¸€ä¸ª URL è·å¾—çš„å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½åº”è¯¥å°è¯•åŒæ—¶è·å–ä¸¤ä¸ªå€¼ã€‚è¿™æ˜¯åŸºäº Promise çš„å¼‚æ­¥å‡½æ•°æœ¬è´¨çš„ä¸€ç§æƒ…å†µã€‚ä¸ºäº†ç­‰å¾…ä¸€ç»„å¹¶å‘æ‰§è¡Œçš„å¼‚æ­¥å‡½æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨ Promise.all() å°±åƒç›´æ¥ä½¿ç”¨ Promise ä¸€æ ·ï¼š </p>

<pre><code class="language-javascript">let [value1, value2] = await Promise.all([getJSON(url1), getJSON(url2)]);
</code></pre>

<h3 id="toc_24">13.3.4 å®ç°è¯¦ç»†</h3>

<p>æœ€åï¼Œä¸ºäº†äº†è§£å¼‚æ­¥åŠŸèƒ½æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè€ƒè™‘ä¸€ä¸‹å¹•åå‘ç”Ÿäº†ä»€ä¹ˆå¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚</p>

<p>å‡è®¾å†™è¿™æ ·çš„ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼š</p>

<pre><code class="language-javascript">async function f(x) { /* body */ }
</code></pre>

<p>å¯ä»¥å°†å…¶è§†ä¸ºåŒ…è£…åŸå§‹å‡½æ•°ä¸»ä½“çš„ Promise è¿”å›å‡½æ•°ï¼š</p>

<pre><code class="language-javascript">function f(x) {
    return new Promise(function(resolve, reject) {
        try {
            resolve((function(x) { /* body */ })(x));
        }
        catch(e) {
            reject(e);
        }
    });
}
</code></pre>

<p>ç”¨åƒè¿™æ ·çš„è¯­æ³•è½¬æ¢æ¥è¡¨è¾¾ await å…³é”®å­—æ¯”è¾ƒå›°éš¾ã€‚ä½†æ˜¯ï¼Œå°† await å…³é”®å­—è§†ä¸ºå°†å‡½æ•°ä¸»ä½“åˆ†è§£ä¸ºå•ç‹¬çš„åŒæ­¥å—çš„æ ‡è®°ã€‚ES2017 è§£é‡Šå™¨å¯ä»¥å°†å‡½æ•°ä¸»ä½“åˆ†è§£ä¸ºä¸€ç³»åˆ—å•ç‹¬çš„å­å‡½æ•°ï¼Œæ¯ä¸ªå­å‡½æ•°éƒ½ä¼ é€’ç»™ä½äºå…¶å‰é¢ await æ ‡è®°çš„ Promise çš„ then() æ–¹æ³•ã€‚</p>

<h2 id="toc_25">13.4 å¼‚æ­¥è¿­ä»£</h2>

<p>åœ¨æœ¬ç« çš„å¼€å¤´æˆ‘ä»¬è®¨è®ºäº†åŸºäºå›è°ƒå’ŒåŸºäºäº‹ä»¶çš„å¼‚æ­¥ï¼Œå½“æˆ‘ä»¬ä»‹ç» Promise æ—¶ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°å®ƒä»¬å¯¹äºå•æ¬¡å¼‚æ­¥è®¡ç®—å¾ˆæœ‰ç”¨ï¼Œä½†ä¸é€‚ç”¨äºé‡å¤æ€§å¼‚æ­¥äº‹ä»¶çš„ä»£ç ï¼Œä¾‹å¦‚ setInterval()ï¼Œç½‘ç»œæµè§ˆå™¨ä¸­çš„â€œclickâ€äº‹ä»¶æˆ– Node æµä¸Šçš„â€œdataâ€äº‹ä»¶ã€‚å› ä¸ºå•ä¸ª Promise ä¸é€‚ç”¨äºå¼‚æ­¥äº‹ä»¶åºåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¸èƒ½å¯¹è¿™äº›äº‹ç‰©ä½¿ç”¨å¸¸è§„çš„å¼‚æ­¥å‡½æ•°å’Œ await è¯­å¥ã€‚</p>

<p>ä½†æ˜¯ ES2018 æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚å¼‚æ­¥è¿­ä»£å™¨ç±»ä¼¼äºç¬¬ 12 ç« ä¸­æè¿°çš„è¿­ä»£å™¨ï¼Œä½†æ˜¯å®ƒä»¬åŸºäº Promiseï¼Œå¹¶ä¸”æ‰“ç®—ä¸ for/of å¾ªç¯ä¸€èµ·ä½¿ç”¨çš„æ–°å½¢å¼ï¼šfor/awaitã€‚</p>

<h3 id="toc_26">13.4.1 for/await å¾ªç¯</h3>

<p>Node 12 ä½¿å…¶å¯è¯»æµå¯ä»¥å¼‚æ­¥è¿­ä»£ã€‚è¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„ for/await å¾ªç¯ä»æµä¸­è¯»å–è¿ç»­çš„æ•°æ®å—ï¼š</p>

<pre><code class="language-javascript">const fs = require(&quot;fs&quot;);

async function parseFile(filename) {
    let stream = fs.createReadStream(filename, { encoding: &quot;utf-8&quot;});
    for await (let chunk of stream) {
        parseChunk(chunk); // Assume parseChunk() is defined elsewhere
    }
}
</code></pre>

<p>åƒæ™®é€šçš„ await è¡¨è¾¾å¼ä¸€æ ·ï¼Œfor/await å¾ªç¯æ˜¯åŸºäº promise çš„ã€‚ç²—ç•¥åœ°è¯´ï¼Œå¼‚æ­¥è¿­ä»£å™¨äº§ç”Ÿä¸€ä¸ª Promiseï¼Œfor/await å¾ªç¯ç­‰å¾…è¯¥ Promise å…‘ç°ï¼Œå°†å…‘ç°å€¼åˆ†é…ç»™å¾ªç¯å˜é‡ï¼Œç„¶åè¿è¡Œå¾ªç¯çš„ä¸»ä½“ã€‚ç„¶åé‡æ–°å¼€å§‹ï¼Œä»è¿­ä»£å™¨ä¸­è·å¾—å¦ä¸€ä¸ª Promiseï¼Œç„¶åç­‰å¾…è¯¥æ–° Promise å…‘ç°ã€‚</p>

<p>å‡è®¾æœ‰ä¸€ä¸ª URL æ•°ç»„ï¼š</p>

<pre><code class="language-javascript">const urls = [url1, url2, url3];
</code></pre>

<p>å¯ä»¥åœ¨æ¯ä¸ª URL ä¸Šè°ƒç”¨ fetch() ä»¥è·å–ä¸€ä¸ª promise æ•°ç»„ï¼š</p>

<pre><code class="language-javascript">const promises = urls.map(url =&gt; fetch(url));
</code></pre>

<p>æˆ‘ä»¬åœ¨æœ¬ç« çš„å‰é¢å·²ç»çœ‹åˆ°ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨ Promise.all() ç­‰å¾…æ•°ç»„ä¸­çš„æ‰€æœ‰ promise éƒ½å·²å…Œç¾ã€‚ä½†æ˜¯ï¼Œå‡è®¾æˆ‘ä»¬å¸Œæœ›ç¬¬ä¸€ä¸ªæå–çš„ç»“æœå°½å¿«å¯ç”¨ï¼Œå¹¶ä¸”ä¸æƒ³ç­‰å¾…æ‰€æœ‰ URL éƒ½è¢«è·å–ã€‚ï¼ˆå½“ç„¶ï¼Œç¬¬ä¸€æ¬¡è·å–å¯èƒ½æ¯”å…¶ä»–ä»»ä½•è·å–éƒ½è¦èŠ±è´¹æ›´é•¿çš„æ—¶é—´ï¼Œå› æ­¤ä¸ä¸€å®šæ¯”ä½¿ç”¨ Promise.all() æ›´å¿«ã€‚ï¼‰æ•°ç»„æ˜¯å¯è¿­ä»£çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¸è§„çš„ for/of å¯¹æ•°ç»„è¿›è¡Œéå†ï¼š</p>

<pre><code class="language-javascript">for(const promise of promises) {
    response = await promise;
    handle(response);
}
</code></pre>

<p>æ­¤ç¤ºä¾‹ä»£ç ä½¿ç”¨ for/of å¾ªç¯éå†å¸¸è§„è¿­ä»£å™¨ã€‚ä½†æ˜¯å› ä¸ºæ­¤è¿­ä»£å™¨è¿”å› Promiseï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥å°†æ–°çš„ for/await ç¨å¾®ç®€åŒ–ä¸‹ä»£ç ï¼š</p>

<pre><code class="language-javascript">for await (const response of promises) {
    handle(response);
}
</code></pre>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œfor/await å¾ªç¯ä»…å°† await è°ƒç”¨æ„å»ºåˆ°å¾ªç¯ä¸­ï¼Œå¹¶ä½¿æˆ‘ä»¬çš„ä»£ç ç¨å¾®ç´§å‡‘ä¸€äº›ï¼Œä½†æ˜¯ä¸¤ä¸ªç¤ºä¾‹çš„ä½œç”¨å®Œå…¨ç›¸åŒã€‚é‡è¦çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªç¤ºä¾‹åªæœ‰åœ¨å£°æ˜ä¸ºå¼‚æ­¥çš„å‡½æ•°ä¸­æ—¶æ‰èµ·ä½œç”¨ã€‚for/await å¾ªç¯ä¸å¸¸è§„ await è¡¨è¾¾å¼æ²¡æœ‰ä»€ä¹ˆä¸åŒã€‚</p>

<p>ä½†æ˜¯ï¼Œé‡è¦çš„æ˜¯è¦æ„è¯†åˆ°ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ for/wait ä½œç”¨äºå¸¸è§„è¿­ä»£å™¨çš„ã€‚ä½œç”¨äºå®Œå…¨å¼‚æ­¥çš„è¿­ä»£å™¨ä½¿äº‹æƒ…å˜å¾—æ›´åŠ æœ‰è¶£ã€‚</p>

<h3 id="toc_27">13.4.2 å¼‚æ­¥è¿­ä»£å™¨</h3>

<p>è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ç¬¬ 12 ç« ä¸­çš„ä¸€äº›æœ¯è¯­ã€‚å¯è¿­ä»£å¯¹è±¡æ˜¯å¯ä»¥ä¸ for/of å¾ªç¯ä¸€èµ·ä½¿ç”¨çš„å¯¹è±¡ã€‚å®ƒå®šä¹‰äº†ä¸€ä¸ªåç§°ä¸º Symbol.iterator çš„æ–¹æ³•ã€‚æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ã€‚è¿­ä»£å™¨å¯¹è±¡å…·æœ‰ next() æ–¹æ³•ï¼Œå¯ä»¥é‡å¤è°ƒç”¨è¯¥æ–¹æ³•ä»¥è·å¾—å¯è¿­ä»£å¯¹è±¡çš„å€¼ã€‚è¿­ä»£å™¨å¯¹è±¡çš„ next() æ–¹æ³•è¿”å›è¿­ä»£ç»“æœå¯¹è±¡ã€‚è¿­ä»£ç»“æœå¯¹è±¡å…·æœ‰ value å±æ€§å’Œæˆ–æˆ– done å±æ€§ã€‚</p>

<p>å¼‚æ­¥è¿­ä»£å™¨ä¸å¸¸è§„è¿­ä»£å™¨éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªé‡è¦çš„åŒºåˆ«ã€‚ é¦–å…ˆï¼Œä¸€ä¸ªå¼‚æ­¥å¯è¿­ä»£å¯¹è±¡ä»¥ç¬¦å·åç§° Symbol.asyncIterator è€Œä¸æ˜¯ Symbol.iterator å®ç°ä¸€ä¸ªæ–¹æ³•ã€‚ï¼ˆå¦‚å‰æ‰€è¿°ï¼Œfor/await ä¸å¸¸è§„å¯è¿­ä»£å¯¹è±¡å…¼å®¹ï¼Œä½†æ˜¯å®ƒæ›´å–œæ¬¢å¼‚æ­¥å¯è¿­ä»£å¯¹è±¡ï¼Œå¹¶åœ¨å°è¯• Symbol.iterator æ–¹æ³•ä¹‹å‰å…ˆå°è¯•ä½¿ç”¨ Symbol.asyncIterator æ–¹æ³•ã€‚ï¼‰å…¶æ¬¡ï¼Œå¼‚æ­¥è¿­ä»£å™¨çš„ next() æ–¹æ³•è¿”å›è§£æä¸ºè¿­ä»£å™¨ç»“æœå¯¹è±¡çš„ Promiseï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›è¿­ä»£å™¨ç»“æœå¯¹è±¡ã€‚</p>

<p><strong>æ³¨æ„</strong></p>

<p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œå½“æˆ‘ä»¬åœ¨å¸¸è§„çš„ã€åŒæ­¥å¯è¿­ä»£çš„ Promise æ•°ç»„ä¸Šä½¿ç”¨ for/await æ—¶ï¼Œæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨åŒæ­¥è¿­ä»£å™¨ç»“æœå¯¹è±¡ï¼Œå…¶ä¸­ value å±æ€§æ˜¯ Promise å¯¹è±¡ï¼Œä½† done å±æ€§æ˜¯åŒæ­¥çš„ã€‚çœŸæ­£çš„å¼‚æ­¥è¿­ä»£å™¨ä¸ºè¿­ä»£ç»“æœå¯¹è±¡è¿”å› Promiseï¼Œå¹¶ä¸” value å’Œ done å±æ€§éƒ½æ˜¯å¼‚æ­¥çš„ã€‚è¿™æ˜¯ä¸€ä¸ªå¾®å¦™çš„åŒºåˆ«ï¼šä½¿ç”¨å¼‚æ­¥è¿­ä»£å™¨ï¼Œå¯ä»¥å¼‚æ­¥é€‰æ‹©ä½•æ—¶ç»“æŸè¿­ä»£ã€‚</p>

<h3 id="toc_28">13.4.3 å¼‚æ­¥ç”Ÿæˆå™¨</h3>

<p>æ­£å¦‚æˆ‘ä»¬åœ¨ç¬¬ 12 ç« ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼Œå®ç°è¿­ä»£å™¨çš„æœ€ç®€å•æ–¹æ³•é€šå¸¸æ˜¯ä½¿ç”¨ç”Ÿæˆå™¨ã€‚å¼‚æ­¥è¿­ä»£å™¨ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å£°æ˜ä¸ºå¼‚æ­¥çš„ç”Ÿæˆå™¨å‡½æ•°æ¥å®ç°ã€‚å¼‚æ­¥ç”Ÿæˆå™¨å…·æœ‰å¼‚æ­¥ç‰¹æ€§å’Œç”Ÿæˆå™¨ç‰¹æ€§ï¼šå¯ä»¥åƒåœ¨å¸¸è§„å¼‚æ­¥å‡½æ•°ä¸­ä¸€æ ·ä½¿ç”¨ awaitï¼Œå¹¶ä¸”å¯ä»¥åƒåœ¨å¸¸è§„ç”Ÿæˆå™¨ä¸­ä¸€æ ·ä½¿ç”¨ yieldã€‚ä½†æ˜¯ï¼Œäº§ç”Ÿçš„å€¼ä¼šè‡ªåŠ¨åŒ…è£…åœ¨ Promise ä¸­ã€‚ç”šè‡³å¼‚æ­¥ç”Ÿæˆå™¨çš„è¯­æ³•ä¹Ÿæ˜¯ä¸€ä¸ªç»„åˆï¼šå¼‚æ­¥å‡½æ•°å’Œ function* ç»„åˆä¸º async function*ã€‚è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæè¿°å¦‚ä½•ä½¿ç”¨å¼‚æ­¥ç”Ÿæˆå™¨å’Œ for/await å¾ªç¯ä»£æ›¿ setInterval() å›è°ƒå‡½æ•°ä»¥å›ºå®šçš„é—´éš”é‡å¤è¿è¡Œä»£ç ï¼š</p>

<pre><code class="language-javascript">// A Promise-based wrapper around setTimeout() that we can use await with.
// Returns a Promise that fulfills in the specified number of milliseconds
function elapsedTime(ms) {
    return new Promise(resolve =&gt; setTimeout(resolve, ms));
}

// An async generator function that increments a counter and yields it
// a specified (or infinite) number of times at a specified interval.
async function* clock(interval, max=Infinity) {
    for(let count = 1; count &lt;= max; count++) { // regular for loop
        await elapsedTime(interval);            // wait for time to pass
        yield count;                            // yield the counter
    }
}

// A test function that uses the async generator with for/await
async function test() {                       // Async so we can use for/await
    for await (let tick of clock(300, 100)) { // Loop 100 times every 300ms
        console.log(tick);
    }
}
</code></pre>

<h3 id="toc_29">13.4.4 å®ç°å¼‚æ­¥è¿­ä»£å™¨</h3>

<p>é™¤äº†ä½¿ç”¨å¼‚æ­¥ç”Ÿæˆå™¨æ¥å®ç°å¼‚æ­¥è¿­ä»£å™¨å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ Symbol.asyncIterator() æ–¹æ³•å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ¥ç›´æ¥å®ç°å®ƒä»¬ï¼Œè€Œ Symbol.asyncIterator() æ–¹æ³•å°†è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œ next() æ–¹æ³•å°†è¿”å›ä¸€ä¸ªå†³è®®ä¸ºè¿­ä»£å™¨ç»“æœå¯¹è±¡çš„ Promiseã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é‡æ–°å®ç°äº†ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­çš„ clock() å‡½æ•°ï¼Œå› æ­¤å®ƒä¸æ˜¯ç”Ÿæˆå™¨ï¼Œè€Œä»…æ˜¯è¿”å›ä¸€ä¸ªå¼‚æ­¥å¯è¿­ä»£çš„å¯¹è±¡ã€‚è¯·æ³¨æ„ï¼Œæ­¤ç¤ºä¾‹ä¸­çš„ next() æ–¹æ³•æœªæ˜ç¡®è¿”å› Promiseï¼›ç›¸åï¼Œæˆ‘ä»¬åªå£°æ˜ next() æ˜¯å¼‚æ­¥çš„ï¼š</p>

<pre><code class="language-javascript">function clock(interval, max=Infinity) {
    // A Promise-ified version of setTimeout that we can use await with.
    // Note that this takes an absolute time instead of an interval.
    function until(time) {
        return new Promise(resolve =&gt; setTimeout(resolve, time - Date.now()));
    }

    // Return an asynchronously iterable object
    return {
        startTime: Date.now(),  // Remember when we started
        count: 1,               // Remember which iteration we&#39;re on
        async next() {          // The next() method makes this an iterator
            if (this.count &gt; max) {     // Are we done?
                return { done: true };  // Iteration result indicating done
            }
            // Figure out when the next iteration should begin,
            let targetTime = this.startTime + this.count * interval;
            // wait until that time,
            await until(targetTime);
            // and return the count value in an iteration result object.
            return { value: this.count++ };
        },
        // This method means that this iterator object is also an iterable.
        [Symbol.asyncIterator]() { return this; }
    };
}
</code></pre>

<p>è¿™ä¸ªåŸºäºè¿­ä»£å™¨ç‰ˆæœ¬çš„ clock() å‡½æ•°ä¿®å¤äº†åŸºäºç”Ÿæˆå™¨ç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªç¼ºé™·ã€‚è¯·æ³¨æ„ï¼Œåœ¨æ­¤ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¯æ¬¡è¿­ä»£å¼€å§‹æ—¶è®¾ç½®äº†ç»å¯¹ç›®æ ‡æ—¶é—´ï¼Œå¹¶å°†å…¶ä¸å½“å‰æ—¶é—´çš„å·®å€¼ä½œä¸ºé—´éš”ä¼ é€’ç»™ setTimeout()ã€‚å¦‚æœæˆ‘ä»¬å°† clock() ä¸ for/await å¾ªç¯ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™æ­¤ç‰ˆæœ¬å°†åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…æ›´ç²¾ç¡®åœ°è¿è¡Œå¾ªç¯è¿­ä»£ï¼Œå› ä¸ºå®ƒè€ƒè™‘äº†å®é™…è¿è¡Œå¾ªç¯ä¸»ä½“æ‰€éœ€çš„æ—¶é—´ã€‚ä½†æ˜¯ï¼Œæ­¤ä¿®è¡¥ç¨‹åºä¸ä»…æ¶‰åŠå®šæ—¶ç²¾åº¦ã€‚for/await å¾ªç¯å§‹ç»ˆåœ¨å¼€å§‹ä¸‹ä¸€æ¬¡è¿­ä»£ä¹‹å‰ç­‰å¾…ä¸€æ¬¡è¿­ä»£è¿”å›çš„ Promise è¢«å…‘ç°ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨ä¸å¸¦ for/await å¾ªç¯çš„å¼‚æ­¥è¿­ä»£å™¨ï¼Œåˆ™æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢åœ¨éœ€è¦æ—¶è°ƒç”¨ next() æ–¹æ³•ã€‚ä½¿ç”¨åŸºäºç”Ÿæˆå™¨çš„ clock() ç‰ˆæœ¬ï¼Œå¦‚æœä¾æ¬¡è°ƒç”¨ next() æ–¹æ³•ä¸‰éï¼Œå°†è·å¾—ä¸‰ä¸ª Promiseï¼Œè¿™äº› Promise å‡ ä¹éƒ½åœ¨åŒä¸€æ—¶é—´å®Œæˆï¼Œè¿™å¯èƒ½ä¸æ˜¯æƒ³è¦çš„ç»“æœã€‚æˆ‘ä»¬åœ¨è¿™é‡Œå®ç°çš„åŸºäºè¿­ä»£å™¨çš„ç‰ˆæœ¬æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚</p>

<p>å¼‚æ­¥è¿­ä»£å™¨çš„å¥½å¤„åœ¨äºï¼Œå®ƒä»¬å…è®¸æˆ‘ä»¬è¡¨ç¤ºå¼‚æ­¥äº‹ä»¶æˆ–æ•°æ®æµã€‚å‰é¢è®¨è®ºçš„ clock() å‡½æ•°ç¼–å†™èµ·æ¥éå¸¸ç®€å•ï¼Œå› ä¸ºå¼‚æ­¥æºæ˜¯æˆ‘ä»¬è‡ªå·±è¿›è¡Œçš„ setTimeout() è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬å°è¯•ä¸å…¶ä»–å¼‚æ­¥æºä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä¾‹å¦‚äº‹ä»¶å¤„ç†ç¨‹åºçš„è§¦å‘ï¼Œå®ç°å¼‚æ­¥è¿­ä»£å™¨çš„éš¾åº¦å°†å¤§å¤§æé«˜â€”â€”â€”â€”æˆ‘ä»¬é€šå¸¸åªæœ‰ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºå‡½æ•°æ¥å“åº”äº‹ä»¶ï¼Œä½†æ˜¯æ¯æ¬¡è°ƒç”¨è¿­ä»£å™¨çš„ next() æ–¹æ³•ä¸€å®šè¿”å›ä¸€ä¸ªä¸åŒçš„ Promise å¯¹è±¡ï¼Œå¹¶ä¸”åœ¨ç¬¬ä¸€ä¸ª Promise å†³è®®ä¹‹å‰ï¼Œå¯èƒ½ä¼šå¤šæ¬¡è°ƒç”¨ next()ã€‚è¿™æ„å‘³ç€ï¼Œä»»ä½•å¼‚æ­¥è¿­ä»£å™¨æ–¹æ³•éƒ½å¿…é¡»èƒ½å¤Ÿç»´æŠ¤ä¸€ä¸ªå†…éƒ¨çš„ Promise é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—å°†åœ¨å“åº”å¼‚æ­¥äº‹ä»¶æ—¶æŒ‰é¡ºåºè¿›è¡Œå†³è®®ã€‚å¦‚æœæˆ‘ä»¬å°†æ­¤ Promise æœ‰åºåˆ—çš„è¡Œä¸ºå°è£…åˆ° AsyncQueue ç±»ä¸­ï¼Œé‚£ä¹ˆåŸºäº AsyncQueue ç¼–å†™å¼‚æ­¥è¿­ä»£å™¨å°†å˜å¾—æ›´åŠ å®¹æ˜“ã€‚ <sup id="fnref3"><a href="#fn3" rel="footnote">3</a></sup></p>

<p>æ­£å¦‚æœŸæœ›çš„é‚£æ ·ï¼Œåé¢çš„ AsyncQueue ç±»å…·æœ‰ enqueue() å’Œ dequeue() æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œdequeue() æ–¹æ³•è¿”å› Promise è€Œä¸æ˜¯å®é™…å€¼ï¼Œè¿™æ„å‘³ç€å¯ä»¥åœ¨è°ƒç”¨ enqueue() ä¹‹å‰è°ƒç”¨ dequeue()ã€‚AsyncQueue ç±»ä¹Ÿæ˜¯ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨ï¼Œæ—¨åœ¨ä¸ for/await å¾ªç¯ä¸€èµ·ä½¿ç”¨ï¼Œè¯¥å¾ªç¯çš„ä¸»ä½“åœ¨æ¯æ¬¡å°†æ–°å€¼å¼‚æ­¥æ’é˜Ÿæ—¶éƒ½è¿è¡Œä¸€æ¬¡ã€‚ï¼ˆAsyncQueue æœ‰ä¸€ä¸ª close() æ–¹æ³•ã€‚ä¸€æ—¦è¢«è°ƒç”¨ï¼Œå°±ä¸èƒ½å°†æ›´å¤šçš„å€¼åŠ å…¥é˜Ÿåˆ—ã€‚å½“å…³é—­çš„é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œfor/await å¾ªç¯å°†åœæ­¢éå†ã€‚ï¼‰</p>

<p>è¯·æ³¨æ„ï¼ŒAsyncQueue çš„å®ç°ä¸ä½¿ç”¨å¼‚æ­¥æˆ–ç­‰å¾…ï¼Œè€Œæ˜¯ç›´æ¥ä¸ Promise ä¸€èµ·ä½¿ç”¨ã€‚è¯¥ä»£ç æœ‰äº›å¤æ‚ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥æµ‹è¯•å¯¹æœ¬é•¿ç¯‡æ–‡ç« æ‰€æ¶‰åŠå†…å®¹çš„ç†è§£ã€‚å³ä½¿æ‚¨ä¸å®Œå…¨äº†è§£ AsyncQueue çš„å®ç°ï¼Œä¹Ÿè¯·çœ‹ä¸€ä¸‹å®ƒåé¢çš„ç®€çŸ­ç¤ºä¾‹ï¼šå®ƒåœ¨ AsyncQueue ä¹‹ä¸Šå®ç°äº†ä¸€ä¸ªç®€å•ä½†éå¸¸æœ‰è¶£çš„å¼‚æ­¥è¿­ä»£å™¨ã€‚</p>

<pre><code class="language-javascript">/**
 * An asynchronously iterable queue class. Add values with enqueue()
 * and remove them with dequeue(). dequeue() returns a Promise, which
 * means that values can be dequeued before they are enqueued. The
 * class implements [Symbol.asyncIterator] and next() so that it can
 * be used with the for/await loop (which will not terminate until
 * the close() method is called.)
 */
class AsyncQueue {
    constructor() {
        // Values that have been queued but not dequeued yet are stored here
        this.values = [];
        // When Promises are dequeued before their corresponding values are
        // queued, the resolve methods for those Promises are stored here.
        this.resolvers = [];
        // Once closed, no more values can be enqueued, and no more unfulfilled
        // Promises returned.
        this.closed = false;
    }

    enqueue(value) {
        if (this.closed) {
            throw new Error(&quot;AsyncQueue closed&quot;);
        }
        if (this.resolvers.length &gt; 0) {
            // If this value has already been promised, resolve that Promise
            const resolve = this.resolvers.shift();
            resolve(value);
        }
        else {
            // Otherwise, queue it up
            this.values.push(value);
        }
    }

    dequeue() {
        if (this.values.length &gt; 0) {
            // If there is a queued value, return a resolved Promise for it
            const value = this.values.shift();
            return Promise.resolve(value);
        }
        else if (this.closed) {
            // If no queued values and we&#39;re closed, return a resolved
            // Promise for the &quot;end-of-stream&quot; marker
            return Promise.resolve(AsyncQueue.EOS);
        }
        else {
            // Otherwise, return an unresolved Promise,
            // queuing the resolver function for later use
            return new Promise((resolve) =&gt; { this.resolvers.push(resolve); });
        }
    }

    close() {
        // Once the queue is closed, no more values will be enqueued.
        // So resolve any pending Promises with the end-of-stream marker
        while(this.resolvers.length &gt; 0) {
            this.resolvers.shift()(AsyncQueue.EOS);
        }
        this.closed = true;
    }

    // Define the method that makes this class asynchronously iterable
    [Symbol.asyncIterator]() { return this; }

    // Define the method that makes this an asynchronous iterator. The
    // dequeue() Promise resolves to a value or the EOS sentinel if we&#39;re
    // closed. Here, we need to return a Promise that resolves to an
    // iterator result object.
    next() {
        return this.dequeue().then(value =&gt; (value === AsyncQueue.EOS)
                                   ? { value: undefined, done: true }
                                   : { value: value, done: false });
    }
}

// A sentinel value returned by dequeue() to mark &quot;end of stream&quot; when closed
AsyncQueue.EOS = Symbol(&quot;end-of-stream&quot;);
</code></pre>

<p>å› ä¸º AsyncQueue ç±»å®šä¹‰äº†å¼‚æ­¥è¿­ä»£åŸºç¡€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç®€å•åœ°é€šè¿‡å¼‚æ­¥æ’é˜Ÿå€¼æ¥åˆ›å»ºæ›´æœ‰è¶£çš„è‡ªå®šä¹‰å¼‚æ­¥è¿­ä»£å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ AsyncQueue ç”Ÿæˆå¯é€šè¿‡ for/await å¾ªç¯å¤„ç†çš„ web æµè§ˆå™¨äº‹ä»¶æµçš„ç¤ºä¾‹ï¼š</p>

<pre><code class="language-javascript">// Push events of the specified type on the specified document element
// onto an AsyncQueue object, and return the queue for use as an event stream
function eventStream(elt, type) {
    const q = new AsyncQueue();                  // Create a queue
    elt.addEventListener(type, e=&gt;q.enqueue(e)); // Enqueue events
    return q;
}

async function handleKeys() {
    // Get a stream of keypress events and loop once for each one
    for await (const event of eventStream(document, &quot;keypress&quot;)) {
        console.log(event.key);
    }
}
</code></pre>

<h2 id="toc_30">13.5 Summary</h2>

<p>åœ¨æœ¬ç« ä¸­ï¼Œæ‚¨å­¦ä¹ äº†ï¼š</p>

<p>å¤§å¤šæ•°çœŸå®çš„ JavaScript ç¨‹åºéƒ½æ˜¯å¼‚æ­¥çš„ã€‚</p>

<p>ä¼ ç»Ÿä¸Šï¼Œå¼‚æ­¥æ˜¯é€šè¿‡äº‹ä»¶å’Œå›è°ƒå‡½æ•°æ¥å¤„ç†çš„ã€‚ä½†æ˜¯ï¼Œè¿™å¯èƒ½ä¼šå˜å¾—å¤æ‚ï¼Œå› ä¸ºæœ€ç»ˆå¯èƒ½ä¼šåµŒå¥—åœ¨å…¶ä»–å›è°ƒä¸­åµŒå¥—çš„å¤šä¸ªçº§åˆ«çš„å›è°ƒï¼Œå¹¶ä¸”å› ä¸ºå¾ˆéš¾è¿›è¡Œå¯é çš„å¼‚å¸¸å¤„ç†ã€‚</p>

<p>Promise æä¾›äº†æ„é€ å›è°ƒå‡½æ•°çš„æ–°æ–¹æ³•ã€‚å¦‚æœæ­£ç¡®ä½¿ç”¨ï¼ˆä¸å¹¸çš„æ˜¯ï¼ŒPromise æ˜“äºé”™è¯¯ä½¿ç”¨ï¼‰ï¼Œå®ƒä»¬å¯ä»¥å°†å¼‚æ­¥ä»£ç è½¬æ¢ä¸ºåµŒå¥—åœ¨è°ƒç”¨ then() çš„çº¿æ€§é“¾ä¸­çš„ä»£ç ï¼Œä¸€ä¸ªè®¡ç®—çš„å¼‚æ­¥æ­¥éª¤è·Ÿéšåœ¨å…¶ä»–ä¹‹åã€‚è€Œä¸”ï¼ŒPromise å…è®¸å°†å¼‚å¸¸å¤„ç†ä»£ç é›†ä¸­åˆ°ä¸€ä¸ª then() è°ƒç”¨é“¾æœ«å°¾çš„å•ä¸ª catch() è°ƒç”¨ä¸­ã€‚</p>

<p>async å’Œ await å…³é”®å­—å…è®¸æˆ‘ä»¬ç¼–å†™å¼‚æ­¥ä»£ç ï¼Œè¯¥ä»£ç åŸºäº Promiseï¼Œä½†çœ‹èµ·æ¥åƒåŒæ­¥ä»£ç ã€‚è¿™ä½¿ä»£ç æ›´æ˜“äºç†è§£å’Œæ¨ç†ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°è¢«å£°æ˜ä¸º asyncï¼Œå®ƒå°†éšå¼è¿”å›ä¸€ä¸ª Promiseã€‚åœ¨å¼‚æ­¥å‡½æ•°å†…éƒ¨ï¼Œå¯ä»¥ await Promiseï¼ˆæˆ–è¿”å› Promise çš„å‡½æ•°ï¼‰ï¼Œå°±åƒ Promise å€¼æ˜¯åŒæ­¥è®¡ç®—çš„ä¸€æ ·ã€‚</p>

<p>å¼‚æ­¥å¯è¿­ä»£çš„å¯¹è±¡å¯ä»¥ä¸ for/await å¾ªç¯ä¸€èµ·ä½¿ç”¨ã€‚å¯ä»¥é€šè¿‡å®ç° [Symbol.asyncIterator]() æ–¹æ³•æˆ–è°ƒç”¨ async function* ç”Ÿæˆå™¨å‡½æ•°æ¥åˆ›å»ºå¼‚æ­¥å¯è¿­ä»£å¯¹è±¡ã€‚å¼‚æ­¥è¿­ä»£å™¨ä¸º Node ä¸­æµçš„â€œdataâ€äº‹ä»¶æä¾›äº†ä¸€ç§æ›¿ä»£æ–¹æ³•ï¼Œå¯ç”¨äºè¡¨ç¤ºå®¢æˆ·ç«¯ JavaScript ä¸­çš„ç”¨æˆ·è¾“å…¥äº‹ä»¶çš„æµã€‚</p>

<div class="footnotes">
<hr/>
<ol>

<li id="fn1">
<p>XMLHttpRequest ç±»ä¸ XML æ— å…³ã€‚åœ¨ç°ä»£çš„å®¢æˆ·ç«¯ JavaScript ä¸­ï¼Œå®ƒå·²è¢« fetch() API å–ä»£ï¼Œè¯¥ API å·²åœ¨ Â§15.11.1 ä¸­è¿›è¡Œäº†ä»‹ç»ã€‚æ­¤å¤„æ˜¾ç¤ºçš„ä»£ç ç¤ºä¾‹æ˜¯æœ¬ä¹¦ä¸­æœ€åä¸€ä¸ªåŸºäº XMLHttpRequest çš„ç¤ºä¾‹ã€‚ &nbsp;<a href="#fnref1" rev="footnote">&#8617;</a></p>
</li>

<li id="fn2">
<p>é€šå¸¸ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨çš„å¼€å‘äººå‘˜æ§åˆ¶å°çš„é¡¶å±‚ä½¿ç”¨ awaitã€‚è¿˜æœ‰ä¸€ä¸ªæ‚¬è€Œæœªå†³çš„å»ºè®®ï¼Œå…è®¸åœ¨å°†æ¥çš„ JavaScript ç‰ˆæœ¬ä¸­è¿›è¡Œé¡¶çº§ awaitã€‚ &nbsp;<a href="#fnref2" rev="footnote">&#8617;</a></p>
</li>

<li id="fn3">
<p>æˆ‘ä» Dr. Axel Rauschmayer çš„åšå®¢<a href="">https://2ality.com</a>ä¸­äº†è§£äº†è¿™ç§å¼‚æ­¥è¿­ä»£æ–¹æ³•ã€‚&nbsp;<a href="#fnref3" rev="footnote">&#8617;</a></p>
</li>

</ol>
</div>

]]></content>
  </entry>
  
</feed>
