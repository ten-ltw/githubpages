<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    
    通过变量作用域深入了解undefined - 十
    
  </title>
  <meta name="description" content="">
  <link href="atom.xml" rel="alternate" title="十" type="application/atom+xml">
  <link rel="stylesheet" href="asset/css/foundation.min.css" />
  <link rel="stylesheet" href="asset/css/docs.css" />
  <script src="asset/js/vendor/modernizr.js"></script>
  <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>
    hljs.initHighlightingOnLoad();
  </script>
</head>

<body class="antialiased hide-extras">
  <div class="marketing off-canvas-wrap" data-offcanvas>
    <div class="inner-wrap">
      <nav class="top-bar docs-bar hide-for-small" data-topbar>
        <div id="header">
          <h3><a href="index.html">十的对称 十的完美</a></h1>
        </div>
      </nav>
      <nav class="tab-bar show-for-small">
        <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
          <span> &nbsp;</span>
        </a>
        <div id="header">
          <h3><a href="index.html">十的对称 十的完美</a></h1>
        </div>
      </nav>
      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><a href="index.html">关于我</a></li>
          
          <li class="divider"></li>
          <li><label>JavaScript权威指南第七版</label></li>
          
          <li><a title="# 第 8 章 函数" href="16106664265983.html"># 第 8 章 函数</a></li>
          
          
          <li class="divider"></li>
          <li><label>JavaScript30</label></li>
          
          <li><a title="01 JavaScript Drum Kit" href="16089052254448.html">01 JavaScript Drum Kit</a></li>
          
          <li><a title="01 JavaScript Drum Kit 中文指南" href="16089048368062.html">01 JavaScript Drum Kit 中文指南</a></li>
          
          
          <li class="divider"></li>
          <li><label>杂念</label></li>
          
          <li><a title="努力了三个月的总结" href="16084764191221.html">努力了三个月的总结</a></li>
          
          
          <li class="divider"></li>
          <li><label>JavaScript</label></li>
          
          <li><a title="类型转换" href="16089553577924.html">类型转换</a></li>
          
          <li><a title="通过变量作用域深入了解undefined" href="16088182648987.html">通过变量作用域深入了解undefined</a></li>
          
          <li><a title="重新认识下熟悉的浏览器" href="16076922632055.html">重新认识下熟悉的浏览器</a></li>
          
          <li><a title="JavaScript类型转换" href="16087263047458.html">JavaScript类型转换</a></li>
          
          
          <li class="divider"></li>
          <li><label>重学前端--学习笔记</label></li>
          
          <li><a title="JavaScript全部的对象分类" href="16085442753431.html">JavaScript全部的对象分类</a></li>
          
          <li><a title="JavaScript的面向对象" href="16085441443213.html">JavaScript的面向对象</a></li>
          
          <li><a title="JavaScript中的类型" href="16083847578374.html">JavaScript中的类型</a></li>
          
          <li><a title="JavaScript原型和原型链" href="16080322533005.html">JavaScript原型和原型链</a></li>
          
          
          <li class="divider"></li>
          <li><label>Angular</label></li>
          
          <li><a title="angular mock的使用" href="16073237309370.html">angular mock的使用</a></li>
          
          
          <li class="divider"></li>
          <li><label>英语课</label></li>
          
          <li><a title="chapter 3 Travaling" href="16092359109167.html">chapter 3 Travaling</a></li>
          
          <li><a title="chapter 2 Dining" href="16089552578971.html">chapter 2 Dining</a></li>
          
          <li><a title="Chapter 1 Shopping" href="16089552264437.html">Chapter 1 Shopping</a></li>
          
          
        </ul>
      </aside>
      <a class="exit-off-canvas" href="#"></a>
      <section id="main-content" role="main" class="scroll-container">
        <div class="row">
          <div class="large-9 medium-9 columns">
  <div class="markdown-body">
  <div class="markdown-inside">
    <h1>通过变量作用域深入了解undefined</h1>
    <time class="article-date" datetime="2020-12-24T21:57:44+08:00">发布于2020/12/24</time>
    <p>听winter老师的课知道undefined是一个变量，它可以被改变，所以使用void（0）来代替他，但是在做实验的时候发现虽然它赋值不报错，取值时候undefined却并没有改变。</p>

<pre><code class="language-javascript">    undefined = 0
    // 0
    undefined
    // undefined
</code></pre>

<p>这回学习到了变量作用域，再结合之前学的对象的属性，深入了解下undefined到底什么时候会被篡改。</p>

<h2 id="toc_0">函数作用域和声明提前</h2>

<p>别的语言一般为块级作用域，js取而代之使用了函数作用域：变量在声明它们的函数体以及这个函数体嵌套的任意函数体内都是有定义的。</p>

<pre><code class="language-javascript">    var a = function test(o){
        var i = 0;                          // i在整个函数体内均是有定义的
        if(typeof o == &quot;object&quot;){
            var j = 4;                      // j在函数体内是有定义的，不仅仅是在这个代码段内
            for(var k=0; k &lt; 3; k++){       // k在函数体内是有定义的，不仅仅是在循环内
                console.log(k);             // 输出数字0～2
            }
            console.log(k);                 // k已经定义了，输出3
        }
        console.log(k);                     // k已经定义了，输出3
        console.log(j);                     // j已经定义了，输出4
    };
</code></pre>

<p>JavaScript的这个特性被非正式地称为声明提前（hoisting），即JavaScript函数里声明的所有变量（但不涉及赋值）都被“提前”至函数体的顶部。</p>

<pre><code class="language-javascript">    var a = &#39;1&#39;;
    function f(){
        console.log(a);
        var a = &#39;2&#39;;
        console.log(a);
    }
</code></pre>

<p>由于函数作用域的特性，变量a的声明被提前到了整个函数体最前面，声明了但是没赋值，所以第一次console是undefined。执行到var语句时才被赋值，这应该也是为什么可以一个变量多次var生命的愿意，后面每一次var都只是起到了赋值的作用。</p>

<h2 id="toc_1">ES6块作用域</h2>

<p>ES6弥补了这这个概念，追加了let和const，也就有了{}块作用域的概念，let和const的区别就不提了，这个在工作中经常用到，用上面的例子感受一下let和var的区别。</p>

<pre><code class="language-javascript">    var a = function test(o){
        var i = 0;                          // i在整个函数体内均是有定义的
        if(typeof o == &quot;object&quot;){
            let j = 4;                      // j在if块内是有定义的
            for(var k=0; k &lt; 3; k++){       // k在函数体内是有定义的，不仅仅是在循环内
                console.log(k);             // 输出数字0～2
                console.log(j);             // j已经定义了，输出4
            }
            console.log(k);                 // k已经定义了，输出3
        }
        console.log(k);                     // k已经定义了，输出3
        console.log(j);                     // j在块外，抛出异常Uncaught ReferenceError: j is not defined
    };
</code></pre>

<p>let和const只有在块内是被声明的。</p>

<h2 id="toc_2">全局变量的本质</h2>

<p>当声明一个JavaScript全局变量时，实际上是定义了全局对象的一个属性。当使用var声明一个变量时，创建的这个属性是不可配置的，无法通过delete运算符删除。</p>

<pre><code class="language-javascript">    test =1
    // 1
    window.test
    // 1
    delete test
    // true
    window.test
    // undefined
    var test = 1
    // undefined
    window.test
    // 1
    delete test
    // false
    window.test
    // 1
</code></pre>

<p>可以看到当定义一个全局变量的时候他变成了window的属性。<br/>
JavaScript可以允许使用this关键字来引用全局对象，但是不能引用局部变量中存放的对象。</p>

<pre><code class="language-javascript">    this.test
    // 1
</code></pre>

<h2 id="toc_3">深入理解undefined的本质</h2>

<p>undefined明明是个变量为什么赋值后无法使用呢。任何地方都可以直接使用undefined，那他是一个全局变量一个全局的属性，事实也果然如此。</p>

<pre><code class="language-javascript">    window.undefined == undefined
    // true
</code></pre>

<p>而属性分两类，他们的特征如下：</p>

<ul>
<li>数据属性
<ul>
<li>value：就是属性的值。</li>
<li>writable：决定属性是否能被赋值。</li>
<li>enumerable：决定for in 能否枚举该属性。</li>
<li>configurable：决定该属性能否被删除或者改变特征值。</li>
</ul></li>
<li>访问器属性（getter/setter）
<ul>
<li>getter：函数或undefined，在取属性值时被调用。</li>
<li>setter：函数或undefined，在设置属性值时被调用。</li>
<li>enumerable：决定for in 能否枚举该属性。</li>
<li>configurable：决定该属性能否被删除或者改变特征值。<br/>
查看下全局属性undefined的属性特征。</li>
</ul></li>
</ul>

<pre><code class="language-javascript">    console.log(Object.getOwnPropertyDescriptor(window,&#39;undefined&#39;));
    // configurable: false
    // enumerable: false
    // value: undefined
    // writable: false
</code></pre>

<p>writable：false，就是这个原因undefined虽然是个全局变量，但是我们赋值之后他并没有被改变。那为什么还需要用void(0)来代替undefined呢？结合上面的函数作用域再做一个实验。</p>

<pre><code class="language-javascript">    function test() {
        var undefined = 100; 
        console.log(undefined);
        var obj = {a : undefined}; 
        console.log(Object.getOwnPropertyDescriptor(obj,&#39;a&#39;));
    }
    test();
    // 100
    // configurable: true
    // enumerable: true
    // value: 100
    // writable: true
</code></pre>

<p>在函数作用域中，undefined被从声明并赋值为100，无论是直接console它自己还是去查看undefined属性特性都能看出，undefined变量被修改了。这也就说在作用域内undefined可以被修改。</p>

<pre><code class="language-javascript">    function test() {
        const undefined = 100; 
        console.log(undefined);
        const obj = {a : undefined}; 
        console.log(Object.getOwnPropertyDescriptor(obj,&#39;a&#39;));
        test();
    }
    // 100
    // configurable: true
    // enumerable: true
    // value: 100
    // writable: true
</code></pre>

<p>块作用域内也一样可以被修改，得出结论undefined是一个类似var声明一样可以被重复声明的全局属性，而他的属性特性writable是false，所以不能被修改，但是在非全局作用域内，他是可以被篡改的，这是由也就要注意用void (0)来替代undefined。</p>

<h2 id="toc_4">作用域链</h2>

<p>以书中的角度用对象属性去看作用域链：</p>

<ul>
<li>JavaScript最顶层的代码，其作用域链只有一个全局对象。</li>
</ul>

<table>
    <tr>
        <th colspan=2>Scope chain</th>
    </tr>
    <tr>
        <td>0</td><td>Global object</td>
    <tr>
</table>

<ul>
<li>不包含嵌套的函数，其作用域两个对象：函数自身的变量对象和全局对象。</li>
</ul>

<table>
    <tr>
        <th colspan=2>Scope chain</th>
    </tr>
    <tr>
        <td>0</td><td>Activation object</td>
    <tr>
    <tr>
        <td>1</td><td>Global object</td>
    <tr>
</table>

<blockquote>
<p>活动对象(activation object)，该对象包含了函数的所有局部变量、命名参数、参数集合以及this，然后此对象会被推入作用域链的前端</p>
</blockquote>

<ul>
<li>对于包含了嵌套函数的函数，其作用域包含至少三个对象：自身的变量对象，外层的变量对象（将自身嵌套的函数），全局变量对象。</li>
</ul>

<table>
    <tr>
        <th colspan=2>Scope chain</th>
    </tr>
    <tr>
        <td>0</td><td>Sub activation object</td>
    <tr>
    <tr>
        <td>1</td><td>Activation object</td>
    <tr>
    <tr>
        <td>2</td><td>Global object</td>
    <tr>
</table>

<p>作用域链给我的感觉类似原型链，将函数的上下文构成了链表的形式,而方法执行时一层一层往外找，所以为了方便链表从上到下查找属性，所以有了声明提前，链表最顶端为嵌套函数的最里层，链表最底端则是全局变量对象。</p>

<pre><code class="language-javascript">    function test(){
        var fun1,fun2;
        for(var i=0;i&lt;2;i++){
            if(i === 0){
                fun1 = function(){console.log(&#39;fun1:i=&#39;+i)};
            }
            if(i === 1){
                fun2 = function(){console.log(&#39;fun2:i=&#39;+i)};
            }
        };
        fun1();
        fun2();
    }∫
    test();
    // fun1:i=2
    // fun2:i=2
</code></pre>

  </div>
</div>
<br /><br />
<hr />
<div class="row clearfix">
  <div class="large-6 columns">
    <div class="text-left" style="padding:15px 0px;">
      
      <a href="16089048368062.html" title="Previous Post: 01 JavaScript Drum Kit 中文指南">&laquo;
        01 JavaScript Drum Kit 中文指南</a>
      
    </div>
  </div>
  <div class="large-6 columns">
    <div class="text-right" style="padding:15px 0px;">
      
      <a href="16084764191221.html" title="Next Post: 努力了三个月的总结">努力了三个月的总结 &raquo;</a>
      
    </div>
  </div>
</div>
<div class="row">
  <div style="padding:0px 0.93em;" class="share-comments">
    
  </div>
</div>
<script type="text/javascript">
  $(function () {
    var currentURL = '16088182648987.html';
    $('#side-nav a').each(function () {
      if ($(this).attr('href') == currentURL) {
        $(this).parent().addClass('active');
      }
    });
  });
</script>  
          </div>
          <div class="large-3 medium-3 columns">
            <div class="hide-for-small">
              <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">
                    
                    <li class="side-title"><span>JavaScript权威指南第七版</span></li>
                    
                    <li>
                      <a title="# 第 8 章 函数" href="16106664265983.html"># 第 8 章 函数</a>
                    </li>
                    
                    
                    <li class="side-title"><span>JavaScript30</span></li>
                    
                    <li>
                      <a title="01 JavaScript Drum Kit" href="16089052254448.html">01 JavaScript Drum Kit</a>
                    </li>
                    
                    <li>
                      <a title="01 JavaScript Drum Kit 中文指南" href="16089048368062.html">01 JavaScript Drum Kit 中文指南</a>
                    </li>
                    
                    
                    <li class="side-title"><span>杂念</span></li>
                    
                    <li>
                      <a title="努力了三个月的总结" href="16084764191221.html">努力了三个月的总结</a>
                    </li>
                    
                    
                    <li class="side-title"><span>JavaScript</span></li>
                    
                    <li>
                      <a title="类型转换" href="16089553577924.html">类型转换</a>
                    </li>
                    
                    <li>
                      <a title="通过变量作用域深入了解undefined" href="16088182648987.html">通过变量作用域深入了解undefined</a>
                    </li>
                    
                    <li>
                      <a title="重新认识下熟悉的浏览器" href="16076922632055.html">重新认识下熟悉的浏览器</a>
                    </li>
                    
                    <li>
                      <a title="JavaScript类型转换" href="16087263047458.html">JavaScript类型转换</a>
                    </li>
                    
                    
                    <li class="side-title"><span>重学前端--学习笔记</span></li>
                    
                    <li>
                      <a title="JavaScript全部的对象分类" href="16085442753431.html">JavaScript全部的对象分类</a>
                    </li>
                    
                    <li>
                      <a title="JavaScript的面向对象" href="16085441443213.html">JavaScript的面向对象</a>
                    </li>
                    
                    <li>
                      <a title="JavaScript中的类型" href="16083847578374.html">JavaScript中的类型</a>
                    </li>
                    
                    <li>
                      <a title="JavaScript原型和原型链" href="16080322533005.html">JavaScript原型和原型链</a>
                    </li>
                    
                    
                    <li class="side-title"><span>Angular</span></li>
                    
                    <li>
                      <a title="angular mock的使用" href="16073237309370.html">angular mock的使用</a>
                    </li>
                    
                    
                    <li class="side-title"><span>英语课</span></li>
                    
                    <li>
                      <a title="chapter 3 Travaling" href="16092359109167.html">chapter 3 Travaling</a>
                    </li>
                    
                    <li>
                      <a title="chapter 2 Dining" href="16089552578971.html">chapter 2 Dining</a>
                    </li>
                    
                    <li>
                      <a title="Chapter 1 Shopping" href="16089552264437.html">Chapter 1 Shopping</a>
                    </li>
                    
                    
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>
        <div class="page-bottom">
          <div class="row">
            <hr />
            <div class="small-9 columns">
              <p class="copyright">Contact Me&nbsp;
                Tel: +86 18641188786,&nbsp;
                mail: 416376663@qq.com</p>
            </div>
            <div class="small-3 columns">
              <p class="copyright text-right"><a href="#top">TOP</a></p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
  <script src="asset/js/foundation.min.js"></script>
  <script src="asset/js/foundation/foundation.offcanvas.js"></script>
  <script>
    $(document).foundation();
  </script>
  
  
  
</body>

</html>