<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    
    TypeScript - 十
    
  </title>
  <meta name="description" content="">
  <link href="atom.xml" rel="alternate" title="十" type="application/atom+xml">
  <link rel="stylesheet" href="asset/css/foundation.min.css" />
  <link rel="stylesheet" href="asset/css/docs.css" />
  <script src="asset/js/vendor/modernizr.js"></script>
  <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>
    hljs.initHighlightingOnLoad();
  </script>
</head>

<body class="antialiased hide-extras">
  <div class="marketing off-canvas-wrap" data-offcanvas>
    <div class="inner-wrap">
      <nav class="top-bar docs-bar hide-for-small" data-topbar>
        <div id="header">
          <h3><a href="index.html">十的对称 十的完美</a></h1>
        </div>
      </nav>
      <nav class="tab-bar show-for-small">
        <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
          <span> &nbsp;</span>
        </a>
        <div id="header">
          <h3><a href="index.html">十的对称 十的完美</a></h1>
        </div>
      </nav>
      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li><a href="index.html">关于我</a></li>
          
          <li class="divider"></li>
          <li><label>HomeAssistant</label></li>
          
          <li><a title="Ubuntu 20.04Lts 安装 HA" href="16201149334405.html">Ubuntu 20.04Lts 安装 HA</a></li>
          
          <li><a title="Windows10 安装 HomeAssistant" href="16200327308578.html">Windows10 安装 HomeAssistant</a></li>
          
          
          <li class="divider"></li>
          <li><label>TypeScript</label></li>
          
          <li><a title="TypeScript" href="16203819997302.html">TypeScript</a></li>
          
          
          <li class="divider"></li>
          <li><label>Angular</label></li>
          
          <li><a title="Angular 中 RXJS 的应用" href="16178761821381.html">Angular 中 RXJS 的应用</a></li>
          
          <li><a title="ng-fundamentals 基础内容查缺补漏" href="16175910817779.html">ng-fundamentals 基础内容查缺补漏</a></li>
          
          <li><a title="Angular 中的 DI" href="16166681233612.html">Angular 中的 DI</a></li>
          
          <li><a title="Angular 变更检测——它到底是如何工作的？" href="16164996860696.html">Angular 变更检测——它到底是如何工作的？</a></li>
          
          
          <li class="divider"></li>
          <li><label>JavaScript</label></li>
          
          <li><a title="States and Fates" href="16129618605374.html">States and Fates</a></li>
          
          <li><a title="JavaScript 深浅拷贝" href="16124460113427.html">JavaScript 深浅拷贝</a></li>
          
          <li><a title="通过函数声明和调用掌握函数的 this 值" href="16107633205948.html">通过函数声明和调用掌握函数的 this 值</a></li>
          
          <li><a title="通过变量作用域深入了解 undefined" href="16088182648987.html">通过变量作用域深入了解 undefined</a></li>
          
          <li><a title="JavaScript 原型和原型链" href="16080322533005.html">JavaScript 原型和原型链</a></li>
          
          
          <li class="divider"></li>
          <li><label>JavaScript权威指南第七版</label></li>
          
          <li><a title="第 6 章 对象" href="16113218396407.html">第 6 章 对象</a></li>
          
          <li><a title="第 7 章 数组" href="16124375850406.html">第 7 章 数组</a></li>
          
          <li><a title="第 8 章 函数" href="16106664265983.html">第 8 章 函数</a></li>
          
          <li><a title="第 9 章 类" href="16118386693796.html">第 9 章 类</a></li>
          
          <li><a title="第 10 章 模块" href="16130963383709.html">第 10 章 模块</a></li>
          
          <li><a title="第 12 章 迭代器和生成器" href="16135261093456.html">第 12 章 迭代器和生成器</a></li>
          
          <li><a title="第 13 章 异步 JavaScript" href="16130963623880.html">第 13 章 异步 JavaScript</a></li>
          
          
        </ul>
      </aside>
      <a class="exit-off-canvas" href="#"></a>
      <section id="main-content" role="main" class="scroll-container">
        <div class="row">
          <div class="large-9 medium-9 columns">
  <div class="markdown-body">
  <div class="markdown-inside">
    <h1>TypeScript</h1>
    <time class="article-date" datetime="2021-05-07T18:06:39+08:00">发布于2021/05/07</time>
    <h2 id="toc_0">TypeScript 基础</h2>

<h3 id="toc_1">函数签名和重载 Signature Overloading</h3>

<pre><code class="language-typescript">function contactPeople(method: &quot;email&quot;, ...people: HasEmail[]): void;
function contactPeople(method: &quot;phone&quot;, ...people: HasPhoneNumber[]): void;
function contactPeople(method: &quot;email&quot; | &quot;phone&quot;, ...people: (HasEmail | HasPhoneNumber)[]): void {
}
</code></pre>

<h3 id="toc_2">词法作用域 Lexical Scope</h3>

<h4 id="toc_3">TODO</h4>

<h2 id="toc_4">Interfaces 和 type aliases</h2>

<h4 id="toc_5">TODO</h4>

<h2 id="toc_6">泛型 Generics</h2>

<h3 id="toc_7">泛型使用</h3>

<pre><code class="language-typescript">interface WrappedValue&lt;T&gt; {
  value: T;
}
let val: WrappedValue&lt;string[]&gt; = { value: [] };
val.value;
</code></pre>

<p>鼠标悬停在 <code>val.value</code> 的 <code>value</code> 上可以看到：</p>

<blockquote>
<p>(property) WrappedValue<string[]>.value: string[]</p>
</blockquote>

<p>在各种类库的描述文件中也经常能够看到泛型的应用：</p>

<pre><code class="language-typescript">interface MapLike&lt;T&gt; {
    [index: string]: T;
}
interface SortedReadonlyArray&lt;T&gt; extends ReadonlyArray&lt;T&gt; {
    &quot; __sortedArrayBrand&quot;: any;
}
interface SortedArray&lt;T&gt; extends Array&lt;T&gt; {
    &quot; __sortedArrayBrand&quot;: any;
}
</code></pre>

<h3 id="toc_8">泛型参数</h3>

<p>上述方式在使用 WrappedValue 时必须添加泛型参数，如果不添加使用会报错：</p>

<blockquote>
<p>Generic type &#39;WrappedValue<T>&#39; requires 1 type argument(s).</p>
</blockquote>

<p>这里可以看到 WrappedValue 需要一个实参，那么我们也可以为其设置参数默认值，就可以不提供类型参数也能使用 WrappedValue：</p>

<pre><code class="language-typescript">interface WrappedValue&lt;T = any&gt; {
  value: T;
}
let val: WrappedValue = { value: [] };
val.value;
</code></pre>

<p>下面是一个常用的泛型做参数的情况：</p>

<pre><code class="language-typescript">function resolveOrTimeout&lt;T&gt;(promise: Promise&lt;T&gt;, timeout: number): Promise&lt;T&gt; { // =&gt; 1
  return new Promise&lt;T&gt;((resolve, reject) =&gt; { // =&gt; 2
    // start the timeout, reject when it triggers
    const task = setTimeout(() =&gt; reject(&quot;time up!&quot;), timeout); // =&gt; 3

    promise.then(val =&gt; {
      // cancel the timeout
      clearTimeout(task); // =&gt; 4                                    

      // resolve with the value // =&gt; 5
      resolve(val);                                            
    });
  });
}
</code></pre>

<ol>
<li>泛型 T 设定后，会传递一个类型为 Promise&lt;T&gt; 名为 promise 的参数。</li>
<li>这个方法返回一个类型为 Promise&lt;T&gt; 的新 Promise。</li>
<li>根据 timeout 时间设置定时，如果时间到了，执行 callback，也就是新创建的 Promise 将 rejected。</li>
<li>如果 timeout 设定的时间没终止，传入的参数 promise 提前 fulfilled，那么直接清除延时。</li>
<li>将 fulfilled 的值 resolve 到新创建的 Promise 中。</li>
</ol>

<p>这是一个典型的 Http 请求超时的解决方案。</p>

<h3 id="toc_9">约束和作用域 Constraints Scope</h3>

<p>可以通过 extends 来约束泛型：</p>

<pre><code class="language-typescript">function arrayToDict&lt;T extends { id: string }&gt;(array: T[]): { [k: string]: T } {
  const out: { [k: string]: T } = {};
  array.forEach(val =&gt; {
    out[val.id] = val;
  });
  return out;
}
</code></pre>

<p>如果用以下代码将不带有 id 属性对象的数组作为 arrayToDict 的参数：</p>

<pre><code class="language-typescript">const myDict = arrayToDict([
  { foo: &quot;foo&quot; }
]);
</code></pre>

<p>就会出现以下错误：</p>

<blockquote>
<p>Type &#39;{ foo: string; }&#39; is not assignable to type &#39;{ id: string; }&#39;.<br/>
  Object literal may only specify known properties, and &#39;foo&#39; does not exist in type &#39;{ id: string; }&#39;.</p>
</blockquote>

<p>这里限制了泛型 T 内必须有 string 类型的 id 属性，所以我们可以使用 <code>val.id</code>。如果将约束 <code>extends { id: string }</code> 删除，就会看到 <code>val.id</code> 出现下面的错误：</p>

<blockquote>
<p>Property &#39;id&#39; does not exist on type &#39;T&#39;.</p>
</blockquote>

<p>泛型类似参数，同样享有函数参数同样的作用域，也可以应用在闭包中：</p>

<pre><code class="language-typescript">function firstTuple&lt;T&gt;(firstElement: T) {
  return function finishTuple&lt;U&gt;(b: U) {
    return [a, b] as [T, U];
  };
}
const myTuple = startTuple([&quot;first&quot;])(42);
</code></pre>

<p>鼠标悬停在 myTuple 上可以看到该元组的类型：</p>

<blockquote>
<p><strong>const</strong> myTuple: [string[], number]</p>
</blockquote>

<h3 id="toc_10">泛型的使用</h3>

<p>泛型只有在 input 和 output 同时需要时才使用，下面是一个没有必要用泛型的例子：</p>

<pre><code class="language-typescript">interface Shape {
  draw();
}

interface Circle extends Shape {
  radius: number;
}

function drawShapes1&lt;S extends Shape&gt;(shapes: S[]) {
  shapes.forEach(s =&gt; s.draw());
}

function drawShapes2(shapes: Shape[]) {
  // this is simpler. Above type param is not necessary
  shapes.forEach(s =&gt; s.draw());
}
</code></pre>

<p>方法 2 和方法 1 起到了同样的效果，但是输出不再需要泛型。</p>

<p>但是如果有这样一个需求，Shape 中不但有 draw 方法，还有是否已经绘制的 Flag，并且我要在绘制之后将 Shape 对象返回，就可以使用泛型：</p>

<pre><code class="language-typescript">interface Shape {
  draw();
  isDrawn: boolean;
}

interface Circle extends Shape {
  radius: number;
}

function drawShapes&lt;S extends Shape&gt;(shapes: S[]): S[] {
  return shapes.map(s =&gt; {
    s.draw;
    s.isDrawn = true;
    return s;
  })
}
</code></pre>

<h2 id="toc_11">顶层类型和底层类型</h2>

<h3 id="toc_12">Top Types</h3>

<ul>
<li>any</li>
<li>unknow</li>
</ul>

<p>顶层类型可以接收任何类型的值。</p>

<p>unknow 在不确定类型时无法获取它的值。</p>

<pre><code class="language-typescript">let myUnknown: unknown = &quot;hello, unknown&quot;;

if (typeof myUnknown === &quot;string&quot;) {
  // in here, myUnknown is of type string
  myUnknown.split(&quot;, &quot;); // 
}
if (myUnknown instanceof Promise) {
  // in here, myUnknown is of type Promise&lt;any&gt;
  myUnknown.then(x =&gt; console.log(x));
}
</code></pre>

<blockquote>
<p>typeof 在判断 null、array、object 时都是 object，需要用 instanceof 来判断原型链。</p>
</blockquote>

<h3 id="toc_13">Type Guards</h3>

<p>TypeScript 的类型判断自上而下进行，无法反向推断类型，比如函数的参数，如果没有定义类型，即使在后面赋值 string，参数类型仍然是 any。</p>

<p>可以用以下方式确认复杂类型：</p>

<pre><code class="language-typescript">function isHasEmail(x: any): x is HasEmail {
  return typeof x.name === &quot;string&quot; &amp;&amp; typeof x.email === &quot;string&quot;;
}
if (isHasEmail(myUnknown)) {
  // In here, myUnknown is of type HasEmail
  console.log(myUnknown.name, myUnknown.email);
}
</code></pre>

<p>同理利用泛型有了下面这种通用的类型守卫：</p>

<pre><code class="language-typescript">function isDefined&lt;T&gt;(arg: T | undefined): arg is T {
  return typeof arg !== &quot;undefined&quot;;
}
</code></pre>

<h3 id="toc_14">Branded Types</h3>

<h4 id="toc_15">TODO</h4>

<h3 id="toc_16">Bottom Types</h3>

<p>never 个人感觉没啥用。</p>

<h2 id="toc_17">高级类型</h2>

<h3 id="toc_18">keyof 和 typeof</h3>

<p>typeof 是 JavaScript 就有的特性。</p>

<p>keyof 可以直接获取接口的属性名。</p>

<p>接口也可以用属性表达式来获取对应属性的类型。</p>

<pre><code class="language-typescript">interface CommunicationMethods {
  email: HasEmail;
  phone: HasPhoneNumber;
  fax: { fax: number };
}

function contact&lt;K extends keyof CommunicationMethods&gt;(
  method: K,
  contact: CommunicationMethods[K] // 💡turning key into value -- a *mapped type*
) {
  //...
}
type AllType = keyof CommunicationMethods;
let x: AllType = &#39;email&#39;;
type Email = CommunicationMethods[&#39;email&#39;];
</code></pre>

<h3 id="toc_19">Built-In 类型</h3>

<h4 id="toc_20">Partial</h4>

<pre><code class="language-typescript">/**
 * Make all properties in T optional
 */
type Partial&lt;T&gt; = {
    [P in keyof T]?: T[P];
};
</code></pre>

<p>返回新的类型，并且所有的参数都是可选项。</p>

<h4 id="toc_21">Pick</h4>

<pre><code class="language-typescript">type HasThen&lt;T&gt; = Pick&lt;Promise&lt;T&gt;, &quot;then&quot; | &quot;catch&quot;&gt;;

let hasThen: HasThen&lt;number&gt; = Promise.resolve(4);
hasThen.then;
</code></pre>

<p>返回一个类型，指定允许访问的属性。</p>

<h4 id="toc_22">Extract</h4>

<h4 id="toc_23">Exclude</h4>

<h4 id="toc_24">Record</h4>

  </div>
</div>
<br /><br />
<hr />
<div class="row clearfix">
  <div class="large-6 columns">
    <div class="text-left" style="padding:15px 0px;">
      
    </div>
  </div>
  <div class="large-6 columns">
    <div class="text-right" style="padding:15px 0px;">
      
      <a href="16201149334405.html" title="Next Post: Ubuntu 20.04Lts 安装 HA">Ubuntu 20.04Lts 安装 HA &raquo;</a>
      
    </div>
  </div>
</div>
<div class="row">
  <div style="padding:0px 0.93em;" class="share-comments">
    
  </div>
</div>
<script type="text/javascript">
  $(function () {
    var currentURL = '16203819997302.html';
    $('#side-nav a').each(function () {
      if ($(this).attr('href') == currentURL) {
        $(this).parent().addClass('active');
      }
    });
  });
</script>  
          </div>
          <div class="large-3 medium-3 columns">
            <div class="hide-for-small">
              <div class="sidebar">
                <nav>
                  <ul id="side-nav" class="side-nav">
                    
                    <li class="side-title"><span>HomeAssistant</span></li>
                    
                    <li>
                      <a title="Ubuntu 20.04Lts 安装 HA" href="16201149334405.html">Ubuntu 20.04Lts 安装 HA</a>
                    </li>
                    
                    <li>
                      <a title="Windows10 安装 HomeAssistant" href="16200327308578.html">Windows10 安装 HomeAssistant</a>
                    </li>
                    
                    
                    <li class="side-title"><span>TypeScript</span></li>
                    
                    <li>
                      <a title="TypeScript" href="16203819997302.html">TypeScript</a>
                    </li>
                    
                    
                    <li class="side-title"><span>Angular</span></li>
                    
                    <li>
                      <a title="Angular 中 RXJS 的应用" href="16178761821381.html">Angular 中 RXJS 的应用</a>
                    </li>
                    
                    <li>
                      <a title="ng-fundamentals 基础内容查缺补漏" href="16175910817779.html">ng-fundamentals 基础内容查缺补漏</a>
                    </li>
                    
                    <li>
                      <a title="Angular 中的 DI" href="16166681233612.html">Angular 中的 DI</a>
                    </li>
                    
                    <li>
                      <a title="Angular 变更检测——它到底是如何工作的？" href="16164996860696.html">Angular 变更检测——它到底是如何工作的？</a>
                    </li>
                    
                    
                    <li class="side-title"><span>JavaScript</span></li>
                    
                    <li>
                      <a title="States and Fates" href="16129618605374.html">States and Fates</a>
                    </li>
                    
                    <li>
                      <a title="JavaScript 深浅拷贝" href="16124460113427.html">JavaScript 深浅拷贝</a>
                    </li>
                    
                    <li>
                      <a title="通过函数声明和调用掌握函数的 this 值" href="16107633205948.html">通过函数声明和调用掌握函数的 this 值</a>
                    </li>
                    
                    <li>
                      <a title="通过变量作用域深入了解 undefined" href="16088182648987.html">通过变量作用域深入了解 undefined</a>
                    </li>
                    
                    <li>
                      <a title="JavaScript 原型和原型链" href="16080322533005.html">JavaScript 原型和原型链</a>
                    </li>
                    
                    
                    <li class="side-title"><span>JavaScript权威指南第七版</span></li>
                    
                    <li>
                      <a title="第 6 章 对象" href="16113218396407.html">第 6 章 对象</a>
                    </li>
                    
                    <li>
                      <a title="第 7 章 数组" href="16124375850406.html">第 7 章 数组</a>
                    </li>
                    
                    <li>
                      <a title="第 8 章 函数" href="16106664265983.html">第 8 章 函数</a>
                    </li>
                    
                    <li>
                      <a title="第 9 章 类" href="16118386693796.html">第 9 章 类</a>
                    </li>
                    
                    <li>
                      <a title="第 10 章 模块" href="16130963383709.html">第 10 章 模块</a>
                    </li>
                    
                    <li>
                      <a title="第 12 章 迭代器和生成器" href="16135261093456.html">第 12 章 迭代器和生成器</a>
                    </li>
                    
                    <li>
                      <a title="第 13 章 异步 JavaScript" href="16130963623880.html">第 13 章 异步 JavaScript</a>
                    </li>
                    
                    
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>
        <div class="page-bottom">
          <div class="row">
            <hr />
            <div class="small-9 columns">
              <p class="copyright">Contact Me&nbsp;
                Tel: +86 18641188786,&nbsp;
                mail: li.tw.ten@gmail.com</p>
            </div>
            <div class="small-3 columns">
              <p class="copyright text-right"><a href="#top">TOP</a></p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
  <script src="asset/js/foundation.min.js"></script>
  <script src="asset/js/foundation/foundation.offcanvas.js"></script>
  <script>
    $(document).foundation();
  </script>
  
  
  
</body>

</html>